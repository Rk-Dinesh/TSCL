import{i as I,r as h,j as e,b as D,A as q,B as b}from"./index-Ck5knsAu.js";const T=()=>{const k=sessionStorage.getItem("token"),N=I(),[g,y]=h.useState(""),[n,v]=h.useState([]),[u,w]=h.useState(""),[c,x]=h.useState([]),[r,C]=h.useState([{name:"Dashboard",value:"dashboard",checked:!1},{name:"Organization",value:"organization",checked:!1},{name:"Department",value:"department",checked:!1},{name:"Zone",value:"zone",checked:!1},{name:"Ward",value:"ward",checked:!1},{name:"Street",value:"street",checked:!1},{name:"Complaint",value:"complaint",checked:!1},{name:"Complaint Type",value:"complainttype",checked:!1},{name:"AdminUser",value:"admin",checked:!1},{name:"PublicUser",value:"user",checked:!1},{name:"Setting",value:"setting",checked:!1},{name:"Status",value:"status",checked:!1}]),[m,P]=h.useState({roleName:"",featurePermissions:"",grievancePermissions:""}),A=a=>{y(a.target.value)},S=a=>{const s=[...r];s[a].checked=!s[a].checked,s[a].checked?v([...n,{feature:s[a].value,permissions:[]}]):v(n.filter(t=>t.feature!==s[a].value)),C(s)},p=(a,s)=>{const t=[...n],l=t.findIndex(d=>d.feature===r[a].value);t[l].permissions.includes(s)?t[l].permissions=t[l].permissions.filter(d=>d!==s):t[l].permissions.push(s),v(t)},E=a=>{const s=[...n],t=s.findIndex(l=>l.feature===r[a].value);s[t].permissions.length===4?s[t].permissions=[]:s[t].permissions=["view","create","edit","delete"],v(s)},L=a=>{w(a.target.value),x([])},f=a=>{c.includes(a)?x(c.filter(s=>s!==a)):x([...c,a])},R=()=>{c.length===4?x([]):x(["view","create","edit","delete"])},G=async a=>{a.preventDefault();let s=!0;const t={roleName:"",featurePermissions:"",grievancePermissions:""};if(g.trim()===""&&(t.roleName="Role name is required.",s=!1),n.forEach(i=>{i.permissions.length===0&&(t.featurePermissions="Please select at least one permission for each selected feature.",s=!1)}),u!==""&&c.length===0&&(t.grievancePermissions="Please select at least one permission for the selected grievance type.",s=!1),P(t),!s)return;const l=[...n];u&&l.push({feature:u,permissions:c});const d={role_name:g,accessLevels:l,status:"active",created_by_user:"admin"};try{const i=await D.post(`${q}/role/post`,d,{headers:{Authorization:`Bearer ${k}`}});i.status===200?(b.success("Role created Successfully"),N("/setting")):(console.error("Error in posting data",i),b.error("Failed to Upload"))}catch(i){console.error("Error in posting data",i)}};return e.jsx("div",{className:"md:mx-6 mx-1 my-3 font-lexend overflow-y-auto no-scrollbar bg-white rounded-lg",children:e.jsx("div",{className:"px-6 py-6 overflow-auto no-scrollbar",children:e.jsxs("form",{onSubmit:G,children:[e.jsxs("div",{className:"flex gap-6 text-base items-center ",children:[e.jsx("label",{children:"Role Name:"}),e.jsx("input",{type:"text",value:g,onChange:A,className:"w-80 text-start border  rounded-lg ml-2 px-3 py-1 outline-none"})]}),m.roleName&&e.jsx("p",{className:"error mt-3 text-red-500",children:m.roleName}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"mt-6 mb-3 text-base ",children:"Access Levels:"}),r.map((a,s)=>{var t,l,d,i,j;return e.jsxs("div",{className:"md:grid md:grid-cols-3 mb-3 text-base ",children:[e.jsxs("div",{className:"col-span-1 flex gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.checked,onChange:()=>S(s)}),e.jsx("label",{children:a.name})]}),a.checked&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 ",children:[e.jsx("label",{className:"mx-4 md:text-base text-sm ",children:"Permissions:"}),e.jsx("input",{type:"checkbox",value:"view",checked:((t=n.find(o=>o.feature===r[s].value))==null?void 0:t.permissions.includes("view"))||!1,onChange:()=>p(s,"view")}),e.jsx("label",{className:"text-sm",children:"View"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:"create",checked:((l=n.find(o=>o.feature===r[s].value))==null?void 0:l.permissions.includes("create"))||!1,onChange:()=>p(s,"create")}),e.jsx("label",{children:"Create"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:"edit",checked:((d=n.find(o=>o.feature===r[s].value))==null?void 0:d.permissions.includes("edit"))||!1,onChange:()=>p(s,"edit")}),e.jsx("label",{children:"Edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:"delete",checked:((i=n.find(o=>o.feature===r[s].value))==null?void 0:i.permissions.includes("delete"))||!1,onChange:()=>p(s,"delete")}),e.jsx("label",{children:"Delete"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:"all",checked:((j=n.find(o=>o.feature===r[s].value))==null?void 0:j.permissions.length)===4||!1,onChange:()=>E(s)}),e.jsx("label",{children:"All"})]})]})]},s)}),m.featurePermissions&&e.jsx("p",{className:"error text-center text-red-500 ",children:m.featurePermissions})]}),e.jsxs("div",{className:"md:grid md:grid-cols-3 my-8",children:[e.jsxs("div",{className:"flex gap-3 items-center col-span-1",children:[e.jsx("h3",{className:" text-base ",children:"Grievance "}),e.jsxs("select",{value:u,onChange:L,className:"block   px-4 py-1.5  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",children:[e.jsx("option",{value:"",children:"Select Grievance Type"}),e.jsx("option",{value:"grievance",children:"Super Admin"}),e.jsx("option",{value:"viewrequest1",children:"Commissioner"}),e.jsx("option",{value:"requestview2",children:"Department Head"}),e.jsx("option",{value:"requestview3",children:"Junior Engineer"}),e.jsx("option",{value:"requestview1",children:"Operator"})]})]}),e.jsx("div",{children:u&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"mx-4  text-base",children:"Permissions:"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:"view",checked:c.includes("view"),onChange:()=>f("view")}),e.jsx("label",{children:"View"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:"create",checked:c.includes("create"),onChange:()=>f("create")}),e.jsx("label",{children:"Create"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:"edit",checked:c.includes("edit"),onChange:()=>f("edit")}),e.jsx("label",{children:"Edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:"delete",checked:c.includes("delete"),onChange:()=>f("delete")}),e.jsx("label",{children:"Delete"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:"all",checked:c.length===4,onChange:R}),e.jsx("label",{children:"All"})]})]})})]}),m.grievancePermissions&&e.jsx("p",{className:"error text-center text-red-500",children:m.grievancePermissions}),e.jsx("div",{className:"flex justify-center mt-3",children:e.jsx("button",{className:"text-center px-3 py-1.5 bg-primary text-white rounded-full",type:"submit",children:"Save Role Access Level"})})]})})})};export{T as default};
