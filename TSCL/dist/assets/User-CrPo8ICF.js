import{i as H,k as h,m as Y,o as G,j as e,b as _,A as w,B as j,r as l,d as J,x as ye,D as Ne,y as ve,q as I,v as _e,w as we,E as Pe,z as Se}from"./index-tsgvEHmX.js";import{S as K}from"./SavaCancel-r2kPCP2i.js";import{D as ke}from"./DeleteModal-DJp1pd7G.js";import{F as De,B as Ue}from"./FileUploadButton-C5ckz8lU.js";const Ie=H().shape({public_user_name:h().trim().required("User Name is required"),phone:h().test("len","Phone Number must be 10 characters",s=>s.length===10).required("Phone Number is required"),email:h().email("Invalid Email Id").required("Email Id is required"),address:h().required("Address is required"),pincode:h().test("len","Pincode must be 6 characters",s=>s.length===6).required("Pincode is required")}),Ce=s=>{const{register:o,formState:{errors:r},handleSubmit:p,setValue:m,watch:P}=Y({resolver:G(Ie),mode:"all"}),x=async S=>{const y={...S,login_password:"tscl@123",user_status:"active",verification_status:"active"},N=localStorage.getItem("token");try{const d=await _.post(`${w}/public-user/post`,y,{headers:{Authorization:`Bearer ${N}`}});d.status===200?(j.success("Public User created Successfully"),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",d),j.error("Failed to Upload"))}catch(d){console.error("Error in posting data",d)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsx("div",{className:"bg-white w-fit h-fit  font-lexend m-2",children:e.jsxs("form",{onSubmit:p(x),children:[e.jsxs("div",{className:"border-b-2 border-gray-300 mx-10 my-5",children:[e.jsxs("div",{className:" grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 col-span-1 whitespace-nowrap",htmlFor:"public_user_name",children:"Name"}),e.jsx("input",{type:"text",id:"public_user_name",className:"mx-2 font-lexend px-2 text-sm text-end outline-none col-span-2",placeholder:"User Name",...o("public_user_name")})]}),r.public_user_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.public_user_name.message})]}),e.jsxs("div",{className:" flex flex-col gap-3 mx-10 my-1 ",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"Phone",children:"Phone :"}),e.jsx("input",{type:"text",id:"phone",className:"w-6/5 text-end outline-none col-span-2",placeholder:"Phone Number",...o("phone")})]}),r.phone&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.phone.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"email",children:"Email Id :"}),e.jsx("input",{type:"email",id:"email",className:" text-end outline-none col-span-2",placeholder:"abc@gmail.com",...o("email")})]}),r.email&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.email.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"address",children:"Address :"}),e.jsx("input",{type:"text",id:"address",className:" text-end outline-none col-span-2",placeholder:"Address",...o("address")})]}),r.address&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.address.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"pincode",children:"Pincode :"}),e.jsx("input",{type:"text",id:"pincode",className:" text-end outline-none col-span-2",placeholder:"Pincode ",...o("pincode")})]}),r.pincode&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.pincode.message})]})]}),e.jsx("div",{className:"py-6",children:e.jsx(K,{onCancel:s.toggleModal})})]})})})},Ee=H().shape({public_user_name:h().required("User Name is required"),address:h().required("Address is required"),pincode:h().required("Pincode is required"),user_status:h().test("not-select","Please select an Status",s=>s!==""&&s!=="Status")}),Ae=s=>{const{userId:o}=s,r=localStorage.getItem("token"),{register:p,formState:{errors:m},handleSubmit:P,setValue:x,watch:S}=Y({resolver:G(Ee),mode:"all"});l.useEffect(()=>{(async()=>{try{const d=await _.get(`${w}/public-user/getbyid?public_user_id=${o}`,{headers:{Authorization:`Bearer ${r}`}}),i=J(d.data.data);x("public_user_name",i.public_user_name),x("address",i.address),x("pincode",i.pincode),x("user_status",i.user_status)}catch(d){console.error("Error fetching data",d)}})()},[o,x]);const y=async N=>{const d={...N};try{const i=await _.post(`${w}/public-user/update?public_user_id=${o}`,d,{headers:{Authorization:`Bearer ${r}`}});i.status===200?(j.success("Public User Updated Successfully"),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",i),j.error("Failed to Upload"))}catch(i){console.error("Error in posting data",i)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsx("div",{className:"bg-white w-fit h-fit  font-lexend m-2",children:e.jsxs("form",{onSubmit:P(y),children:[e.jsxs("div",{className:"border-b-2 border-gray-300 mx-10 my-5",children:[e.jsxs("div",{className:" grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 col-span-1 whitespace-nowrap",htmlFor:"public_user_name",children:"Name"}),e.jsx("input",{type:"text",id:"public_user_name",className:"mx-2 font-lexend px-2 text-sm text-end outline-none col-span-2",placeholder:"User Name",...p("public_user_name")})]}),m.public_user_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.public_user_name.message})]}),e.jsxs("div",{className:" flex flex-col gap-3 mx-10 my-1 ",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"address",children:"Address :"}),e.jsx("input",{type:"text",id:"address",className:" text-end outline-none col-span-2",placeholder:"Address",...p("address")})]}),m.address&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.address.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"pincode",children:"Pincode :"}),e.jsx("input",{type:"text",id:"pincode",className:" text-end outline-none col-span-2",placeholder:"Pincode ",...p("pincode")})]}),m.pincode&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.pincode.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:" grid grid-cols-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-2",htmlFor:"user_status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"user_status",...p("user_status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]})]}),m.user_status&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.user_status.message})]})]}),e.jsx("div",{className:"py-6",children:e.jsx(K,{onCancel:s.toggleModal})})]})})})},Fe=`public_user_name,phone,email,address,pincode,login_password,verification_status,user_status,role
user,1234567890,email@gmail.com, Address,123456,password,verified,status,user`,Le=({permissions:s})=>{const o=s==null?void 0:s.includes("create"),r=s==null?void 0:s.includes("edit"),p=s==null?void 0:s.includes("delete"),m=s==null?void 0:s.includes("download"),[P,x]=l.useState(!1),[S,y]=l.useState(!1),[N,d]=l.useState(null),[i,B]=l.useState(!1),[Q,M]=l.useState(null),[C,W]=l.useState(""),[E,X]=l.useState(1),[k]=l.useState(8),[$,Z]=l.useState(1),[Be,ee]=l.useState([]),[v,te]=l.useState([]),[q,se]=l.useState(null),z=localStorage.getItem("token"),[ae,O]=l.useState(null),[L,V]=l.useState("Bulk Upload"),[le,re]=l.useState(null),F=t=>{se(q===t?null:t)},ne=t=>q===t;l.useEffect(()=>{D()},[C,E]);const ce=t=>{t>0&&t<=$&&X(t)},D=()=>{_.get(`${w}/public-user/get`,{headers:{Authorization:`Bearer ${z}`}}).then(t=>{const a=J(t.data.data);te(a);const g=a.filter(c=>Object.values(c).some(n=>n.toString().toLowerCase().includes(C.toLowerCase())));Z(Math.ceil(g.length/k));const u=E*k,f=u-k;ee(g.slice(f,u))}).catch(t=>{console.error(t)})},de=()=>{x(!P)},oe=()=>{y(!S),d(null)},T=()=>{B(!i),M(null)},A=E*k,U=A-k,R=v.filter(t=>Object.values(t).some(a=>a.toString().toLowerCase().includes(C.toLowerCase()))),ie=R.slice().reverse().slice(U,A),me=async()=>{try{await _.delete(`${w}/public-user/delete?public_user_id=${Q}`,{headers:{Authorization:`Bearer ${z}`}}),T(),D(),j.success("Deleted successfully")}catch{j.error("Failed to delete")}},xe=t=>{O(t.target.files[0]),V("Upload")},ue=()=>{L==="Bulk Upload"?document.getElementById("fileInput").click():he(ae)},he=async t=>{try{const a=new FormData;a.append("file",t),(await _.post(`${w}/public-user/uploadcsv`,a,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(V("Bulk Upload"),O(null),D(),j.success("Data Uploaded Successfully")):j.error("Data failed to Upload")}catch(a){console.log(a)}},pe=t=>{re(t.target.value)},ge=async t=>{if(t==="csv"){const a=v.map(n=>({public_user_id:n.public_user_id,public_user_name:n.public_user_name,phone:n.phone,email:n.email,address:n.address,pincode:n.pincode,verification_status:n.verification_status,user_status:n.user_status})),g=[Object.keys(a[0]).join(","),...a.map(n=>Object.values(n).join(","))].join(`
`),u=new Blob([g],{type:"text/csv;charset=utf-8;"}),f=window.URL.createObjectURL(u),c=document.createElement("a");c.setAttribute("href",f),c.setAttribute("download","User_data.csv"),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}else if(t==="pdf")try{const g=Math.ceil(v.length/30),u=new Pe("l","mm","a4");let f=0;for(let c=1;c<=g;c++){const n=(c-1)*30,je=Math.min(n+30,v.length),fe=v.slice(n,je).map(b=>[b.public_user_id,b.public_user_name,b.phone,b.email,b.address,b.pincode,b.verification_status,b.user_status]);u.text(`Page ${c}`,10,f+10),u.autoTable({startY:f+15,head:[["UserId","UserName","Phone","Email","Address","Pincode","VerificationStatus"]],body:fe,theme:"striped"}),c<g&&(u.addPage(),f=10)}u.save("User_data.pdf")}catch(a){console.error("Error exporting data:",a)}},be=()=>{Se(Fe)};return e.jsxs(l.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-2 mx-8 flex-wrap",children:[e.jsx(ye,{value:C,onChange:t=>W(t.target.value),placeholder:"Search User"}),o&&e.jsx(De,{onChange:xe,buttonText:L,accept:".csv",onClick:ue}),m&&e.jsx(Ne,{selectedDoc:le,onChange:pe,exportData:ge})]}),e.jsx(ve,{title:"Public User",hasCreatePermission:o,onClick:()=>x(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-2  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Public Username ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-3  my-2 font-lexend font-semibold whitespace-nowrap",children:["Phone",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Email",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Status",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Verification Status",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsx("div",{className:"mx-3 my-3 font-lexend font-semibold whitespace-nowrap text-center",children:"Action"})})]})}),e.jsx("tbody",{children:ie.map((t,a)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("p",{className:"text-center text-sm mx-1 my-2 font-lexend whitespace-nowrap text-gray-700",children:U+a+1<10?`0${U+a+1}`:U+a+1})}),e.jsx("td",{children:e.jsx("p",{className:" mx-1  my-2 font-lexend whitespace-nowrap text-start text-sm capitalize text-gray-700",children:t.public_user_name})}),e.jsx("td",{children:e.jsx("p",{className:" mx-3  my-2 font-lexend whitespace-nowrap text-start text-sm capitalize text-gray-700",children:t.phone})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1  my-2 font-lexend  whitespace-nowrap capitalize text-gray-700",children:t.email})}),e.jsx("td",{children:e.jsx("p",{className:" mx-2  my-2 font-lexend whitespace-nowrap text-start text-sm capitalize text-gray-700",children:t.user_status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1  my-2 font-lexend whitespace-nowrap text-sm  capitalize text-gray-700",children:t.verification_status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(_e,{onClick:()=>F(a)}),ne(a)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[r&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{y(!0),d(t.public_user_id),F()},children:"Edit"}),p&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{B(!0),M(t.public_user_id),F()},children:"Delete"})]})]})})]},a))})]})})}),e.jsxs("div",{className:" my-2 mb-5 mx-7",children:[e.jsx(Ue,{handleDownload:be}),e.jsx(we,{Length:v.length,currentPage:E,totalPages:$,firstIndex:U,lastIndex:A,paginate:ce,hasNextPage:A>=R.length})]})]})}),P&&e.jsx(Ce,{toggleModal:de,handlerefresh:D}),S&&e.jsx(Ae,{toggleModal:oe,handlerefresh:D,userId:N}),i&&e.jsx(ke,{toggleDeleteModal:T,delete:me})]})};export{Le as default};
