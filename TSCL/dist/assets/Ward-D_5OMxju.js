import{i as ee,k as B,r as n,l as te,o as ae,j as e,b as D,A as C,B as w,d as T,I as Se,F as Q,m as X,n as ke}from"./index-BcYsGqVu.js";import{R as M}from"./index-D7OJULEB.js";import{D as ze}from"./DeleteModal-CGzHCWo0.js";import{P as De,a as Ce}from"./index-1Cs2earB.js";import{a as Pe}from"./index-D_-LWkAi.js";import{E as Ie}from"./jspdf.plugin.autotable-doWDoFvS.js";const Ee=ee().shape({zone_name:B().test("not-select","Please select an Zone",a=>a!==""&&a!=="Select Zone"),ward_name:B().required("ward_name is required")}),Me=a=>{const{ExistingZones:g}=a,[N,v]=n.useState(null),[_,f]=n.useState(null),{register:c,formState:{errors:u},handleSubmit:y,watch:b}=te({resolver:ae(Ee),mode:"all"});n.useEffect(()=>{if(_){const l=g.find(x=>x.zone_name===_);l&&v(l.zone_id)}},[_,g]);const P=async l=>{const x={...l,zone_id:N,status:"active",created_by_user:sessionStorage.getItem("name")};try{const S=sessionStorage.getItem("token"),r=await D.post(`${C}/ward/post`,x,{headers:{Authorization:`Bearer ${S}`}});r.status===200?(w.success("Ward created Successfully"),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",r),w.error("Failed to Upload"))}catch(S){console.error("Error in posting data",S)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Ward"})}),e.jsxs("form",{onSubmit:y(P),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"zone_name",children:"Zone Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"zone_name",...c("zone_name"),onChange:l=>f(l.target.value),children:[e.jsx("option",{value:"",children:"Select Zone"}),g.map(l=>e.jsx("option",{value:l.zone_name,children:l.zone_name},l.zone_id))]}),u.zone_name&&e.jsx("p",{className:"text-red-500",children:u.zone_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"ward_name",children:"Ward Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",type:"text",placeholder:" Ward Name",...c("ward_name")}),u.ward_name&&e.jsx("p",{className:"text-red-500",children:u.ward_name.message})]})]}),e.jsxs("div",{className:"flex justify-end mx-10 gap-5 ",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:a.toggleCloseModal,children:"cancel"}),e.jsx("button",{className:" text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",children:"Save"})]})]})]})})},Ze=ee().shape({zone_name:B().test("not-select","Please select an Zone",a=>a!==""&&a!=="Select Zone"),ward_name:B().required("ward_name is required"),status:B().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),We=a=>{const g=sessionStorage.getItem("token"),{ExistingZones:N,wardId:v}=a,[_,f]=n.useState(null),[c,u]=n.useState(null),{register:y,formState:{errors:b},handleSubmit:P,watch:l,setValue:x}=te({resolver:ae(Ze),mode:"all"});n.useEffect(()=>{(async()=>{try{const p=await D.get(`${C}/ward/getbyid?ward_id=${v}`,{headers:{Authorization:`Bearer ${g}`}}),m=T(p.data.data);u(m.zone_name),x("ward_name",m.ward_name),x("status",m.status),x("zone_name",m.zone_name)}catch(p){console.error("Error fetching data",p)}})()},[v,x]),n.useEffect(()=>{if(c){const r=N.find(p=>p.zone_name===c);r&&f(r.zone_id)}},[c,N]);const S=async r=>{const p={...r,zone_id:_};try{const m=await D.post(`${C}/ward/update?ward_id=${v}`,p,{headers:{Authorization:`Bearer ${g}`}});m.status===200?(w.success("Ward Updated Successfully"),f(null),f(null),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",m),w.error("Failed to Upload"))}catch(m){console.error("Error in posting data",m)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Ward"})}),e.jsxs("form",{onSubmit:P(S),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"zone_name",children:"Zone Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"zone_name",...y("zone_name"),onChange:r=>u(r.target.value),children:[e.jsx("option",{value:c,disabled:!0,children:c}),N.map(r=>e.jsx("option",{value:r.zone_name,children:r.zone_name},r.zone_id))]}),b.zone_name&&e.jsx("p",{className:"text-red-500",children:b.zone_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"ward_name",children:"Ward Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",type:"text",placeholder:" Ward Name",...y("ward_name")}),b.ward_name&&e.jsx("p",{className:"text-red-500",children:b.ward_name.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...y("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),b.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:b.status.message})]})]}),e.jsxs("div",{className:"flex justify-end mx-10 gap-5 ",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:a.toggleModal,children:"cancel"}),e.jsx("button",{className:" text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",children:"Save"})]})]})]})})},$e=`zone_id,zone_name,ward_name,status,created_by_user
Z***,ZoneName,WardName,Status,admin`,Ve=({permissions:a})=>{const g=a==null?void 0:a.includes("create"),N=a==null?void 0:a.includes("edit"),v=a==null?void 0:a.includes("delete"),_=a==null?void 0:a.includes("download"),[f,c]=n.useState(!1),[u,y]=n.useState(!1),[b,P]=n.useState(null),[l,x]=n.useState(!1),[S,r]=n.useState(null),[p,m]=n.useState(null),[F,se]=n.useState(""),[h,ne]=n.useState(1),[I]=n.useState(8),[Z,re]=n.useState(1),[Ae,le]=n.useState([]),[oe,V]=n.useState(null),[q,H]=n.useState("Bulk Upload"),[L,de]=n.useState(null),[k,ce]=n.useState([]),[Y,ie]=n.useState(null),U=sessionStorage.getItem("token"),R=t=>{ie(Y===t?null:t)},xe=t=>Y===t;n.useEffect(()=>{$(),pe()},[F,h,I,U]);const W=t=>{t>0&&t<=Z&&ne(t)},$=async()=>{try{const t=await D.get(`${C}/ward/get`,{headers:{Authorization:`Bearer ${U}`}}),s=T(t.data.data);ce(s);const i=s.filter(o=>Object.values(o).some(d=>d.toString().toLowerCase().includes(F.toLowerCase())));re(Math.ceil(i.length/I));const j=h*I,z=j-I;le(i.slice(z,j))}catch(t){console.error(t)}},me=()=>{c(!f)},he=()=>{y(!u),P(null)},ue=()=>{c(!f)},G=()=>{x(!l),r(null)},pe=async()=>{try{const t=await D.get(`${C}/zone/getactive`,{headers:{Authorization:`Bearer ${U}`}}),s=T(t.data.data);m(s)}catch(t){console.error("Error fetching existing roles:",t)}},O=h*I,A=O-I,J=k.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(F.toLowerCase()))),ge=J.slice(A,O),fe=async()=>{try{await D.delete(`${C}/ward/delete?ward_id=${S}`,{headers:{Authorization:`Bearer ${U}`}}),G(),$(),w.success("Deleted successfully")}catch{w.error("Failed to delete")}},be=t=>{V(t.target.files[0]),H("Upload")},je=()=>{q==="Bulk Upload"?document.getElementById("fileInput").click():ye(oe)},ye=async t=>{try{const s=new FormData;s.append("file",t),(await D.post(`${C}/ward/uploadcsv`,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(H("Bulk Upload"),V(null),$(),w.success("Data Uploaded Successfully")):w.error("Data failed to Upload")}catch(s){console.log(s)}},we=t=>{de(t.target.value)},K=async t=>{if(t==="csv"){const s=k.map(d=>({ward_id:d.ward_id,zone_id:d.zone_id,zone_name:d.zone_name,ward_name:d.ward_name,status:d.status,created_by_user:d.created_by_user})),i=[Object.keys(s[0]).join(","),...s.map(d=>Object.values(d).join(","))].join(`
`),j=new Blob([i],{type:"text/csv;charset=utf-8;"}),z=window.URL.createObjectURL(j),o=document.createElement("a");o.setAttribute("href",z),o.setAttribute("download","Ward_data.csv"),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}else if(t==="pdf")try{const i=Math.ceil(k.length/30),j=new Ie("l","mm","a4");let z=0;for(let o=1;o<=i;o++){const d=(o-1)*30,ve=Math.min(d+30,k.length),_e=k.slice(d,ve).map(E=>[E.ward_id,E.zone_id,E.zone_name,E.ward_name,E.status,E.created_by_user]);j.text(`Page ${o}`,10,z+10),j.autoTable({startY:z+15,head:[["ward_id","zone_id","zone_name","ward_name","Status","createdBy"]],body:_e,theme:"striped"}),o<i&&(j.addPage(),z=10)}j.save("Ward_data.pdf")}catch(s){console.error("Error exporting data:",s)}},Ne=()=>{const t=new Blob([$e],{type:"text/csv"}),s=URL.createObjectURL(t),i=document.createElement("a");i.href=s,i.download="ward_bulkupload_template.csv",i.click(),URL.revokeObjectURL(s)};return e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-3 mx-8 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-white px-3 py-2 rounded-full",children:[e.jsx(Se,{className:"text-xl"}),e.jsx("input",{type:"search",className:"outline-none bg-transparent text-base",placeholder:"Search Ward",value:F,onChange:t=>se(t.target.value)})]}),g&&e.jsxs("div",{className:"relative text-center   hover:text-white py-1.5 rounded-full",children:[e.jsx("input",{type:"file",id:"fileInput",className:"hidden",onChange:be,accept:".csv"}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border-primary border-2 font-normal text-base w-36 py-1.5  rounded-full text-primary hover:text-white hover:bg-primary  ",onClick:je,children:[e.jsx(Q,{}),q]})]}),_&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("form",{children:e.jsxs("select",{className:"block w-full py-2 px-2  text-sm border-2 text-gray-400  border-gray-300 rounded-full bg-gray-50 outline-none",onChange:we,children:[e.jsx("option",{hidden:!0,children:"Download"}),e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"pdf",children:"PDF"})]})}),L===null&&e.jsx(Pe,{className:"text-2xl text-gray-500"}),L==="csv"&&e.jsx(De,{className:"text-3xl text-gray-500",onClick:()=>K("csv")}),L==="pdf"&&e.jsx(Ce,{className:"text-3xl text-gray-500",onClick:()=>K("pdf")})]})]}),e.jsxs("div",{className:"flex justify-between items-center my-2 mx-8 gap-1 flex-wrap",children:[e.jsx("h1",{className:"md:text-xl text-lg font-medium ",children:"Ward"}),g&&e.jsxs("button",{className:"flex flex-row-2 gap-2  font-lexend items-center border-2 bg-blue-500 text-white rounded-full py-2 px-3 justify-between md:text-base text-sm",onClick:()=>c(!0),children:[e.jsx(Q,{})," Add Ward"]})]}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full mt-3 ",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Ward ",e.jsx(M,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Zone ",e.jsx(M,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Status ",e.jsx(M,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedBy ",e.jsx(M,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedAt",e.jsx(M,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["UpdatedAt",e.jsx(M,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-semibold font-lexend",children:"Action"})})]})}),e.jsx("tbody",{children:ge.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-700",children:A+s+1<10?`0${A+s+1}`:A+s+1})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.ward_name})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.zone_name})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2  font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:X(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:X(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(ke,{onClick:()=>R(s)}),xe(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[N&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{y(!0),P(t.ward_id),R()},children:"Edit"}),v&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{x(!0),r(t.ward_id),R()},children:"Delete"})]})]})})]},s))})]})})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"bg-primary px-3 py-2 rounded-full text-white text-sm font-alegerya",onClick:Ne,children:"Bulk Upload Template"})}),e.jsxs("nav",{className:"flex items-center flex-column flex-wrap md:flex-row md:justify-between justify-center pt-4","aria-label":"Table navigation",children:[e.jsxs("span",{className:"text-sm font-normal text-gray-700 mb-4 md:mb-0 block w-full md:inline md:w-auto text-center font-alegerya",children:["Showing"," ",e.jsxs("span",{className:"text-gray-700",children:[A+1," to ",Math.min(O,k.length)]})," ","of ",e.jsxs("span",{className:"text-gray-900",children:[k.length," entries"]})]}),e.jsxs("ul",{className:"inline-flex -space-x-px rtl:space-x-reverse text-sm h-8 font-alegerya",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>W(1),disabled:h===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-s-lg hover:bg-paginate-bg hover:text-primary-hover",children:"<<"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>W(h-1),disabled:h===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Back"})}),Array.from({length:Z},(t,s)=>s+1).slice(Math.max(0,h-2),Math.min(Z,h+1)).map(t=>e.jsx("li",{children:e.jsx("button",{onClick:()=>W(t),className:`flex items-center justify-center px-3 h-8 leading-tight border border-paginate-br hover:text-white hover:bg-primary ${h===t?"bg-primary text-white":"bg-white text-black"}`,children:t})},t)),e.jsx("li",{children:e.jsx("button",{onClick:()=>W(h+1),disabled:O>=J.length,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Next"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>W(Z),disabled:h===Z,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-e-lg hover:bg-paginate-bg hover:text-primary-hover",children:">>"})})]})]})]})]})}),f&&e.jsx(Me,{toggleModal:me,toggleCloseModal:ue,ExistingZones:p,handlerefresh:$}),u&&e.jsx(We,{toggleModal:he,handlerefresh:$,ExistingZones:p,wardId:b}),l&&e.jsx(ze,{toggleDeleteModal:G,delete:fe})]})};export{Ve as default};
