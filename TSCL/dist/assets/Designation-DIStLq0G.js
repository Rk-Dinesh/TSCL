import{i as ae,k as C,l as se,o as ne,j as e,b as y,A as N,B as v,r as n,d as V,I as ke,F as te,p as Ce,t as Pe,n as Ee}from"./index-BcYsGqVu.js";import{R as O}from"./index-D7OJULEB.js";import{D as Oe}from"./DeleteModal-CGzHCWo0.js";import{P as Ie,a as $e}from"./index-1Cs2earB.js";import{a as ze}from"./index-D_-LWkAi.js";import{E as Be}from"./jspdf.plugin.autotable-doWDoFvS.js";const Fe=ae().shape({org_name:C().test("not-select","Please select an Organization",a=>a!==""&&a!=="Select  Organization"),dept_name:C().test("not-select","Please select an Department",a=>a!==""&&a!=="Select  Department"),designation:C().required("Designation is required")}),Ae=({ExistingOrganiZations:a,ExistingDepartments:P,toggleModal:w,handlerefresh:I})=>{const{register:h,formState:{errors:c},handleSubmit:u}=se({resolver:ne(Fe),mode:"all"}),D=async r=>{const _={...r,status:"active",created_by_user:sessionStorage.getItem("name")};try{const g=sessionStorage.getItem("token"),o=await y.post(`${N}/designation/post`,_,{headers:{Authorization:`Bearer ${g}`}});o.status===200?(v.success("Designatiom created Successfully"),w(),I()):(console.error("Error in posting data",o),v.error("Failed to Upload"))}catch(g){console.error("Error in posting data",g)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] h-[460px] font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-8 pb-2",children:"Add Desgination"})}),e.jsxs("form",{onSubmit:u(D),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"org_name",children:"Organization Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",...h("org_name"),children:[e.jsx("option",{value:"",children:"Select Organization"}),a.map(r=>e.jsx("option",{value:r.org_name,children:r.org_name},r.org_id))]}),c.org_name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:c.org_name.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"dept_name",children:"Department Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",...h("dept_name"),children:[e.jsx("option",{value:"",children:"Select Department"}),P.map(r=>e.jsx("option",{value:r.dept_name,children:r.dept_name},r.dept_id))]}),c.dept_name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:c.dept_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"designation",children:"Designation"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"designation",type:"text",placeholder:"Designation Name",...h("designation")}),c.designation&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:c.designation.message})]})]}),e.jsxs("div",{className:"flex justify-end mx-10 gap-5",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:w,children:"Cancel"}),e.jsx("button",{className:"text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",children:"Save"})]})]})]})})},Me=ae().shape({org_name:C().test("not-select","Please select an Organization",a=>a!==""&&a!=="Select  Organization"),dept_name:C().test("not-select","Please select an Department",a=>a!==""&&a!=="Select  Department"),designation:C().required("Designation is required"),status:C().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Ue=({ExistingOrganiZations:a,ExistingDepartments:P,toggleModal:w,handlerefresh:I,desgId:h})=>{const[c,u]=n.useState(null),[D,r]=n.useState(null),_=sessionStorage.getItem("token"),{register:g,formState:{errors:o},handleSubmit:M,setValue:S,watch:q}=se({resolver:ne(Me),mode:"all"});n.useEffect(()=>{(async()=>{try{const j=await y.get(`${N}/designation/getbyid?desgination_id=${h}`,{headers:{Authorization:`Bearer ${_}`}}),d=V(j.data.data);S("org_name",d.org_name),u(d.org_name),S("dept_name",d.dept_name),r(d.dept_name),S("designation",d.designation),S("status",d.status)}catch(j){console.error("Error fetching data",j)}})()},[h,S]);const U=async l=>{const j={...l};try{const d=await y.post(`${N}/designation/update?desgination_id=${h}`,j,{headers:{Authorization:`Bearer ${_}`}});d.status===200?(v.success("Desgination Updated Successfully"),u(null),r(null),w(),I()):(console.error("Error in posting data",d),v.error("Failed to Upload"))}catch(d){console.error("Error in posting data",d)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] h-[420px] font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Desgination"})}),e.jsxs("form",{onSubmit:M(U),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"org_name",children:"Organization Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",...g("org_name"),onChange:l=>u(l.target.value),children:[e.jsx("option",{value:c,disabled:!0,children:c}),a.map(l=>e.jsx("option",{value:l.org_name,children:l.org_name},l.org_id))]}),o.org_name&&e.jsx("p",{className:"text-red-500",children:o.org_name.message})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"dept_name",children:"Department Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",...g("dept_name"),onChange:l=>r(l.target.value),children:[e.jsx("option",{value:D,disabled:!0,children:D}),P.map(l=>e.jsx("option",{value:l.dept_name,children:l.dept_name},l.dept_id))]}),o.dept_name&&e.jsx("p",{className:"text-red-500",children:o.dept_name.message})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"designation",children:"Desgination"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"designation",type:"text",placeholder:"Desgination Name",...g("designation")}),o.designation&&e.jsx("p",{className:"text-red-500",children:o.designation.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...g("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),o.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:o.status.message})]})]}),e.jsxs("div",{className:"flex justify-end mx-10 gap-5",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:w,children:"Cancel"}),e.jsx("button",{className:"text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",children:"Save"})]})]})]})})},Le=`designation,dept_name,org_name,status,created_by_user
Designation,Department,Organization,active,admin`,Je=({permissions:a})=>{const P=a==null?void 0:a.includes("create"),w=a==null?void 0:a.includes("edit"),I=a==null?void 0:a.includes("delete"),h=a==null?void 0:a.includes("download"),[c,u]=n.useState(!1),[D,r]=n.useState(!1),[_,g]=n.useState(!1),[o,M]=n.useState(null),[S,q]=n.useState(null),[U,l]=n.useState(null),[j,d]=n.useState(null),[L,re]=n.useState(""),[p,le]=n.useState(1),[$]=n.useState(8),[z,oe]=n.useState(1),[Re,ie]=n.useState([]),[f,Y]=n.useState([]),[G,ce]=n.useState(null),R=sessionStorage.getItem("token"),[de,J]=n.useState(null),[K,Q]=n.useState("Bulk Upload"),[Z,me]=n.useState(null),H=t=>{ce(G===t?null:t)},xe=t=>G===t;n.useEffect(()=>{F(),ue(),fe()},[L,p]);const B=t=>{t>0&&t<=z&&le(t)},F=()=>{y.get(`${N}/designation/get`,{headers:{Authorization:`Bearer ${R}`}}).then(t=>{const s=V(t.data.data);Y(s);const x=s.filter(i=>Object.values(i).some(m=>m.toString().toLowerCase().includes(L.toLowerCase())));oe(Math.ceil(x.length/$));const b=p*$,k=b-$;ie(x.slice(k,b))})},ge=()=>{u(!c)},pe=()=>{r(!D),q(null)},he=()=>{u(!c)},W=()=>{g(!_),M(null)},ue=async()=>{try{const t=await y.get(`${N}/organization/getactive`,{headers:{Authorization:`Bearer ${R}`}}),s=V(t.data.data);l(s)}catch(t){console.error("Error fetching existing Organisations:",t)}},fe=async()=>{try{const t=await y.get(`${N}/department/getactive`,{headers:{Authorization:`Bearer ${R}`}}),s=V(t.data.data);d(s)}catch(t){console.error("Error fetching existing Departments:",t)}},T=p*$,A=T-$,X=f.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(L.toLowerCase()))),be=X.slice().reverse().slice(A,T),je=async()=>{try{await y.delete(`${N}/designation/delete?desgination_id=${o}`,{headers:{Authorization:`Bearer ${R}`}}),W(),F(),Y(f.filter(t=>f.desgination_id!==o)),v.success("Deleted successfully")}catch{v.error("Failed to delete")}},ye=t=>{J(t.target.files[0]),Q("Upload")},Ne=()=>{K==="Bulk Upload"?document.getElementById("fileInput").click():ve(de)},ve=async t=>{try{const s=new FormData;s.append("file",t),(await y.post(`${N}/designation/uploadcsv`,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(Q("Bulk Upload"),J(null),F(),v.success("Data Uploaded Successfully")):v.error("Data failed to Upload")}catch(s){console.log(s)}},we=t=>{me(t.target.value)},ee=async t=>{if(t==="csv"){const s=f.map(m=>({desgination_id:m.desgination_id,designation:m.designation,dept_name:m.dept_name,org_name:m.org_name,status:m.status,created_by_user:m.created_by_user})),x=[Object.keys(s[0]).join(","),...s.map(m=>Object.values(m).join(","))].join(`
`),b=new Blob([x],{type:"text/csv;charset=utf-8;"}),k=window.URL.createObjectURL(b),i=document.createElement("a");i.setAttribute("href",k),i.setAttribute("download","Designation_data.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}else if(t==="pdf")try{const x=Math.ceil(f.length/30),b=new Be("l","mm","a4");let k=0;for(let i=1;i<=x;i++){const m=(i-1)*30,_e=Math.min(m+30,f.length),Se=f.slice(m,_e).map(E=>[E.desgination_id,E.designation,E.dept_name,E.org_name,E.status,E.created_by_user]);b.text(`Page ${i}`,10,k+10),b.autoTable({startY:k+15,head:[["Designation ID","Designation","DeptName","OrgName","Status","createdBy"]],body:Se,theme:"striped"}),i<x&&(b.addPage(),k=10)}b.save("Designation_data.pdf")}catch(s){console.error("Error exporting data:",s)}},De=()=>{const t=new Blob([Le],{type:"text/csv"}),s=URL.createObjectURL(t),x=document.createElement("a");x.href=s,x.download="bulkupload_template.csv",x.click(),URL.revokeObjectURL(s)};return e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-3 mx-8 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-white py-2 px-3 rounded-full",children:[e.jsx(ke,{className:"text-xl"}),e.jsx("input",{type:"search",className:"outline-none bg-transparent text-base",placeholder:"Search Department",value:L,onChange:t=>re(t.target.value)})]}),P&&e.jsxs("div",{className:"relative text-center   hover:text-white py-1.5 rounded-full",children:[e.jsx("input",{type:"file",id:"fileInput",className:"hidden",onChange:ye,accept:".csv"}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border-primary border-2 font-normal text-base w-36 py-1.5  rounded-full text-primary hover:text-white hover:bg-primary  ",onClick:Ne,children:[e.jsx(te,{}),K]})]}),h&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("form",{children:e.jsxs("select",{className:"block w-full py-2 px-2  text-sm border-2 text-gray-400  border-gray-300 rounded-full bg-gray-50 outline-none",onChange:we,children:[e.jsx("option",{hidden:!0,children:"Download"}),e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"pdf",children:"PDF"})]})}),Z===null&&e.jsx(ze,{className:"text-2xl text-gray-500"}),Z==="csv"&&e.jsx(Ie,{className:"text-3xl text-gray-500",onClick:()=>ee("csv")}),Z==="pdf"&&e.jsx($e,{className:"text-3xl text-gray-500",onClick:()=>ee("pdf")})]})]}),e.jsxs("div",{className:"flex justify-between items-center my-2 mx-8 gap-1 flex-wrap",children:[e.jsx("h1",{className:"md:text-xl text-lg font-medium  font-lexend",children:"Designation"}),P&&e.jsxs("button",{className:"flex  gap-2  items-center border-2 bg-blue-500 text-white font-lexend rounded-full p-2 w-fit justify-between",onClick:()=>u(!0),children:[e.jsx(te,{})," Add Desgination"]})]}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3 overflow-x-auto h-3/5 no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{className:"",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-3 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Designation ",e.jsx(O,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-3 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Department Name ",e.jsx(O,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Org Name ",e.jsx(O,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold  whitespace-nowrap",children:["Status ",e.jsx(O,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedBy ",e.jsx(O,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedAt ",e.jsx(O,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-semibold font-lexend  whitespace-nowrap",children:"Action"})})]})}),e.jsx("tbody",{children:be.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-800",children:A+s+1<10?`0${A+s+1}`:A+s+1})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"capitalize mx-3 my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.designation})}),e.jsx("td",{children:e.jsxs("div",{className:"flex  gap-2 items-center justify-start mx-3 my-3  text-sm text-gray-800",children:[e.jsx("img",{src:Ce,alt:"logo",className:"w-8 h-8"}),e.jsxs("p",{className:"font-lexend whitespace-nowrap capitalize   text-gray-800",children:[" ",t.dept_name]})]})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"capitalize mx-3 my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.org_name})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2  font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800 ",children:Pe(t.createdAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(Ee,{onClick:()=>H(s)}),xe(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[w&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{r(!0),q(t.desgination_id),H()},children:"Edit"}),I&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{g(!0),M(t.desgination_id),H()},children:"Delete"})]})]})})]},s))})]})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"bg-primary px-3 py-2 rounded-full text-white text-sm font-alegerya",onClick:De,children:"Bulk Upload Template"})}),e.jsxs("nav",{className:"flex items-center flex-column flex-wrap md:flex-row md:justify-between justify-center pt-4","aria-label":"Table navigation",children:[e.jsxs("span",{className:"text-sm font-normal text-gray-700 mb-4 md:mb-0 block w-full md:inline md:w-auto text-center font-alegerya",children:["Showing"," ",e.jsxs("span",{className:"text-gray-700",children:[A+1," to ",Math.min(T,f.length)]})," ","of"," ",e.jsxs("span",{className:"text-gray-900",children:[f.length," entries"]})]}),e.jsxs("ul",{className:"inline-flex -space-x-px rtl:space-x-reverse text-sm h-8 font-alegerya",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>B(1),disabled:p===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-s-lg hover:bg-paginate-bg hover:text-primary-hover",children:"<<"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>B(p-1),disabled:p===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Back"})}),Array.from({length:z},(t,s)=>s+1).slice(Math.max(0,p-2),Math.min(z,p+1)).map(t=>e.jsx("li",{children:e.jsx("button",{onClick:()=>B(t),className:`flex items-center justify-center px-3 h-8 leading-tight border border-paginate-br hover:text-white hover:bg-primary ${p===t?"bg-primary text-white":"bg-white text-black"}`,children:t})},t)),e.jsx("li",{children:e.jsx("button",{onClick:()=>B(p+1),disabled:T>=X.length,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Next"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>B(z),disabled:p===z,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-e-lg hover:bg-paginate-bg hover:text-primary-hover",children:">>"})})]})]})]})]})}),c&&e.jsx(Ae,{toggleModal:ge,toggleCloseModal:he,ExistingOrganiZations:U,ExistingDepartments:j,handlerefresh:F}),D&&e.jsx(Ue,{toggleModal:pe,handlerefresh:F,ExistingOrganiZations:U,ExistingDepartments:j,desgId:S}),_&&e.jsx(Oe,{toggleDeleteModal:W,delete:je})]})};export{Je as default};
