import{i as X,k as h,r as a,m as Z,o as ee,j as e,b as C,B as I,d as V,x as ve,D as we,y as Pe,q as T,v as Se,w as ke,E as Ce,z as Ie}from"./index-tsgvEHmX.js";import{D as Me}from"./DeleteModal-DJp1pd7G.js";import{S as te}from"./SavaCancel-r2kPCP2i.js";import{A as b}from"./ApiClient-w4qWO__2.js";import{F as Oe,B as Fe}from"./FileUploadButton-C5ckz8lU.js";const Te=X().shape({emp_name:h().trim().required("Employee Name is required"),dept_name:h().required("Department is required"),phone:h().matches(/^\d{10}$/,"Must be 10 digits and contain only numbers").required("Phone Number is required"),email:h().email("Invalid Email Id").required("Email Id is required"),address:h().required("Address is required"),dob:h().required("DOB is required"),pincode:h().test("len","Pincode must be 6 characters",s=>s.length===6).required("Pincode is required"),designation:h().test("not-select","Please select a Designation",s=>s!==""&&s!=="Designation")}),Le=s=>{const{ExistingDesignation:D,ExistingDept:L}=s,[E,M]=a.useState([]),[O,_]=a.useState(""),{register:p,formState:{errors:d},handleSubmit:v,watch:w}=Z({resolver:ee(Te),mode:"all"}),P=w("dept_name");a.useEffect(()=>{if(P){const x=D.filter(l=>l.dept_name===P);M(x)}else M([]),_("")},[P]);const j=x=>{const l=x.target.value,f=D.find(S=>S.designation===l);_(f.desgination_id)},m=async x=>{const l={...x,status:"active",created_by_user:localStorage.getItem("name"),designation_id:O};try{const f=await C.post(b.POST_EMPLOYEE.url,l,{headers:b.POST_EMPLOYEE.headers});f.status===200?(I.success(f.data.message),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",f),I.error("Failed to Upload"))}catch(f){console.error("Error in posting data",f)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center",children:e.jsx("div",{className:"bg-white w-fit h-fit font-lexend m-2",children:e.jsxs("form",{onSubmit:v(m),children:[e.jsxs("div",{className:"border-b-2 border-gray-300 mx-10 my-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 col-span-1 whitespace-nowrap",htmlFor:"emp_name",children:"Name:"}),e.jsx("input",{type:"text",id:"emp_name",className:"mx-2 font-lexend px-2 text-sm text-end outline-none col-span-2",placeholder:"Employee Name",...p("emp_name")})]}),d.emp_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.emp_name.message})]}),e.jsxs("div",{className:"flex flex-col gap-3 mx-10 my-1",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-2",htmlFor:"dept_name",children:"Department:"}),e.jsxs("select",{className:"text-sm text-black border border-gray-900 rounded-lg border-none outline-none",id:"dept_name",...p("dept_name"),children:[e.jsx("option",{value:"",children:" Select Department"}),L.map((x,l)=>e.jsx("option",{value:x.dept_name,children:x.dept_name},l))]})]}),d.dept_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.dept_name.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-2",htmlFor:"designation",children:"Desgination :"}),e.jsxs("select",{className:"text-sm text-black border border-gray-900 rounded-lg border-none outline-none",id:"designation",...p("designation"),onChange:j,children:[e.jsx("option",{value:"",children:"Select Designation"}),E&&E.map((x,l)=>e.jsx("option",{value:x.designation,children:x.designation},l))]})]}),d.designation&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.designation.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"phone",children:"Phone:"}),e.jsx("input",{type:"text",id:"phone",className:"w-6/5 text-end outline-none col-span-2",placeholder:"Phone Number",...p("phone")})]}),d.phone&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.phone.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"email",children:"Email Id:"}),e.jsx("input",{type:"email",id:"email",className:"text-end outline-none col-span-2",placeholder:"abc@gmail.com",...p("email")})]}),d.email&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.email.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"address",children:"Address:"}),e.jsx("input",{type:"text",id:"address",className:"text-end outline-none col-span-2",placeholder:"Address",...p("address")})]}),d.address&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.address.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"pincode",children:"Pincode:"}),e.jsx("input",{type:"text",id:"pincode",className:"text-end outline-none col-span-2",placeholder:"Pincode",...p("pincode")})]}),d.pincode&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.pincode.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"dob",children:"Date of Birth :"}),e.jsx("input",{type:"date",id:"dob",className:"text-end outline-none col-span-2",placeholder:"DOB",...p("dob")})]}),d.dob&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.dob.message})]})]}),e.jsx("div",{className:"py-6",children:e.jsx(te,{onCancel:s.toggleModal})})]})})})},qe=X().shape({emp_name:h().trim().required("Employee Name is required"),dept_name:h().required("Department is required"),address:h().required("Address is required"),dob:h().required("DOB is required"),pincode:h().test("len","Pincode must be 6 characters",s=>s.length===6).required("Pincode is required"),designation:h().test("not-select","Please select a Designation",s=>s!==""&&s!=="Designation"),status:h().test("not-select","Please select an Status",s=>s!==""&&s!=="Status")}),Ae=s=>{const{ExistingDesignation:D,ExistingDept:L,adminId:E}=s,[M,O]=a.useState(null),[_,p]=a.useState(""),[d,v]=a.useState(null),[w,P]=a.useState([]),{register:j,formState:{errors:m},handleSubmit:x,setValue:l,watch:f}=Z({resolver:ee(qe),mode:"all"}),S=f("dept_name");a.useEffect(()=>{(async()=>{try{const r=b.FETCH_EMPLOYEE(E),g=await C.get(r.url,{headers:r.headers}),i=V(g.data.data);l("emp_name",i.emp_name),l("dept_name",i.dept_name),O(i.dept_name),l("address",i.address),l("pincode",i.pincode),l("dob",i.dob),p(i.designation),l("designation_id",i.designation_id),v(i.designation_id),l("designation",i.designation),l("status",i.status)}catch(r){console.error("Error fetching data",r)}})()},[E,l]),a.useEffect(()=>{if(S){const o=D.filter(r=>r.dept_name===S);P(o)}},[S,D]);const G=o=>{const r=o.target.value;l("dept_name",r),O(r),v(null),p(""),l("designation","")},q=o=>{const r=o.target.value,g=w.find(i=>i.designation===r);v(g.desgination_id)},z=async o=>{const r={...o,designation_id:d};try{const g=b.UPDATE_EMPLOYEE(E),i=await C.post(g.url,r,{headers:g.headers});i.status===200?(I.success(i.data.message),O(null),p(null),v(null),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",i),I.error("Failed to Upload"))}catch(g){console.error("Error in posting data",g)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsx("div",{className:"bg-white w-fit h-fit  font-lexend m-2",children:e.jsxs("form",{onSubmit:x(z),children:[e.jsxs("div",{className:"border-b-2 border-gray-300 mx-10 my-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 col-span-1 whitespace-nowrap",htmlFor:"emp_name",children:"Name:"}),e.jsx("input",{type:"text",id:"emp_name",className:"mx-2 font-lexend px-2 text-sm text-end outline-none col-span-2",placeholder:"Employee Name",...j("emp_name")})]}),m.emp_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.emp_name.message})]}),e.jsxs("div",{className:"flex flex-col gap-3 mx-10 my-1",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-2",htmlFor:"dept_name",children:"Department:"}),e.jsxs("select",{className:"text-sm text-black border border-gray-900 rounded-lg border-none outline-none",id:"dept_name",...j("dept_name"),onChange:G,children:[e.jsx("option",{value:M,className:"text-gray-500",children:M}),L.map((o,r)=>e.jsx("option",{value:o.dept_name,children:o.dept_name},r))]})]}),m.dept_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.dept_name.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-2",htmlFor:"designation",children:"Desgination :"}),e.jsxs("select",{className:"text-sm text-black border border-gray-900 rounded-lg border-none outline-none",id:"designation",...j("designation"),onChange:q,children:[e.jsx("option",{value:_,className:"text-gray-500",children:_===""?"select Designation":_}),w&&w.map((o,r)=>e.jsx("option",{value:o.designation,children:o.designation},r))]})]}),m.designation&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.designation.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"address",children:"Address:"}),e.jsx("input",{type:"text",id:"address",className:"text-end outline-none col-span-2",placeholder:"Address",...j("address")})]}),m.address&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.address.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"pincode",children:"Pincode:"}),e.jsx("input",{type:"text",id:"pincode",className:"text-end outline-none col-span-2",placeholder:"Pincode",...j("pincode")})]}),m.pincode&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.pincode.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"dob",children:"Date of Birth :"}),e.jsx("input",{type:"date",id:"dob",className:"text-end outline-none col-span-2",placeholder:"DOB",...j("dob")})]}),m.dob&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.dob.message})]}),e.jsxs("div",{className:" grid grid-cols-3 gap-3 ",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-2",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...j("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),m.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:m.status.message})]})]}),e.jsx("div",{className:"py-6",children:e.jsx(te,{onCancel:s.toggleModal})})]})})})},Be=`emp_name,designation_id,designation,dept_name,phone,email,address,pincode,status,created_by_user
name,DE***,designation,Department,1234567890,abc@gmail.com,address,123456,active,admin`,He=({permissions:s})=>{const[D,L]=a.useState(!1),E=s==null?void 0:s.includes("create"),M=s==null?void 0:s.includes("edit"),O=s==null?void 0:s.includes("delete"),_=s==null?void 0:s.includes("download"),[p,d]=a.useState(!1),[v,w]=a.useState(null),[P,j]=a.useState(!1),[m,x]=a.useState(null),[l,f]=a.useState(null),[S,G]=a.useState(null),[q,z]=a.useState(""),[o,r]=a.useState(1),[g]=a.useState(8),[i,se]=a.useState(1),[Ye,ae]=a.useState([]),[A,ne]=a.useState([]),[$,le]=a.useState(null),[de,H]=a.useState(null),[J,K]=a.useState("Bulk Upload"),[ie,oe]=a.useState(null),R=t=>{le($===t?null:t)},re=t=>$===t;a.useEffect(()=>{B(),pe(),he()},[q,o]);const ce=t=>{t>0&&t<=i&&r(t)},B=()=>{C.get(b.GET_EMPLOYEE.url,{headers:b.GET_EMPLOYEE.headers}).then(t=>{const n=V(t.data.data);ne(n);const k=n.filter(u=>Object.values(u).some(c=>c.toString().toLowerCase().includes(q.toLowerCase())));se(Math.ceil(k.length/g));const N=o*g,F=N-g;ae(k.slice(F,N))}).catch(t=>{console.error(t)})},me=()=>{L(!D)},xe=()=>{d(!p),w(null)},Q=()=>{j(!P),x(null)},pe=async()=>{try{const t=await C.get(b.GET_DESIG_EMPLOYEEACTIVE.url,{headers:b.GET_DESIG_EMPLOYEEACTIVE.headers}),n=V(t.data.data);f(n)}catch(t){console.error("Error fetching existing Roles:",t)}},he=async()=>{try{const t=await C.get(b.GET_DEPT_EMPLOYEEACTIVE.url,{headers:b.GET_DEPT_EMPLOYEEACTIVE.headers}),n=V(t.data.data);G(n)}catch(t){console.error("Error fetching existing Department:",t)}},U=o*g,Y=U-g,W=A.filter(t=>Object.values(t).some(n=>n.toString().toLowerCase().includes(q.toLowerCase()))),ge=W.slice().reverse().slice(Y,U),ue=async()=>{try{const t=b.DELETE_EMPLOYEE(m);await C.delete(t.url,{headers:t.headers}),Q(),B(),I.success("Deleted successfully")}catch{I.error("Failed to delete")}},je=t=>{H(t.target.files[0]),K("Upload")},be=()=>{J==="Bulk Upload"?document.getElementById("fileInput").click():fe(de)},fe=async t=>{try{const n=new FormData;n.append("file",t),localStorage,(await C.post(b.CSV_EMPLOYEE.url,n,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(K("Bulk Upload"),H(null),B(),I.success("Data Uploaded Successfully")):I.error("Data failed to Upload")}catch(n){console.log(n)}},ye=t=>{oe(t.target.value)},Ee=async t=>{if(t==="csv"){const n=A.map(c=>({emp_id:c.emp_id,emp_name:c.emp_name,designation_id:c.designation_id,designation:c.designation,dept_name:c.dept_name,phone:c.phone,email:c.email,address:c.address,pincode:c.pincode,status:c.status,role:c.role,created_by_user:c.created_by_user})),k=[Object.keys(n[0]).join(","),...n.map(c=>Object.values(c).join(","))].join(`
`),N=new Blob([k],{type:"text/csv;charset=utf-8;"}),F=window.URL.createObjectURL(N),u=document.createElement("a");u.setAttribute("href",F),u.setAttribute("download","Employee_data.csv"),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u)}else if(t==="pdf")try{const k=Math.ceil(A.length/30),N=new Ce("l","mm","a4");let F=0;for(let u=1;u<=k;u++){const c=(u-1)*30,De=Math.min(c+30,A.length),_e=A.slice(c,De).map(y=>[y.emp_id,y.emp_name,y.designation,y.dept_name,y.phone,y.email,y.address,y.pincode,y.status,y.created_by_user]);N.text(`Page ${u}`,10,F+10),N.autoTable({startY:F+15,head:[["Emp_Id","Emp_Name","Designation","Dept_Name","Phone","Email","Address","Pincode","Status","CreatedBy"]],body:_e,theme:"striped"}),u<k&&(N.addPage(),F=10)}N.save("Employee_data.pdf")}catch(n){console.error("Error exporting data:",n)}},Ne=()=>{Ie(Be)};return e.jsxs(a.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-2 mx-8 flex-wrap",children:[e.jsx(ve,{value:q,onChange:t=>z(t.target.value),placeholder:"Search Employee"}),E&&e.jsx(Oe,{onChange:je,buttonText:J,accept:".csv",onClick:be}),_&&e.jsx(we,{selectedDoc:ie,onChange:ye,exportData:Ee})]}),e.jsx(Pe,{title:"MSCL Employee",hasCreatePermission:E,onClick:()=>L(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-2  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Employee Name ",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Designation",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Department",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-3  my-2 font-lexend font-semibold whitespace-nowrap",children:["Phone",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Email",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Status",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["CreatedBy",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsx("div",{className:"mx-1 my-3 text-start font-lexend font-semibold whitespace-nowrap",children:"Action"})})]})}),e.jsx("tbody",{children:ge.map((t,n)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsxs("p",{className:"text-center text-sm mx-4 my-2 font-lexend whitespace-nowrap  text-gray-700",children:[" ",Y+n+1<10?`0${Y+n+1}`:Y+n+1]})}),e.jsx("td",{children:e.jsx("p",{className:" mx-1  my-2 font-lexend whitespace-nowrap text-start text-sm capitalize text-gray-700",children:t.emp_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm  mx-1  my-2  font-lexend whitespace-nowrap capitalize text-gray-700",children:t.designation})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm  mx-1  my-2  font-lexend whitespace-nowrap capitalize text-gray-700",children:t.dept_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-3  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.phone})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.email})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(Se,{onClick:()=>R(n)}),re(n)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[M&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{d(!0),w(t.emp_id),R()},children:"Edit"}),O&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{j(!0),x(t.emp_id),R()},children:"Delete"})]})]})})]},n))})]})})}),e.jsxs("div",{className:" my-2 mb-5 mx-7",children:[e.jsx(Fe,{handleDownload:Ne}),e.jsx(ke,{Length:A.length,currentPage:o,totalPages:i,firstIndex:Y,lastIndex:U,paginate:ce,hasNextPage:U>=W.length})]})]})}),D&&e.jsx(Le,{toggleModal:me,handlerefresh:B,ExistingDesignation:l,ExistingDept:S}),p&&e.jsx(Ae,{toggleModal:xe,handlerefresh:B,ExistingDesignation:l,ExistingDept:S,adminId:v}),P&&e.jsx(Me,{toggleDeleteModal:Q,delete:ue})]})};export{He as default};
