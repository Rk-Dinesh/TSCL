import{i as H,k as h,l as Y,o as G,j as e,b as _,A as w,B as f,r as l,d as J,n as ye}from"./index-KlxDuXca.js";import{R as I,P as ve}from"./Pagination-CZoS4CI6.js";import{S as K}from"./SavaCancel-DnY9KWLv.js";import{D as Ne}from"./DeleteModal-Bq2aEtZp.js";import{S as _e,D as we,E as Pe}from"./DocumentDownload-Cf_kB8s3.js";import{F as Se,B as ke}from"./FileUploadButton-Bc1PelCC.js";import{H as De}from"./HeaderButton-D4Lkrp4E.js";import"./index-BebfzzXM.js";import"./index-BKjO-751.js";import"./index-D_Jj7K4f.js";const Ue=H().shape({public_user_name:h().required("User Name is required"),phone:h().required("Phone Number is required"),email:h().required("Email Id  is required"),address:h().required("Address is required"),pincode:h().required("Pincode is required")}),Ie=a=>{const{register:o,formState:{errors:r},handleSubmit:g,setValue:u,watch:P}=Y({resolver:G(Ue),mode:"all"}),x=async S=>{const y={...S,login_password:"tscl@123",user_status:"active",verification_status:"active"},v=sessionStorage.getItem("token");try{const d=await _.post(`${w}/public-user/post`,y,{headers:{Authorization:`Bearer ${v}`}});d.status===200?(f.success("Public User created Successfully"),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",d),f.error("Failed to Upload"))}catch(d){console.error("Error in posting data",d)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsx("div",{className:"bg-white w-fit h-fit  font-lexend m-2",children:e.jsxs("form",{onSubmit:g(x),children:[e.jsxs("div",{className:"border-b-2 border-gray-300 mx-10 my-5",children:[e.jsxs("div",{className:" grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 col-span-1 whitespace-nowrap",htmlFor:"public_user_name",children:"Name"}),e.jsx("input",{type:"text",id:"public_user_name",className:"mx-2 font-lexend px-2 text-sm text-end outline-none col-span-2",placeholder:"User Name",...o("public_user_name")})]}),r.public_user_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.public_user_name.message})]}),e.jsxs("div",{className:" flex flex-col gap-3 mx-10 my-1 ",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"Phone",children:"Phone :"}),e.jsx("input",{type:"text",id:"phone",className:"w-6/5 text-end outline-none col-span-2",placeholder:"Phone Number",...o("phone")})]}),r.phone&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.phone.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"email",children:"Email Id :"}),e.jsx("input",{type:"email",id:"email",className:" text-end outline-none col-span-2",placeholder:"abc@gmail.com",...o("email")})]}),r.email&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.email.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"address",children:"Address :"}),e.jsx("input",{type:"text",id:"address",className:" text-end outline-none col-span-2",placeholder:"Address",...o("address")})]}),r.address&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.address.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"pincode",children:"Pincode :"}),e.jsx("input",{type:"text",id:"pincode",className:" text-end outline-none col-span-2",placeholder:"Pincode ",...o("pincode")})]}),r.pincode&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.pincode.message})]})]}),e.jsx("div",{className:"py-6",children:e.jsx(K,{onCancel:a.toggleModal})})]})})})},Ce=H().shape({public_user_name:h().required("User Name is required"),address:h().required("Address is required"),pincode:h().required("Pincode is required"),user_status:h().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Ee=a=>{const{userId:o}=a,r=sessionStorage.getItem("token"),{register:g,formState:{errors:u},handleSubmit:P,setValue:x,watch:S}=Y({resolver:G(Ce),mode:"all"});l.useEffect(()=>{(async()=>{try{const d=await _.get(`${w}/public-user/getbyid?public_user_id=${o}`,{headers:{Authorization:`Bearer ${r}`}}),i=J(d.data.data);x("public_user_name",i.public_user_name),x("address",i.address),x("pincode",i.pincode),x("user_status",i.user_status)}catch(d){console.error("Error fetching data",d)}})()},[o,x]);const y=async v=>{const d={...v};try{const i=await _.post(`${w}/public-user/update?public_user_id=${o}`,d,{headers:{Authorization:`Bearer ${r}`}});i.status===200?(f.success("Public User Updated Successfully"),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",i),f.error("Failed to Upload"))}catch(i){console.error("Error in posting data",i)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsx("div",{className:"bg-white w-fit h-fit  font-lexend m-2",children:e.jsxs("form",{onSubmit:P(y),children:[e.jsxs("div",{className:"border-b-2 border-gray-300 mx-10 my-5",children:[e.jsxs("div",{className:" grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 col-span-1 whitespace-nowrap",htmlFor:"public_user_name",children:"Name"}),e.jsx("input",{type:"text",id:"public_user_name",className:"mx-2 font-lexend px-2 text-sm text-end outline-none col-span-2",placeholder:"User Name",...g("public_user_name")})]}),u.public_user_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:u.public_user_name.message})]}),e.jsxs("div",{className:" flex flex-col gap-3 mx-10 my-1 ",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"address",children:"Address :"}),e.jsx("input",{type:"text",id:"address",className:" text-end outline-none col-span-2",placeholder:"Address",...g("address")})]}),u.address&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:u.address.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"pincode",children:"Pincode :"}),e.jsx("input",{type:"text",id:"pincode",className:" text-end outline-none col-span-2",placeholder:"Pincode ",...g("pincode")})]}),u.pincode&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:u.pincode.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:" grid grid-cols-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-2",htmlFor:"user_status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"user_status",...g("user_status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]})]}),u.user_status&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:u.user_status.message})]})]}),e.jsx("div",{className:"py-6",children:e.jsx(K,{onCancel:a.toggleModal})})]})})})},Ae=`public_user_name,phone,email,address,pincode,login_password,verification_status,user_status,role
user,1234567890,email@gmail.com, Address,123456,password,verified,status,user`,Ye=({permissions:a})=>{const o=a==null?void 0:a.includes("create"),r=a==null?void 0:a.includes("edit"),g=a==null?void 0:a.includes("delete"),u=a==null?void 0:a.includes("download"),[P,x]=l.useState(!1),[S,y]=l.useState(!1),[v,d]=l.useState(null),[i,F]=l.useState(!1),[Q,M]=l.useState(null),[C,W]=l.useState(""),[E,X]=l.useState(1),[k]=l.useState(8),[$,Z]=l.useState(1),[Be,ee]=l.useState([]),[N,te]=l.useState([]),[q,se]=l.useState(null),L=sessionStorage.getItem("token"),[ae,O]=l.useState(null),[z,R]=l.useState("Bulk Upload"),[le,re]=l.useState(null),B=t=>{se(q===t?null:t)},ne=t=>q===t;l.useEffect(()=>{D()},[C,E]);const ce=t=>{t>0&&t<=$&&X(t)},D=()=>{_.get(`${w}/public-user/get`,{headers:{Authorization:`Bearer ${L}`}}).then(t=>{const s=J(t.data.data);te(s);const m=s.filter(c=>Object.values(c).some(n=>n.toString().toLowerCase().includes(C.toLowerCase())));Z(Math.ceil(m.length/k));const p=E*k,j=p-k;ee(m.slice(j,p))}).catch(t=>{console.error(t)})},de=()=>{x(!P)},oe=()=>{y(!S),d(null)},V=()=>{F(!i),M(null)},A=E*k,U=A-k,T=N.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(C.toLowerCase()))),ie=T.slice().reverse().slice(U,A),me=async()=>{try{await _.delete(`${w}/public-user/delete?public_user_id=${Q}`,{headers:{Authorization:`Bearer ${L}`}}),V(),D(),f.success("Deleted successfully")}catch{f.error("Failed to delete")}},ue=t=>{O(t.target.files[0]),R("Upload")},xe=()=>{z==="Bulk Upload"?document.getElementById("fileInput").click():pe(ae)},pe=async t=>{try{const s=new FormData;s.append("file",t),(await _.post(`${w}/public-user/uploadcsv`,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(R("Bulk Upload"),O(null),D(),f.success("Data Uploaded Successfully")):f.error("Data failed to Upload")}catch(s){console.log(s)}},he=t=>{re(t.target.value)},ge=async t=>{if(t==="csv"){const s=N.map(n=>({public_user_id:n.public_user_id,public_user_name:n.public_user_name,phone:n.phone,email:n.email,address:n.address,pincode:n.pincode,verification_status:n.verification_status,user_status:n.user_status})),m=[Object.keys(s[0]).join(","),...s.map(n=>Object.values(n).join(","))].join(`
`),p=new Blob([m],{type:"text/csv;charset=utf-8;"}),j=window.URL.createObjectURL(p),c=document.createElement("a");c.setAttribute("href",j),c.setAttribute("download","User_data.csv"),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}else if(t==="pdf")try{const m=Math.ceil(N.length/30),p=new Pe("l","mm","a4");let j=0;for(let c=1;c<=m;c++){const n=(c-1)*30,fe=Math.min(n+30,N.length),je=N.slice(n,fe).map(b=>[b.public_user_id,b.public_user_name,b.phone,b.email,b.address,b.pincode,b.verification_status,b.user_status]);p.text(`Page ${c}`,10,j+10),p.autoTable({startY:j+15,head:[["UserId","UserName","Phone","Email","Address","Pincode","VerificationStatus"]],body:je,theme:"striped"}),c<m&&(p.addPage(),j=10)}p.save("User_data.pdf")}catch(s){console.error("Error exporting data:",s)}},be=()=>{const t=new Blob([Ae],{type:"text/csv"}),s=URL.createObjectURL(t),m=document.createElement("a");m.href=s,m.download="bulkupload_template.csv",m.click(),URL.revokeObjectURL(s)};return e.jsxs(l.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-3 mx-8 flex-wrap",children:[e.jsx(_e,{value:C,onChange:t=>W(t.target.value),placeholder:"Search User"}),o&&e.jsx(Se,{onChange:ue,buttonText:z,accept:".csv",onClick:xe}),u&&e.jsx(we,{selectedDoc:le,onChange:he,exportData:ge})]}),e.jsx(De,{title:"Public User",hasCreatePermission:o,onClick:()=>x(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Public Username ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-3  my-2 font-lexend font-semibold whitespace-nowrap",children:["Phone",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Email",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Status",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Verification Status",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsx("div",{className:"mx-3 my-3 font-lexend font-semibold whitespace-nowrap text-center",children:"Action"})})]})}),e.jsx("tbody",{children:ie.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("p",{className:"text-center text-sm mx-1 my-2 font-lexend whitespace-nowrap text-gray-700",children:U+s+1<10?`0${U+s+1}`:U+s+1})}),e.jsx("td",{children:e.jsx("p",{className:" mx-1  my-2 font-lexend whitespace-nowrap text-start text-sm capitalize text-gray-700",children:t.public_user_name})}),e.jsx("td",{children:e.jsx("p",{className:" mx-3  my-2 font-lexend whitespace-nowrap text-start text-sm capitalize text-gray-700",children:t.phone})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1  my-2 font-lexend  whitespace-nowrap capitalize text-gray-700",children:t.email})}),e.jsx("td",{children:e.jsx("p",{className:" mx-2  my-2 font-lexend whitespace-nowrap text-start text-sm capitalize text-gray-700",children:t.user_status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1  my-2 font-lexend whitespace-nowrap text-sm  capitalize text-gray-700",children:t.verification_status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(ye,{onClick:()=>B(s)}),ne(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[r&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{y(!0),d(t.public_user_id),B()},children:"Edit"}),g&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{F(!0),M(t.public_user_id),B()},children:"Delete"})]})]})})]},s))})]})})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx(ke,{handleDownload:be}),e.jsx(ve,{Length:N.length,currentPage:E,totalPages:$,firstIndex:U,lastIndex:A,paginate:ce,hasNextPage:A>=T.length})]})]})}),P&&e.jsx(Ie,{toggleModal:de,handlerefresh:D}),S&&e.jsx(Ee,{toggleModal:oe,handlerefresh:D,userId:v}),i&&e.jsx(Ne,{toggleDeleteModal:V,delete:me})]})};export{Ye as default};
