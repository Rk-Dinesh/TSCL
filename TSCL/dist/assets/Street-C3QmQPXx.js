import{i as Q,k as U,r as s,l as X,o as ee,j as e,b as C,A as I,B as N,d as T,m as K,n as ve,p as De}from"./index-Bcq-xcbe.js";import{R as k,P as ze}from"./Pagination-NoxGYsms.js";import{S as te}from"./SavaCancel-BMH7jq3r.js";import{D as ke}from"./DeleteModal-BWWcbtK_.js";import{S as Ce,D as Ie,E as Pe}from"./DocumentDownload-DKUl4nU_.js";import{F as Ee,B as Be}from"./FileUploadButton-Cb0sjKSa.js";import{H as $e}from"./HeaderButton-BImpP2es.js";import"./index-CmGGunKB.js";import"./index-Coec18zc.js";import"./index-LzYQNQ_r.js";const Me=Q().shape({ward_name:U().test("not-select","Please select a ward",a=>a!==""&&a!=="Select Street"),street_name:U().required("street_name is required")}),Ae=a=>{const{ExistingWards:u}=a,[S,P]=s.useState(null),[M,j]=s.useState(null),[v,D]=s.useState(null),[b,E]=s.useState(null),{register:i,formState:{errors:m},handleSubmit:y,watch:g}=X({resolver:ee(Me),mode:"all"});s.useEffect(()=>{if(b){const l=u.find(h=>h.ward_name===b);l&&(P(l.zone_id),j(l.ward_id),D(l.zone_name))}},[b,u]);const B=async l=>{const h={...l,zone_id:S,ward_id:M,zone_name:v,status:"active",created_by_user:sessionStorage.getItem("name")};try{const f=sessionStorage.getItem("token"),r=await C.post(`${I}/street/post`,h,{headers:{Authorization:`Bearer ${f}`}});r.status===200?(N.success("Street created Successfully"),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",r),N.error("Failed to Upload"))}catch(f){console.error("Error in posting data",f)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Street"})}),e.jsxs("form",{onSubmit:y(B),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"ward_name",children:"Ward Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",...i("ward_name"),onChange:l=>E(l.target.value),children:[e.jsx("option",{value:"",children:"Select Street"}),u.map(l=>e.jsx("option",{value:l.ward_name,children:l.ward_name},l.ward_id))]}),m.ward_name&&e.jsx("p",{className:"text-red-500",children:m.ward_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"street_name",children:"Street Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"street_name",type:"text",placeholder:"Street Name",...i("street_name")}),m.street_name&&e.jsx("p",{className:"text-red-500",children:m.street_name.message})]})]}),e.jsx(te,{onCancel:a.toggleCloseModal})]})]})})},We=Q().shape({ward_name:U().test("not-select","Please select a ward",a=>a!==""&&a!=="Select Street"),street_name:U().required("street_name is required"),status:U().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Fe=a=>{const{ExistingWards:u,streetId:S}=a,P=sessionStorage.getItem("token"),[M,j]=s.useState(null),[v,D]=s.useState(null),[b,E]=s.useState(null),[i,m]=s.useState(null),{register:y,formState:{errors:g},handleSubmit:B,watch:l,setValue:h}=X({resolver:ee(We),mode:"all"});s.useEffect(()=>{(async()=>{try{const c=await C.get(`${I}/street/getbyid?street_id=${S}`,{headers:{Authorization:`Bearer ${P}`}}),x=T(c.data.data);m(x.ward_name),h("ward_name",x.ward_name),h("street_name",x.street_name),h("status",x.status)}catch(c){console.error("Error fetching data",c)}})()},[S,h]),s.useEffect(()=>{if(i){const r=u.find(c=>c.ward_name===i);r&&(j(r.zone_id),D(r.ward_id),E(r.zone_name))}},[i,u]);const f=async r=>{const c={...r,zone_id:M,ward_id:v,zone_name:b};try{const x=await C.post(`${I}/street/update?street_id=${S}`,c,{headers:{Authorization:`Bearer ${P}`}});x.status===200?(N.success("Street updated Successfully"),j(null),D(null),E(null),m(null),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",x),N.error("Failed to Upload"))}catch(x){console.error("Error in posting data",x)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Street"})}),e.jsxs("form",{onSubmit:B(f),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"ward_name",children:"Ward Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",...y("ward_name"),onChange:r=>m(r.target.value),children:[e.jsx("option",{value:i,disabled:!0,children:i}),u.map(r=>e.jsx("option",{value:r.ward_name,children:r.ward_name},r.ward_id))]}),g.ward_name&&e.jsx("p",{className:"text-red-500",children:g.ward_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"street_name",children:"Street Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"street_name",type:"text",placeholder:"Street Name",...y("street_name")}),g.street_name&&e.jsx("p",{className:"text-red-500",children:g.street_name.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...y("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),g.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:g.status.message})]})]}),e.jsx(te,{onCancel:a.toggleModal})]})]})})},Ue=`street_name,ward_id,ward_name,zone_id,zone_name,status,created_by_user
 streetName,Ward***,WardName,Z***,ZoneName,Status,admin`,Qe=({permissions:a})=>{const u=a==null?void 0:a.includes("create"),S=a==null?void 0:a.includes("edit"),P=a==null?void 0:a.includes("delete"),M=a==null?void 0:a.includes("download"),[j,v]=s.useState(!1),[D,b]=s.useState(!1),[E,i]=s.useState(null),[m,y]=s.useState(!1),[g,B]=s.useState(null),[l,h]=s.useState(null),[f,r]=s.useState(""),[c,x]=s.useState(1),[A]=s.useState(8),[R,ae]=s.useState(1),[Oe,se]=s.useState([]),[$,ne]=s.useState([]),[V,re]=s.useState(null),L=sessionStorage.getItem("token"),[le,q]=s.useState(null),[H,Y]=s.useState("Bulk Upload"),[oe,de]=s.useState(null),Z=t=>{re(V===t?null:t)},ce=t=>V===t;s.useEffect(()=>{W(),he()},[f,c]);const ie=t=>{t>0&&t<=R&&x(t)},W=()=>{C.get(`${I}/street/get`,{headers:{Authorization:`Bearer ${L}`}}).then(t=>{const n=T(t.data.data);ne(n);const _=n.filter(d=>Object.values(d).some(o=>o.toString().toLowerCase().includes(f.toLowerCase())));ae(Math.ceil(_.length/A));const p=c*A,z=p-A;se(_.slice(z,p))})},me=()=>{v(!j)},xe=()=>{b(!D),i(null)},ue=()=>{v(!j)},G=()=>{y(!m),B(null)},he=async()=>{try{const t=await C.get(`${I}/ward/getactive`,{headers:{Authorization:`Bearer ${L}`}}),n=T(t.data.data);h(n)}catch(t){console.error("Error fetching existing roles:",t)}},O=c*A,F=O-A,J=$.filter(t=>Object.values(t).some(n=>n.toString().toLowerCase().includes(f.toLowerCase()))),fe=J.slice(F,O),ge=async()=>{try{await C.delete(`${I}/street/delete?street_id=${g}`,{headers:{Authorization:`Bearer ${L}`}}),G(),W(),N.success("Deleted successfully")}catch{N.error("Failed to delete")}},pe=t=>{q(t.target.files[0]),Y("Upload")},je=()=>{H==="Bulk Upload"?document.getElementById("fileInput").click():be(le)},be=async t=>{try{const n=new FormData;n.append("file",t),(await C.post(`${I}/street/uploadcsv`,n,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(Y("Bulk Upload"),q(null),W(),N.success("Data Uploaded Successfully")):N.error("Data failed to Upload")}catch(n){console.log(n)}},ye=t=>{de(t.target.value)},_e=async t=>{if(t==="csv"){const n=$.map(o=>({street_id:o.street_id,street_name:o.street_name,ward_id:o.ward_id,ward_name:o.ward_name,zone_id:o.zone_id,zone_name:o.zone_name,status:o.status,created_by_user:o.created_by_user})),_=[Object.keys(n[0]).join(","),...n.map(o=>Object.values(o).join(","))].join(`
`),p=new Blob([_],{type:"text/csv;charset=utf-8;"}),z=window.URL.createObjectURL(p),d=document.createElement("a");d.setAttribute("href",z),d.setAttribute("download","Street_data.csv"),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)}else if(t==="pdf")try{const _=Math.ceil($.length/30),p=new Pe("l","mm","a4");let z=0;for(let d=1;d<=_;d++){const o=(d-1)*30,Ne=Math.min(o+30,$.length),Se=$.slice(o,Ne).map(w=>[w.street_id,w.street_name,w.ward_id,w.ward_name,w.zone_id,w.zone_name,w.status,w.created_by_user]);p.text(`Page ${d}`,10,z+10),p.autoTable({startY:z+15,head:[["street_id","street_name","ward_id","ward_name","zone_id","zone_name","status","created_by_user"]],body:Se,theme:"striped"}),d<_&&(p.addPage(),z=10)}p.save("Street_data.pdf")}catch(n){console.error("Error exporting data:",n)}},we=()=>{De(Ue)};return e.jsxs(s.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-3 mx-8 flex-wrap",children:[e.jsx(Ce,{value:f,onChange:t=>r(t.target.value),placeholder:"Search Street"}),u&&e.jsx(Ee,{onChange:pe,buttonText:H,accept:".csv",onClick:je}),M&&e.jsx(Ie,{selectedDoc:oe,onChange:ye,exportData:_e})]}),e.jsx($e,{title:"Street",hasCreatePermission:u,onClick:()=>v(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Street ",e.jsx(k,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Ward ",e.jsx(k,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Zone ",e.jsx(k,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Status ",e.jsx(k,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedBy ",e.jsx(k,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedAt",e.jsx(k,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["UpdatedAt",e.jsx(k,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-lexend font-semibold",children:"Action"})})]})}),e.jsx("tbody",{children:fe.map((t,n)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-700",children:F+n+1<10?`0${F+n+1}`:F+n+1})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.street_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.ward_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.zone_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2  font-lexend whitespace-nowrap capitalize text-gray-700",children:K(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:K(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(ve,{onClick:()=>Z(n)}),ce(n)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[S&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{b(!0),i(t.street_id),Z()},children:"Edit"}),P&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{y(!0),B(t.street_id),Z()},children:"Delete"})]})]})})]},n))})]})})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx(Be,{handleDownload:we}),e.jsx(ze,{Length:$.length,currentPage:c,totalPages:R,firstIndex:F,lastIndex:O,paginate:ie,hasNextPage:O>=J.length})]})]})}),j&&e.jsx(Ae,{toggleModal:me,toggleCloseModal:ue,ExistingWards:l,handlerefresh:W}),D&&e.jsx(Fe,{toggleModal:xe,handlerefresh:W,ExistingWards:l,streetId:E}),m&&e.jsx(ke,{toggleDeleteModal:G,delete:ge})]})};export{Qe as default};
