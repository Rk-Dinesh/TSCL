import{r as i,u as T,b as C,A as _,d as V,j as e,I as H,m as w,n as Y,B as q}from"./index-BcYsGqVu.js";import{R as d}from"./index-D7OJULEB.js";import{P as G,a as J}from"./index-1Cs2earB.js";import{a as K}from"./index-D_-LWkAi.js";import{E as Q}from"./jspdf.plugin.autotable-doWDoFvS.js";const ne=({permissions:r})=>{r==null||r.includes("create"),r==null||r.includes("edit"),r==null||r.includes("delete");const P=r==null?void 0:r.includes("download"),[j,D]=i.useState(""),[l,k]=i.useState(1),[p]=i.useState(8),[g,S]=i.useState(1),[W,E]=i.useState([]),[x,I]=i.useState([]),L=sessionStorage.getItem("token"),z=sessionStorage.getItem("role");sessionStorage.getItem("dept");const[y,A]=i.useState(null),O=T();i.useEffect(()=>{M()},[j,l]);const u=t=>{t>0&&t<=g&&k(t)},M=()=>{C.get(`${_}/grievance-escalation/get`,{headers:{Authorization:`Bearer ${L}`}}).then(t=>{const a=V(t.data.data);a.filter(s=>s.escalation_to.toLowerCase()===z.toLowerCase()),I(a);const m=a.filter(s=>Object.values(s).some(n=>n.toString().toLowerCase().includes(j.toLowerCase())));S(Math.ceil(m.length/p));const c=l*p,h=c-p;E(m.slice(h,c))}).catch(t=>{console.error(t)})},b=l*p,f=b-p,v=x.filter(t=>Object.values(t).some(a=>a.toString().toLowerCase().includes(j.toLowerCase()))),U=v.slice().reverse().slice(f,b),$=t=>{A(t.target.value)},N=async t=>{if(t==="csv"){const a=x.map(n=>({grievance_id:n.grievance_id,escalation_department:n.escalation_department,escalation_complaint:n.escalation_complaint,escalated_due:n.escalated_due,escalated_user:n.escalated_user,escalation_details:n.escalation_details,status:n.status,updatedAt:w(n.updatedAt)})),m=[Object.keys(a[0]).join(","),...a.map(n=>Object.values(n).join(","))].join(`
`),c=new Blob([m],{type:"text/csv;charset=utf-8;"}),h=window.URL.createObjectURL(c),s=document.createElement("a");s.setAttribute("href",h),s.setAttribute("download","Escalation_data.csv"),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}else if(t==="pdf")try{const m=Math.ceil(x.length/30),c=new Q("l","mm","a4");let h=0;for(let s=1;s<=m;s++){const n=(s-1)*30,R=Math.min(n+30,x.length),F=x.slice(n,R).map(o=>[o.grievance_id,o.escalation_department,o.escalation_complaint,o.escalated_due,o.escalated_user,o.escalation_details,o.status,w(o.updatedAt)]);c.text(`Page ${s}`,10,h+10),c.autoTable({startY:h+15,head:[["grievance_id","Department","Complaint","Over Due","Escalated User","Escalation Details","status","LastUpdated"]],body:F,theme:"striped"}),s<m&&(c.addPage(),h=10)}c.save("Escalation_data.pdf")}catch(a){console.error("Error exporting data:",a)}},B=()=>{try{C.post(`${_}/manual-escalation-check`).then(t=>{q.success("Manual Escalation Done!!!")}).catch(t=>{console.error(t)})}catch{}};return e.jsx(i.Fragment,{children:e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen ",children:[e.jsxs("div",{className:"flex flex-row  gap-1 justify-between items-center my-7 mx-8 flex-wrap",children:[e.jsxs("h1",{className:"md:text-xl text-lg font-medium whitespace-nowrap",children:[" ","Escalation"]}),e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsxs("div",{className:"flex  items-center gap-3 bg-white py-2 px-3 rounded-full",children:[e.jsx(H,{className:"text-xl"}),e.jsx("input",{type:"search",className:"outline-none bg-transparent text-base",placeholder:"Search Escalation",value:j,onChange:t=>D(t.target.value)})]}),e.jsx("button",{className:"bg-red-600 rounded-full px-3 py-2 text-white text-sm",onClick:()=>B(),children:"Manual Cron"}),P&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("form",{children:e.jsxs("select",{className:"block w-full py-2 px-2  text-sm border-2 text-gray-400  border-gray-300 rounded-full bg-gray-50 outline-none",onChange:$,children:[e.jsx("option",{hidden:!0,children:"Download"}),e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"pdf",children:"PDF"})]})}),y===null&&e.jsx(K,{className:"text-2xl text-gray-500"}),y==="csv"&&e.jsx(G,{className:"text-3xl text-gray-500",onClick:()=>N("csv")}),y==="pdf"&&e.jsx(J,{className:"text-3xl text-gray-500",onClick:()=>N("pdf")})]})]})]}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar my-3",children:e.jsxs("table",{className:"w-full  ",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Complaint No ",e.jsx(d,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Department ",e.jsx(d,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Complaint ",e.jsx(d,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-center font-semibold whitespace-nowrap",children:["Date ",e.jsx(d,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Over Due ",e.jsx(d,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Escalated User ",e.jsx(d,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Escalation Level ",e.jsx(d,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Status ",e.jsx(d,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:"Action"})})]})}),e.jsx("tbody",{children:U.map((t,a)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center",children:f+a+1<10?`0${f+a+1}`:f+a+1})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 border-slate-900 rounded-lg text-center py-1 my-1 capitalize text-slate-900 ",children:t.grievance_id})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.escalation_department})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.escalation_complaint})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2  font-lexend text-center whitespace-nowrap text-sm text-gray-800",children:w(t.updatedAt)})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2  font-lexend text-center whitespace-nowrap text-sm text-gray-800",children:t.escalated_due})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800",children:t.escalated_user})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800",children:t.escalation_details})}),e.jsx("td",{children:e.jsx("p",{className:"border w-28 rounded-full text-center py-1.5 mx-2 text-sm font-normal capitalize border-gray-800 text-gray-800",children:t.status})}),e.jsx("td",{children:e.jsx("div",{className:"mx-3 my-3 whitespace-nowrap",onClick:()=>O("/view",{state:{grievanceId:t.grievance_id}}),children:e.jsx(Y,{})})})]},a))})]})})}),e.jsx("div",{className:" my-3 mb-5 mx-7",children:e.jsxs("nav",{className:"flex items-center flex-column flex-wrap md:flex-row md:justify-between justify-center pt-4","aria-label":"Table navigation",children:[e.jsxs("span",{className:"text-sm font-normal text-gray-700 mb-4 md:mb-0 block w-full md:inline md:w-auto text-center font-alegerya",children:["Showing"," ",e.jsxs("span",{className:"text-gray-700",children:[f+1," to ",Math.min(b,x.length)]})," ","of"," ",e.jsxs("span",{className:"text-gray-900",children:[x.length," entries"]})]}),e.jsxs("ul",{className:"inline-flex -space-x-px rtl:space-x-reverse text-sm h-8 font-alegerya",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>u(1),disabled:l===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-s-lg hover:bg-paginate-bg hover:text-primary-hover",children:"<<"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>u(l-1),disabled:l===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Back"})}),Array.from({length:g},(t,a)=>a+1).slice(Math.max(0,l-2),Math.min(g,l+1)).map(t=>e.jsx("li",{children:e.jsx("button",{onClick:()=>u(t),className:`flex items-center justify-center px-3 h-8 leading-tight border border-paginate-br hover:text-white hover:bg-primary ${l===t?"bg-primary text-white":"bg-white text-black"}`,children:t})},t)),e.jsx("li",{children:e.jsx("button",{onClick:()=>u(l+1),disabled:b>=v.length,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Next"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>u(g),disabled:l===g,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-e-lg hover:bg-paginate-bg hover:text-primary-hover",children:">>"})})]})]})})]})})})};export{ne as default};
