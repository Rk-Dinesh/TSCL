import{r as s,j as e,l as Pe,u as Ae,P as ke,E as De,y as ze,p as T,b as K,A as Q,d as W,O as Ie,w as Me,z as Ee,J as Te,B as $e}from"./index-Cb3AN3R3.js";import{S as Le,D as Re,E as Ge}from"./DocumentDownload-A0b-q8L_.js";import{P as Oe}from"./Pagination-ClPqWgoN.js";import{D as Ue,a as Be}from"./DateRangeComp-B_BpUMFB.js";import{M as Fe}from"./ManyTicketTransfer-CEtZFA1_.js";import"./index-CmROlnnr.js";import"./index-Du0g9a49.js";import"./index-aztxF81R.js";const He=({Ward:l,handleWard:m})=>{var h;const[f,w]=s.useState(""),[b,j]=s.useState(!1),P=x=>{w(x.target.value),j(!0)},y=x=>{m(x),w(x),j(!1)},p=(h=l==null?void 0:l.data)==null?void 0:h.filter(x=>x.ward_name.toLowerCase().includes(f.toLowerCase()));return e.jsxs("div",{className:"relative  ",children:[e.jsx("input",{type:"text",className:"block  px-3 py-2 w-24 text-sm bg-primary text-white border border-none rounded-full outline-none shadow-lg",placeholder:"Ward",value:f,onChange:P}),b&&e.jsx("div",{className:"absolute top-full left-0 w-24 max-h-40 overflow-auto bg-white shadow-lg rounded-lg z-10",children:e.jsxs("ul",{children:[e.jsx("li",{className:"px-3 py-2 hover:bg-gray-200 cursor-pointer",onClick:()=>y("All"),children:"All"}),p==null?void 0:p.map((x,_)=>e.jsx("li",{className:"px-3 py-2 hover:bg-gray-200 cursor-pointer",onClick:()=>y(x.ward_name),children:x.ward_name},_)),(p==null?void 0:p.length)===0&&e.jsx("li",{className:"px-3 py-2 text-gray-500",children:"No results found"})]})})]})},X=({permissions:l,include:m,endpoint:f})=>{var Y;l==null||l.includes("create"),l==null||l.includes("edit"),l==null||l.includes("delete");const w=l==null?void 0:l.includes("download"),b=Pe(),[j,P]=s.useState(""),[y,p]=s.useState(1),[h,x]=s.useState(10),[_,ee]=s.useState(1),[Ve,te]=s.useState([]),[$,ae]=s.useState([]),[A,se]=s.useState([]),[u,k]=s.useState([]),L=localStorage.getItem("token"),ne=localStorage.getItem("code"),R=Ae(),[le,ce]=s.useState(null),[G,O]=s.useState(!1),[U,B]=s.useState([]),[F,re]=s.useState("All"),[D,z]=s.useState(null),[I,H]=s.useState(null),[V,Z]=s.useState(null),[M,E]=s.useState(null),[ie,oe]=s.useState({}),[J,de]=s.useState({});s.useEffect(()=>{q(),me()},[]),s.useEffect(()=>{b(ke()),b(De()),b(ze())},[b]);const S=T(t=>t.zone),xe=T(t=>t.ward),g=T(t=>t.origin);s.useEffect(()=>{var t;if(g&&(g!=null&&g.data)){const a=(t=g==null?void 0:g.data)==null?void 0:t.reduce((c,r)=>(c[r.res_name]=r.image,c),{});oe(a)}},[g]);const q=()=>{K.get(`${Q}/new-grievance/${f}?assign_user=${ne}`,{headers:{Authorization:`Bearer ${L}`}}).then(t=>{const a=W(t.data.data);se(a);const c=a.filter(r=>Object.values(r).some(o=>o.toString().toLowerCase().includes(j.toLowerCase())));k(c)}).catch(t=>{console.error(t)})};s.useEffect(()=>{const t=A.filter(a=>Object.values(a).some(c=>c.toString().toLowerCase().includes(j.toLowerCase())));k(t)},[j]),s.useEffect(()=>{const t=y*h,a=t-h;te(u.slice(a,t)),ee(Math.ceil(u.length/h))},[u,y,h]);const me=async()=>{try{const t=await K.get(`${Q}/status/get`,{headers:{Authorization:`Bearer ${L}`}}),a=W(t.data.data),c=a.reduce((r,o)=>(r[o.status_name]=o.color,r),{});ae(a),de(c)}catch(t){console.error("Error fetching existing ActiveStatus:",t)}},v=t=>{t>0&&t<=_&&p(t)},he=t=>{const a=t[0].startDate,c=t[0].endDate,r=A.filter(o=>{const i=new Date(o.createdAt);return i>=a&&i<Be(c,1)});k(r),$e.success("Grievance filtered")},C=y*h,N=C-h,ue=t=>{re(t),z(null),E(null),v(1)},pe=t=>{z(t==="All"?null:t),v(1)},ge=t=>{H(t==="All"?null:t),v(1)},fe=t=>{Z(t==="All"?null:t),v(1)},je=t=>{E(t==="All"?null:t),v(1)},ye=u.slice().reverse().filter(t=>{const a=F==="All"?!0:"",c=D===null?!0:t.status===D,r=M===null?!0:t.priority===M,o=I===null?!0:t.zone_name===I,i=V===null?!0:t.ward_name===V;return a&&c&&r&&o&&i}).slice(N,C),be=t=>{ce(t.target.value)},ve=async t=>{if(t==="csv"){const a=u.map(n=>({grievance_id:n.grievance_id,grievance_mode:n.grievance_mode,complaint_type_title:n.complaint_type_title,dept_name:n.dept_name,zone_name:n.zone_name,ward_name:n.ward_name,street_name:n.street_name,pincode:n.pincode,complaint:n.complaint,public_user_id:n.public_user_id,public_user_name:n.public_user_name,phone:n.phone,assign_user:n.assign_user,assign_username:n.assign_username,assign_userphone:n.assign_userphone,status:n.status,escalation_level:n.escalation_level,priority:n.priority})),c=[Object.keys(a[0]).join(","),...a.map(n=>Object.values(n).join(","))].join(`
`),r=new Blob([c],{type:"text/csv;charset=utf-8;"}),o=window.URL.createObjectURL(r),i=document.createElement("a");i.setAttribute("href",o),i.setAttribute("download","Grievance_data.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}else if(t==="pdf")try{const c=Math.ceil(u.length/30),r=new Ge("l","mm","a4");let o=0;for(let i=1;i<=c;i++){const n=(i-1)*30,Se=Math.min(n+30,u.length),Ce=u.slice(n,Se).map(d=>[d.grievance_id,d.grievance_mode,d.complaint_type_title,d.dept_name,d.pincode,d.complaint,d.public_user_name,d.phone,d.assign_username,d.assign_userphone,d.status,d.escalation_level,d.priority]);r.text(`Page ${i}`,10,o+10),r.autoTable({startY:o+15,head:[["grievance_id","grievance_mode","complaintType","dept","pincode","complaint","publicUser","phone","assignUser","assignUserphone","status","Escalation","Priority"]],body:Ce,theme:"striped"}),i<c&&(r.addPage(),o=10)}r.save("Grievance_data.pdf")}catch(a){console.error("Error exporting data:",a)}},we=t=>{const a=parseInt(t.target.value,10);x(a),p(1)},Ne=t=>{B(a=>a.includes(t)?a.filter(c=>c!==t):[...a,t])},_e=()=>{O(!G),B([])};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:"  font-lexend h-screen ",children:[e.jsxs("div",{className:"flex flex-row  gap-3 p-2 mt-1 mx-4 flex-wrap md:justify-between items-center ",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Ue,{onChange:he}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-medium text-gray-600",children:"Page Entries"}),e.jsxs("select",{id:"itemsPerPage",value:h,onChange:we,className:" p-1 outline-none text-sm rounded px-2",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]}),e.jsxs("div",{className:"flex flex-row flex-wrap gap-1.5",children:[e.jsx(Le,{value:j,onChange:t=>P(t.target.value),placeholder:"Search Grievances"}),w&&e.jsx(Re,{selectedDoc:le,onChange:be,exportData:ve})]})]}),e.jsxs("div",{className:`bg-white  mx-4 rounded-lg mt-1  p-3 ${A.length<8?"h-4/5":"h-fit"}`,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center md:gap-6 gap-2 md:mt-2 mx-3",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsx("p",{className:"text-lg  whitespace-nowrap",children:"View Report"})}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("select",{className:"block w-full  px-1 py-2 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-lg",onChange:t=>ge(t.target.value),value:I||"",children:[e.jsx("option",{hidden:!0,children:"Zone"}),e.jsx("option",{value:"All",children:"All"}),S&&((Y=S==null?void 0:S.data)==null?void 0:Y.map((t,a)=>e.jsx("option",{value:t.zone_name,children:t.zone_name},a)))]})}),e.jsx(He,{Ward:xe,handleWard:fe}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("select",{className:"block w-full  px-1 py-2 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-lg",onChange:t=>je(t.target.value),value:M||"",children:[e.jsx("option",{hidden:!0,children:"Priority"}),e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"Low",children:"Low"})]})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("select",{className:"block w-full  px-1 py-2 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-lg",onChange:t=>pe(t.target.value),value:D||"",children:[e.jsx("option",{hidden:!0,children:"Status"}),e.jsx("option",{value:"All",children:"All"}),$&&$.map((t,a)=>e.jsx("option",{value:t.status_name,children:t.status_name},a))]})}),e.jsx("button",{className:`w-20 py-1.5 ${F==="All"?"bg-primary text-white":"bg-white text-black"} rounded-full shadow-lg`,onClick:()=>ue("All"),children:"All"})]})]}),m=="yes"&&e.jsx("div",{className:"my-2 mx-3 flex flex-wrap gap-2 ",children:e.jsx("button",{className:"bg-blue-300 shadow-md px-3 py-1 rounded-full text-white text-sm",onClick:()=>O(!0),children:"Multi-Transfer"})}),e.jsx("div",{className:" rounded-lg  py-3 overflow-x-auto ",children:e.jsxs("table",{className:"w-full mt-2 ",children:[e.jsx("thead",{className:" border-b border-gray-300  ",children:e.jsxs("tr",{className:"",children:[m==="yes"&&e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-3 my-2 font-lexend text-center font-semibold whitespace-nowrap",children:e.jsx(Ie,{className:"text-xl text-center text-primary"})})}),e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend  font-medium whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 text-start font-lexend font-medium  whitespace-nowrap",children:"Complaint No"})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:"Origin"})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 text-start font-lexend font-medium  whitespace-nowrap",children:"Complaint"})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 text-start font-lexend font-medium  whitespace-nowrap",children:"Ward"})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 text-center font-lexend font-medium  whitespace-nowrap",children:"Street"})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:"Raised by"})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 text-start font-lexend font-medium  whitespace-nowrap",children:"Phone"})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:"Date and Time"})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-center mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:"Priority"})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-center mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:"Status"})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 text-start font-lexend font-medium  whitespace-nowrap",children:"Action"})})]})}),e.jsx("tbody",{children:ye.map((t,a)=>e.jsxs("tr",{className:`${t.isEsacalted==="yes"?"bg-red-500":t.isHighlighted==="yes"?"bg-yellow-200":"border-gray-300"} border-b`,children:[m==="yes"&&e.jsx("td",{className:" flex gap-2 items-center justify-center ",children:e.jsxs("div",{className:"flex items-center ",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 mt-4  text-dark bg-gray-800 border-gray-800 rounded",checked:U.includes(t.grievance_id),onChange:()=>Ne(t.grievance_id)}),e.jsx("label",{className:"sr-only",htmlFor:"checkbox-table-search-1",children:"checkbox"})]})}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"text-center text-sm mx-3 my-2 font-lexend whitespace-nowrap text-gray-700 flex items-center justify-center",children:[N+a+1<10?`0${N+a+1}`:N+a+1,(t==null?void 0:t.escalation_notify)&&(t==null?void 0:t.escalation_notify_read)==="no"&&e.jsx("span",{className:"ml-2 w-3 h-3 bg-blue-600 rounded-full"})]})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 border-slate-900 rounded-lg text-center py-1 my-1 capitalize text-slate-900 ",onClick:()=>R(`/view3?grievanceId=${t.grievance_id}`),children:t.grievance_id})}),e.jsx("td",{className:"flex gap-1 items-center justify-center text-gray-700",children:e.jsx("img",{src:ie[t.grievance_mode]||Me,alt:t.grievance_mode,className:"w-6 h-6 mx-1.5 my-2 rounded-full"})}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalizetext-gray-700",children:t.complaint})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalizetext-gray-700",children:t.ward_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalizetext-gray-700",children:t.street_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start ml-4 my-2 font-lexend whitespace-nowrap text-sm capitalizetext-gray-700",children:t.public_user_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalizetext-gray-700",children:t.phone})]}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalizetext-gray-700",children:Ee(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:`border-2 w-28 rounded-full text-center py-1.5 mx-2 text-sm font-medium capitalize  ${t.priority==="High"?"text-red-500 border-red-500":t.priority==="Medium"?"text-sky-500 border-sky-500":t.priority==="Low"?"text-green-500 border-green-500":""}`,children:t.priority})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 rounded-full text-center py-1 tex-sm font-normal mx-2 capitalize  ",style:{borderColor:J[t.status]||"gray",color:J[t.status]||"black",fontSize:14},children:t.status})}),e.jsxs("td",{className:"flex justify-center relative group",children:[e.jsx(Te,{className:"text-xl",onClick:()=>R(`/view3?grievanceId=${t.grievance_id}`)}),e.jsx("span",{className:"tooltip hidden group-hover:block absolute -top-6 left-1/2 transform -translate-x-1/2 bg-blue-400 text-white text-xs rounded py-1 px-2",children:"View"})]})]},a))})]})})]}),e.jsx("div",{className:" mt-1 mb-5 mx-7",children:e.jsx(Oe,{Length:u.length,currentPage:y,totalPages:_,firstIndex:N,lastIndex:C,paginate:v,hasNextPage:C>=u.length})})]})}),G&&e.jsx(Fe,{toggleTModal:_e,selectedRows:U,handlerefresh:q})]})};function tt({permissions:l}){const[m,f]=s.useState("tab1");return e.jsxs("div",{className:"overflow-auto no-scrollbar",children:[e.jsxs("ul",{className:"flex mb-2 list-none justify-center mt-1",children:[e.jsx("li",{className:"-mb-px mr-1",children:e.jsx("a",{className:`text-white   font-medium rounded-sm text-sm px-5 py-1.5 text-center  ${m==="tab1"?"bg-gray-700":"bg-gray-400"}`,onClick:()=>f("tab1"),children:"Current Grievances"})}),e.jsx("li",{className:"-mb-px mr-1",children:e.jsx("a",{className:`text-white   font-medium rounded-sm text-sm px-5 py-1.5 text-center ${m==="tab2"?"bg-gray-700":"bg-gray-400"}`,onClick:()=>f("tab2"),children:"Closed Grievances"})})]}),e.jsxs("div",{className:"mx-1 ",children:[m==="tab1"&&e.jsx(X,{permissions:l,include:"yes",endpoint:"getbyassignnotclosed"}),m==="tab2"&&e.jsx(X,{permissions:l,endpoint:"getbyassignclosed"})]})]})}export{tt as default};
