import{r as c,u as H,b as C,A as S,d as k,j as e,I as Y,F as J,t as q}from"./index-q9gTl8Nx.js";import{R as h}from"./index-BV5I8TVR.js";import{P as K,a as Q}from"./index-Dc1RO-OU.js";import{a as W}from"./index-CrIzh8Eh.js";import{E as X}from"./jspdf.plugin.autotable-UcE--c0v.js";const ie=({permissions:l})=>{const D=l==null?void 0:l.includes("create");l==null||l.includes("edit"),l==null||l.includes("delete");const I=l==null?void 0:l.includes("download");c.useState(!1);const[j,A]=c.useState(""),[d,z]=c.useState(1),[p]=c.useState(8),[g,E]=c.useState(1),[Z,L]=c.useState([]),[m,M]=c.useState([]),v=sessionStorage.getItem("token"),_=H(),O=()=>{_("/form")},[ee,$]=c.useState([]),[w,G]=c.useState({}),[y,F]=c.useState(null);c.useEffect(()=>{C.get(`${S}/new-grievance/get`,{headers:{Authorization:`Bearer ${v}`}}).then(t=>{const s=k(t.data.data);M(s);const x=s.filter(n=>Object.values(n).some(a=>a.toString().toLowerCase().includes(j.toLowerCase())));E(Math.ceil(x.length/p));const i=d*p,o=i-p;L(x.slice(o,i))}).catch(t=>{console.error(t)}),R()},[j,d]);const R=async()=>{try{const t=await C.get(`${S}/status/get`,{headers:{Authorization:`Bearer ${v}`}}),s=k(t.data.data),x=s.reduce((i,o)=>(i[o.status_name]=o.color,i),{});$(s),G(x)}catch(t){console.error("Error fetching existing ActiveStatus:",t)}},u=t=>{t>0&&t<=g&&z(t)},b=d*p,f=b-p,N=m.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(j.toLowerCase()))),T=N.slice().reverse().slice(f,b),U=t=>{F(t.target.value)},P=async t=>{if(t==="csv"){const s=m.map(a=>({grievance_id:a.grievance_id,grievance_mode:a.grievance_mode,complaint_type_title:a.complaint_type_title,dept_name:a.dept_name,zone_name:a.zone_name,ward_name:a.ward_name,street_name:a.street_name,pincode:a.pincode,complaint:a.complaint,public_user_id:a.public_user_id,public_user_name:a.public_user_name,phone:a.phone,assign_user:a.assign_user,assign_username:a.assign_username,assign_userphone:a.assign_userphone,status:a.status,escalation_level:a.escalation_level,priority:a.priority})),x=[Object.keys(s[0]).join(","),...s.map(a=>Object.values(a).join(","))].join(`
`),i=new Blob([x],{type:"text/csv;charset=utf-8;"}),o=window.URL.createObjectURL(i),n=document.createElement("a");n.setAttribute("href",o),n.setAttribute("download","Grievance_data.csv"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}else if(t==="pdf")try{const x=Math.ceil(m.length/30),i=new X("l","mm","a4");let o=0;for(let n=1;n<=x;n++){const a=(n-1)*30,B=Math.min(a+30,m.length),V=m.slice(a,B).map(r=>[r.grievance_id,r.grievance_mode,r.complaint_type_title,r.dept_name,r.pincode,r.complaint,r.public_user_name,r.phone,r.assign_username,r.assign_userphone,r.status,r.escalation_level,r.priority]);i.text(`Page ${n}`,10,o+10),i.autoTable({startY:o+15,head:[["grievance_id","grievance_mode","complaintType","dept","pincode","complaint","publicUser","phone","assignUser","assignUserphone","status","Escalation","Priority"]],body:V,theme:"striped"}),n<x&&(i.addPage(),o=10)}i.save("Grievance_data.pdf")}catch(s){console.error("Error exporting data:",s)}};return e.jsx(c.Fragment,{children:e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row  gap-3 p-2 mt-3 mx-8 flex-wrap md:justify-end ",children:[e.jsxs("p",{className:"flex items-center gap-3 bg-white px-3 py-1.5 rounded-full",children:[e.jsx(Y,{className:"text-xl"}),e.jsx("input",{type:"search",className:"outline-none bg-transparent text-base",placeholder:"Search Grievances",value:j,onChange:t=>A(t.target.value)})]}),I&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("form",{children:e.jsxs("select",{className:"block w-full py-2 px-2  text-sm border-2 text-gray-400  border-gray-300 rounded-full bg-gray-50 outline-none",onChange:U,children:[e.jsx("option",{hidden:!0,children:"Download"}),e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"pdf",children:"PDF"})]})}),y===null&&e.jsx(W,{className:"text-2xl text-gray-500"}),y==="csv"&&e.jsx(K,{className:"text-3xl text-gray-500",onClick:()=>P("csv")}),y==="pdf"&&e.jsx(Q,{className:"text-3xl text-gray-500",onClick:()=>P("pdf")})]})]}),e.jsxs("div",{className:"flex flex-row  gap-1 justify-between items-center my-2 mx-8 flex-wrap",children:[e.jsxs("h1",{className:"md:text-xl text-lg font-medium whitespace-nowrap",children:[" ","New Grievances"]}),D&&e.jsxs("button",{className:"flex flex-row-2 gap-2 items-center border-2 bg-blue-500 text-white font-lexend rounded-full p-2.5 w-fit justify-between md:text-base text-sm",onClick:O,children:[e.jsx(J,{})," Add Grievances"]})]}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3 py-3 overflow-x-auto h-3/5 no-scrollbar ",children:e.jsxs("table",{className:"w-full mt-2 ",children:[e.jsx("thead",{className:" border-b border-gray-300  ",children:e.jsxs("tr",{className:"",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-3 my-2 font-lexend font-medium whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 text-start font-lexend font-medium  whitespace-nowrap",children:"Complaint No"})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Raised by ",e.jsx(h,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Complaint Type ",e.jsx(h,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Department",e.jsx(h,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Assigned JE ",e.jsx(h,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Date and Time ",e.jsx(h,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:["Priority ",e.jsx(h,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-center mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Status ",e.jsx(h,{})]})})]})}),e.jsx("tbody",{children:T.map((t,s)=>e.jsxs("tr",{className:" border-b border-gray-300  ",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"text-center text-sm mx-3 my-2 font-lexend whitespace-nowrap text-gray-700",children:f+s+1<10?`0${f+s+1}`:f+s+1})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 border-slate-900 rounded-lg text-center py-1 my-1   text-slate-900",onClick:()=>_("/view",{state:{grievanceId:t.grievance_id}}),children:t.grievance_id})}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.public_user_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.complaint_type_title})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.dept_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.assign_username?t.assign_username:"Yet to be assigned"})]}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:q(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:`border-2 w-26 rounded-full text-center py-1.5 mx-2 text-sm font-medium capitalize  ${t.priority==="High"?"text-red-500 border-red-500":t.priority==="Medium"?"text-sky-500 border-sky-500":t.priority==="Low"?"text-green-500 border-green-500":""}`,children:t.priority})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 rounded-full text-center py-1 tex-sm font-normal mx-2 capitalize  ",style:{borderColor:w[t.status]||"gray",color:w[t.status]||"black",fontSize:14},children:t.status})})]},s))})]})}),e.jsx("div",{className:" my-3 mb-5 mx-7",children:e.jsxs("nav",{className:"flex items-center flex-column flex-wrap md:flex-row md:justify-between justify-center pt-4","aria-label":"Table navigation",children:[e.jsxs("span",{className:"text-sm font-normal text-gray-700 mb-4 md:mb-0 block w-full md:inline md:w-auto text-center font-alegerya",children:["Showing"," ",e.jsxs("span",{className:"text-gray-700",children:[f+1," to ",Math.min(b,m.length)]})," ","of"," ",e.jsxs("span",{className:"text-gray-900",children:[m.length," entries"]})]}),e.jsxs("ul",{className:"inline-flex -space-x-px rtl:space-x-reverse text-sm h-8 font-alegerya",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>u(1),disabled:d===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-s-lg hover:bg-paginate-bg hover:text-primary-hover",children:"<<"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>u(d-1),disabled:d===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Back"})}),Array.from({length:g},(t,s)=>s+1).slice(Math.max(0,d-2),Math.min(g,d+1)).map(t=>e.jsx("li",{children:e.jsx("button",{onClick:()=>u(t),className:`flex items-center justify-center px-3 h-8 leading-tight border border-paginate-br hover:text-white hover:bg-primary ${d===t?"bg-primary text-white":"bg-white text-black"}`,children:t})},t)),e.jsx("li",{children:e.jsx("button",{onClick:()=>u(d+1),disabled:b>=N.length,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Next"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>u(g),disabled:d===g,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-e-lg hover:bg-paginate-bg hover:text-primary-hover",children:">>"})})]})]})})]})})})};export{ie as default};
