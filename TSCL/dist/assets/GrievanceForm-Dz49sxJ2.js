import{i as C,k as n,v as H,u as J,r as i,w as K,x as Q,y as X,z as Y,C as v,l as ee,b as c,A as m,d as y,j as e,o as te,B as h}from"./index-KIUE0VQ7.js";const ae=C().shape({public_user_name:n().required("Name is required"),phone:n().required("Contact number is required").matches(/^[0-9]{10}$/,"Contact number must be 10 digits"),email:n().required("Email id is required").email("Invalid email format"),address:n().required("Address is required")}),le=C().shape({grievance_mode:n().required("Origin is required"),complaint_type_title:n().required("Complaint  is required"),dept_name:n().required("Department is required"),zone_name:n().required("Zone is required"),ward_name:n().required("Ward is required"),street_name:n().required("Street is required"),pincode:n().required("Pincode is required").matches(/^[0-9]{6}$/,"Pincode must be 6 digits"),complaint:n().required("Complaint Type is required"),complaint_details:n().required("Description is required")}),se=C().shape({...ae.fields,...le.fields}).required(),oe=()=>{const f=H(),G=J(),[d,w]=i.useState(null),[D,$]=i.useState([]),[z,E]=i.useState([]),[A,V]=i.useState([]),[b,T]=i.useState([]);i.useState("");const g=sessionStorage.getItem("token");i.useEffect(()=>{f(K()),f(Q()),f(X()),f(Y())},[f]);const W=v(t=>t.department),Z=v(t=>t.complaint),P=v(t=>t.zone),B=v(t=>t.complainttype),{register:s,formState:{errors:a},handleSubmit:M,reset:O,setValue:r,watch:_}=ee({resolver:te(se),mode:"onBlur"}),N=_("phone"),k=_("zone_name"),F=_("ward_name"),S=_("dept_name");i.useEffect(()=>{S?c.get(`${m}/complaint/getdept?dept_name=${S}`,{headers:{Authorization:`Bearer ${g}`}}).then(t=>{try{const l=y(t.data.data);V(l),r("complaint_type_title","")}catch(l){console.error("Error decrypting data:",l)}}).catch(t=>{console.error("Error fetching data:",t)}):V([])},[S]),i.useEffect(()=>{k?c.get(`${m}/ward/getzone?zone_name=${k}`,{headers:{Authorization:`Bearer ${g}`}}).then(t=>{try{const l=y(t.data.data);$(l),r("ward_name",""),r("street_name","")}catch(l){console.error("Error decrypting data:",l)}}).catch(t=>{console.error("Error fetching data:",t)}):$([])},[k]),i.useEffect(()=>{F?c.get(`${m}/street/getward?ward_name=${F}`,{headers:{Authorization:`Bearer ${g}`}}).then(t=>{try{const l=y(t.data.data);E(l),r("street_name","")}catch(l){console.error("Error decrypting data:",l)}}).catch(t=>{console.error("Error fetching data:",t)}):E([])},[F]),i.useEffect(()=>{if(N&&N.length===10){async function t(){try{const l=await c.get(`${m}/public-user/getbyphone?phone=${N}`,{headers:{Authorization:`Bearer ${g}`}}),o=y(l.data.data);r("public_user_name",o.public_user_name),r("email",o.email),r("address",o.address),r("pincode",o.pincode),w(o)}catch{w(null)}}t()}else r("public_user_name",""),r("email",""),r("address",""),r("pincode",""),w(null)},[N]);const L=t=>{const l=t.target.files;l.length>5?(h.error("Maximum 5 files allowed"),t.target.value=null):T(l)},R=async t=>{const l={public_user_name:t.public_user_name,phone:t.phone,email:t.email,address:t.address,pincode:t.pincode,login_password:"tscl@123",verification_status:"active",user_status:"active"},u=x=>{const j=Z.data.find(p=>p.complaint_type_title===x);return j?j.priority:null};let o;if(d)await c.post(`${m}/public-user/post`,l),o=d.public_user_id;else{const x=await c.post(`${m}/public-user/post`,l);o=y(x.data.data)}const I={grievance_mode:t.grievance_mode,complaint_type_title:t.complaint,dept_name:t.dept_name,zone_name:t.zone_name,ward_name:t.ward_name,street_name:t.street_name,pincode:t.pincode,complaint:t.complaint_type_title,complaint_details:t.complaint_details,public_user_id:o,public_user_name:t.public_user_name,phone:t.phone,status:"new",statusflow:"new",priority:u(t.complaint_type_title)};console.log(I);try{const x=await c.post(`${m}/new-grievance/post`,I,{headers:{Authorization:`Bearer ${g}`}}),j=await x.data.data;if(x.status===200&&h.success("Grievance created Successfully"),b.length>0)if(b.length>5)h.error("File limit exceeded. Maximum 5 files allowed.");else try{const p=new FormData;for(let q=0;q<b.length;q++)p.append("files",b[q]);p.append("grievance_id",j),p.append("created_by_user","admin"),(await c.post(`${m}/new-grievance-attachment/post`,p,{headers:{"Content-Type":"multipart/form-data"}})).status===200&&(T([]),h.success("Attachment created Successfully"))}catch(p){console.error(p),h.error("Error creating attachment")}O(),G("/view",{state:{grievanceId:j}})}catch(x){console.log(x),h.error("An error occurred during submission. Please try again.")}},U=async(t,l)=>{try{return(await c.post(`${m}/translate/translate`,{text:t,targetLanguage:l})).data.translatedText}catch(u){return console.error(u),null}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-blue-100 flex flex-col  md:px-8 px-3 text-start h-fit   font-lexend overflow-y-auto no-scrollbar",children:[e.jsx("h1",{className:"text-xl my-5",children:"Grievance Form"}),e.jsxs("div",{className:"  bg-white max-w-[592px] h-fit rounded-lg ",children:[e.jsx("div",{className:"border-b-2 border-search",children:e.jsx("h1",{className:" text-xl px-3 py-3",children:"Request by"})}),e.jsxs("form",{onSubmit:M(R),children:[e.jsxs("div",{className:"flex flex-col flex-wrap overflow-hidden my-5 gap-2",children:[e.jsxs("div",{className:"flex flex-col md:flex-row  md:justify-between font-normal mx-10",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2",htmlFor:"phone",children:"Contact Number"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("input",{type:"text",id:"phone",className:"w-full md:w-80 text-start border-2  rounded-lg ml-2 px-2 py-2 outline-none",placeholder:"Phone Number",...s("phone")}),a.phone&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.phone.message})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row  md:justify-between font-normal mx-10",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2",htmlFor:"public_user_name",children:"Name"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("input",{type:"text",id:"public_user_name",className:"w-full md:w-80 text-start border-2  rounded-lg ml-2 px-2 py-2 outline-none",placeholder:"User Name",...s("public_user_name"),defaultValue:d?d.public_user_name:""}),a.public_user_name&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.public_user_name.message})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row  md:justify-between font-normal mx-10",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2",htmlFor:"email",children:"Email id"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("input",{type:"email",id:"email",className:"w-full md:w-80 text-start border-2  rounded-lg ml-2 px-2 py-2 outline-none",placeholder:"abc@gmail.com",...s("email"),defaultValue:d?d.email:""}),a.email&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.email.message})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row  md:justify-between font-normal mx-10",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 py-2",htmlFor:"address",children:"Address"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("input",{type:"text",id:"address",className:"w-full md:w-80 text-start border-2  rounded-lg ml-2 px-2 py-2 outline-none",placeholder:"Enter your Address",...s("address"),defaultValue:d?d.address:""}),a.address&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.address.message})]})]})]}),e.jsxs("div",{className:" flex-col justify-center items-center max-w-[592px] bg-white h-fit rounded-lg mt-5",children:[e.jsx("div",{className:"border-b-2 border-search",children:e.jsx("h1",{className:" text-xl px-3 py-3",children:"Grievance Details"})}),e.jsxs("div",{className:"flex flex-col flex-wrap overflow-y-auto my-5 gap-2 no-scrollbar",children:[e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3  font-normal mx-10  ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"grievance_mode",children:"Origin"}),e.jsxs("div",{className:" md:col-span-2",children:[e.jsxs("select",{className:"block w-full  px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...s("grievance_mode"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select an Origin"}),e.jsx("option",{value:"Whatsapp",children:"Whatsapp"}),e.jsx("option",{value:"Call",children:"Call"}),e.jsx("option",{value:"Website",children:"Website"})]}),a.grievance_mode&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.grievance_mode.message})]})]}),e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"complaint",children:"Complaint Type"}),e.jsxs("div",{className:" md:col-span-2",children:[e.jsxs("select",{className:"block w-full   px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...s("complaint"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Complaint Type"}),B.data&&B.data.map(t=>e.jsx("option",{value:t.complaint_type,children:t.complaint_type},t.compliant_type_id))]}),a.complaint&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.complaint.message})]})]}),e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"dept_name",children:"Department"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("select",{className:"block w-full  px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...s("dept_name"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Department"}),W.data&&W.data.map(t=>e.jsx("option",{value:t.dept_name,children:t.dept_name},t.dept_id))]}),a.dept_name&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.dept_name.message})]})]}),e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"complaint_type_title",children:"Complaint"}),e.jsxs("div",{className:" md:col-span-2",children:[e.jsxs("select",{className:"block w-full   px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...s("complaint_type_title"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Complaint"}),A&&A.map(t=>e.jsx("option",{value:t.complaint_type_title,children:t.complaint_type_title},t.complaint_id))]}),a.complaint_type_title&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.complaint_type_title.message})]})]}),e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"zone_name",children:"Zone"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("select",{className:"block w-full  px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...s("zone_name"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Zone"}),P.data&&P.data.map(t=>e.jsx("option",{value:t.zone_name,children:t.zone_name},t.zone_id))]}),a.zone_name&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.zone_name.message})]})]}),e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"ward_name",children:"Ward"}),e.jsxs("div",{className:" md:col-span-2",children:[e.jsxs("select",{className:"block w-full  px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...s("ward_name"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Ward"}),D&&D.map(t=>e.jsx("option",{value:t.ward_name,children:t.ward_name},t.ward_id))]}),a.ward_name&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.ward_name.message})]})]}),e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"street_name",children:"Street"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("select",{className:"block w-full  px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...s("street_name"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Street"}),z&&z.map(t=>e.jsx("option",{value:t.street_name,children:t.street_name},t.street_id))]}),a.street_name&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.street_name.message})]})]}),e.jsxs("div",{className:"gflex flex-col md:grid md:grid-cols-3   font-normal mx-10",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"pincode",children:"Pincode"}),e.jsxs("div",{className:"flex flex-col md:col-span-2",children:[e.jsx("input",{type:"text",id:"pincode",className:"w-full text-start border-2  rounded-lg  px-2 py-2 outline-none",placeholder:"Pincode",...s("pincode"),defaultValue:d?d.pincode:""}),a.pincode&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.pincode.message})]})]}),e.jsxs("div",{className:" flex flex-col md:grid md:grid-cols-3   font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg  font-medium mb-2 md:col-span-1",htmlFor:"complaint_details",children:"Description"}),e.jsxs("div",{className:"flex flex-col md:col-span-2 border rounded p-1",children:[e.jsx("div",{className:"flex justify-end items-center -mb-2",children:e.jsxs("select",{className:"block px-4 py-3 text-sm rounded-lg outline-none",onChange:t=>{const l=t.target.value,u=_("complaint_details");U(u,l).then(o=>{r("complaint_details",o)})},children:[e.jsx("option",{hidden:!0,value:"",children:"LAN"}),e.jsx("option",{value:"ta",children:"EN - TA"}),e.jsx("option",{value:"en",children:"TA - EN"})]})}),e.jsx("hr",{className:"w-full"}),e.jsx("textarea",{id:"complaint_details",rows:"5",className:"block py-2.5 pl-3 w-full text-sm text-gray-900 rounded border-none outline-none focus:outline-none focus:shadow-outline mb-2",placeholder:"Description here...",...s("complaint_details")}),a.complaint_details&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2",children:a.complaint_details.message})]})]}),e.jsxs("div",{className:" flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsxs("label",{className:"block text-black text-lg  font-medium mb-2 md:col-span-1",htmlFor:"file",children:["Attachment"," ",e.jsxs("p",{className:"text-xs ",children:["(optional / ",e.jsx("br",{})," upto 5 files allowed)"]})]}),e.jsxs("div",{className:"flex flex-col md:col-span-2",children:[e.jsx("input",{type:"file",id:"file",multiple:!0,accept:".jpeg, .jpg, .png",className:" w-full py-2 px-2 rounded-lg outline-none",onChange:L}),b.length>=5&&e.jsx("p",{className:"text-red-500 text-sm",children:"Maximum 5 files allowed"})]})]})]}),e.jsx("div",{className:" text-center my-3",children:e.jsx("button",{type:"submit",className:" text-white bg-primary text-base font-lexend rounded-full px-4 py-1.5 ",children:"Submit"})})]})]})]})]})})};export{oe as default};
