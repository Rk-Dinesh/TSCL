import{i as Q,k as R,r as s,m as X,o as ee,j as e,b as k,A as ve,B as y,d as q,q as K,s as De,v as Pe}from"./index-Cb3AN3R3.js";import{R as T}from"./index-C-hq6bKM.js";import{S as te}from"./SavaCancel-CuKZ8TfL.js";import{A as C}from"./ApiClient-w4qWO__2.js";import{D as Ie}from"./DeleteModal-De28Bu6M.js";import{S as Te,D as Ce,E as ke}from"./DocumentDownload-A0b-q8L_.js";import{B as ze}from"./BulkUploadButton-C25cRLG1.js";import{P as Ae}from"./Pagination-ClPqWgoN.js";import{F as Me}from"./FileUploadButton-DWkzr3As.js";import{H as We}from"./HeaderButton-By5upfsz.js";import"./index-Du0g9a49.js";import"./index-CmROlnnr.js";import"./index-BK6gNoz8.js";const Be=Q().shape({ward_name:R().test("not-select","Please select a ward",a=>a!==""&&a!=="Select Street"),street_name:R().required("street_name is required")}),Fe=a=>{const{ExistingWards:x}=a,[v,M]=s.useState(null),[z,D]=s.useState(null),[w,A]=s.useState(null),[p,f]=s.useState(null),[S,g]=s.useState(!1),{register:u,formState:{errors:h},handleSubmit:m,watch:W}=X({resolver:ee(Be),mode:"all"});s.useEffect(()=>{if(p){const n=x.find(j=>j.ward_name===p);n&&(M(n.zone_id),D(n.ward_id),A(n.zone_name))}},[p,x]);const U=async n=>{const j={...n,zone_id:v,ward_id:z,zone_name:w,status:"active",created_by_user:localStorage.getItem("name")};try{g(!0);const l=localStorage.getItem("token"),o=await k.post(`${ve}/street/post`,j,{headers:{Authorization:`Bearer ${l}`}});o.status===200?(y.success("Street created Successfully"),g(!1),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",o),g(!1),y.error("Failed to Upload"))}catch(l){console.error("Error in posting data",l),g(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Street"})}),e.jsxs("form",{onSubmit:m(U),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"ward_name",children:"Ward Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",...u("ward_name"),onChange:n=>f(n.target.value),children:[e.jsx("option",{value:"",children:"Select Ward"}),x.map((n,j)=>e.jsx("option",{value:n.ward_name,children:n.ward_name},j))]}),h.ward_name&&e.jsx("p",{className:"text-red-500",children:h.ward_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"street_name",children:"Street Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"street_name",type:"text",placeholder:"Street Name",...u("street_name")}),h.street_name&&e.jsx("p",{className:"text-red-500",children:h.street_name.message})]})]}),e.jsx(te,{onCancel:a.toggleCloseModal,isLoading:S})]})]})})},Re=Q().shape({ward_name:R().test("not-select","Please select a ward",a=>a!==""&&a!=="Select Street"),street_name:R().required("street_name is required"),status:R().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Ue=a=>{const{ExistingWards:x,streetId:v}=a,[M,z]=s.useState(null),[D,w]=s.useState(null),[A,p]=s.useState(null),[f,S]=s.useState(null),[g,u]=s.useState(!1),{register:h,formState:{errors:m},handleSubmit:W,watch:U,setValue:n}=X({resolver:ee(Re),mode:"all"});s.useEffect(()=>{(async()=>{try{const o=C.FETCH_STREET(v),c=await k.get(o.url,{headers:o.headers}),b=q(c.data.data);S(b.ward_name),n("ward_name",b.ward_name),n("street_name",b.street_name),n("status",b.status)}catch(o){console.error("Error fetching data",o)}})()},[v,n]),s.useEffect(()=>{if(f){const l=x.find(o=>o.ward_name===f);l&&(z(l.zone_id),w(l.ward_id),p(l.zone_name))}},[f,x]);const j=async l=>{const o={...l,zone_id:M,ward_id:D,zone_name:A};try{u(!0);const c=C.UPDATE_STREET(v),b=await k.post(c.url,o,{headers:c.headers});b.status===200?(y.success("Street updated Successfully"),u(!1),z(null),w(null),p(null),S(null),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",b),u(!1),y.error("Failed to Upload"))}catch(c){console.error("Error in posting data",c),u(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Street"})}),e.jsxs("form",{onSubmit:W(j),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"ward_name",children:"Ward Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",...h("ward_name"),onChange:l=>S(l.target.value),children:[e.jsx("option",{value:f,disabled:!0,children:f}),x.map((l,o)=>e.jsx("option",{value:l.ward_name,children:l.ward_name},o))]}),m.ward_name&&e.jsx("p",{className:"text-red-500",children:m.ward_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"street_name",children:"Street Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"street_name",type:"text",placeholder:"Street Name",...h("street_name")}),m.street_name&&e.jsx("p",{className:"text-red-500",children:m.street_name.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...h("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),m.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:m.status.message})]})]}),e.jsx(te,{onCancel:a.toggleModal,isLoading:g})]})]})})},Le=`ward_id,street_name
 Ward***,streetName`,st=({permissions:a})=>{const x=a==null?void 0:a.includes("create"),v=a==null?void 0:a.includes("edit"),M=a==null?void 0:a.includes("delete"),z=a==null?void 0:a.includes("download"),[D,w]=s.useState(!1),[A,p]=s.useState(!1),[f,S]=s.useState(null),[g,u]=s.useState(!1),[h,m]=s.useState(null),[W,U]=s.useState(null),[n,j]=s.useState(""),[l,o]=s.useState(1),[c,b]=s.useState(10),[G,ae]=s.useState(1),[Oe,se]=s.useState([]),[P,re]=s.useState([]),[Z,ne]=s.useState(null),[le,L]=s.useState(null),[H,O]=s.useState("Bulk Upload"),[oe,de]=s.useState(null),V=t=>{ne(Z===t?null:t)},ce=t=>Z===t;s.useEffect(()=>{B(),he()},[n,l,c]);const ie=t=>{t>0&&t<=G&&o(t)},B=()=>{k.get(C.GET_STREET.url,{headers:C.GET_STREET.headers}).then(t=>{const r=q(t.data.data);re(r);const N=r.filter(i=>Object.values(i).some(d=>d.toString().toLowerCase().includes(n.toLowerCase())));ae(Math.ceil(N.length/c));const _=l*c,I=_-c;se(N.slice(I,_))})},me=()=>{w(!D)},xe=()=>{p(!A),S(null)},ue=()=>{w(!D)},Y=()=>{u(!g),m(null)},he=async()=>{try{const t=await k.get(C.GET_WARD_STREETACTIVE.url,{headers:C.GET_WARD_STREETACTIVE.headers}),r=q(t.data.data);U(r)}catch(t){console.error("Error fetching existing roles:",t)}},$=l*c,F=$-c,J=P.filter(t=>Object.values(t).some(r=>r.toString().toLowerCase().includes(n.toLowerCase()))),pe=J.slice(F,$),fe=async()=>{try{const t=C.DELETE_STREET(h);await k.delete(t.url,{headers:t.headers}),Y(),B(),y.success("Deleted successfully")}catch{y.error("Failed to delete")}},ge=t=>{L(t.target.files[0]),O("Upload")},je=()=>{H==="Bulk Upload"?document.getElementById("fileInput").click():be(le)},be=async t=>{try{console.log(t);const r=new FormData;r.append("file",t),r.append("created_by_user",localStorage.getItem("name")),(await k.post(`${API}/street/uploadcsv`,r,{headers:{"Content-Type":"multipart/form-data"}})).status===200&&(O("Bulk Upload"),L(null),B(),y.success("Data Uploaded successfully"))}catch(r){r.response&&r.response.data&&r.response.data.error?(y.error(r.response.data.error),O("Bulk Upload"),L(null)):(y.error("An unexpected error occurred"),O("Bulk Upload"),L(null))}},_e=t=>{de(t.target.value)},ye=async t=>{if(t==="csv"){const r=P.map(d=>({street_id:d.street_id,street_name:d.street_name,ward_id:d.ward_id,ward_name:d.ward_name,zone_id:d.zone_id,zone_name:d.zone_name,status:d.status,created_by_user:d.created_by_user})),N=[Object.keys(r[0]).join(","),...r.map(d=>Object.values(d).join(","))].join(`
`),_=new Blob([N],{type:"text/csv;charset=utf-8;"}),I=window.URL.createObjectURL(_),i=document.createElement("a");i.setAttribute("href",I),i.setAttribute("download","Street_data.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}else if(t==="pdf")try{const N=Math.ceil(P.length/30),_=new ke("l","mm","a4");let I=0;for(let i=1;i<=N;i++){const d=(i-1)*30,Ne=Math.min(d+30,P.length),Ee=P.slice(d,Ne).map(E=>[E.street_id,E.street_name,E.ward_id,E.ward_name,E.zone_id,E.zone_name,E.status,E.created_by_user]);_.text(`Page ${i}`,10,I+10),_.autoTable({startY:I+15,head:[["street_id","street_name","ward_id","ward_name","zone_id","zone_name","status","created_by_user"]],body:Ee,theme:"striped"}),i<N&&(_.addPage(),I=10)}_.save("Street_data.pdf")}catch(r){console.error("Error exporting data:",r)}},we=()=>{Pe(Le)},Se=t=>{const r=parseInt(t.target.value,10);b(r),o(1)};return e.jsxs(s.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-2 mx-8 flex-wrap",children:[e.jsx(Te,{value:n,onChange:t=>j(t.target.value),placeholder:"Search Street"}),x&&e.jsx(Me,{onChange:ge,buttonText:H,accept:".csv",onClick:je}),z&&e.jsx(Ce,{selectedDoc:oe,onChange:_e,exportData:ye})]}),e.jsx(We,{title:"Street",hasCreatePermission:x,onClick:()=>w(!0)}),e.jsxs("div",{className:`bg-white  mx-4 rounded-lg mt-1  p-3 ${P.length<6?"h-3/5":"h-fit"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mx-3",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-medium text-gray-600",children:"Page Entries"}),e.jsxs("select",{id:"itemsPerPage",value:c,onChange:Se,className:" p-1 outline-none text-sm rounded px-2",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]}),e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Street ",e.jsx(T,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Ward ",e.jsx(T,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Zone ",e.jsx(T,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Status ",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedBy ",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedAt",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["UpdatedAt",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-lexend font-semibold",children:"Action"})})]})}),e.jsx("tbody",{children:pe.map((t,r)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-700",children:F+r+1<10?`0${F+r+1}`:F+r+1})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.street_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.ward_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.zone_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2  font-lexend whitespace-nowrap capitalize text-gray-700",children:K(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:K(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(De,{onClick:()=>V(r)}),ce(r)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[v&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{p(!0),S(t.street_id),V()},children:"Edit"}),M&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{u(!0),m(t.street_id),V()},children:"Delete"})]})]})})]},r))})]})})]}),e.jsxs("div",{className:" my-2 mb-5 mx-7",children:[e.jsx(ze,{handleDownload:we}),e.jsx(Ae,{Length:P.length,currentPage:l,totalPages:G,firstIndex:F,lastIndex:$,paginate:ie,hasNextPage:$>=J.length})]})]})}),D&&e.jsx(Fe,{toggleModal:me,toggleCloseModal:ue,ExistingWards:W,handlerefresh:B}),A&&e.jsx(Ue,{toggleModal:xe,handlerefresh:B,ExistingWards:W,streetId:f}),g&&e.jsx(Ie,{toggleDeleteModal:Y,delete:fe})]})};export{st as default};
