import{i as J,k as R,l as K,o as Q,j as e,b as v,A as U,B as h,r,d as W,m as Y,n as Oe}from"./index-KlxDuXca.js";import{R as A,P as ve}from"./Pagination-CZoS4CI6.js";import{S as X}from"./SavaCancel-DnY9KWLv.js";import{D as _e}from"./DeleteModal-Bq2aEtZp.js";import{S as Se,D as Ie,E as De}from"./DocumentDownload-Cf_kB8s3.js";import{F as Ae,B as ke}from"./FileUploadButton-Bc1PelCC.js";import{H as Ee}from"./HeaderButton-D4Lkrp4E.js";import"./index-BebfzzXM.js";import"./index-BKjO-751.js";import"./index-D_Jj7K4f.js";const ze=J().shape({org_name:R().required("Organization is required")}),Pe=s=>{const{register:i,formState:{errors:b},handleSubmit:y,watch:g}=K({resolver:Q(ze),mode:"all"}),N=async _=>{const m=sessionStorage.getItem("token"),w={..._,status:"active",created_by_user:sessionStorage.getItem("name")};try{const c=await v.post(`${U}/organization/post`,w,{headers:{Authorization:`Bearer ${m}`}});c.status===200?(h.success("Org created Successfully"),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",c),h.error("Failed to Upload"))}catch(c){console.error("Error in posting data",c)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[358px]  font-lexend m-2 ",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Organization"})}),e.jsxs("form",{onSubmit:y(N),children:[e.jsxs("div",{className:"mx-6 my-10",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-4",htmlFor:"org_name",children:"Organization Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",type:"text",placeholder:" Organization Name",...i("org_name")}),b.org_name&&e.jsx("p",{className:"text-red-500",children:b.org_name.message})]}),e.jsx(X,{onCancel:s.toggleModal})]})]})})},Ce=J().shape({org_name:R().required("Organization is required"),status:R().test("not-select","Please select an Status",s=>s!==""&&s!=="Status")}),Te=s=>{const{orgId:i}=s,b=sessionStorage.getItem("token"),{register:y,formState:{errors:g},handleSubmit:N,watch:_,setValue:m}=K({resolver:Q(Ce),mode:"all"});r.useEffect(()=>{(async()=>{try{const x=await v.get(`${U}/organization/getbyid?org_id=${i}`,{headers:{Authorization:`Bearer ${b}`}}),p=W(x.data.data);m("org_name",p.org_name),m("status",p.status)}catch(x){console.error("Error fetching data",x)}})()},[i,m]);const w=async c=>{const x=sessionStorage.getItem("token"),p={...c};try{const f=await v.post(`${U}/organization/update?org_id=${i}`,p,{headers:{Authorization:`Bearer ${x}`}});f.status===200?(h.success("Org Updated Successfully"),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",f),h.error("Failed to Upload"))}catch(f){console.error("Error in posting data",f)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[358px]  font-lexend m-2 ",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Edit Organization"})}),e.jsxs("form",{onSubmit:N(w),children:[e.jsxs("div",{className:"mx-8 my-6",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-4",htmlFor:"org_name",children:"Organization Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",type:"text",placeholder:" Organization Name",...y("org_name")}),g.org_name&&e.jsx("p",{className:"text-red-500",children:g.org_name.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:" grid grid-cols-3 mx-10 my-8",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...y("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]})]}),g.status&&e.jsx("p",{className:"text-red-500 text-xs text-center -mt-4 mb-2 ",children:g.status.message})]}),e.jsx(X,{onCancel:s.toggleModal})]})]})})},C="http://13.48.10.96:4000",Be=()=>sessionStorage.getItem("token"),T={Authorization:`Bearer ${Be()}`},O={GET_ORGANIZATION:{url:`${C}/organization/get`,headers:T},GET_ORGANIZATIONACTIVE:{url:`${C}/organization/getactive`,headers:T},DELETE_ORGANIZATION:{url:`${C}/organization/delete?org_id=${deleteId}`,headers:T},CSV_ORGANIZATION:{url:`${C}organization/uploadcsv`,headers:T}},Re=`org_name,status,created_by_user
organization,active,admin`,Ke=({permissions:s})=>{const i=s==null?void 0:s.includes("create"),b=s==null?void 0:s.includes("edit"),y=s==null?void 0:s.includes("delete"),g=s==null?void 0:s.includes("download"),[N,_]=r.useState(!1),[m,w]=r.useState(!1),[c,x]=r.useState(null),[p,f]=r.useState(!1),[ee,M]=r.useState(null),[k,te]=r.useState(""),[E,ae]=r.useState(1),[S]=r.useState(8),[$,se]=r.useState(1),[Ue,re]=r.useState([]),[u,L]=r.useState([]),[F,ne]=r.useState(null);sessionStorage.getItem("token");const[oe,G]=r.useState(null),[Z,V]=r.useState("Bulk Upload"),[le,ce]=r.useState(null),B=t=>{ne(F===t?null:t)},de=t=>F===t;r.useEffect(()=>{I()},[k,E]);const ie=t=>{t>0&&t<=$&&ae(t)},I=()=>{v.get(O.GET_ORGANIZATION.url,{headers:O.GET_ORGANIZATION.headers}).then(t=>{const a=W(t.data.data);L(a);const o=a.filter(n=>Object.values(n).some(l=>l.toString().toLowerCase().includes(k.toLowerCase())));se(Math.ceil(o.length/S));const d=E*S,j=d-S;re(o.slice(j,d))}).catch(t=>{console.error(t)})},me=()=>{_(!N)},xe=()=>{w(!m),x(null)},q=()=>{f(!p),M(null)},z=E*S,D=z-S,H=u.filter(t=>Object.values(t).some(a=>a.toString().toLowerCase().includes(k.toLowerCase()))),ue=H.slice().reverse().slice(D,z),he=async()=>{try{await v.delete(O.DELETE_ORGANIZATION.url,{headers:O.DELETE_ORGANIZATION.headers}),q(),I(),L(u.filter(t=>u.org_id!==ee)),h.success("Deleted successfully")}catch{h.error("Failed to delete")}},ge=t=>{G(t.target.files[0]),V("Upload")},pe=()=>{Z==="Bulk Upload"?document.getElementById("fileInput").click():fe(oe)},fe=async t=>{try{const a=new FormData;a.append("file",t),(await v.post(O.CSV_ORGANIZATION.url,a,{headers:O.CSV_ORGANIZATION.headers})).status===200?(V("Bulk Upload"),G(null),I(),h.success("Data Uploaded Successfully")):h.error("Data failed to Upload")}catch(a){console.log(a)}},je=t=>{ce(t.target.value)},be=async t=>{if(t==="csv"){const a=u.map(l=>({org_id:l.org_id,org_name:l.org_name,status:l.status,created_by_user:l.created_by_user})),o=[Object.keys(a[0]).join(","),...a.map(l=>Object.values(l).join(","))].join(`
`),d=new Blob([o],{type:"text/csv;charset=utf-8;"}),j=window.URL.createObjectURL(d),n=document.createElement("a");n.setAttribute("href",j),n.setAttribute("download","Organization_data.csv"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}else if(t==="pdf")try{const o=Math.ceil(u.length/30),d=new De("l","mm","a4");let j=0;for(let n=1;n<=o;n++){const l=(n-1)*30,Ne=Math.min(l+30,u.length),we=u.slice(l,Ne).map(P=>[P.org_id,P.org_name,P.status,P.created_by_user]);d.text(`Page ${n}`,10,j+10),d.autoTable({startY:j+15,head:[["OrgID","OrgName","Status","createdBy"]],body:we,theme:"striped"}),n<o&&(d.addPage(),j=10)}d.save("Organization_data.pdf")}catch(a){console.error("Error exporting data:",a)}},ye=()=>{const t=new Blob([Re],{type:"text/csv"}),a=URL.createObjectURL(t),o=document.createElement("a");o.href=a,o.download="bulkupload_template.csv",o.click(),URL.revokeObjectURL(a)};return e.jsxs(r.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen ",children:[e.jsxs("div",{className:"flex flex-row md:justify-end gap-2 p-2 mt-3 mx-8 flex-wrap items-center",children:[e.jsx(Se,{value:k,onChange:t=>te(t.target.value),placeholder:"Search Organization"}),i&&e.jsx(Ae,{onChange:ge,buttonText:Z,accept:".csv",onClick:pe}),g&&e.jsx(Ie,{selectedDoc:le,onChange:je,exportData:be})]}),e.jsx(Ee,{title:"Organization",hasCreatePermission:i,onClick:()=>_(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar my-3",children:e.jsxs("table",{className:"w-full  ",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Org Name ",e.jsx(A,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Status ",e.jsx(A,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedBy ",e.jsx(A,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedAt ",e.jsx(A,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Last UpdatedAt ",e.jsx(A,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-start mx-1.5 my-3 font-semibold font-lexend",children:"Action"})})]})}),e.jsx("tbody",{children:ue.map((t,a)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center",children:D+a+1<10?`0${D+a+1}`:D+a+1})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"capitalize mx-1.5 my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.org_name})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2  font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800 ",children:Y(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800",children:Y(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(Oe,{onClick:()=>B(a)}),de(a)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[b&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{w(!0),x(t.org_id),B()},children:"Edit"}),y&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{f(!0),M(t.org_id),B()},children:"Delete"})]})]})})]},a))})]})})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx(ke,{handleDownload:ye}),e.jsx(ve,{Length:u.length,currentPage:E,totalPages:$,firstIndex:D,lastIndex:z,paginate:ie,hasNextPage:z>=H.length})]})]})}),N&&e.jsx(Pe,{toggleModal:me,handlerefresh:I}),m&&e.jsx(Te,{toggleModal:xe,handlerefresh:I,orgId:c}),p&&e.jsx(_e,{toggleDeleteModal:q,delete:he})]})};export{Ke as default};
