import{w as F,i as $,r as d,j as e,b as A,A as S,d as q,B as p}from"./index-B6bLt-HT.js";const V=()=>{var C;const j=(C=F().state)==null?void 0:C.role_id,b=sessionStorage.getItem("token"),E=$(),[N,k]=d.useState(""),[r,h]=d.useState([]),[u,y]=d.useState(""),[o,v]=d.useState([]),[x,w]=d.useState([{name:"Dashboard",value:"dashboard",checked:!1},{name:"Organization",value:"organization",checked:!1},{name:"Department",value:"department",checked:!1},{name:"Zone",value:"zone",checked:!1},{name:"Ward",value:"ward",checked:!1},{name:"Street",value:"street",checked:!1},{name:"Complaint",value:"complaint",checked:!1},{name:"Complaint Type",value:"complainttype",checked:!1},{name:"AdminUser",value:"admin",checked:!1},{name:"PublicUser",value:"user",checked:!1},{name:"Setting",value:"setting",checked:!1},{name:"Status",value:"status",checked:!1}]),[m,L]=d.useState({roleName:"",featurePermissions:"",grievancePermissions:""});d.useEffect(()=>{(async()=>{try{const s=await A.get(`${S}/role/getbyid?role_id=${j}`,{headers:{Authorization:`Bearer ${b}`}}),t=q(s.data.data);if(s.status===200){k(t.role_name),h(t.accessLevels||[]),y(t.grievanceType||""),v(t.grievancePermissions||[]);const l=x.map(n=>({...n,checked:t.accessLevels.some(c=>c.feature===n.value)}));w(l)}else p.error("Failed to fetch role data")}catch(s){console.error("Error fetching role data",s),p.error("Error fetching role data")}})()},[j,b]);const D=a=>{k(a.target.value)},R=a=>{const s=[...x];s[a].checked=!s[a].checked,s[a].checked?h(t=>[...t,{feature:s[a].value,permissions:[]}]):h(t=>t.filter(l=>l.feature!==s[a].value)),w(s)},f=(a,s)=>{const t=[...r],l=t.findIndex(n=>n.feature===x[a].value);if(l!==-1){const n=t[l].permissions;n.includes(s)?t[l].permissions=n.filter(c=>c!==s):t[l].permissions.push(s),h(t)}},I=a=>{const s=[...r],t=s.findIndex(l=>l.feature===x[a].value);t!==-1&&(s[t].permissions=s[t].permissions.length===4?[]:["view","create","edit","delete"],h(s))},G=a=>{y(a.target.value),v([])},g=a=>{v(s=>s.includes(a)?s.filter(t=>t!==a):[...s,a])},T=()=>{v(a=>a.length===4?[]:["view","create","edit","delete"])},_=async a=>{a.preventDefault();let s=!0;const t={roleName:"",featurePermissions:"",grievancePermissions:""};if(N.trim()===""&&(t.roleName="Role name is required.",s=!1),r.forEach(c=>{c.permissions.length===0&&(t.featurePermissions="Please select at least one permission for each selected feature.",s=!1)}),u!==""&&o.length===0&&(t.grievancePermissions="Please select at least one permission for the selected grievance type.",s=!1),L(t),!s)return;const l=[...r];u&&l.push({feature:u,permissions:o});const n={role_name:N,accessLevels:l,status:"active",created_by_user:"admin"};try{(await A.post(`${S}/role/update?role_id=${j}`,n,{headers:{Authorization:`Bearer ${b}`}})).status===200?(p.success("Role updated successfully"),E("/setting")):p.error("Failed to update role")}catch(c){console.error("Error updating data",c),p.error("Error updating role")}};return e.jsx("div",{className:"md:mx-6 mx-1 my-3 font-lexend overflow-y-auto no-scrollbar bg-white rounded-lg",children:e.jsx("div",{className:"px-6 py-6 overflow-auto no-scrollbar",children:e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"flex gap-6 text-base items-center ",children:[e.jsx("label",{children:"Role Name:"}),e.jsx("input",{type:"text",value:N,onChange:D,className:"w-80 text-start border rounded-lg ml-2 px-3 py-1 outline-none"})]}),m.roleName&&e.jsx("p",{className:"error mt-3 text-red-500",children:m.roleName}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"mt-6 mb-3 text-base ",children:"Access Levels:"}),x.map((a,s)=>{var t,l,n,c,P;return e.jsxs("div",{className:"md:grid md:grid-cols-3 mb-3 text-base ",children:[e.jsxs("div",{className:"col-span-1 flex gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.checked,onChange:()=>R(s)}),e.jsx("label",{children:a.name})]}),a.checked&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 ",children:[e.jsx("label",{className:"mx-4 md:text-base text-sm ",children:"Permissions:"}),e.jsx("input",{type:"checkbox",value:"view",checked:((t=r.find(i=>i.feature===a.value))==null?void 0:t.permissions.includes("view"))||!1,onChange:()=>f(s,"view")}),e.jsx("label",{className:"text-sm",children:"View"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:"create",checked:((l=r.find(i=>i.feature===a.value))==null?void 0:l.permissions.includes("create"))||!1,onChange:()=>f(s,"create")}),e.jsx("label",{children:"Create"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:"edit",checked:((n=r.find(i=>i.feature===a.value))==null?void 0:n.permissions.includes("edit"))||!1,onChange:()=>f(s,"edit")}),e.jsx("label",{children:"Edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:"delete",checked:((c=r.find(i=>i.feature===a.value))==null?void 0:c.permissions.includes("delete"))||!1,onChange:()=>f(s,"delete")}),e.jsx("label",{children:"Delete"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:((P=r.find(i=>i.feature===a.value))==null?void 0:P.permissions.length)===4,onChange:()=>I(s)}),e.jsx("label",{children:"All"})]})]})]},s)})]}),m.featurePermissions&&e.jsx("p",{className:"error text-red-500",children:m.featurePermissions}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"mt-6 mb-3 text-base ",children:"Grievance Type:"}),e.jsxs("select",{className:"w-80 text-start border rounded-lg ml-2 px-3 py-1 outline-none",value:u,onChange:G,children:[e.jsx("option",{value:"",children:"Select Grievance Type"}),e.jsx("option",{value:"grievance",children:"Super Admin"}),e.jsx("option",{value:"viewrequest4",children:"Commissioner"}),e.jsx("option",{value:"viewrequest3",children:"Department Head"}),e.jsx("option",{value:"viewrequest2",children:"Junior Engineer"}),e.jsx("option",{value:"viewrequest1",children:"Operator"})]})]}),u&&e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"mt-6 mb-3 text-base",children:"Permissions:"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.includes("view"),onChange:()=>g("view")}),e.jsx("label",{className:"text-sm",children:"View"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:o.includes("create"),onChange:()=>g("create")}),e.jsx("label",{children:"Create"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:o.includes("edit"),onChange:()=>g("edit")}),e.jsx("label",{children:"Edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:o.includes("delete"),onChange:()=>g("delete")}),e.jsx("label",{children:"Delete"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:o.length===4,onChange:T}),e.jsx("label",{children:"All"})]})]})]}),m.grievancePermissions&&e.jsx("p",{className:"error text-red-500",children:m.grievancePermissions}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"submit",className:"mt-6 px-4 py-2 bg-blue-500 text-white  rounded-lg",children:"Save Changes"})})]})})})};export{V as default};
