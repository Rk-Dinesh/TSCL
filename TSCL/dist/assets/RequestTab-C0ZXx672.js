import{l as he,r as n,u as ue,y as ge,p as fe,b as S,A as D,d as A,j as e,O as je,w as ye,z as ve,B as be}from"./index-Cb3AN3R3.js";import{R as u}from"./index-C-hq6bKM.js";import{S as _e,D as we,E as Ne}from"./DocumentDownload-A0b-q8L_.js";import{P as Ce}from"./Pagination-ClPqWgoN.js";import{H as Pe}from"./HeaderButton-By5upfsz.js";import{D as Se,a as De}from"./DateRangeComp-B_BpUMFB.js";import{M as Ae}from"./ManyTicketTransfer-CEtZFA1_.js";import"./index-CmROlnnr.js";import"./index-Du0g9a49.js";import"./index-BK6gNoz8.js";import"./index-aztxF81R.js";const U=({permissions:r,include:p,endpoint:k})=>{const b=r==null?void 0:r.includes("create");r==null||r.includes("edit"),r==null||r.includes("delete");const _=r==null?void 0:r.includes("download"),w=he(),[f,F]=n.useState(""),[j,I]=n.useState(1),[h,V]=n.useState(10),[T,q]=n.useState(1),[ke,H]=n.useState([]),[N,Y]=n.useState([]),[m,C]=n.useState([]),P=localStorage.getItem("token"),E=ue(),[J,K]=n.useState([]);n.useState([]);const[y,Q]=n.useState("All"),[$,W]=n.useState({}),[Ie,X]=n.useState([]),[Z,ee]=n.useState(null),[z,R]=n.useState(!1),[M,G]=n.useState([]),[te,ae]=n.useState({});n.useEffect(()=>{const t=async()=>{try{const a=await S.get(`${D}/complainttype/getactive`,{headers:{Authorization:`Bearer ${P}`}}),c=A(a.data.data);K(c)}catch(a){console.error("Error fetching existing Complainttype:",a)}};L(),t(),se(),w(ge())},[]);const x=fe(t=>t.origin);n.useEffect(()=>{var t;if(x&&(x!=null&&x.data)){const a=(t=x==null?void 0:x.data)==null?void 0:t.reduce((c,l)=>(c[l.res_name]=l.image,c),{});ae(a)}},[x]);const L=async()=>{try{const t=await S.get(`${D}/new-grievance/${k}`,{headers:{Authorization:`Bearer ${P}`}}),a=A(t.data.data);Y(a);const c=a.filter(l=>Object.values(l).some(d=>d.toString().toLowerCase().includes(f.toLowerCase())));C(c)}catch{}};n.useEffect(()=>{const t=N.filter(a=>Object.values(a).some(c=>c.toString().toLowerCase().includes(f.toLowerCase())));C(t)},[f]),n.useEffect(()=>{const t=j*h,a=t-h;H(m.slice(a,t)),q(Math.ceil(m.length/h))},[m,j,h]);const se=async()=>{try{const t=await S.get(`${D}/status/get`,{headers:{Authorization:`Bearer ${P}`}}),a=A(t.data.data),c=a.reduce((l,d)=>(l[d.status_name]=d.color,l),{});X(a),W(c)}catch(t){console.error("Error fetching existing ActiveStatus:",t)}},O=t=>{t>0&&t<=T&&I(t)},ne=t=>{const a=t[0].startDate,c=t[0].endDate,l=N.filter(d=>{const i=new Date(d.createdAt);return i>=a&&i<De(c,1)});C(l),be.success("Grievance filtered")},v=j*h,g=v-h,ce=m.slice().reverse().filter(t=>y==="All"?!0:t.complaint_type_title===y).slice(g,v),B=t=>{Q(t),O(1)},le=()=>{E("/form")},re=t=>{ee(t.target.value)},ie=async t=>{if(t==="csv"){const a=m.map(s=>({grievance_id:s.grievance_id,grievance_mode:s.grievance_mode,complaint_type_title:s.complaint_type_title,dept_name:s.dept_name,zone_name:s.zone_name,ward_name:s.ward_name,street_name:s.street_name,pincode:s.pincode,complaint:s.complaint,public_user_id:s.public_user_id,public_user_name:s.public_user_name,phone:s.phone,assign_user:s.assign_user,assign_username:s.assign_username,assign_userphone:s.assign_userphone,status:s.status,escalation_level:s.escalation_level,priority:s.priority})),c=[Object.keys(a[0]).join(","),...a.map(s=>Object.values(s).join(","))].join(`
`),l=new Blob([c],{type:"text/csv;charset=utf-8;"}),d=window.URL.createObjectURL(l),i=document.createElement("a");i.setAttribute("href",d),i.setAttribute("download","Grievance_data.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}else if(t==="pdf")try{const c=Math.ceil(m.length/30),l=new Ne("l","mm","a4");let d=0;for(let i=1;i<=c;i++){const s=(i-1)*30,xe=Math.min(s+30,m.length),pe=m.slice(s,xe).map(o=>[o.grievance_id,o.grievance_mode,o.complaint_type_title,o.dept_name,o.pincode,o.complaint,o.public_user_name,o.phone,o.assign_username,o.assign_userphone,o.status,o.escalation_level,o.priority]);l.text(`Page ${i}`,10,d+10),l.autoTable({startY:d+15,head:[["grievance_id","grievance_mode","complaintType","dept","pincode","complaint","publicUser","phone","assignUser","assignUserphone","status","Escalation","Priority"]],body:pe,theme:"striped"}),i<c&&(l.addPage(),d=10)}l.save("Grievance_data.pdf")}catch(a){console.error("Error exporting data:",a)}},oe=t=>{const a=parseInt(t.target.value,10);V(a),I(1)},de=t=>{G(a=>a.includes(t)?a.filter(c=>c!==t):[...a,t])},me=()=>{R(!z),G([])};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:"  font-lexend h-screen ",children:[p==="yes"&&e.jsx(Pe,{title:"Grievances",hasCreatePermission:b,onClick:le}),e.jsxs("div",{className:"flex flex-row  gap-3 p-2 mt-1 mx-4 flex-wrap md:justify-between items-center ",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Se,{onChange:ne}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-medium text-gray-600",children:"Page Entries"}),e.jsxs("select",{id:"itemsPerPage",value:h,onChange:oe,className:" p-1 outline-none text-sm rounded px-2",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]}),e.jsxs("div",{className:"flex flex-row flex-wrap gap-1.5",children:[e.jsx(_e,{value:f,onChange:t=>F(t.target.value),placeholder:"Search Grievances"}),_&&e.jsx(we,{selectedDoc:Z,onChange:re,exportData:ie})]})]}),e.jsxs("div",{className:`bg-white  mx-4 rounded-lg mt-1  p-3 ${N.length<8?"h-4/5":"h-fit"}`,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center md:gap-6 gap-2 md:mt-2 mx-3",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsx("p",{className:"text-lg  whitespace-nowrap",children:"View Report"})}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[J.map((t,a)=>e.jsx("div",{children:e.jsx("button",{className:`px-2 py-1.5 capitalize ${y===t.complaint_type?"bg-primary text-white":"bg-blue-100 text-primary"} rounded-full shadow-lg`,onClick:()=>B(t.complaint_type),children:t.complaint_type})},a)),e.jsx("button",{className:`w-20 py-1.5 ${y==="All"?"bg-primary text-white":"bg-blue-100 text-primary"} rounded-full shadow-lg`,onClick:()=>B("All"),children:"All"})]})]}),p=="yes"&&e.jsx("div",{className:"my-2 mx-3 flex flex-wrap gap-2 ",children:e.jsx("button",{className:"bg-blue-300 shadow-md px-3 py-1 rounded-full text-white text-sm",onClick:()=>R(!0),children:"Multi-Transfer"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full mt-2 ",children:[e.jsx("thead",{className:" border-b border-gray-300  ",children:e.jsxs("tr",{className:"",children:[p==="yes"&&e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-3 my-2 font-lexend text-center font-semibold whitespace-nowrap",children:e.jsx(je,{className:"text-xl text-center text-primary"})})}),e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-3 my-2 font-lexend  font-medium whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 text-start font-lexend font-medium  whitespace-nowrap",children:"Complaint No"})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:"Origin"})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Raised by ",e.jsx(u,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Complaint Type ",e.jsx(u,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Department",e.jsx(u,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Complaint",e.jsx(u,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Assigned JE ",e.jsx(u,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Date and Time ",e.jsx(u,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-center mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Status ",e.jsx(u,{})]})})]})}),e.jsx("tbody",{children:ce.map((t,a)=>e.jsxs("tr",{className:" border-b border-gray-300  ",children:[p==="yes"&&e.jsx("td",{className:" flex gap-2 items-center justify-center ",children:e.jsxs("div",{className:"flex items-center ",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 mt-4  text-dark bg-gray-800 border-gray-800 rounded",checked:M.includes(t.grievance_id),onChange:()=>de(t.grievance_id)}),e.jsx("label",{className:"sr-only",htmlFor:"checkbox-table-search-1",children:"checkbox"})]})}),e.jsx("td",{className:"",children:e.jsx("div",{className:"text-center text-sm mx-3 my-2 font-lexend whitespace-nowrap text-gray-700",children:g+a+1<10?`0${g+a+1}`:g+a+1})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 border-slate-900 rounded-lg text-center py-1 my-1  text-slate-900 ",onClick:()=>E(`/view?grievanceId=${t.grievance_id}`),children:t.grievance_id})}),e.jsx("td",{className:"flex gap-1 items-center justify-center text-gray-700",children:e.jsx("img",{src:te[t.grievance_mode]||ye,alt:t.grievance_mode,className:"w-6 h-6 mx-1.5 my-2 rounded-full"})}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.public_user_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.complaint_type_title})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.dept_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.complaint})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.assign_username?t.assign_username:"Yet to be assigned"})]}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:ve(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 rounded-full text-center py-1 tex-sm font-normal mx-2 capitalize  ",style:{borderColor:$[t.status]||"gray",color:$[t.status]||"black",fontSize:14},children:t.status})})]},a))})]})})]}),e.jsx("div",{className:" mt-2 mb-5 mx-7",children:e.jsx(Ce,{Length:m.length,currentPage:j,totalPages:T,firstIndex:g,lastIndex:v,paginate:O,hasNextPage:v>=m.length})}),e.jsx("p",{className:"text-transparent",children:"transparent"})]})}),z&&e.jsx(Ae,{toggleTModal:me,selectedRows:M,handlerefresh:L})]})};function Ve({permissions:r}){const[p,k]=n.useState("tab1"),b="yes",_=localStorage.getItem("name"),w=localStorage.getItem("code");return e.jsx("div",{className:"overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"mx-1 my-5 ",children:[p==="tab1"&&e.jsx(U,{permissions:r,include:b,endpoint:`getbyoperator?operator=${_}&operator_id=${w}`}),p==="tab2"&&e.jsx(U,{permissions:r,endpoint:"byclosed"})]})})}export{Ve as default};
