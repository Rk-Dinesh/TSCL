import{i as H,k as E,l as Y,o as G,j as e,b as N,A as v,B as h,r as n,d as J,m as V,n as we}from"./index-B-YhHBab.js";import{R as k,P as Ne}from"./Pagination-DoNtECT-.js";import{S as K}from"./SavaCancel-89r2xThE.js";import{D as ve}from"./DeleteModal-BhbeyLgd.js";import{S as Se,D as _e,E as De}from"./DocumentDownload-C6yILlzs.js";import{F as ze,B as ke}from"./FileUploadButton-CZ7XzdX5.js";import{H as Pe}from"./HeaderButton-DsXCe15j.js";import"./index-BnDzthMN.js";import"./index-DCU07Eno.js";import"./index-D011Getu.js";const Ce=H().shape({zone_name:E().required("Zone_name is required")}),Ie=a=>{const{register:i,formState:{errors:p},handleSubmit:b,watch:f}=Y({resolver:G(Ce),mode:"all"}),y=async S=>{const m={...S,status:"active",created_by_user:sessionStorage.getItem("name")};try{const x=sessionStorage.getItem("token"),g=await N.post(`${v}/zone/post`,m,{headers:{Authorization:`Bearer ${x}`}});g.status===200?(h.success("Zone created Successfully"),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",g),h.error("Failed to Upload"))}catch(x){console.error("Error in posting data",x)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[340px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Zone"})}),e.jsxs("form",{onSubmit:b(y),children:[e.jsxs("div",{className:"mx-6 my-10",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-4",htmlFor:"zone_name",children:"Zone Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"zone_name",type:"text",placeholder:"Zone Name",...i("zone_name")}),p.zone_name&&e.jsx("p",{className:"text-red-500",children:p.zone_name.message})]}),e.jsx(K,{onCancel:a.toggleModal})]})]})})},Ze=H().shape({zone_name:E().required("Zone_name is required"),status:E().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Be=a=>{const{zoneId:i}=a,p=sessionStorage.getItem("token"),{register:b,formState:{errors:f},handleSubmit:y,watch:S,setValue:m}=Y({resolver:G(Ze),mode:"all"});n.useEffect(()=>{(async()=>{try{const u=await N.get(`${v}/zone/getbyid?zone_id=${i}`,{headers:{Authorization:`Bearer ${p}`}}),c=J(u.data.data);m("zone_name",c.zone_name),m("status",c.status)}catch(u){console.error("Error fetching data",u)}})()},[i,m]);const x=async g=>{const u={...g};try{const c=await N.post(`${v}/zone/update?zone_id=${i}`,u,{headers:{Authorization:`Bearer ${p}`}});c.status===200?(h.success("Zone Updated Successfully"),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",c),h.error("Failed to Upload"))}catch(c){console.error("Error in posting data",c)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[340px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Edit Zone"})}),e.jsxs("form",{onSubmit:y(x),children:[e.jsxs("div",{className:"mx-8 my-6",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-4",htmlFor:"zone_name",children:"Zone Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"zone_name",type:"text",placeholder:"Zone Name",...b("zone_name")}),f.zone_name&&e.jsx("p",{className:"text-red-500",children:f.zone_name.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:" grid grid-cols-3 mx-10 my-6",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...b("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]})]}),f.status&&e.jsx("p",{className:"text-red-500 text-xs text-center -mt-4 mb-2 ",children:f.status.message})]}),e.jsx(K,{onCancel:a.toggleModal})]})]})})},Ee=`zone_name,status,created_by_user
ZoneName,active,admin`,Ye=({permissions:a})=>{const i=a==null?void 0:a.includes("create"),p=a==null?void 0:a.includes("edit"),b=a==null?void 0:a.includes("delete"),f=a==null?void 0:a.includes("download"),[y,S]=n.useState(!1),[m,x]=n.useState(!1),[g,u]=n.useState(null),[c,M]=n.useState(!1),[Q,U]=n.useState(null),[P,W]=n.useState(""),[C,X]=n.useState(1),[_]=n.useState(8),[$,ee]=n.useState(1),[Me,te]=n.useState([]),[w,se]=n.useState([]),[A,ae]=n.useState(null),F=sessionStorage.getItem("token"),[ne,L]=n.useState(null),[O,R]=n.useState("Bulk Upload"),[oe,le]=n.useState(null),B=t=>{ae(A===t?null:t)},re=t=>A===t;n.useEffect(()=>{D()},[P,C]);const ce=t=>{t>0&&t<=$&&X(t)},D=()=>{N.get(`${v}/zone/get`,{headers:{Authorization:`Bearer ${F}`}}).then(t=>{const s=J(t.data.data);se(s);const l=s.filter(o=>Object.values(o).some(r=>r.toString().toLowerCase().includes(P.toLowerCase())));ee(Math.ceil(l.length/_));const d=C*_,j=d-_;te(l.slice(j,d))})},de=()=>{S(!y)},ie=()=>{x(!m),u(null)},T=()=>{M(!c),U(null)},I=C*_,z=I-_,q=w.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(P.toLowerCase()))),me=q.slice(z,I),xe=async()=>{try{await N.delete(`${v}/zone/delete?zone_id=${Q}`,{headers:{Authorization:`Bearer ${F}`}}),T(),D(),h.success("Deleted successfully")}catch{h.error("Failed to delete")}},ue=t=>{L(t.target.files[0]),R("Upload")},he=()=>{O==="Bulk Upload"?document.getElementById("fileInput").click():pe(ne)},pe=async t=>{try{const s=new FormData;s.append("file",t),(await N.post(`${v}/zone/uploadcsv`,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(R("Bulk Upload"),L(null),D(),h.success("Data Uploaded Successfully")):h.error("Data failed to Upload")}catch(s){console.log(s)}},fe=t=>{le(t.target.value)},ge=async t=>{if(t==="csv"){const s=w.map(r=>({zone_id:r.zone_id,zone_name:r.zone_name,status:r.status,created_by_user:r.created_by_user})),l=[Object.keys(s[0]).join(","),...s.map(r=>Object.values(r).join(","))].join(`
`),d=new Blob([l],{type:"text/csv;charset=utf-8;"}),j=window.URL.createObjectURL(d),o=document.createElement("a");o.setAttribute("href",j),o.setAttribute("download","Zone_data.csv"),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}else if(t==="pdf")try{const l=Math.ceil(w.length/30),d=new De("l","mm","a4");let j=0;for(let o=1;o<=l;o++){const r=(o-1)*30,be=Math.min(r+30,w.length),ye=w.slice(r,be).map(Z=>[Z.zone_id,Z.zone_name,Z.status,Z.created_by_user]);d.text(`Page ${o}`,10,j+10),d.autoTable({startY:j+15,head:[["Zone_Id","Zone_Name","Status","createdBy"]],body:ye,theme:"striped"}),o<l&&(d.addPage(),j=10)}d.save("Zone_data.pdf")}catch(s){console.error("Error exporting data:",s)}},je=()=>{const t=new Blob([Ee],{type:"text/csv"}),s=URL.createObjectURL(t),l=document.createElement("a");l.href=s,l.download="Zone_bulkupload_template.csv",l.click(),URL.revokeObjectURL(s)};return e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen ",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-3 mx-8 flex-wrap",children:[e.jsx(Se,{value:P,onChange:t=>W(t.target.value),placeholder:"Search Zone"}),i&&e.jsx(ze,{onChange:ue,buttonText:O,accept:".csv",onClick:he}),f&&e.jsx(_e,{selectedDoc:oe,onChange:fe,exportData:ge})]}),e.jsx(Pe,{title:"Zone",hasCreatePermission:i,onClick:()=>S(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar ",children:e.jsxs("table",{className:"w-full mt-3 ",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Zone ",e.jsx(k,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold  whitespace-nowrap",children:["Status ",e.jsx(k,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedBy ",e.jsx(k,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedAt",e.jsx(k,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["UpdatedAt",e.jsx(k,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-lexend font-semibold",children:"Action"})})]})}),e.jsx("tbody",{children:me.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300 ",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-cente text-gray-700",children:z+s+1<10?`0${z+s+1}`:z+s+1})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"capitalize text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.zone_name})}),e.jsx("td",{children:e.jsx("p",{className:" mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize  text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2  font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:V(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:V(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(we,{onClick:()=>B(s)}),re(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[p&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{x(!0),u(t.zone_id),B()},children:"Edit"}),b&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{M(!0),U(t.zone_id),B()},children:"Delete"})]})]})})]},s))})]})})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx(ke,{handleDownload:je}),e.jsx(Ne,{Length:w.length,currentPage:C,totalPages:$,firstIndex:z,lastIndex:I,paginate:ce,hasNextPage:I>=q.length})]})]})}),y&&e.jsx(Ie,{toggleModal:de,handlerefresh:D}),m&&e.jsx(Be,{toggleModal:ie,handlerefresh:D,zoneId:g}),c&&e.jsx(ve,{toggleDeleteModal:T,delete:xe})]})};export{Ye as default};
