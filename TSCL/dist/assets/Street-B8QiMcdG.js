import{i as Q,k as F,r as s,l as X,o as ee,j as e,b as I,A as C,B as N,d as Z,m as K,n as ve}from"./index-KlxDuXca.js";import{R as z,P as De}from"./Pagination-CZoS4CI6.js";import{S as te}from"./SavaCancel-DnY9KWLv.js";import{D as ke}from"./DeleteModal-Bq2aEtZp.js";import{S as ze,D as Ie,E as Ce}from"./DocumentDownload-Cf_kB8s3.js";import{F as Pe,B as Ee}from"./FileUploadButton-Bc1PelCC.js";import{H as Be}from"./HeaderButton-D4Lkrp4E.js";import"./index-BebfzzXM.js";import"./index-BKjO-751.js";import"./index-D_Jj7K4f.js";const $e=Q().shape({ward_name:F().test("not-select","Please select a ward",a=>a!==""&&a!=="Select Street"),street_name:F().required("street_name is required")}),Me=a=>{const{ExistingWards:h}=a,[S,P]=s.useState(null),[M,b]=s.useState(null),[v,D]=s.useState(null),[y,E]=s.useState(null),{register:m,formState:{errors:x},handleSubmit:_,watch:g}=X({resolver:ee($e),mode:"all"});s.useEffect(()=>{if(y){const l=h.find(p=>p.ward_name===y);l&&(P(l.zone_id),b(l.ward_id),D(l.zone_name))}},[y,h]);const B=async l=>{const p={...l,zone_id:S,ward_id:M,zone_name:v,status:"active",created_by_user:sessionStorage.getItem("name")};try{const f=sessionStorage.getItem("token"),r=await I.post(`${C}/street/post`,p,{headers:{Authorization:`Bearer ${f}`}});r.status===200?(N.success("Street created Successfully"),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",r),N.error("Failed to Upload"))}catch(f){console.error("Error in posting data",f)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Street"})}),e.jsxs("form",{onSubmit:_(B),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"ward_name",children:"Ward Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",...m("ward_name"),onChange:l=>E(l.target.value),children:[e.jsx("option",{value:"",children:"Select Street"}),h.map(l=>e.jsx("option",{value:l.ward_name,children:l.ward_name},l.ward_id))]}),x.ward_name&&e.jsx("p",{className:"text-red-500",children:x.ward_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"street_name",children:"Street Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"street_name",type:"text",placeholder:"Street Name",...m("street_name")}),x.street_name&&e.jsx("p",{className:"text-red-500",children:x.street_name.message})]})]}),e.jsx(te,{onCancel:a.toggleCloseModal})]})]})})},Ae=Q().shape({ward_name:F().test("not-select","Please select a ward",a=>a!==""&&a!=="Select Street"),street_name:F().required("street_name is required"),status:F().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Ue=a=>{const{ExistingWards:h,streetId:S}=a,P=sessionStorage.getItem("token"),[M,b]=s.useState(null),[v,D]=s.useState(null),[y,E]=s.useState(null),[m,x]=s.useState(null),{register:_,formState:{errors:g},handleSubmit:B,watch:l,setValue:p}=X({resolver:ee(Ae),mode:"all"});s.useEffect(()=>{(async()=>{try{const c=await I.get(`${C}/street/getbyid?street_id=${S}`,{headers:{Authorization:`Bearer ${P}`}}),u=Z(c.data.data);x(u.ward_name),p("ward_name",u.ward_name),p("street_name",u.street_name),p("status",u.status)}catch(c){console.error("Error fetching data",c)}})()},[S,p]),s.useEffect(()=>{if(m){const r=h.find(c=>c.ward_name===m);r&&(b(r.zone_id),D(r.ward_id),E(r.zone_name))}},[m,h]);const f=async r=>{const c={...r,zone_id:M,ward_id:v,zone_name:y};try{const u=await I.post(`${C}/street/update?street_id=${S}`,c,{headers:{Authorization:`Bearer ${P}`}});u.status===200?(N.success("Street updated Successfully"),b(null),D(null),E(null),x(null),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",u),N.error("Failed to Upload"))}catch(u){console.error("Error in posting data",u)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Street"})}),e.jsxs("form",{onSubmit:B(f),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"ward_name",children:"Ward Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",..._("ward_name"),onChange:r=>x(r.target.value),children:[e.jsx("option",{value:m,disabled:!0,children:m}),h.map(r=>e.jsx("option",{value:r.ward_name,children:r.ward_name},r.ward_id))]}),g.ward_name&&e.jsx("p",{className:"text-red-500",children:g.ward_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"street_name",children:"Street Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"street_name",type:"text",placeholder:"Street Name",..._("street_name")}),g.street_name&&e.jsx("p",{className:"text-red-500",children:g.street_name.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",..._("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),g.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:g.status.message})]})]}),e.jsx(te,{onCancel:a.toggleModal})]})]})})},We=`street_name,ward_id,ward_name,zone_id,zone_name,status,created_by_user
 streetName,Ward***,WardName,Z***,ZoneName,Status,admin`,Ke=({permissions:a})=>{const h=a==null?void 0:a.includes("create"),S=a==null?void 0:a.includes("edit"),P=a==null?void 0:a.includes("delete"),M=a==null?void 0:a.includes("download"),[b,v]=s.useState(!1),[D,y]=s.useState(!1),[E,m]=s.useState(null),[x,_]=s.useState(!1),[g,B]=s.useState(null),[l,p]=s.useState(null),[f,r]=s.useState(""),[c,u]=s.useState(1),[A]=s.useState(8),[T,ae]=s.useState(1),[Fe,se]=s.useState([]),[$,ne]=s.useState([]),[q,re]=s.useState(null),O=sessionStorage.getItem("token"),[le,V]=s.useState(null),[H,Y]=s.useState("Bulk Upload"),[oe,de]=s.useState(null),R=t=>{re(q===t?null:t)},ce=t=>q===t;s.useEffect(()=>{U(),he()},[f,c]);const ie=t=>{t>0&&t<=T&&u(t)},U=()=>{I.get(`${C}/street/get`,{headers:{Authorization:`Bearer ${O}`}}).then(t=>{const n=Z(t.data.data);ne(n);const i=n.filter(d=>Object.values(d).some(o=>o.toString().toLowerCase().includes(f.toLowerCase())));ae(Math.ceil(i.length/A));const j=c*A,k=j-A;se(i.slice(k,j))})},me=()=>{v(!b)},xe=()=>{y(!D),m(null)},ue=()=>{v(!b)},G=()=>{_(!x),B(null)},he=async()=>{try{const t=await I.get(`${C}/ward/getactive`,{headers:{Authorization:`Bearer ${O}`}}),n=Z(t.data.data);p(n)}catch(t){console.error("Error fetching existing roles:",t)}},L=c*A,W=L-A,J=$.filter(t=>Object.values(t).some(n=>n.toString().toLowerCase().includes(f.toLowerCase()))),pe=J.slice(W,L),fe=async()=>{try{await I.delete(`${C}/street/delete?street_id=${g}`,{headers:{Authorization:`Bearer ${O}`}}),G(),U(),N.success("Deleted successfully")}catch{N.error("Failed to delete")}},ge=t=>{V(t.target.files[0]),Y("Upload")},je=()=>{H==="Bulk Upload"?document.getElementById("fileInput").click():be(le)},be=async t=>{try{const n=new FormData;n.append("file",t),(await I.post(`${C}/street/uploadcsv`,n,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(Y("Bulk Upload"),V(null),U(),N.success("Data Uploaded Successfully")):N.error("Data failed to Upload")}catch(n){console.log(n)}},ye=t=>{de(t.target.value)},_e=async t=>{if(t==="csv"){const n=$.map(o=>({street_id:o.street_id,street_name:o.street_name,ward_id:o.ward_id,ward_name:o.ward_name,zone_id:o.zone_id,zone_name:o.zone_name,status:o.status,created_by_user:o.created_by_user})),i=[Object.keys(n[0]).join(","),...n.map(o=>Object.values(o).join(","))].join(`
`),j=new Blob([i],{type:"text/csv;charset=utf-8;"}),k=window.URL.createObjectURL(j),d=document.createElement("a");d.setAttribute("href",k),d.setAttribute("download","Street_data.csv"),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)}else if(t==="pdf")try{const i=Math.ceil($.length/30),j=new Ce("l","mm","a4");let k=0;for(let d=1;d<=i;d++){const o=(d-1)*30,Ne=Math.min(o+30,$.length),Se=$.slice(o,Ne).map(w=>[w.street_id,w.street_name,w.ward_id,w.ward_name,w.zone_id,w.zone_name,w.status,w.created_by_user]);j.text(`Page ${d}`,10,k+10),j.autoTable({startY:k+15,head:[["street_id","street_name","ward_id","ward_name","zone_id","zone_name","status","created_by_user"]],body:Se,theme:"striped"}),d<i&&(j.addPage(),k=10)}j.save("Street_data.pdf")}catch(n){console.error("Error exporting data:",n)}},we=()=>{const t=new Blob([We],{type:"text/csv"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download="street_bulkupload_template.csv",i.click(),URL.revokeObjectURL(n)};return e.jsxs(s.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-3 mx-8 flex-wrap",children:[e.jsx(ze,{value:f,onChange:t=>r(t.target.value),placeholder:"Search Street"}),h&&e.jsx(Pe,{onChange:ge,buttonText:H,accept:".csv",onClick:je}),M&&e.jsx(Ie,{selectedDoc:oe,onChange:ye,exportData:_e})]}),e.jsx(Be,{title:"Street",hasCreatePermission:h,onClick:()=>v(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Street ",e.jsx(z,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Ward ",e.jsx(z,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Zone ",e.jsx(z,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Status ",e.jsx(z,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedBy ",e.jsx(z,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedAt",e.jsx(z,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["UpdatedAt",e.jsx(z,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-lexend font-semibold",children:"Action"})})]})}),e.jsx("tbody",{children:pe.map((t,n)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-700",children:W+n+1<10?`0${W+n+1}`:W+n+1})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.street_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.ward_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.zone_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2  font-lexend whitespace-nowrap capitalize text-gray-700",children:K(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:K(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(ve,{onClick:()=>R(n)}),ce(n)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[S&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{y(!0),m(t.street_id),R()},children:"Edit"}),P&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{_(!0),B(t.street_id),R()},children:"Delete"})]})]})})]},n))})]})})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx(Ee,{handleDownload:we}),e.jsx(De,{Length:$.length,currentPage:c,totalPages:T,firstIndex:W,lastIndex:L,paginate:ie,hasNextPage:L>=J.length})]})]})}),b&&e.jsx(Me,{toggleModal:me,toggleCloseModal:ue,ExistingWards:l,handlerefresh:U}),D&&e.jsx(Ue,{toggleModal:xe,handlerefresh:U,ExistingWards:l,streetId:E}),x&&e.jsx(ke,{toggleDeleteModal:G,delete:fe})]})};export{Ke as default};
