import{r,u as q,b as P,A as _,d as Y,j as e,q as f,s as G,B as H}from"./index-Cb3AN3R3.js";import{R as i}from"./index-C-hq6bKM.js";import{S as J,D as K,E as Q}from"./DocumentDownload-A0b-q8L_.js";import{P as W}from"./Pagination-ClPqWgoN.js";import"./index-CmROlnnr.js";import"./index-Du0g9a49.js";const ce=({permissions:l})=>{l==null||l.includes("create"),l==null||l.includes("edit"),l==null||l.includes("delete");const D=l==null?void 0:l.includes("download"),[u,C]=r.useState(""),[j,y]=r.useState(1),[d,E]=r.useState(10),[w,I]=r.useState(1),[X,S]=r.useState([]),[x,L]=r.useState([]),z=localStorage.getItem("token"),A=localStorage.getItem("role");localStorage.getItem("dept");const[O,k]=r.useState(null),v=q();r.useEffect(()=>{b()},[u,j,d]);const $=t=>{t>0&&t<=w&&y(t)},b=()=>{P.get(`${_}/grievance-escalation/get`,{headers:{Authorization:`Bearer ${z}`}}).then(t=>{const a=Y(t.data.data);a.filter(s=>s.escalation_to.toLowerCase()===A.toLowerCase()),L(a);const m=a.filter(s=>Object.values(s).some(n=>n.toString().toLowerCase().includes(u.toLowerCase())));I(Math.ceil(m.length/d));const c=j*d,h=c-d;S(m.slice(h,c))}).catch(t=>{console.error(t)})},g=j*d,p=g-d,N=x.filter(t=>Object.values(t).some(a=>a.toString().toLowerCase().includes(u.toLowerCase()))),R=N.slice().reverse().slice(p,g),U=t=>{k(t.target.value)},B=async t=>{if(t==="csv"){const a=x.map(n=>({grievance_id:n.grievance_id,escalation_department:n.escalation_department,escalation_complaint:n.escalation_complaint,escalated_due:n.escalated_due,escalated_user:n.escalated_user,escalation_details:n.escalation_details,status:n.status,updatedAt:f(n.updatedAt)})),m=[Object.keys(a[0]).join(","),...a.map(n=>Object.values(n).join(","))].join(`
`),c=new Blob([m],{type:"text/csv;charset=utf-8;"}),h=window.URL.createObjectURL(c),s=document.createElement("a");s.setAttribute("href",h),s.setAttribute("download","Escalation_data.csv"),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}else if(t==="pdf")try{const m=Math.ceil(x.length/30),c=new Q("l","mm","a4");let h=0;for(let s=1;s<=m;s++){const n=(s-1)*30,V=Math.min(n+30,x.length),F=x.slice(n,V).map(o=>[o.grievance_id,o.escalation_department,o.escalation_complaint,o.escalated_due,o.escalated_user,o.escalation_details,o.status,f(o.updatedAt)]);c.text(`Page ${s}`,10,h+10),c.autoTable({startY:h+15,head:[["grievance_id","Department","Complaint","Over Due","Escalated User","Escalation Details","status","LastUpdated"]],body:F,theme:"striped"}),s<m&&(c.addPage(),h=10)}c.save("Escalation_data.pdf")}catch(a){console.error("Error exporting data:",a)}},M=()=>{try{P.post(`${_}/manual-escalation-check`).then(t=>{b(),H.success("Manual Escalation Done!!!")}).catch(t=>{console.error(t)})}catch{}},T=t=>{const a=parseInt(t.target.value,10);E(a),y(1)};return e.jsx(r.Fragment,{children:e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen ",children:[e.jsxs("div",{className:"flex flex-row  gap-1 justify-between items-center my-7 mx-8 flex-wrap",children:[e.jsxs("h1",{className:"md:text-xl text-lg font-medium whitespace-nowrap",children:[" ","Escalation"]}),e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(J,{value:u,onChange:t=>C(t.target.value),placeholder:"Search Escalation"}),e.jsx("button",{className:"bg-red-600 rounded-full px-3 py-2 text-white text-sm",onClick:()=>M(),children:"Refresh"}),D&&e.jsx(K,{selectedDoc:O,onChange:U,exportData:B})]})]}),e.jsxs("div",{className:`bg-white  mx-4 rounded-lg overflow-x-auto mt-1  p-3 ${x.length<6?"h-3/5":"h-fit"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mx-3",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-medium text-gray-600",children:"Page Entries"}),e.jsxs("select",{id:"itemsPerPage",value:d,onChange:T,className:" p-1 outline-none text-sm rounded px-2",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]}),e.jsx("div",{className:"overflow-x-auto my-1",children:e.jsxs("table",{className:"w-full  ",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Complaint No ",e.jsx(i,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Department ",e.jsx(i,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Complaint ",e.jsx(i,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-center font-semibold whitespace-nowrap",children:["Date ",e.jsx(i,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Over Due ",e.jsx(i,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Escalated User ",e.jsx(i,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Escalation Level ",e.jsx(i,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Status ",e.jsx(i,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:"Action"})})]})}),e.jsx("tbody",{children:R.map((t,a)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center",children:p+a+1<10?`0${p+a+1}`:p+a+1})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 border-slate-900 rounded-lg text-center py-1 my-1 capitalize text-slate-900 ",onClick:()=>v(`/escalateview?grievanceId=${t.grievance_id}`),children:t.grievance_id})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.escalation_department})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.escalation_complaint})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2  font-lexend text-center whitespace-nowrap text-sm text-gray-800",children:f(t.updatedAt)})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2  font-lexend text-center whitespace-nowrap text-sm text-gray-800",children:t.escalated_due})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800",children:t.escalated_user})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800",children:t.escalation_details})}),e.jsx("td",{children:e.jsx("p",{className:"border w-28 rounded-full text-center py-1.5 mx-2 text-sm font-normal capitalize border-gray-800 text-gray-800",children:t.status})}),e.jsx("td",{children:e.jsx("div",{className:"mx-3 my-3 whitespace-nowrap",onClick:()=>v("/view",{state:{grievanceId:t.grievance_id}}),children:e.jsx(G,{})})})]},a))})]})})]}),e.jsx("div",{className:" my-3 mb-5 mx-7",children:e.jsx(W,{Length:x.length,currentPage:j,totalPages:w,firstIndex:p,lastIndex:g,paginate:$,hasNextPage:g>=N.length})})]})})})};export{ce as default};
