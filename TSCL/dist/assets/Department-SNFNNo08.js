import{i as te,k as M,r,l as ae,o as se,j as e,b as S,A as k,B as v,d as q,I as De,F as Z,p as Se,m as ee,n as ke}from"./index-BcYsGqVu.js";import{R as I}from"./index-D7OJULEB.js";import{D as Ce}from"./DeleteModal-CGzHCWo0.js";import{P as Pe,a as Ie}from"./index-1Cs2earB.js";import{a as Oe}from"./index-D_-LWkAi.js";import{E as Ee}from"./jspdf.plugin.autotable-doWDoFvS.js";const $e=te().shape({org_name:M().test("not-select","Please select an Organization",a=>a!==""&&a!=="Select  Organization"),dept_name:M().required("Department is required")}),ze=({ExistingOrganiZations:a,toggleModal:y,handlerefresh:O})=>{const[_,U]=r.useState(null),[p,m]=r.useState(null),{register:g,formState:{errors:h},handleSubmit:N,watch:u}=ae({resolver:se($e),mode:"all"});r.useEffect(()=>{if(p){const n=a.find(P=>P.org_name===p);n&&U(n.org_id)}},[p,a]);const C=async n=>{const P={...n,org_id:_,status:"active",created_by_user:sessionStorage.getItem("name")};try{const w=sessionStorage.getItem("token"),l=await S.post(`${k}/department/post`,P,{headers:{Authorization:`Bearer ${w}`}});l.status===200?(v.success("Department created Successfully"),y(),O()):(console.error("Error in posting data",l),v.error("Failed to Upload"))}catch(w){console.error("Error in posting data",w)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px] font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Department"})}),e.jsxs("form",{onSubmit:N(C),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"org_name",children:"Organization Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",...g("org_name"),onChange:n=>m(n.target.value),children:[e.jsx("option",{value:"",children:"Select Organization"}),a.map(n=>e.jsx("option",{value:n.org_name,children:n.org_name},n.org_id))]}),h.org_name&&e.jsx("p",{className:"text-red-500",children:h.org_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"dept_name",children:"Department Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",type:"text",placeholder:"Department Name",...g("dept_name")}),h.dept_name&&e.jsx("p",{className:"text-red-500",children:h.dept_name.message})]})]}),e.jsxs("div",{className:"flex justify-end mx-10 gap-5",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:y,children:"Cancel"}),e.jsx("button",{className:"text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",children:"Save"})]})]})]})})},Ae=te().shape({org_name:M().test("not-select","Please select an Organization",a=>a!==""&&a!=="Select  Organization"),dept_name:M().required("Department is required"),status:M().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Be=({ExistingOrganiZations:a,toggleModal:y,handlerefresh:O,deptId:_})=>{const[U,p]=r.useState(null),[m,g]=r.useState(null),h=sessionStorage.getItem("token"),{register:N,formState:{errors:u},handleSubmit:C,setValue:n,watch:P}=ae({resolver:se(Ae),mode:"all"});r.useEffect(()=>{(async()=>{try{const f=await S.get(`${k}/department/getbyid?dept_id=${_}`,{headers:{Authorization:`Bearer ${h}`}}),o=q(f.data.data);n("org_name",o.org_name),g(o.org_name),n("dept_name",o.dept_name),n("status",o.status)}catch(f){console.error("Error fetching data",f)}})()},[_,n]),r.useEffect(()=>{if(m){const l=a.find(f=>f.org_name===m);l&&p(l.org_id)}},[m,a]);const w=async l=>{const f={...l};try{const o=await S.post(`${k}/department/update?dept_id=${_}`,f,{headers:{Authorization:`Bearer ${h}`}});o.status===200?(v.success("Department Updated Successfully"),g(null),p(null),y(),O()):(console.error("Error in posting data",o),v.error("Failed to Upload"))}catch(o){console.error("Error in posting data",o)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px] font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Department"})}),e.jsxs("form",{onSubmit:C(w),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"org_name",children:"Organization Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",...N("org_name"),onChange:l=>g(l.target.value),children:[e.jsx("option",{value:m,disabled:!0,children:m}),a.map(l=>e.jsx("option",{value:l.org_name,children:l.org_name},l.org_id))]}),u.org_name&&e.jsx("p",{className:"text-red-500",children:u.org_name.message})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"dept_name",children:"Department Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",type:"text",placeholder:"Department Name",...N("dept_name")}),u.dept_name&&e.jsx("p",{className:"text-red-500",children:u.dept_name.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...N("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),u.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:u.status.message})]})]}),e.jsxs("div",{className:"flex justify-end mx-10 gap-5",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:y,children:"Cancel"}),e.jsx("button",{className:"text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",children:"Save"})]})]})]})})},Fe=`dept_name,org_name,status,created_by_user
Department,Organization,active,admin`,Ye=({permissions:a})=>{const y=a==null?void 0:a.includes("create"),O=a==null?void 0:a.includes("edit"),_=a==null?void 0:a.includes("delete"),U=a==null?void 0:a.includes("download"),[p,m]=r.useState(!1),[g,h]=r.useState(!1),[N,u]=r.useState(!1),[C,n]=r.useState(null),[P,w]=r.useState(null),[l,f]=r.useState(null),[o,re]=r.useState(""),[x,ne]=r.useState(1),[E]=r.useState(8),[$,le]=r.useState(1),[Me,oe]=r.useState([]),[b,H]=r.useState([]),[Y,ce]=r.useState(null),R=sessionStorage.getItem("token"),[de,G]=r.useState(null),[J,K]=r.useState("Bulk Upload"),[T,ie]=r.useState(null),V=t=>{ce(Y===t?null:t)},me=t=>Y===t;r.useEffect(()=>{A(),ue()},[o,x]);const z=t=>{t>0&&t<=$&&ne(t)},A=()=>{S.get(`${k}/department/get`,{headers:{Authorization:`Bearer ${R}`}}).then(t=>{const s=q(t.data.data);H(s);const d=s.filter(c=>Object.values(c).some(i=>i.toString().toLowerCase().includes(o.toLowerCase())));le(Math.ceil(d.length/E));const j=x*E,D=j-E;oe(d.slice(D,j))})},xe=()=>{m(!p)},pe=()=>{h(!g),w(null)},he=()=>{m(!p)},Q=()=>{u(!N),n(null)},ue=async()=>{try{const t=await S.get(`${k}/organization/getactive`,{headers:{Authorization:`Bearer ${R}`}}),s=q(t.data.data);f(s)}catch(t){console.error("Error fetching existing Organisations:",t)}},L=x*E,B=L-E,W=b.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(o.toLowerCase()))),ge=W.slice().reverse().slice(B,L),fe=async()=>{try{await S.delete(`${k}/department/delete?dept_id=${C}`,{headers:{Authorization:`Bearer ${R}`}}),Q(),A(),H(b.filter(t=>b.dept_id!==C)),v.success("Deleted successfully")}catch{v.error("Failed to delete")}},be=t=>{G(t.target.files[0]),K("Upload")},je=()=>{J==="Bulk Upload"?document.getElementById("fileInput").click():ye(de)},ye=async t=>{try{const s=new FormData;s.append("file",t),(await S.post(`${k}/department/uploadcsv`,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(K("Bulk Upload"),G(null),A(),v.success("Data Uploaded Successfully")):v.error("Data failed to Upload")}catch(s){console.log(s)}},Ne=t=>{ie(t.target.value)},X=async t=>{if(t==="csv"){const s=b.map(i=>({dept_id:i.dept_id,dept_name:i.dept_name,org_name:i.org_name,status:i.status,created_by_user:i.created_by_user})),d=[Object.keys(s[0]).join(","),...s.map(i=>Object.values(i).join(","))].join(`
`),j=new Blob([d],{type:"text/csv;charset=utf-8;"}),D=window.URL.createObjectURL(j),c=document.createElement("a");c.setAttribute("href",D),c.setAttribute("download","Department_data.csv"),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}else if(t==="pdf")try{const d=Math.ceil(b.length/30),j=new Ee("l","mm","a4");let D=0;for(let c=1;c<=d;c++){const i=(c-1)*30,ve=Math.min(i+30,b.length),_e=b.slice(i,ve).map(F=>[F.dept_id,F.dept_name,F.org_name,F.status,F.created_by_user]);j.text(`Page ${c}`,10,D+10),j.autoTable({startY:D+15,head:[["DeptId","DeptName","OrgName","Status","createdBy"]],body:_e,theme:"striped"}),c<d&&(j.addPage(),D=10)}j.save("Department_data.pdf")}catch(s){console.error("Error exporting data:",s)}},we=()=>{const t=new Blob([Fe],{type:"text/csv"}),s=URL.createObjectURL(t),d=document.createElement("a");d.href=s,d.download="bulkupload_template.csv",d.click(),URL.revokeObjectURL(s)};return e.jsxs(r.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-3 mx-8 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-white py-2 px-3 rounded-full",children:[e.jsx(De,{className:"text-xl"}),e.jsx("input",{type:"search",className:"outline-none bg-transparent text-base",placeholder:"Search Department",value:o,onChange:t=>re(t.target.value)})]}),y&&e.jsxs("div",{className:"relative text-center   hover:text-white py-1.5 rounded-full",children:[e.jsx("input",{type:"file",id:"fileInput",className:"hidden",onChange:be,accept:".csv"}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border-primary border-2 font-normal text-base w-36 py-1.5  rounded-full text-primary hover:text-white hover:bg-primary  ",onClick:je,children:[e.jsx(Z,{}),J]})]}),U&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("form",{children:e.jsxs("select",{className:"block w-full py-2 px-2  text-sm border-2 text-gray-400  border-gray-300 rounded-full bg-gray-50 outline-none",onChange:Ne,children:[e.jsx("option",{hidden:!0,children:"Download"}),e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"pdf",children:"PDF"})]})}),T===null&&e.jsx(Oe,{className:"text-2xl text-gray-500"}),T==="csv"&&e.jsx(Pe,{className:"text-3xl text-gray-500",onClick:()=>X("csv")}),T==="pdf"&&e.jsx(Ie,{className:"text-3xl text-gray-500",onClick:()=>X("pdf")})]})]}),e.jsxs("div",{className:"flex justify-between items-center my-2 mx-8 gap-1 flex-wrap",children:[e.jsx("h1",{className:"md:text-xl text-lg font-medium  font-lexend",children:"Department"}),y&&e.jsxs("button",{className:"flex  gap-2  items-center border-2 bg-blue-500 text-white font-lexend rounded-full p-2 w-fit justify-between",onClick:()=>m(!0),children:[e.jsx(Z,{})," Add Department"]})]}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3 overflow-x-auto h-3/5 no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{className:"",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-3 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Department Name ",e.jsx(I,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Org Name ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold  whitespace-nowrap",children:["Status ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedBy ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedAt ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Last UpdatedAt ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-semibold font-lexend  whitespace-nowrap",children:"Action"})})]})}),e.jsx("tbody",{children:ge.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-800",children:B+s+1<10?`0${B+s+1}`:B+s+1})}),e.jsx("td",{children:e.jsxs("div",{className:"flex  gap-2 items-center justify-start mx-5 my-3  text-sm text-gray-800",children:[e.jsx("img",{src:Se,alt:"logo",className:"w-8 h-8"}),e.jsxs("p",{className:"font-lexend whitespace-nowrap capitalize   text-gray-800",children:[" ",t.dept_name]})]})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"capitalize mx-3 my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.org_name})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2  font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800 ",children:ee(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800",children:ee(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(ke,{onClick:()=>V(s)}),me(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[O&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{h(!0),w(t.dept_id),V()},children:"Edit"}),_&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{u(!0),n(t.dept_id),V()},children:"Delete"})]})]})})]},s))})]})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"bg-primary px-3 py-2 rounded-full text-white text-sm font-alegerya",onClick:we,children:"Bulk Upload Template"})}),e.jsxs("nav",{className:"flex items-center flex-column flex-wrap md:flex-row md:justify-between justify-center pt-4","aria-label":"Table navigation",children:[e.jsxs("span",{className:"text-sm font-normal text-gray-700 mb-4 md:mb-0 block w-full md:inline md:w-auto text-center font-alegerya",children:["Showing"," ",e.jsxs("span",{className:"text-gray-700",children:[B+1," to ",Math.min(L,b.length)]})," ","of"," ",e.jsxs("span",{className:"text-gray-900",children:[b.length," entries"]})]}),e.jsxs("ul",{className:"inline-flex -space-x-px rtl:space-x-reverse text-sm h-8 font-alegerya",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>z(1),disabled:x===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-s-lg hover:bg-paginate-bg hover:text-primary-hover",children:"<<"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>z(x-1),disabled:x===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Back"})}),Array.from({length:$},(t,s)=>s+1).slice(Math.max(0,x-2),Math.min($,x+1)).map(t=>e.jsx("li",{children:e.jsx("button",{onClick:()=>z(t),className:`flex items-center justify-center px-3 h-8 leading-tight border border-paginate-br hover:text-white hover:bg-primary ${x===t?"bg-primary text-white":"bg-white text-black"}`,children:t})},t)),e.jsx("li",{children:e.jsx("button",{onClick:()=>z(x+1),disabled:L>=W.length,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Next"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>z($),disabled:x===$,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-e-lg hover:bg-paginate-bg hover:text-primary-hover",children:">>"})})]})]})]})]})}),p&&e.jsx(ze,{toggleModal:xe,toggleCloseModal:he,ExistingOrganiZations:l,handlerefresh:A}),g&&e.jsx(Be,{toggleModal:pe,handlerefresh:A,ExistingOrganiZations:l,deptId:P}),N&&e.jsx(Ce,{toggleDeleteModal:Q,delete:fe})]})};export{Ye as default};
