import{i as De,k as ke,r as a,m as Ie,o as $e,b as A,A as P,d as M,j as e,B as J,l as Me,u as ze,y as Ee,p as Ue,O as Re,w as Te,z as Be}from"./index-Cb3AN3R3.js";import{R as b}from"./index-C-hq6bKM.js";import{S as Le,D as Ge,E as Oe}from"./DocumentDownload-A0b-q8L_.js";import{P as Fe}from"./Pagination-ClPqWgoN.js";import{M as Ye}from"./ManyTicketTransfer-CEtZFA1_.js";import{D as qe,a as He}from"./DateRangeComp-B_BpUMFB.js";import"./index-CmROlnnr.js";import"./index-Du0g9a49.js";import"./index-aztxF81R.js";const Ve=De().shape({assign_username:ke().test("not-select","Please select an Assign User",l=>l!==""&&l!=="Select  Assign_user")}),Je=l=>{const{selectedRows:u,toggleAModal:f,handlerefresh:C}=l,D=localStorage.getItem("token"),[j,z]=a.useState([]),{register:v,formState:{errors:w},handleSubmit:h,watch:K}=Ie({resolver:$e(Ve),mode:"all"});a.useEffect(()=>{k()},[]);const k=async()=>{try{const x=localStorage.getItem("dept"),p=await A.get(`${P}/user/getbydept?dept_name=${x}`,{headers:{Authorization:`Bearer ${D}`}}),y=M(p.data.data);z(y)}catch(x){console.error(x)}},E=async x=>{const p=event.target.querySelector("select"),y=p.options[p.selectedIndex],U=y.getAttribute("data-user-id"),_=y.getAttribute("data-user-phone"),R={grievanceIds:u,assignUserDetails:{...x,assign_user:U,assign_userphone:_},user:localStorage.getItem("name")};try{const i=await A.post(`${P}/new-grievance/updatemanyassign`,R,{headers:{Authorization:`Bearer ${D}`}});i.status===200?(J.success("Bulk-Assign Successfull"),f(),C()):(console.error("Error in posting data",i),J.error("Failed to Upload"))}catch(i){console.error("Error in posting data",i)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white  h-fit  font-lexend m-2 rounded-sm w-[500px]",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-6",children:e.jsx("h1",{className:"text-xl font-medium pt-6 ",children:"Assign User"})}),e.jsx("form",{onSubmit:h(E),children:e.jsxs("div",{className:"  py-2 mx-6 my-3 gap-5 ",children:[e.jsxs("div",{className:"mb-3 flex items-baseline gap-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3 w-2/6",htmlFor:"assign_username",children:"Assign_user"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-4/6 py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"assign_username",...v("assign_username"),children:[e.jsx("option",{value:"",children:"Select Assign_user"}),j&&j.map((x,p)=>e.jsx("option",{value:x.user_name,"data-user-id":x.user_id,"data-user-phone":x.phone,"data-user-name":x.user_name,children:x.user_name},p))]})]}),w.assign_username&&e.jsx("p",{className:"text-red-500 text-end text-sm mb-2 -mt-2",children:w.assign_username.message}),e.jsxs("div",{className:"flex justify-end py-3 mx-10 my-3 gap-5",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:f,children:"Cancel"}),e.jsx("button",{className:"text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",children:"Assign"})]})]})})]})})},ne=({permissions:l,include:u,endpoint:f})=>{l==null||l.includes("create"),l==null||l.includes("edit"),l==null||l.includes("delete");const C=l==null?void 0:l.includes("download"),D=Me(),[j,z]=a.useState(""),[v,w]=a.useState(1),[h,K]=a.useState(10),[k,E]=a.useState(1),[x,p]=a.useState([]),[y,U]=a.useState([]),[_,R]=a.useState([]),[i,T]=a.useState([]),[Q,le]=a.useState([]),[W,X]=a.useState(!1),[Z,ee]=a.useState(!1),[B,L]=a.useState([]),[re,ce]=a.useState(null),[ie,oe]=a.useState({}),G=localStorage.getItem("token"),te=localStorage.getItem("dept"),[se,de]=a.useState({}),me=ze(),[ae,xe]=a.useState("All"),[O,F]=a.useState(null),[Y,q]=a.useState(null),[I,H]=a.useState(null);a.useEffect(()=>{V(),ue(),he(),D(Ee())},[]);const g=Ue(t=>t.origin);a.useEffect(()=>{var t;if(g&&(g!=null&&g.data)){const s=(t=g==null?void 0:g.data)==null?void 0:t.reduce((r,c)=>(r[c.res_name]=c.image,r),{});oe(s)}},[g]);const V=()=>{A.get(`${P}/new-grievance/${f}?dept_name=${te}`,{headers:{Authorization:`Bearer ${G}`}}).then(t=>{const s=M(t.data.data);R(s);const r=s.filter(c=>Object.values(c).some(d=>d.toString().toLowerCase().includes(j.toLowerCase())));T(r)}).catch(t=>{console.error(t)})},ue=async()=>{try{const t=await A.get(`${P}/status/get`,{headers:{Authorization:`Bearer ${G}`}}),s=M(t.data.data),r=s.reduce((c,d)=>(c[d.status_name]=d.color,c),{});U(s),de(r)}catch(t){console.error("Error fetching existing ActiveStatus:",t)}},he=async()=>{try{const t=await A.get(`${P}/user/getbydept?dept_name=${te}`,{headers:{Authorization:`Bearer ${G}`}}),s=M(t.data.data);le(s)}catch(t){sconsole.error("Error fetching existing ActiveStatus:",t)}};a.useEffect(()=>{const t=_.filter(s=>Object.values(s).some(r=>r.toString().toLowerCase().includes(j.toLowerCase())));T(t)},[j]),a.useEffect(()=>{const t=v*h,s=t-h;p(i.slice(s,t)),E(Math.ceil(i.length/h))},[i,v,h]);const N=t=>{t>0&&t<=k&&w(t)},pe=t=>{const s=t[0].startDate,r=t[0].endDate,c=_.filter(d=>{const o=new Date(d.createdAt);return o>=s&&o<He(r,1)});T(c),J.success("Grievance filtered")},$=v*h,S=$-h,ge=t=>{xe(t),F(null),q(null),H(null),N(1)},fe=t=>{F(t==="All"?null:t),N(1)},je=t=>{q(t==="All"?null:t),N(1)},ye=t=>{H(t==="All"?null:t),N(1)},be=i.slice().reverse().filter(t=>{const s=ae==="All"?!0:"",r=O===null?!0:t.status===O,c=Y===null?!0:t.priority===Y,d=I===null?!0:I==="Yet to be Assigned"?!t.assign_username:t.assign_username===I;return s&&r&&c&&d}).slice(S,$),ve=t=>{L(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},we=()=>{X(!W),L([])},_e=()=>{ee(!Z),L([])},Ne=t=>{ce(t.target.value)},Se=async t=>{if(t==="csv"){const s=i.map(n=>({grievance_id:n.grievance_id,grievance_mode:n.grievance_mode,complaint_type_title:n.complaint_type_title,dept_name:n.dept_name,zone_name:n.zone_name,ward_name:n.ward_name,street_name:n.street_name,pincode:n.pincode,complaint:n.complaint,public_user_id:n.public_user_id,public_user_name:n.public_user_name,phone:n.phone,assign_user:n.assign_user,assign_username:n.assign_username,assign_userphone:n.assign_userphone,status:n.status,escalation_level:n.escalation_level,priority:n.priority})),r=[Object.keys(s[0]).join(","),...s.map(n=>Object.values(n).join(","))].join(`
`),c=new Blob([r],{type:"text/csv;charset=utf-8;"}),d=window.URL.createObjectURL(c),o=document.createElement("a");o.setAttribute("href",d),o.setAttribute("download","Grievance_data.csv"),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}else if(t==="pdf")try{const r=Math.ceil(i.length/30),c=new Oe("l","mm","a4");let d=0;for(let o=1;o<=r;o++){const n=(o-1)*30,Pe=Math.min(n+30,i.length),Ce=i.slice(n,Pe).map(m=>[m.grievance_id,m.grievance_mode,m.complaint_type_title,m.dept_name,m.pincode,m.complaint,m.public_user_name,m.phone,m.assign_username,m.assign_userphone,m.status,m.escalation_level,m.priority]);c.text(`Page ${o}`,10,d+10),c.autoTable({startY:d+15,head:[["grievance_id","grievance_mode","complaintType","dept","pincode","complaint","publicUser","phone","assignUser","assignUserphone","status","Escalation","Priority"]],body:Ce,theme:"striped"}),o<r&&(c.addPage(),d=10)}c.save("Grievance_data.pdf")}catch(s){console.error("Error exporting data:",s)}},Ae=t=>{const s=parseInt(t.target.value,10);K(s),w(1)};return e.jsxs(a.Fragment,{children:[e.jsx("div",{className:"bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"  font-lexend h-screen ",children:[e.jsxs("div",{className:"flex flex-row  gap-3 p-2 mt-1 mx-4 flex-wrap md:justify-between items-center",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx(qe,{onChange:pe}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-medium text-gray-600",children:"Page Entries"}),e.jsxs("select",{id:"itemsPerPage",value:h,onChange:Ae,className:" p-1 outline-none text-sm rounded px-2",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]}),e.jsxs("div",{className:"flex flex-row flex-wrap gap-1.5",children:[e.jsx(Le,{value:j,onChange:t=>z(t.target.value),placeholder:"Search Grievances"}),C&&e.jsx(Ge,{selectedDoc:re,onChange:Ne,exportData:Se})]})]}),e.jsxs("div",{className:`bg-white  mx-4 rounded-lg mt-1   p-3 ${_.length<8?"h-4/5":"h-fit"}`,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center md:gap-6 gap-2 md:mt-2 mx-3",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsx("p",{className:"text-lg  whitespace-nowrap",children:"View Report"})}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("select",{className:"block w-full  px-1 py-2 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-md",onChange:t=>ye(t.target.value),value:I||"",children:[e.jsx("option",{hidden:!0,children:"Select Assign"}),e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"Yet to be Assigned",children:"Yet to be Assigned"}),Q&&Q.map((t,s)=>e.jsx("option",{value:t.user_name,children:t.user_name},s))]})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("select",{className:"block w-full  px-1 py-2 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-md",onChange:t=>je(t.target.value),value:Y||"",children:[e.jsx("option",{hidden:!0,children:"Priority"}),e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"Low",children:"Low"})]})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("select",{className:"block w-full  px-1 py-2 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-md",onChange:t=>fe(t.target.value),value:O||"",children:[e.jsx("option",{hidden:!0,children:"Status"}),e.jsx("option",{value:"All",children:"All"}),y&&y.map((t,s)=>e.jsx("option",{value:t.status_name,children:t.status_name},s))]})}),e.jsx("button",{className:`w-20 py-1.5 shadow-md ${ae==="All"?"bg-primary text-white":"bg-white text-black"} rounded-full `,onClick:()=>ge("All"),children:"All"})]})]}),u=="yes"&&e.jsxs("div",{className:"my-2 mx-3 flex flex-wrap gap-2 ",children:[e.jsx("button",{className:"bg-blue-300 shadow-md px-3 py-1 rounded-full text-white text-sm",onClick:()=>ee(!0),children:"Multi-Assign"}),e.jsx("button",{className:"bg-blue-300 shadow-md px-3 py-1 rounded-full text-white text-sm",onClick:()=>X(!0),children:"Multi-Transfer"})]}),e.jsx("div",{className:" rounded-lg  py-3 overflow-x-auto",children:e.jsxs("table",{className:"w-full mt-1 ",children:[e.jsx("thead",{className:" border-b border-gray-300  ",children:e.jsxs("tr",{className:"",children:[u==="yes"&&e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-3 my-2 font-lexend text-center font-semibold whitespace-nowrap",children:e.jsx(Re,{className:"text-xl text-center text-primary"})})}),e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-3 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 text-start font-lexend font-medium  whitespace-nowrap",children:"Complaint No"})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:"Origin"})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Complaint",e.jsx(b,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Department",e.jsx(b,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Date and Time ",e.jsx(b,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Raised by ",e.jsx(b,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Assigned JE ",e.jsx(b,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:["Priority ",e.jsx(b,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:["Status ",e.jsx(b,{})]})})]})}),e.jsx("tbody",{children:be.map((t,s)=>e.jsxs("tr",{className:" border-b border-gray-300  ",children:[u==="yes"&&e.jsx("td",{className:" flex gap-2 items-center justify-center ",children:e.jsxs("div",{className:"flex items-center ",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 mt-4  text-dark bg-gray-800 border-gray-800 rounded",checked:B.includes(t.grievance_id),onChange:()=>ve(t.grievance_id)}),e.jsx("label",{className:"sr-only",htmlFor:"checkbox-table-search-1",children:"checkbox"})]})}),e.jsx("td",{className:"",children:e.jsx("div",{className:"text-center text-sm mx-3 my-2 font-lexend whitespace-nowrap",children:S+s+1<10?`0${S+s+1}`:S+s+1})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 border-slate-900 rounded-lg text-center py-1 my-1  capitalize text-slate-900",onClick:()=>me(`/view2?grievanceId=${t.grievance_id}&deptName=${encodeURIComponent(t.dept_name)}`),children:t.grievance_id})}),e.jsx("td",{className:"flex gap-1 items-center justify-center text-gray-700",children:e.jsx("img",{src:ie[t.grievance_mode]||Te,alt:t.grievance_mode,className:"w-6 h-6 mx-1.5 my-2 rounded-full"})}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.complaint})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.dept_name})]}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:Be(t.createdAt)})}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.public_user_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.assign_username?t.assign_username:"Yet to be assigned"})]}),e.jsx("td",{children:e.jsx("p",{className:`border-2 w-26 rounded-full text-center py-1.5 mx-2 text-sm font-medium capitalize  ${t.priority==="High"?"text-red-500 border-red-500":t.priority==="Medium"?"text-sky-500 border-sky-500":t.priority==="Low"?"text-green-500 border-green-500":""}`,children:t.priority})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 rounded-full text-center py-1 tex-sm font-normal mx-2 capitalize  ",style:{borderColor:se[t.status]||"gray",color:se[t.status]||"black",fontSize:14},children:t.status})})]},s))})]})})]}),e.jsx("div",{className:" mt-1 mb-5 mx-7",children:e.jsx(Fe,{Length:i.length,currentPage:v,totalPages:k,firstIndex:S,lastIndex:$,paginate:N,hasNextPage:$>=i.length})})]})}),W&&e.jsx(Ye,{toggleTModal:we,selectedRows:B,handlerefresh:V}),Z&&e.jsx(Je,{toggleAModal:_e,selectedRows:B,handlerefresh:V})]})};function lt({permissions:l}){const[u,f]=a.useState("tab1");return e.jsxs("div",{className:"overflow-auto no-scrollbar",children:[e.jsxs("ul",{className:"flex mb-2 list-none justify-center mt-1",children:[e.jsx("li",{className:"-mb-px mr-1",children:e.jsx("a",{className:`text-white   font-medium rounded-sm text-sm px-5 py-1.5 text-center  ${u==="tab1"?"bg-gray-700":"bg-gray-400"}`,onClick:()=>f("tab1"),children:"Current Grievances"})}),e.jsx("li",{className:"-mb-px mr-1",children:e.jsx("a",{className:`text-white   font-medium rounded-sm text-sm px-5 py-1.5 text-center ${u==="tab2"?"bg-gray-700":"bg-gray-400"}`,onClick:()=>f("tab2"),children:"Closed Grievances"})})]}),e.jsxs("div",{className:"mx-1 ",children:[u==="tab1"&&e.jsx(ne,{permissions:l,include:"yes",endpoint:"getbydeptnotclosed"}),u==="tab2"&&e.jsx(ne,{permissions:l,endpoint:"getbydeptclosed"})]})]})}export{lt as default};
