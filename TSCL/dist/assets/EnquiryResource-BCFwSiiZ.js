import{i as J,k as q,r as a,m as K,o as Q,j as e,B as f,b as A,A as B,d as W,q as G,s as he,v as ge}from"./index-Cb3AN3R3.js";import{R as M}from"./index-C-hq6bKM.js";import{D as pe}from"./DeleteModal-De28Bu6M.js";import{S as fe,D as je,E as be}from"./DocumentDownload-A0b-q8L_.js";import{P as ye}from"./Pagination-ClPqWgoN.js";import{B as we}from"./BulkUploadButton-C25cRLG1.js";import{H as Ne}from"./HeaderButton-By5upfsz.js";import{S as X}from"./SavaCancel-CuKZ8TfL.js";import"./ApiClient-w4qWO__2.js";import"./index-Du0g9a49.js";import"./index-CmROlnnr.js";import"./index-BK6gNoz8.js";const ve=J().shape({res_name:q().required("Resource is required").lowercase()}),Se=s=>{const[m,k]=a.useState(""),[I,y]=a.useState(!1),[D,x]=a.useState(!1),{register:_,formState:{errors:w},handleSubmit:E}=K({resolver:Q(ve),mode:"all"}),u=d=>{const h=d.target.files[0];if(h.size>1024*1024){f.error("File size exceeds 1MB. Please upload a smaller image.");return}const n=new FileReader;n.onload=()=>{k(n.result),y(!1)},n.readAsDataURL(h)},N=async d=>{if(!m){y(!0),f.error("Image upload is mandatory.");return}const h={...d,status:"active",created_by_user:localStorage.getItem("name"),image:m};try{x(!0);const n=await A.post(`${B}/resource/post`,h,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});n.status===200?(f.success("Resource created Successfully"),x(!1),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",n),x(!1),f.error("Failed to Upload"))}catch(n){console.error("Error in posting data",n),x(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] h-[420px] font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Enquiry Resource"})}),e.jsxs("form",{onSubmit:E(N),children:[e.jsxs("div",{className:"mx-6 my-6",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"res_name",children:"Resource Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"res_name",type:"text",placeholder:"Resource Name",..._("res_name")}),w.res_name&&e.jsx("p",{className:"text-red-500",children:w.res_name.message})]}),e.jsxs("div",{className:"mx-6 my-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"image",children:"Upload Image"}),e.jsx("input",{className:" mx-auto block w-3/4 py-1.5 px-4 text-sm text-center text-gray-500 border border-gray-300 rounded-lg cursor-pointer focus:outline-none",id:"image",type:"file",accept:"image/*",onChange:u}),I&&e.jsx("p",{className:"text-red-500 mt-2",children:"Image upload is mandatory."}),m&&e.jsx("p",{className:"text-green-500 mt-2",children:"Image uploaded successfully."})]}),e.jsx(X,{onCancel:s.toggleModal,isLoading:D})]})]})})},Ie=J().shape({res_name:q().required("Resource is required").lowercase(),status:q().test("not-select","Please select a Status",s=>s!==""&&s!=="Status")}),De=s=>{const{ResId:m}=s,k=localStorage.getItem("token"),[I,y]=a.useState(null),[D,x]=a.useState(""),[_,w]=a.useState(!1),[E,u]=a.useState(!1),{register:N,formState:{errors:d},handleSubmit:h,watch:n,setValue:j}=K({resolver:Q(Ie),mode:"all"});a.useEffect(()=>{(async()=>{try{const o=await A.get(`${B}/resource/getbyid?res_id=${m}`,{headers:{Authorization:`Bearer ${k}`}}),c=W(o.data.data);j("res_name",c.res_name),j("status",c.status),y(c.image)}catch(o){console.error("Error fetching data",o)}})()},[m,j]);const U=R=>{const o=R.target.files[0];if(o.size>1024*1024){f.error("File size exceeds 1MB. Please upload a smaller image.");return}const c=new FileReader;c.onload=()=>{const g=c.result;x(g),y(g),w(!1)},c.readAsDataURL(o)},P=async R=>{const o=localStorage.getItem("token"),c={...R,image:D};try{u(!0);const g=await A.post(`${B}/resource/update?res_id=${m}`,c,{headers:{Authorization:`Bearer ${o}`}});g.status===200?(f.success("Resource Updated Successfully"),u(!1),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",g),u(!1),f.error("Failed to Update"))}catch(g){console.error("Error in posting data",g),u(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] h-fit font-lexend m-2 pb-8",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Edit Resource"})}),e.jsxs("form",{onSubmit:h(P),children:[e.jsxs("div",{className:"mx-8 my-6",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-4",htmlFor:"res_name",children:"Resource Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"res_name",type:"text",placeholder:"Resource Name",...N("res_name")}),d.res_name&&e.jsx("p",{className:"text-red-500",children:d.res_name.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 mx-10 my-8",children:[e.jsx("label",{className:"text-gray-900 text-base font-normal col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"text-sm text-black border border-gray-900 rounded-lg border-none outline-none",id:"status",...N("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]})]}),d.status&&e.jsx("p",{className:"text-red-500 text-xs text-center -mt-4 mb-2",children:d.status.message})]}),e.jsxs("div",{className:"mx-6 my-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"image",children:"Upload Image"}),e.jsx("input",{className:"mx-auto block w-3/4 py-1.5 px-4 text-sm text-center text-gray-500 border border-gray-300 rounded-lg cursor-pointer focus:outline-none",id:"image",type:"file",accept:"image/*",onChange:U}),_&&e.jsx("p",{className:"text-red-500 mt-2",children:"Image upload is mandatory."}),I&&e.jsx("div",{className:"mt-4 flex  justify-center",children:e.jsx("img",{src:I,alt:"Uploaded Preview",className:"w-32 h-32 object-cover border rounded-lg"})})]}),e.jsx(X,{onCancel:s.toggleModal,isLoading:E})]})]})})},qe=({permissions:s})=>{const m=s==null?void 0:s.includes("create"),k=s==null?void 0:s.includes("edit"),I=s==null?void 0:s.includes("delete"),y=s==null?void 0:s.includes("download"),[D,x]=a.useState(!1),[_,w]=a.useState(!1),[E,u]=a.useState(null),[N,d]=a.useState(!1),[h,n]=a.useState(null),[j,U]=a.useState(""),[P,R]=a.useState(1),[o]=a.useState(8),[c,g]=a.useState(1),[_e,Z]=a.useState([]),[b,O]=a.useState([]),[V,ee]=a.useState(null),T=localStorage.getItem("token"),[te,se]=a.useState(null),F=t=>{ee(V===t?null:t)},ae=t=>V===t;a.useEffect(()=>{$()},[j,P]);const re=t=>{t>0&&t<=c&&R(t)},$=()=>{A.get(`${B}/resource/get`,{headers:{Authorization:`Bearer ${T}`}}).then(t=>{const r=W(t.data.data);O(r);const v=r.filter(l=>Object.values(l).some(i=>i.toString().toLowerCase().includes(j.toLowerCase())));g(Math.ceil(v.length/o));const p=P*o,S=p-o;Z(v.slice(S,p))}).catch(t=>{console.error(t)})},oe=()=>{x(!D)},le=()=>{w(!_),u(null)},H=()=>{d(!N),n(null)},z=P*o,C=z-o,Y=b.filter(t=>Object.values(t).some(r=>r.toString().toLowerCase().includes(j.toLowerCase()))),ne=Y.slice().reverse().slice(C,z),ce=async()=>{try{const t=await A.delete(`${B}/resource/delete?res_id=${h}`,{headers:{Authorization:`Bearer ${T}`}});H(),$(),O(b.filter(r=>b.res_id!==h)),f.success("Deleted successfully")}catch{f.error("Failed to delete")}},de=t=>{se(t.target.value)},ie=async t=>{if(t==="csv"){const r=b.map(i=>({res_id:i.res_id,res_name:i.res_name,status:i.status,created_by_user:i.created_by_user})),v=[Object.keys(r[0]).join(","),...r.map(i=>Object.values(i).join(","))].join(`
`),p=new Blob([v],{type:"text/csv;charset=utf-8;"}),S=window.URL.createObjectURL(p),l=document.createElement("a");l.setAttribute("href",S),l.setAttribute("download","Resource_data.csv"),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}else if(t==="pdf")try{const v=Math.ceil(b.length/30),p=new be("l","mm","a4");let S=0;for(let l=1;l<=v;l++){const i=(l-1)*30,xe=Math.min(i+30,b.length),ue=b.slice(i,xe).map(L=>[L.res_id,L.res_name,L.status,L.created_by_user]);p.text(`Page ${l}`,10,S+10),p.autoTable({startY:S+15,head:[["ResID","ResName","Status","createdBy"]],body:ue,theme:"striped"}),l<v&&(p.addPage(),S=10)}p.save("Resource_data.pdf")}catch(r){console.error("Error exporting data:",r)}},me=()=>{ge(csvData)};return e.jsxs(a.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen ",children:[e.jsxs("div",{className:"flex flex-row md:justify-end gap-2 p-2 mt-2 mx-8 flex-wrap items-center",children:[e.jsx(fe,{value:j,onChange:t=>U(t.target.value),placeholder:"Search Enquiry Resource"}),y&&e.jsx(je,{selectedDoc:te,onChange:de,exportData:ie})]}),e.jsx(Ne,{title:"Enquiry Resource",hasCreatePermission:m,onClick:()=>x(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar my-2",children:e.jsxs("table",{className:"w-full  ",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Resource Name ",e.jsx(M,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Status ",e.jsx(M,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedBy ",e.jsx(M,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedAt ",e.jsx(M,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Last UpdatedAt ",e.jsx(M,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-start mx-1.5 my-3 font-semibold font-lexend",children:"Action"})})]})}),e.jsx("tbody",{children:ne.map((t,r)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center",children:C+r+1<10?`0${C+r+1}`:C+r+1})}),e.jsxs("td",{className:"flex items-center gap-2 ml-4",children:[e.jsx("img",{src:t.image,alt:"Icon",className:"w-6 h-6 rounded-full"}),e.jsx("p",{className:"capitalize mx-1.5 my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.res_name})]}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2  font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800 ",children:G(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800",children:G(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(he,{onClick:()=>F(r)}),ae(r)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[k&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{w(!0),u(t.res_id),F()},children:"Edit"}),I&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{d(!0),n(t.res_id),F()},children:"Delete"})]})]})})]},r))})]})})}),e.jsxs("div",{className:" my-2 mb-5 mx-7",children:[e.jsx(we,{handleDownload:me}),e.jsx(ye,{Length:b.length,currentPage:P,totalPages:c,firstIndex:C,lastIndex:z,paginate:re,hasNextPage:z>=Y.length})]})]})}),D&&e.jsx(Se,{toggleModal:oe,handlerefresh:$}),_&&e.jsx(De,{toggleModal:le,handlerefresh:$,ResId:E}),N&&e.jsx(pe,{toggleDeleteModal:H,delete:ce})]})};export{qe as default};
