import{i as K,k as g,l as Q,o as W,j as e,b as _,A as k,B as j,r as l,d as X,I as ye,F as J,n as ve}from"./index-q9gTl8Nx.js";import{R as E}from"./index-BV5I8TVR.js";import{D as Ne}from"./DeleteModal-w6shXZ7w.js";import{P as we,a as _e}from"./index-Dc1RO-OU.js";import{a as ke}from"./index-CrIzh8Eh.js";import{E as Pe}from"./jspdf.plugin.autotable-UcE--c0v.js";const Se=K().shape({public_user_name:g().required("User Name is required"),phone:g().required("Phone Number is required"),email:g().required("Email Id  is required"),address:g().required("Address is required"),pincode:g().required("Pincode is required")}),De=a=>{const{register:d,formState:{errors:r},handleSubmit:b,setValue:m,watch:P}=Q({resolver:W(Se),mode:"all"}),p=async S=>{const N={...S,login_password:"tscl@123",user_status:"active",verification_status:"active"},w=sessionStorage.getItem("token");try{const i=await _.post(`${k}/public-user/post`,N,{headers:{Authorization:`Bearer ${w}`}});i.status===200?(j.success("Public User created Successfully"),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",i),j.error("Failed to Upload"))}catch(i){console.error("Error in posting data",i)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsx("div",{className:"bg-white w-fit h-fit  font-lexend m-2",children:e.jsxs("form",{onSubmit:b(p),children:[e.jsxs("div",{className:"border-b-2 border-gray-300 mx-10 my-5",children:[e.jsxs("div",{className:" grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 col-span-1 whitespace-nowrap",htmlFor:"public_user_name",children:"Name"}),e.jsx("input",{type:"text",id:"public_user_name",className:"mx-2 font-lexend px-2 text-sm text-end outline-none col-span-2",placeholder:"User Name",...d("public_user_name")})]}),r.public_user_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.public_user_name.message})]}),e.jsxs("div",{className:" flex flex-col gap-3 mx-10 my-1 ",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"Phone",children:"Phone :"}),e.jsx("input",{type:"text",id:"phone",className:"w-6/5 text-end outline-none col-span-2",placeholder:"Phone Number",...d("phone")})]}),r.phone&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.phone.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"email",children:"Email Id :"}),e.jsx("input",{type:"email",id:"email",className:" text-end outline-none col-span-2",placeholder:"abc@gmail.com",...d("email")})]}),r.email&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.email.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"address",children:"Address :"}),e.jsx("input",{type:"text",id:"address",className:" text-end outline-none col-span-2",placeholder:"Address",...d("address")})]}),r.address&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.address.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"pincode",children:"Pincode :"}),e.jsx("input",{type:"text",id:"pincode",className:" text-end outline-none col-span-2",placeholder:"Pincode ",...d("pincode")})]}),r.pincode&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:r.pincode.message})]})]}),e.jsxs("div",{className:"flex justify-end  py-6 mx-10 my-3 gap-5 ",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:a.toggleModal,children:"cancel"}),e.jsx("button",{className:" text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",children:"Save"})]})]})})})},Ue=K().shape({public_user_name:g().required("User Name is required"),address:g().required("Address is required"),pincode:g().required("Pincode is required"),user_status:g().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Ce=a=>{const{userId:d}=a,r=sessionStorage.getItem("token"),{register:b,formState:{errors:m},handleSubmit:P,setValue:p,watch:S}=Q({resolver:W(Ue),mode:"all"});l.useEffect(()=>{(async()=>{try{const i=await _.get(`${k}/public-user/getbyid?public_user_id=${d}`,{headers:{Authorization:`Bearer ${r}`}}),o=X(i.data.data);p("public_user_name",o.public_user_name),p("address",o.address),p("pincode",o.pincode),p("user_status",o.user_status)}catch(i){console.error("Error fetching data",i)}})()},[d,p]);const N=async w=>{const i={...w};try{const o=await _.post(`${k}/public-user/update?public_user_id=${d}`,i,{headers:{Authorization:`Bearer ${r}`}});o.status===200?(j.success("Public User Updated Successfully"),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",o),j.error("Failed to Upload"))}catch(o){console.error("Error in posting data",o)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsx("div",{className:"bg-white w-fit h-fit  font-lexend m-2",children:e.jsxs("form",{onSubmit:P(N),children:[e.jsxs("div",{className:"border-b-2 border-gray-300 mx-10 my-5",children:[e.jsxs("div",{className:" grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 col-span-1 whitespace-nowrap",htmlFor:"public_user_name",children:"Name"}),e.jsx("input",{type:"text",id:"public_user_name",className:"mx-2 font-lexend px-2 text-sm text-end outline-none col-span-2",placeholder:"User Name",...b("public_user_name")})]}),m.public_user_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.public_user_name.message})]}),e.jsxs("div",{className:" flex flex-col gap-3 mx-10 my-1 ",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"address",children:"Address :"}),e.jsx("input",{type:"text",id:"address",className:" text-end outline-none col-span-2",placeholder:"Address",...b("address")})]}),m.address&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.address.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-1",htmlFor:"pincode",children:"Pincode :"}),e.jsx("input",{type:"text",id:"pincode",className:" text-end outline-none col-span-2",placeholder:"Pincode ",...b("pincode")})]}),m.pincode&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.pincode.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:" grid grid-cols-3",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-2",htmlFor:"user_status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"user_status",...b("user_status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]})]}),m.user_status&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:m.user_status.message})]})]}),e.jsxs("div",{className:"flex justify-end  py-6 mx-10 my-3 gap-5 ",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:a.toggleModal,children:"cancel"}),e.jsx("button",{className:" text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",children:"Save"})]})]})})})},Ie=`public_user_name,phone,email,address,pincode,login_password,verification_status,user_status,role
user,1234567890,email@gmail.com, Address,123456,password,verified,status,user`,Le=({permissions:a})=>{const d=a==null?void 0:a.includes("create"),r=a==null?void 0:a.includes("edit"),b=a==null?void 0:a.includes("delete"),m=a==null?void 0:a.includes("download"),[P,p]=l.useState(!1),[S,N]=l.useState(!1),[w,i]=l.useState(null),[o,q]=l.useState(!1),[Z,O]=l.useState(null),[F,ee]=l.useState(""),[u,te]=l.useState(1),[D]=l.useState(8),[U,se]=l.useState(1),[Ae,ae]=l.useState([]),[y,le]=l.useState([]),[L,re]=l.useState(null),z=sessionStorage.getItem("token"),[ne,R]=l.useState(null),[T,V]=l.useState("Bulk Upload"),[$,ce]=l.useState(null),B=t=>{re(L===t?null:t)},ie=t=>L===t;l.useEffect(()=>{I()},[F,u]);const C=t=>{t>0&&t<=U&&te(t)},I=()=>{_.get(`${k}/public-user/get`,{headers:{Authorization:`Bearer ${z}`}}).then(t=>{const s=X(t.data.data);le(s);const x=s.filter(c=>Object.values(c).some(n=>n.toString().toLowerCase().includes(F.toLowerCase())));se(Math.ceil(x.length/D));const h=u*D,v=h-D;ae(x.slice(v,h))}).catch(t=>{console.error(t)})},de=()=>{p(!P)},oe=()=>{N(!S),i(null)},H=()=>{q(!o),O(null)},M=u*D,A=M-D,Y=y.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(F.toLowerCase()))),xe=Y.slice().reverse().slice(A,M),me=async()=>{try{await _.delete(`${k}/public-user/delete?public_user_id=${Z}`,{headers:{Authorization:`Bearer ${z}`}}),H(),I(),j.success("Deleted successfully")}catch{j.error("Failed to delete")}},ue=t=>{R(t.target.files[0]),V("Upload")},pe=()=>{T==="Bulk Upload"?document.getElementById("fileInput").click():he(ne)},he=async t=>{try{const s=new FormData;s.append("file",t),(await _.post(`${k}/public-user/uploadcsv`,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(V("Bulk Upload"),R(null),I(),j.success("Data Uploaded Successfully")):j.error("Data failed to Upload")}catch(s){console.log(s)}},ge=t=>{ce(t.target.value)},G=async t=>{if(t==="csv"){const s=y.map(n=>({public_user_id:n.public_user_id,public_user_name:n.public_user_name,phone:n.phone,email:n.email,address:n.address,pincode:n.pincode,verification_status:n.verification_status,user_status:n.user_status})),x=[Object.keys(s[0]).join(","),...s.map(n=>Object.values(n).join(","))].join(`
`),h=new Blob([x],{type:"text/csv;charset=utf-8;"}),v=window.URL.createObjectURL(h),c=document.createElement("a");c.setAttribute("href",v),c.setAttribute("download","User_data.csv"),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}else if(t==="pdf")try{const x=Math.ceil(y.length/30),h=new Pe("l","mm","a4");let v=0;for(let c=1;c<=x;c++){const n=(c-1)*30,fe=Math.min(n+30,y.length),je=y.slice(n,fe).map(f=>[f.public_user_id,f.public_user_name,f.phone,f.email,f.address,f.pincode,f.verification_status,f.user_status]);h.text(`Page ${c}`,10,v+10),h.autoTable({startY:v+15,head:[["UserId","UserName","Phone","Email","Address","Pincode","VerificationStatus"]],body:je,theme:"striped"}),c<x&&(h.addPage(),v=10)}h.save("User_data.pdf")}catch(s){console.error("Error exporting data:",s)}},be=()=>{const t=new Blob([Ie],{type:"text/csv"}),s=URL.createObjectURL(t),x=document.createElement("a");x.href=s,x.download="bulkupload_template.csv",x.click(),URL.revokeObjectURL(s)};return e.jsxs(l.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-3 mx-8 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-white px-3 py-2 rounded-full",children:[e.jsx(ye,{className:"text-xl"}),e.jsx("input",{type:"search",className:"outline-none bg-transparent text-base",placeholder:"Search User",value:F,onChange:t=>ee(t.target.value)})]}),d&&e.jsxs("div",{className:"relative text-center   hover:text-white py-1.5 rounded-full",children:[e.jsx("input",{type:"file",id:"fileInput",className:"hidden",onChange:ue,accept:".csv"}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border-primary border-2 font-normal text-base w-36 py-1.5  rounded-full text-primary hover:text-white hover:bg-primary  ",onClick:pe,children:[e.jsx(J,{}),T]})]}),m&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("form",{children:e.jsxs("select",{className:"block w-full py-2 px-2  text-sm border-2 text-gray-400  border-gray-300 rounded-full bg-gray-50 outline-none",onChange:ge,children:[e.jsx("option",{hidden:!0,children:"Download"}),e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"pdf",children:"PDF"})]})}),$===null&&e.jsx(ke,{className:"text-2xl text-gray-500"}),$==="csv"&&e.jsx(we,{className:"text-3xl text-gray-500",onClick:()=>G("csv")}),$==="pdf"&&e.jsx(_e,{className:"text-3xl text-gray-500",onClick:()=>G("pdf")})]})]}),e.jsxs("div",{className:"flex justify-between items-center my-2 mx-8 gap-1 flex-wrap",children:[e.jsx("h1",{className:"md:text-2xl text-xl font-medium  items-center font-lexend",children:"Public User"}),d&&e.jsx("a",{href:"#",children:e.jsxs("button",{className:"flex flex-row-2 gap-2  items-center border-2  font-lexend bg-blue-500 text-white rounded-full p-2.5 w-fit justify-between md:text-base text-sm ",onClick:()=>p(!0),children:[e.jsx(J,{})," Add PublicUser"]})})]}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Public Username ",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-3  my-2 font-lexend font-semibold whitespace-nowrap",children:["Phone",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Email",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Status",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Verification Status",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsx("div",{className:"mx-3 my-3 font-lexend font-semibold whitespace-nowrap text-center",children:"Action"})})]})}),e.jsx("tbody",{children:xe.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("p",{className:"text-center text-sm mx-1 my-2 font-lexend whitespace-nowrap text-gray-700",children:A+s+1<10?`0${A+s+1}`:A+s+1})}),e.jsx("td",{children:e.jsx("p",{className:" mx-1  my-2 font-lexend whitespace-nowrap text-start text-sm capitalize text-gray-700",children:t.public_user_name})}),e.jsx("td",{children:e.jsx("p",{className:" mx-3  my-2 font-lexend whitespace-nowrap text-start text-sm capitalize text-gray-700",children:t.phone})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1  my-2 font-lexend  whitespace-nowrap capitalize text-gray-700",children:t.email})}),e.jsx("td",{children:e.jsx("p",{className:" mx-2  my-2 font-lexend whitespace-nowrap text-start text-sm capitalize text-gray-700",children:t.user_status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1  my-2 font-lexend whitespace-nowrap text-sm  capitalize text-gray-700",children:t.verification_status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(ve,{onClick:()=>B(s)}),ie(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[r&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{N(!0),i(t.public_user_id),B()},children:"Edit"}),b&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{q(!0),O(t.public_user_id),B()},children:"Delete"})]})]})})]},s))})]})})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"bg-primary px-3 py-2 rounded-full text-white text-sm font-alegerya",onClick:be,children:"Bulk Upload Template"})}),e.jsxs("nav",{className:"flex items-center flex-column flex-wrap md:flex-row md:justify-between justify-center pt-4","aria-label":"Table navigation",children:[e.jsxs("span",{className:"text-sm font-normal text-gray-700 mb-4 md:mb-0 block w-full md:inline md:w-auto text-center font-alegerya",children:["Showing"," ",e.jsxs("span",{className:"text-gray-700",children:[A+1," to ",Math.min(M,y.length)]})," ","of ",e.jsxs("span",{className:"text-gray-900",children:[y.length," entries"]})]}),e.jsxs("ul",{className:"inline-flex -space-x-px rtl:space-x-reverse text-sm h-8 font-alegerya",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>C(1),disabled:u===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-s-lg hover:bg-paginate-bg hover:text-primary-hover",children:"<<"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>C(u-1),disabled:u===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Back"})}),Array.from({length:U},(t,s)=>s+1).slice(Math.max(0,u-2),Math.min(U,u+1)).map(t=>e.jsx("li",{children:e.jsx("button",{onClick:()=>C(t),className:`flex items-center justify-center px-3 h-8 leading-tight border border-paginate-br hover:text-white hover:bg-primary ${u===t?"bg-primary text-white":"bg-white text-black"}`,children:t})},t)),e.jsx("li",{children:e.jsx("button",{onClick:()=>C(u+1),disabled:M>=Y.length,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Next"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>C(U),disabled:u===U,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-e-lg hover:bg-paginate-bg hover:text-primary-hover",children:">>"})})]})]})]})]})}),P&&e.jsx(De,{toggleModal:de,handlerefresh:I}),S&&e.jsx(Ce,{toggleModal:oe,handlerefresh:I,userId:w}),o&&e.jsx(Ne,{toggleDeleteModal:H,delete:me})]})};export{Le as default};
