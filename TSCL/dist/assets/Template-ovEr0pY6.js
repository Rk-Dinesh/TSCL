import{i as L,k as f,l as O,r as l,m as V,o as U,n as R,p as H,b,A as w,d as E,j as e,B as u,S as oe,q as T,t as ce,s as de,v as ie,w as me}from"./index-tsgvEHmX.js";import{D as pe}from"./DeleteModal-DJp1pd7G.js";import{S as G}from"./SavaCancel-r2kPCP2i.js";const xe=L().shape({temp_title:f().required("Template title is required"),dept_name:f().test("not-select","Please select an Department",t=>t!==""&&t!=="Select  Department"),complaint_type:f().test("not-select","Please select an Complaint Type",t=>t!==""&&t!=="Select  Complaint Type"),desc:f().required("Description is required")}),he=t=>{const g=O(),[y,j]=l.useState([]),m=localStorage.getItem("token"),{register:p,formState:{errors:o},handleSubmit:i,watch:S,setValue:N}=V({resolver:U(xe),mode:"all"}),d=S("dept_name");l.useEffect(()=>{g(R())},[g]);const h=H(n=>n.department);l.useEffect(()=>{d?b.get(`${w}/complaint/getdept?dept_name=${d}`,{headers:{Authorization:`Bearer ${m}`}}).then(n=>{try{const a=E(n.data.data);j(a),N("complaint_type","")}catch(a){console.error("Error decrypting data:",a)}}).catch(n=>{console.error("Error fetching data:",n)}):j([])},[d]);const _=async n=>{const a={...n,created_by_user:localStorage.getItem("name")};try{const r=await b.post(`${w}/template/post`,a,{headers:{Authorization:`Bearer ${m}`}});r.status===200?(u.success(" created Successfully"),t.toggleModal(),t.handlerefresh()):(console.error("Error in posting data",r),u.error("Failed to Upload"))}catch(r){console.error("Error in posting data",r)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px]   font-lexend p-3",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-6",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Add Template"})}),e.jsxs("form",{onSubmit:i(_),className:"mx-6 pb-3",children:[e.jsxs("div",{className:" my-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"complaint_type",children:"Template Title"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"temp_title",type:"text",placeholder:"Template Title",...p("temp_title")}),o.temp_title&&e.jsx("p",{className:"text-red-500",children:o.temp_title.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"dept_name",children:"Department"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",...p("dept_name"),children:[e.jsx("option",{value:"",children:"Select Departmnet"}),h.data&&h.data.map((n,a)=>e.jsx("option",{value:n.dept_name,children:n.dept_name},a))]}),o.dept_name&&e.jsx("p",{className:"text-red-500",children:o.dept_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"complaint_type",children:"Complaint Type"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"complaint_type",...p("complaint_type"),children:[e.jsx("option",{value:"",children:"Select Complaint Type"}),y&&y.map((n,a)=>e.jsx("option",{value:n.complaint_type_title,children:n.complaint_type_title},a))]}),o.dept_name&&e.jsx("p",{className:"text-red-500",children:o.dept_name.message})]}),e.jsxs("div",{className:" my-2",children:[e.jsx("label",{className:"block text-gray-900 text-base  font-normal mb-1 ",htmlFor:"desc",children:"Description"}),e.jsx("textarea",{id:"desc",rows:"5",className:"block py-2.5 pl-3 w-full text-sm text-gray-900 rounded border outline-none focus:outline-none focus:shadow-outline mb-2",placeholder:"Description here...",...p("desc")}),o.desc&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2",children:o.desc.message})]}),e.jsx(G,{onCancel:t.toggleModal})]})]})})},ue=L().shape({temp_title:f().required("Template title is required"),dept_name:f().test("not-select","Please select a Department",t=>t&&t!=="Select Department"),complaint_type:f().test("not-select","Please select a Complaint Type",t=>t&&t!=="Select Complaint Type"),desc:f().required("Description is required")}),fe=t=>{const g=O(),[y,j]=l.useState([]),m=localStorage.getItem("token"),{tempId:p}=t,{register:o,formState:{errors:i},handleSubmit:S,watch:N,setValue:d}=V({resolver:U(ue),mode:"all"}),h=N("dept_name");l.useEffect(()=>{(async()=>{try{const r=await b.get(`${w}/template/getbyid?temp_id=${p}`,{headers:{Authorization:`Bearer ${m}`}}),c=E(r.data.data);d("temp_title",c.temp_title),d("dept_name",c.dept_name),d("complaint_type",c.complaint_type),d("desc",c.desc)}catch(r){console.error("Error fetching data",r),u.error("Failed to fetch template data")}})()},[p,d,m]),l.useEffect(()=>{g(R())},[g]);const _=H(a=>a.department);l.useEffect(()=>{h?(async()=>{try{const r=await b.get(`${w}/complaint/getdept?dept_name=${h}`,{headers:{Authorization:`Bearer ${m}`}}),c=E(r.data.data);j(c),d("complaint_type","")}catch(r){console.error("Error fetching complaints",r),u.error("Failed to fetch complaint types")}})():j([])},[h,d,m]);const n=async a=>{const r={...a};try{const c=await b.post(`${w}/template/update?temp_id=${p}`,r,{headers:{Authorization:`Bearer ${m}`}});c.status===200?(u.success("Updated Successfully"),t.toggleModal(),t.handlerefresh()):(console.error("Error in posting data",c),u.error("Failed to update template"))}catch(c){console.error("Error in posting data",c),u.error("Failed to update template")}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] font-lexend p-3",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-6",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Template"})}),e.jsxs("form",{onSubmit:S(n),className:"mx-6 pb-3",children:[e.jsxs("div",{className:"my-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"temp_title",children:"Template Title"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"temp_title",type:"text",placeholder:"Template Title",...o("temp_title")}),i.temp_title&&e.jsx("p",{className:"text-red-500",children:i.temp_title.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"dept_name",children:"Department"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",...o("dept_name"),children:[e.jsx("option",{value:"",children:"Select Department"}),_.data&&_.data.map((a,r)=>e.jsx("option",{value:a.dept_name,children:a.dept_name},r))]}),i.dept_name&&e.jsx("p",{className:"text-red-500",children:i.dept_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"complaint_type",children:"Complaint Type"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"complaint_type",...o("complaint_type"),children:[e.jsx("option",{value:"",children:"Select Complaint Type"}),y&&y.map((a,r)=>e.jsx("option",{value:a.complaint_type_title,children:a.complaint_type_title},r))]}),i.complaint_type&&e.jsx("p",{className:"text-red-500",children:i.complaint_type.message})]}),e.jsxs("div",{className:"my-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"desc",children:"Description"}),e.jsx("textarea",{id:"desc",rows:"5",className:"block py-2.5 pl-3 w-full text-sm text-gray-900 rounded border outline-none focus:outline-none focus:shadow-outline mb-2",placeholder:"Description here...",...o("desc")}),i.desc&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2",children:i.desc.message})]}),e.jsx(G,{onCancel:t.toggleModal})]})]})})},we=({permissions:t})=>{const g=t==null?void 0:t.includes("create"),y=t==null?void 0:t.includes("edit"),j=t==null?void 0:t.includes("delete"),[m,p]=l.useState(!1),[o,i]=l.useState(!1),[S,N]=l.useState(null),[d,h]=l.useState(!1),[_,n]=l.useState(null),[a,r]=l.useState(""),[c,J]=l.useState(1),[D]=l.useState(8),[I,K]=l.useState(1),[ge,Q]=l.useState([]),[F,W]=l.useState([]),[M,X]=l.useState(null),P=localStorage.getItem("token"),$=s=>{X(M===s?null:s)},Y=s=>M===s;l.useEffect(()=>{C()},[a,c]);const Z=s=>{s>0&&s<=I&&J(s)},C=()=>{b.get(`${w}/template/get`,{headers:{Authorization:`Bearer ${P}`}}).then(s=>{const x=E(s.data.data);W(x);const q=x.filter(re=>Object.values(re).some(ne=>ne.toString().toLowerCase().includes(a.toLowerCase())));K(Math.ceil(q.length/D));const B=c*D,le=B-D;Q(q.slice(le,B))}).catch(s=>{console.error(s)})},ee=()=>{p(!m)},te=()=>{i(!o),N(null)},A=()=>{h(!d),n(null)},k=c*D,v=k-D,z=F.filter(s=>Object.values(s).some(x=>x.toString().toLowerCase().includes(a.toLowerCase()))),ae=z.slice().reverse().slice(v,k),se=async()=>{try{await b.delete(`${w}/template/delete?temp_id=${_}`,{headers:{Authorization:`Bearer ${P}`}}),A(),C(),u.success("Deleted successfully")}catch{u.error("Failed to delete")}};return e.jsxs(l.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen mt-10",children:[e.jsx(oe,{title:"Template",hasCreatePermission:g,onClick:()=>p(!0),searchValue:a,setSearchValue:r}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3 h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto  no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font- whitespace-nowrap",children:["Template Title",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font- whitespace-nowrap",children:["Department",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Complaint Type ",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Desc ",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Date & Time ",e.jsx(T,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 font-semibold font-lexend whitespace-nowrap text-center",children:"Action"})})]})}),e.jsx("tbody",{children:ae.map((s,x)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("p",{className:" mx-3 my-2 font-lexend text-center whitespace-nowrap text-sm text-gray-700",children:v+x+1<10?`0${v+x+1}`:v+x+1})}),e.jsx("td",{children:e.jsx("p",{className:"mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm capitalize text-gray-700",children:s.temp_title})}),e.jsx("td",{children:e.jsx("p",{className:"mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm capitalize text-gray-700",children:s.dept_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:s.complaint_type})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend truncate text-sm capitalize text-gray-700",children:ce(s.desc,5)})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:de(s.createdAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(ie,{onClick:()=>$(x)}),Y(x)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[y&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{i(!0),N(s.temp_id),$()},children:"Edit"}),j&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{h(!0),n(s.temp_id),$()},children:"Delete"})]})]})})]},x))})]})})}),e.jsx("div",{className:" my-3 mb-5 mx-7",children:e.jsx(me,{Length:F.length,currentPage:c,totalPages:I,firstIndex:v,lastIndex:k,paginate:Z,hasNextPage:k>=z.length})})]})}),m&&e.jsx(he,{toggleModal:ee,handlerefresh:C}),o&&e.jsx(fe,{toggleModal:te,handlerefresh:C,tempId:S}),d&&e.jsx(pe,{toggleDeleteModal:A,delete:se})]})};export{we as default};
