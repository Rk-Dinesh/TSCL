import{i as $,k as i,l as ae,u as le,r as l,n as re,J as ne,K as ce,L as de,p as k,m as ie,b as o,A as m,d as g,j as e,N as oe,o as me,B as _}from"./index-DP2NNKOn.js";const xe=$().shape({public_user_name:i().required("Name is required"),phone:i().required("Contact number is required").matches(/^[0-9]{10}$/,"Contact number must be 10 digits"),email:i().required("Email id is required").email("Invalid email format"),address:i().required("Address is required")}),pe=$().shape({grievance_mode:i().required("Origin is required"),complaint_type_title:i().required("Complaint  is required"),dept_name:i().required("Department is required"),ward_name:i().required("Ward is required"),street_name:i().required("Street is required"),pincode:i().required("Pincode is required").matches(/^[0-9]{6}$/,"Pincode must be 6 digits"),complaintaddress:i().required("Complaint Address is required"),complaint:i().required("Complaint Type is required"),complaint_details:i().required("Description is required")}),ue=$().shape({...xe.fields,...pe.fields}).required(),je=()=>{const N=ae(),E=le(),[G,R]=l.useState(!1),[x,S]=l.useState(null);l.useState([]);const[T,z]=l.useState([]),[V,I]=l.useState([]),[A,M]=l.useState([]),[v,B]=l.useState([]);l.useState("");const f=localStorage.getItem("token"),[he,L]=l.useState({}),[O,J]=l.useState([]),[fe,U]=l.useState([]);l.useEffect(()=>{N(re()),N(ne()),N(ce()),N(de())},[N]);const P=k(t=>t.department),K=k(t=>t.complaint),C=k(t=>t.ward),W=k(t=>t.complainttype),{register:d,formState:{errors:a},handleSubmit:Y,reset:Z,setValue:r,watch:b}=ie({resolver:me(ue),mode:"onBlur"}),w=b("phone"),D=b("ward_name"),j=b("dept_name"),F=b("complaint_type_title"),H=b("address");l.useEffect(()=>{o.get(`${m}/new-grievance/get`,{headers:{Authorization:`Bearer ${f}`}}).then(t=>{const n=g(t.data.data).reverse();J(n)}).catch(t=>{console.error(t)}),Q()},[]);const Q=async()=>{try{const t=await o.get(`${m}/status/get`,{headers:{Authorization:`Bearer ${f}`}}),s=g(t.data.data),n=s.reduce((c,y)=>(c[y.status_name]=y.color,c),{});U(s),L(n)}catch(t){console.error("Error fetching existing ActiveStatus:",t)}};l.useEffect(()=>{j?o.get(`${m}/complaint/getdept?dept_name=${j}`,{headers:{Authorization:`Bearer ${f}`}}).then(t=>{try{const s=g(t.data.data);I(s),r("complaint_type_title","")}catch(s){console.error("Error decrypting data:",s)}}).catch(t=>{console.error("Error fetching data:",t)}):I([])},[j]),l.useEffect(()=>{D?o.get(`${m}/street/getward?ward_name=${D}`,{headers:{Authorization:`Bearer ${f}`}}).then(t=>{try{const s=g(t.data.data);z(s),r("street_name","")}catch(s){console.error("Error decrypting data:",s)}}).catch(t=>{console.error("Error fetching data:",t)}):z([])},[D]),l.useEffect(()=>{if(w&&w.length===10){async function t(){try{const s=await o.get(`${m}/public-user/getbyphone?phone=${w}`,{headers:{Authorization:`Bearer ${f}`}}),c=g(s.data.data);r("public_user_name",c.public_user_name),r("email",c.email),r("address",c.address),r("pincode",c.pincode),S(c)}catch{S(null)}}t()}else r("public_user_name",""),r("email",""),r("address",""),r("pincode",""),S(null)},[w]),l.useEffect(()=>{j&&F&&o.get(`${m}/template/getbyquery?dept_name=${j}&complaint_type=${F}`,{headers:{Authorization:`Bearer ${f}`}}).then(t=>{try{const s=g(t.data.data);M(s),r("complaint_details","")}catch(s){console.error("Error decrypting data:",s)}}).catch(t=>{console.error("Error fetching data:",t)})},[j,F]);const X=t=>{const s=t.target.files;s.length>5?(_.error("Maximum 5 files allowed"),t.target.value=null):B(s)},ee=async t=>{const s={public_user_name:t.public_user_name,phone:t.phone,email:t.email,address:t.address,pincode:t.pincode,login_password:"tscl@123",verification_status:"active",user_status:"active"},n=p=>{const h=K.data.find(u=>u.complaint_type_title===p);return h?h.priority:null},c=p=>{const h=C.data.find(u=>u.ward_name===p);return h?h.zone_name:null};let y;if(x)await o.post(`${m}/public-user/post`,s),y=x.public_user_id;else{const p=await o.post(`${m}/public-user/post`,s);y=g(p.data.data)}const se={grievance_mode:t.grievance_mode,complaint_type_title:t.complaint,dept_name:t.dept_name,zone_name:c(t.ward_name),ward_name:t.ward_name,street_name:t.street_name,pincode:t.pincode,complaintaddress:t.complaintaddress,complaint:t.complaint_type_title,complaint_details:t.complaint_details,public_user_id:y,public_user_name:t.public_user_name,phone:t.phone,status:"new",statusflow:"new",priority:n(t.complaint_type_title)};try{const p=await o.post(`${m}/new-grievance/post`,se,{headers:{Authorization:`Bearer ${f}`}}),h=await p.data.data;if(p.status===200&&_.success("Grievance created Successfully"),v.length>0)if(v.length>5)_.error("File limit exceeded. Maximum 5 files allowed.");else try{const u=new FormData;for(let q=0;q<v.length;q++)u.append("files",v[q]);u.append("grievance_id",h),u.append("created_by_user","admin"),(await o.post(`${m}/new-grievance-attachment/post`,u,{headers:{"Content-Type":"multipart/form-data"}})).status===200&&(B([]),_.success("Attachment created Successfully"))}catch(u){console.error(u),_.error("Error creating attachment")}Z(),E(`/view?grievanceId=${h}`)}catch(p){console.log(p),_.error("An error occurred during submission. Please try again.")}},te=async(t,s)=>{try{return(await o.post(`${m}/translate/translate`,{text:t,targetLanguage:s})).data.translatedText}catch(n){return console.error(n),null}};return e.jsxs("div",{className:"grid grid-cols-12 gap-3 mx-3  overflow-y-auto no-scrollbar",children:[e.jsxs("div",{className:"bg-blue-100 lg:col-span-6 md:col-span-12 col-span-12   text-start h-fit   font-lexend ",children:[e.jsx("h1",{className:"text-xl my-5",children:"Grievance Form"}),e.jsxs("div",{className:"  bg-white w-full h-fit rounded-lg ",children:[e.jsx("div",{className:"border-b-2 border-search",children:e.jsx("h1",{className:" text-xl px-3 py-3",children:"Request by"})}),e.jsxs("form",{onSubmit:Y(ee),children:[e.jsxs("div",{className:"flex flex-col flex-wrap overflow-hidden my-5 gap-2",children:[e.jsxs("div",{className:"flex flex-col md:flex-row  md:justify-between font-normal mx-10",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2",htmlFor:"phone",children:"Phone"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("input",{type:"text",id:"phone",className:"w-full md:w-80 text-start border-2  rounded-lg ml-2 px-2 py-2 outline-none",placeholder:"Phone Number",...d("phone")}),a.phone&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.phone.message})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row  md:justify-between font-normal mx-10",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2",htmlFor:"public_user_name",children:"Name"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("input",{type:"text",id:"public_user_name",className:"w-full md:w-80 text-start border-2  rounded-lg ml-2 px-2 py-2 outline-none",placeholder:"User Name",...d("public_user_name"),defaultValue:x?x.public_user_name:""}),a.public_user_name&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.public_user_name.message})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row  md:justify-between font-normal mx-10",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2",htmlFor:"email",children:"Email id"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("input",{type:"email",id:"email",className:"w-full md:w-80 text-start border-2  rounded-lg ml-2 px-2 py-2 outline-none",placeholder:"abc@gmail.com",...d("email"),defaultValue:x?x.email:""}),a.email&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.email.message})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row  md:justify-between font-normal mx-10",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 py-2",htmlFor:"address",children:"Address"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("input",{type:"text",id:"address",className:"w-full md:w-80 text-start border-2  rounded-lg ml-2 px-2 py-2 outline-none",placeholder:"Enter your Address",...d("address"),defaultValue:x?x.address:""}),a.address&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.address.message})]})]})]}),e.jsxs("div",{className:" flex-col justify-center items-center max-w-[592px] bg-white h-fit rounded-lg mt-5",children:[e.jsx("div",{className:"border-b-2 border-search",children:e.jsx("h1",{className:" text-xl px-3 py-3",children:"Grievance Details"})}),e.jsxs("div",{className:"flex flex-col flex-wrap overflow-y-auto my-5 gap-2 no-scrollbar",children:[e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3  font-normal mx-10  ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"grievance_mode",children:"Origin"}),e.jsxs("div",{className:" md:col-span-2",children:[e.jsxs("select",{className:"block w-full  px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...d("grievance_mode"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select an Origin"}),e.jsx("option",{value:"Whatsapp",children:"Whatsapp"}),e.jsx("option",{value:"Call",children:"Call"}),e.jsx("option",{value:"Website",children:"Website"})]}),a.grievance_mode&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.grievance_mode.message})]})]}),e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"complaint",children:"Complaint Type"}),e.jsxs("div",{className:" md:col-span-2",children:[e.jsxs("select",{className:"block w-full   px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...d("complaint"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Complaint Type"}),W.data&&W.data.map((t,s)=>e.jsx("option",{value:t.complaint_type,children:t.complaint_type},s))]}),a.complaint&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.complaint.message})]})]}),e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"dept_name",children:"Department"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("select",{className:"block w-full  px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...d("dept_name"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Department"}),P.data&&P.data.map((t,s)=>e.jsx("option",{value:t.dept_name,children:t.dept_name},s))]}),a.dept_name&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.dept_name.message})]})]}),e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"complaint_type_title",children:"Complaint"}),e.jsxs("div",{className:" md:col-span-2",children:[e.jsxs("select",{className:"block w-full   px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...d("complaint_type_title"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Complaint"}),V&&V.map((t,s)=>e.jsx("option",{value:t.complaint_type_title,children:t.complaint_type_title},s))]}),a.complaint_type_title&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.complaint_type_title.message})]})]}),e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"ward_name",children:"Ward"}),e.jsxs("div",{className:" md:col-span-2",children:[e.jsxs("select",{className:"block w-full  px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...d("ward_name"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Ward"}),C.data&&C.data.map((t,s)=>e.jsx("option",{value:t.ward_name,children:t.ward_name},s))]}),a.ward_name&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.ward_name.message})]})]}),e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"street_name",children:"Street"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("select",{className:"block w-full  px-4 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",...d("street_name"),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Street"}),T&&T.map((t,s)=>e.jsx("option",{value:t.street_name,children:t.street_name},s))]}),a.street_name&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.street_name.message})]})]}),e.jsxs("div",{className:"gflex flex-col md:grid md:grid-cols-3   font-normal mx-10",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"pincode",children:"Pincode"}),e.jsxs("div",{className:"flex flex-col md:col-span-2",children:[e.jsx("input",{type:"text",id:"pincode",className:"w-full text-start border-2  rounded-lg  px-2 py-2 outline-none",placeholder:"Pincode",...d("pincode"),defaultValue:x?x.pincode:""}),a.pincode&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:a.pincode.message})]})]}),e.jsxs("div",{className:"flex flex-col md:grid md:grid-cols-3 font-normal mx-10",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 md:col-span-1",htmlFor:"complaintaddress",children:"Complaint Address"}),e.jsxs("div",{className:"flex flex-col md:col-span-2 border rounded p-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 mx-1",children:[e.jsx("input",{type:"checkbox",id:"sameAsResidentAddress",checked:G,onChange:t=>{R(t.target.checked),t.target.checked?r("complaintaddress",H):r("complaintaddress","")}}),e.jsx("label",{className:"text-black text-sm font-medium",htmlFor:"sameAsResidentAddress",children:"Same as Resident Address"})]}),e.jsx("hr",{className:"w-full"}),e.jsx("textarea",{id:"complaintaddress",rows:"5",className:"block py-2.5 pl-3 w-full text-sm text-gray-900 rounded border-none outline-none focus:outline-none focus:shadow-outline mb-2",placeholder:"Complaint Address here...",...d("complaintaddress")}),a.complaintaddress&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2",children:a.complaintaddress.message})]})]}),e.jsxs("div",{className:" flex flex-col md:grid md:grid-cols-3   font-normal mx-10 ",children:[e.jsx("label",{className:"block text-black text-lg  font-medium mb-2 md:col-span-1",htmlFor:"complaint_details",children:"Description"}),e.jsxs("div",{className:"flex flex-col md:col-span-2 border rounded p-1",children:[e.jsxs("div",{className:"flex justify-around items-center -mb-1 gap-3",children:[e.jsxs("select",{className:"block w-full  px-2 py-3  text-sm text-black border border-gray-200 rounded-lg bg-gray-50   hover:border-gray-200 outline-none",defaultValue:"",onChange:t=>{const s=t.target.value,n=A.find(c=>c.temp_id===s);n&&r("complaint_details",n.desc)},children:[e.jsx("option",{value:"",hidden:!0,children:"Select a Template"}),A&&A.map((t,s)=>e.jsx("option",{value:t.temp_id,children:t.temp_title},s))]}),e.jsxs("select",{className:"block px-4 py-3 text-sm rounded-lg outline-none",onChange:t=>{const s=t.target.value,n=b("complaint_details");te(n,s).then(c=>{r("complaint_details",c)})},children:[e.jsx("option",{hidden:!0,value:"",children:"LAN"}),e.jsx("option",{value:"ta",children:"EN - TA"}),e.jsx("option",{value:"en",children:"TA - EN"})]})]}),e.jsx("hr",{className:"w-full"}),e.jsx("textarea",{id:"complaint_details",rows:"5",className:"block py-2.5 pl-3 w-full text-sm text-gray-900 rounded border-none outline-none focus:outline-none focus:shadow-outline mb-2",placeholder:"Description here...",...d("complaint_details")}),a.complaint_details&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2",children:a.complaint_details.message})]})]}),e.jsxs("div",{className:" flex flex-col md:grid md:grid-cols-3    font-normal mx-10 ",children:[e.jsxs("label",{className:"block text-black text-lg  font-medium mb-2 md:col-span-1",htmlFor:"file",children:["Attachment"," ",e.jsxs("p",{className:"text-xs ",children:["(optional / ",e.jsx("br",{})," upto 5 files allowed)"]})]}),e.jsxs("div",{className:"flex flex-col md:col-span-2",children:[e.jsx("input",{type:"file",id:"file",multiple:!0,accept:".jpeg, .jpg, .png",className:" w-full py-2 px-2 rounded-lg outline-none",onChange:X}),v.length>=5&&e.jsx("p",{className:"text-red-500 text-sm",children:"Maximum 5 files allowed"})]})]})]}),e.jsx("div",{className:" text-center my-3",children:e.jsx("button",{type:"submit",className:" text-white bg-primary text-base font-lexend rounded-full px-4 py-1.5 mb-4",children:"Submit"})})]})]})]})]}),e.jsxs("div",{className:" lg:col-span-6 md:col-span-12 col-span-12 font-lexend",children:[e.jsx("h1",{className:"text-xl my-5",children:"Recent Grievances"}),e.jsx("div",{className:"bg-white rounded-lg my-2 py-3 overflow-x-auto h-2/5 no-scrollbar",children:e.jsxs("table",{className:"w-full mt-2 mx-3",children:[e.jsx("thead",{className:"border-b border-gray-300",children:e.jsxs("tr",{className:"",children:[e.jsx("th",{children:e.jsx("p",{className:" my-2 text-start font-lexend font-normal text-base whitespace-nowrap",children:"Complaint"})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-start mx-2 my-2 font-lexend font-normal text-base whitespace-nowrap",children:"Raised by"})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-normal text-base whitespace-nowrap",children:"Department"})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-center  my-2 font-lexend font-normal text-base whitespace-nowrap",children:"Assigned JE"})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-center  my-2 font-lexend font-normal text-base whitespace-nowrap",children:"Date/Time"})})]})}),e.jsx("tbody",{children:O.slice(0,10).map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("p",{className:"border-2 w-20 border-slate-900 rounded-lg text-center py-1 my-1 text-sm   text-slate-900",onClick:()=>E(`/view?grievanceId=${t.grievance_id}`),children:t.grievance_id})}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-center mx-2   my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.public_user_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start   my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.dept_name})]}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.assign_username?t.assign_username:"Yet to be assigned"})}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:oe(t.createdAt)})})]},s))})]})})]})]})};export{je as default};
