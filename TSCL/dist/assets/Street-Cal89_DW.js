import{i as K,k as B,r as s,m as Q,o as X,j as e,b as C,A as ve,B as N,d as L,x as De,D as Pe,y as Te,q as I,s as J,v as Ie,w as Ce,E as ze,z as ke}from"./index-tsgvEHmX.js";import{S as ee}from"./SavaCancel-r2kPCP2i.js";import{A as S}from"./ApiClient-w4qWO__2.js";import{D as Ae}from"./DeleteModal-DJp1pd7G.js";import{F as We,B as Me}from"./FileUploadButton-C5ckz8lU.js";const Fe=K().shape({ward_name:B().test("not-select","Please select a ward",a=>a!==""&&a!=="Select Street"),street_name:B().required("street_name is required")}),Be=a=>{const{ExistingWards:u}=a,[E,A]=s.useState(null),[z,v]=s.useState(null),[_,k]=s.useState(null),[g,f]=s.useState(null),{register:p,formState:{errors:i},handleSubmit:m,watch:R}=Q({resolver:X(Fe),mode:"all"});s.useEffect(()=>{if(g){const l=u.find(j=>j.ward_name===g);l&&(A(l.zone_id),v(l.ward_id),k(l.zone_name))}},[g,u]);const W=async l=>{const j={...l,zone_id:E,ward_id:z,zone_name:_,status:"active",created_by_user:localStorage.getItem("name")};try{const r=localStorage.getItem("token"),o=await C.post(`${ve}/street/post`,j,{headers:{Authorization:`Bearer ${r}`}});o.status===200?(N.success("Street created Successfully"),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",o),N.error("Failed to Upload"))}catch(r){console.error("Error in posting data",r)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Street"})}),e.jsxs("form",{onSubmit:m(W),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"ward_name",children:"Ward Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",...p("ward_name"),onChange:l=>f(l.target.value),children:[e.jsx("option",{value:"",children:"Select Ward"}),u.map((l,j)=>e.jsx("option",{value:l.ward_name,children:l.ward_name},j))]}),i.ward_name&&e.jsx("p",{className:"text-red-500",children:i.ward_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"street_name",children:"Street Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"street_name",type:"text",placeholder:"Street Name",...p("street_name")}),i.street_name&&e.jsx("p",{className:"text-red-500",children:i.street_name.message})]})]}),e.jsx(ee,{onCancel:a.toggleCloseModal})]})]})})},Re=K().shape({ward_name:B().test("not-select","Please select a ward",a=>a!==""&&a!=="Select Street"),street_name:B().required("street_name is required"),status:B().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Ue=a=>{const{ExistingWards:u,streetId:E}=a,[A,z]=s.useState(null),[v,_]=s.useState(null),[k,g]=s.useState(null),[f,p]=s.useState(null),{register:i,formState:{errors:m},handleSubmit:R,watch:W,setValue:l}=Q({resolver:X(Re),mode:"all"});s.useEffect(()=>{(async()=>{try{const o=S.FETCH_STREET(E),x=await C.get(o.url,{headers:o.headers}),h=L(x.data.data);p(h.ward_name),l("ward_name",h.ward_name),l("street_name",h.street_name),l("status",h.status)}catch(o){console.error("Error fetching data",o)}})()},[E,l]),s.useEffect(()=>{if(f){const r=u.find(o=>o.ward_name===f);r&&(z(r.zone_id),_(r.ward_id),g(r.zone_name))}},[f,u]);const j=async r=>{const o={...r,zone_id:A,ward_id:v,zone_name:k};try{const x=S.UPDATE_STREET(E),h=await C.post(x.url,o,{headers:x.headers});h.status===200?(N.success("Street updated Successfully"),z(null),_(null),g(null),p(null),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",h),N.error("Failed to Upload"))}catch(x){console.error("Error in posting data",x)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Street"})}),e.jsxs("form",{onSubmit:R(j),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"ward_name",children:"Ward Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",...i("ward_name"),onChange:r=>p(r.target.value),children:[e.jsx("option",{value:f,disabled:!0,children:f}),u.map((r,o)=>e.jsx("option",{value:r.ward_name,children:r.ward_name},o))]}),m.ward_name&&e.jsx("p",{className:"text-red-500",children:m.ward_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"street_name",children:"Street Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"street_name",type:"text",placeholder:"Street Name",...i("street_name")}),m.street_name&&e.jsx("p",{className:"text-red-500",children:m.street_name.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...i("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),m.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:m.status.message})]})]}),e.jsx(ee,{onCancel:a.toggleModal})]})]})})},Oe=`street_name,ward_id,ward_name,zone_id,zone_name,status,created_by_user
 streetName,Ward***,WardName,Z***,ZoneName,Status,admin`,Ye=({permissions:a})=>{const u=a==null?void 0:a.includes("create"),E=a==null?void 0:a.includes("edit"),A=a==null?void 0:a.includes("delete"),z=a==null?void 0:a.includes("download"),[v,_]=s.useState(!1),[k,g]=s.useState(!1),[f,p]=s.useState(null),[i,m]=s.useState(!1),[R,W]=s.useState(null),[l,j]=s.useState(null),[r,o]=s.useState(""),[x,h]=s.useState(1),[D,te]=s.useState(10),[$,ae]=s.useState(1),[Le,se]=s.useState([]),[P,ne]=s.useState([]),[V,re]=s.useState(null),[le,Z]=s.useState(null),[q,G]=s.useState("Bulk Upload"),[oe,de]=s.useState(null),O=t=>{re(V===t?null:t)},ce=t=>V===t;s.useEffect(()=>{M(),he()},[r,x,D]);const ie=t=>{t>0&&t<=$&&h(t)},M=()=>{C.get(S.GET_STREET.url,{headers:S.GET_STREET.headers}).then(t=>{const n=L(t.data.data);ne(n);const y=n.filter(c=>Object.values(c).some(d=>d.toString().toLowerCase().includes(r.toLowerCase())));ae(Math.ceil(y.length/D));const b=x*D,T=b-D;se(y.slice(T,b))})},me=()=>{_(!v)},xe=()=>{g(!k),p(null)},ue=()=>{_(!v)},H=()=>{m(!i),W(null)},he=async()=>{try{const t=await C.get(S.GET_WARD_STREETACTIVE.url,{headers:S.GET_WARD_STREETACTIVE.headers}),n=L(t.data.data);j(n)}catch(t){console.error("Error fetching existing roles:",t)}},U=x*D,F=U-D,Y=P.filter(t=>Object.values(t).some(n=>n.toString().toLowerCase().includes(r.toLowerCase()))),ge=Y.slice(F,U),fe=async()=>{try{const t=S.DELETE_STREET(R);await C.delete(t.url,{headers:t.headers}),H(),M(),N.success("Deleted successfully")}catch{N.error("Failed to delete")}},pe=t=>{Z(t.target.files[0]),G("Upload")},je=()=>{q==="Bulk Upload"?document.getElementById("fileInput").click():be(le)},be=async t=>{try{const n=new FormData;n.append("file",t),(await C.post(S.UPLOAD_STREET.url,n,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(G("Bulk Upload"),Z(null),M(),N.success("Data Uploaded Successfully")):N.error("Data failed to Upload")}catch(n){console.log(n)}},_e=t=>{de(t.target.value)},ye=async t=>{if(t==="csv"){const n=P.map(d=>({street_id:d.street_id,street_name:d.street_name,ward_id:d.ward_id,ward_name:d.ward_name,zone_id:d.zone_id,zone_name:d.zone_name,status:d.status,created_by_user:d.created_by_user})),y=[Object.keys(n[0]).join(","),...n.map(d=>Object.values(d).join(","))].join(`
`),b=new Blob([y],{type:"text/csv;charset=utf-8;"}),T=window.URL.createObjectURL(b),c=document.createElement("a");c.setAttribute("href",T),c.setAttribute("download","Street_data.csv"),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}else if(t==="pdf")try{const y=Math.ceil(P.length/30),b=new ze("l","mm","a4");let T=0;for(let c=1;c<=y;c++){const d=(c-1)*30,Ne=Math.min(d+30,P.length),Ee=P.slice(d,Ne).map(w=>[w.street_id,w.street_name,w.ward_id,w.ward_name,w.zone_id,w.zone_name,w.status,w.created_by_user]);b.text(`Page ${c}`,10,T+10),b.autoTable({startY:T+15,head:[["street_id","street_name","ward_id","ward_name","zone_id","zone_name","status","created_by_user"]],body:Ee,theme:"striped"}),c<y&&(b.addPage(),T=10)}b.save("Street_data.pdf")}catch(n){console.error("Error exporting data:",n)}},we=()=>{ke(Oe)},Se=t=>{const n=parseInt(t.target.value,10);te(n),h(1)};return e.jsxs(s.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-2 mx-8 flex-wrap",children:[e.jsx(De,{value:r,onChange:t=>o(t.target.value),placeholder:"Search Street"}),u&&e.jsx(We,{onChange:pe,buttonText:q,accept:".csv",onClick:je}),z&&e.jsx(Pe,{selectedDoc:oe,onChange:_e,exportData:ye})]}),e.jsx(Te,{title:"Street",hasCreatePermission:u,onClick:()=>_(!0)}),e.jsxs("div",{className:`bg-white  mx-4 rounded-lg mt-1  p-3 ${P.length<8?"h-3/5":"h-fit"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mx-3",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-medium text-gray-600",children:"Page Entries"}),e.jsxs("select",{id:"itemsPerPage",value:D,onChange:Se,className:" p-1 outline-none text-sm rounded px-2",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]}),e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Street ",e.jsx(I,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Ward ",e.jsx(I,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Zone ",e.jsx(I,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Status ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedBy ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedAt",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["UpdatedAt",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-lexend font-semibold",children:"Action"})})]})}),e.jsx("tbody",{children:ge.map((t,n)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-700",children:F+n+1<10?`0${F+n+1}`:F+n+1})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.street_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.ward_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.zone_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5 my-2  font-lexend whitespace-nowrap capitalize text-gray-700",children:J(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1.5  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:J(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(Ie,{onClick:()=>O(n)}),ce(n)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[E&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{g(!0),p(t.street_id),O()},children:"Edit"}),A&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{m(!0),W(t.street_id),O()},children:"Delete"})]})]})})]},n))})]})})]}),e.jsxs("div",{className:" my-2 mb-5 mx-7",children:[e.jsx(Me,{handleDownload:we}),e.jsx(Ce,{Length:P.length,currentPage:x,totalPages:$,firstIndex:F,lastIndex:U,paginate:ie,hasNextPage:U>=Y.length})]})]})}),v&&e.jsx(Be,{toggleModal:me,toggleCloseModal:ue,ExistingWards:l,handlerefresh:M}),k&&e.jsx(Ue,{toggleModal:xe,handlerefresh:M,ExistingWards:l,streetId:f}),i&&e.jsx(Ae,{toggleDeleteModal:H,delete:fe})]})};export{Ye as default};
