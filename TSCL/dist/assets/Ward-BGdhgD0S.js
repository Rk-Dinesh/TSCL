import{i as J,k as W,r as n,l as K,o as Q,j as e,b as z,A as D,B as y,d as L,m as G,n as Se}from"./index-KlxDuXca.js";import{R as I,P as ze}from"./Pagination-CZoS4CI6.js";import{S as X}from"./SavaCancel-DnY9KWLv.js";import{D as De}from"./DeleteModal-Bq2aEtZp.js";import{S as ke,D as Ce,E as Pe}from"./DocumentDownload-Cf_kB8s3.js";import{F as Ee,B as Ie}from"./FileUploadButton-Bc1PelCC.js";import{H as Be}from"./HeaderButton-D4Lkrp4E.js";import"./index-BebfzzXM.js";import"./index-BKjO-751.js";import"./index-D_Jj7K4f.js";const Ze=J().shape({zone_name:W().test("not-select","Please select an Zone",a=>a!==""&&a!=="Select Zone"),ward_name:W().required("ward_name is required")}),We=a=>{const{ExistingZones:g}=a,[w,_]=n.useState(null),[N,p]=n.useState(null),{register:d,formState:{errors:u},handleSubmit:b,watch:f}=K({resolver:Q(Ze),mode:"all"});n.useEffect(()=>{if(N){const r=g.find(m=>m.zone_name===N);r&&_(r.zone_id)}},[N,g]);const k=async r=>{const m={...r,zone_id:w,status:"active",created_by_user:sessionStorage.getItem("name")};try{const v=sessionStorage.getItem("token"),o=await z.post(`${D}/ward/post`,m,{headers:{Authorization:`Bearer ${v}`}});o.status===200?(y.success("Ward created Successfully"),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",o),y.error("Failed to Upload"))}catch(v){console.error("Error in posting data",v)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Ward"})}),e.jsxs("form",{onSubmit:b(k),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"zone_name",children:"Zone Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"zone_name",...d("zone_name"),onChange:r=>p(r.target.value),children:[e.jsx("option",{value:"",children:"Select Zone"}),g.map(r=>e.jsx("option",{value:r.zone_name,children:r.zone_name},r.zone_id))]}),u.zone_name&&e.jsx("p",{className:"text-red-500",children:u.zone_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"ward_name",children:"Ward Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",type:"text",placeholder:" Ward Name",...d("ward_name")}),u.ward_name&&e.jsx("p",{className:"text-red-500",children:u.ward_name.message})]})]}),e.jsx(X,{onCancel:a.toggleCloseModal})]})]})})},$e=J().shape({zone_name:W().test("not-select","Please select an Zone",a=>a!==""&&a!=="Select Zone"),ward_name:W().required("ward_name is required"),status:W().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Me=a=>{const g=sessionStorage.getItem("token"),{ExistingZones:w,wardId:_}=a,[N,p]=n.useState(null),[d,u]=n.useState(null),{register:b,formState:{errors:f},handleSubmit:k,watch:r,setValue:m}=K({resolver:Q($e),mode:"all"});n.useEffect(()=>{(async()=>{try{const h=await z.get(`${D}/ward/getbyid?ward_id=${_}`,{headers:{Authorization:`Bearer ${g}`}}),x=L(h.data.data);u(x.zone_name),m("ward_name",x.ward_name),m("status",x.status),m("zone_name",x.zone_name)}catch(h){console.error("Error fetching data",h)}})()},[_,m]),n.useEffect(()=>{if(d){const o=w.find(h=>h.zone_name===d);o&&p(o.zone_id)}},[d,w]);const v=async o=>{const h={...o,zone_id:N};try{const x=await z.post(`${D}/ward/update?ward_id=${_}`,h,{headers:{Authorization:`Bearer ${g}`}});x.status===200?(y.success("Ward Updated Successfully"),p(null),p(null),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",x),y.error("Failed to Upload"))}catch(x){console.error("Error in posting data",x)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Ward"})}),e.jsxs("form",{onSubmit:k(v),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"zone_name",children:"Zone Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"zone_name",...b("zone_name"),onChange:o=>u(o.target.value),children:[e.jsx("option",{value:d,disabled:!0,children:d}),w.map(o=>e.jsx("option",{value:o.zone_name,children:o.zone_name},o.zone_id))]}),f.zone_name&&e.jsx("p",{className:"text-red-500",children:f.zone_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"ward_name",children:"Ward Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",type:"text",placeholder:" Ward Name",...b("ward_name")}),f.ward_name&&e.jsx("p",{className:"text-red-500",children:f.ward_name.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...b("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),f.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:f.status.message})]})]}),e.jsx(X,{onCancel:a.toggleModal})]})]})})},Ae=`zone_id,zone_name,ward_name,status,created_by_user
Z***,ZoneName,WardName,Status,admin`,Ke=({permissions:a})=>{const g=a==null?void 0:a.includes("create"),w=a==null?void 0:a.includes("edit"),_=a==null?void 0:a.includes("delete"),N=a==null?void 0:a.includes("download"),[p,d]=n.useState(!1),[u,b]=n.useState(!1),[f,k]=n.useState(null),[r,m]=n.useState(!1),[v,o]=n.useState(null),[h,x]=n.useState(null),[$,ee]=n.useState(""),[M,te]=n.useState(1),[C]=n.useState(8),[O,ae]=n.useState(1),[Ue,se]=n.useState([]),[ne,R]=n.useState(null),[T,q]=n.useState("Bulk Upload"),[oe,re]=n.useState(null),[P,le]=n.useState([]),[V,ce]=n.useState(null),A=sessionStorage.getItem("token"),F=t=>{ce(V===t?null:t)},de=t=>V===t;n.useEffect(()=>{B(),he()},[$,M,C,A]);const ie=t=>{t>0&&t<=O&&te(t)},B=async()=>{try{const t=await z.get(`${D}/ward/get`,{headers:{Authorization:`Bearer ${A}`}}),s=L(t.data.data);le(s);const i=s.filter(l=>Object.values(l).some(c=>c.toString().toLowerCase().includes($.toLowerCase())));ae(Math.ceil(i.length/C));const j=M*C,S=j-C;se(i.slice(S,j))}catch(t){console.error(t)}},me=()=>{d(!p)},xe=()=>{b(!u),k(null)},ue=()=>{d(!p)},H=()=>{m(!r),o(null)},he=async()=>{try{const t=await z.get(`${D}/zone/getactive`,{headers:{Authorization:`Bearer ${A}`}}),s=L(t.data.data);x(s)}catch(t){console.error("Error fetching existing roles:",t)}},U=M*C,Z=U-C,Y=P.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes($.toLowerCase()))),ge=Y.slice(Z,U),pe=async()=>{try{await z.delete(`${D}/ward/delete?ward_id=${v}`,{headers:{Authorization:`Bearer ${A}`}}),H(),B(),y.success("Deleted successfully")}catch{y.error("Failed to delete")}},fe=t=>{R(t.target.files[0]),q("Upload")},je=()=>{T==="Bulk Upload"?document.getElementById("fileInput").click():be(ne)},be=async t=>{try{const s=new FormData;s.append("file",t),(await z.post(`${D}/ward/uploadcsv`,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(q("Bulk Upload"),R(null),B(),y.success("Data Uploaded Successfully")):y.error("Data failed to Upload")}catch(s){console.log(s)}},ye=t=>{re(t.target.value)},we=async t=>{if(t==="csv"){const s=P.map(c=>({ward_id:c.ward_id,zone_id:c.zone_id,zone_name:c.zone_name,ward_name:c.ward_name,status:c.status,created_by_user:c.created_by_user})),i=[Object.keys(s[0]).join(","),...s.map(c=>Object.values(c).join(","))].join(`
`),j=new Blob([i],{type:"text/csv;charset=utf-8;"}),S=window.URL.createObjectURL(j),l=document.createElement("a");l.setAttribute("href",S),l.setAttribute("download","Ward_data.csv"),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}else if(t==="pdf")try{const i=Math.ceil(P.length/30),j=new Pe("l","mm","a4");let S=0;for(let l=1;l<=i;l++){const c=(l-1)*30,Ne=Math.min(c+30,P.length),ve=P.slice(c,Ne).map(E=>[E.ward_id,E.zone_id,E.zone_name,E.ward_name,E.status,E.created_by_user]);j.text(`Page ${l}`,10,S+10),j.autoTable({startY:S+15,head:[["ward_id","zone_id","zone_name","ward_name","Status","createdBy"]],body:ve,theme:"striped"}),l<i&&(j.addPage(),S=10)}j.save("Ward_data.pdf")}catch(s){console.error("Error exporting data:",s)}},_e=()=>{const t=new Blob([Ae],{type:"text/csv"}),s=URL.createObjectURL(t),i=document.createElement("a");i.href=s,i.download="ward_bulkupload_template.csv",i.click(),URL.revokeObjectURL(s)};return e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-3 mx-8 flex-wrap",children:[e.jsx(ke,{value:$,onChange:t=>ee(t.target.value),placeholder:"Search Ward"}),g&&e.jsx(Ee,{onChange:fe,buttonText:T,accept:".csv",onClick:je}),N&&e.jsx(Ce,{selectedDoc:oe,onChange:ye,exportData:we})]}),e.jsx(Be,{title:"Ward",hasCreatePermission:g,onClick:()=>d(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full mt-3 ",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Ward ",e.jsx(I,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Zone ",e.jsx(I,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Status ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedBy ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedAt",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["UpdatedAt",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-semibold font-lexend",children:"Action"})})]})}),e.jsx("tbody",{children:ge.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-700",children:Z+s+1<10?`0${Z+s+1}`:Z+s+1})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.ward_name})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.zone_name})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2  font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:G(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:G(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(Se,{onClick:()=>F(s)}),de(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[w&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{b(!0),k(t.ward_id),F()},children:"Edit"}),_&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{m(!0),o(t.ward_id),F()},children:"Delete"})]})]})})]},s))})]})})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx(Ie,{handleDownload:_e}),e.jsx(ze,{Length:P.length,currentPage:M,totalPages:O,firstIndex:Z,lastIndex:U,paginate:ie,hasNextPage:U>=Y.length})]})]})}),p&&e.jsx(We,{toggleModal:me,toggleCloseModal:ue,ExistingZones:h,handlerefresh:B}),u&&e.jsx(Me,{toggleModal:xe,handlerefresh:B,ExistingZones:h,wardId:f}),r&&e.jsx(De,{toggleDeleteModal:H,delete:pe})]})};export{Ke as default};
