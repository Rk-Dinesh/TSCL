import{r as l,u as Y,b as w,A as N,d as P,j as e,t as F}from"./index-BtER-45x.js";import{R as m,P as J}from"./Pagination-DzgA0zaw.js";import{S as q,D as K,E as Q}from"./DocumentDownload-ByZD_dy4.js";import{H as W}from"./HeaderButton-Dt07NwBn.js";import"./index-BzhkxZBX.js";import"./index-DcKunLyf.js";import"./index-kPZ_e412.js";const le=({permissions:r})=>{const S=r==null?void 0:r.includes("create");r==null||r.includes("edit"),r==null||r.includes("delete");const C=r==null?void 0:r.includes("download");l.useState(!1);const[p,D]=l.useState(""),[g,I]=l.useState(1),[h]=l.useState(8),[j,z]=l.useState(1),[X,k]=l.useState([]),[x,A]=l.useState([]),y=sessionStorage.getItem("token"),_=Y(),E=()=>{_("/form")},[Z,L]=l.useState([]),[v,O]=l.useState({}),[$,G]=l.useState(null);l.useEffect(()=>{w.get(`${N}/new-grievance/get`,{headers:{Authorization:`Bearer ${y}`}}).then(t=>{const s=P(t.data.data);A(s);const d=s.filter(n=>Object.values(n).some(a=>a.toString().toLowerCase().includes(p.toLowerCase())));z(Math.ceil(d.length/h));const i=g*h,o=i-h;k(d.slice(o,i))}).catch(t=>{console.error(t)}),R()},[p,g]);const R=async()=>{try{const t=await w.get(`${N}/status/get`,{headers:{Authorization:`Bearer ${y}`}}),s=P(t.data.data),d=s.reduce((i,o)=>(i[o.status_name]=o.color,i),{});L(s),O(d)}catch(t){console.error("Error fetching existing ActiveStatus:",t)}},U=t=>{t>0&&t<=j&&I(t)},f=g*h,u=f-h,b=x.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(p.toLowerCase()))),M=b.slice().reverse().slice(u,f),T=t=>{G(t.target.value)},B=async t=>{if(t==="csv"){const s=x.map(a=>({grievance_id:a.grievance_id,grievance_mode:a.grievance_mode,complaint_type_title:a.complaint_type_title,dept_name:a.dept_name,zone_name:a.zone_name,ward_name:a.ward_name,street_name:a.street_name,pincode:a.pincode,complaint:a.complaint,public_user_id:a.public_user_id,public_user_name:a.public_user_name,phone:a.phone,assign_user:a.assign_user,assign_username:a.assign_username,assign_userphone:a.assign_userphone,status:a.status,escalation_level:a.escalation_level,priority:a.priority})),d=[Object.keys(s[0]).join(","),...s.map(a=>Object.values(a).join(","))].join(`
`),i=new Blob([d],{type:"text/csv;charset=utf-8;"}),o=window.URL.createObjectURL(i),n=document.createElement("a");n.setAttribute("href",o),n.setAttribute("download","Grievance_data.csv"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}else if(t==="pdf")try{const d=Math.ceil(x.length/30),i=new Q("l","mm","a4");let o=0;for(let n=1;n<=d;n++){const a=(n-1)*30,H=Math.min(a+30,x.length),V=x.slice(a,H).map(c=>[c.grievance_id,c.grievance_mode,c.complaint_type_title,c.dept_name,c.pincode,c.complaint,c.public_user_name,c.phone,c.assign_username,c.assign_userphone,c.status,c.escalation_level,c.priority]);i.text(`Page ${n}`,10,o+10),i.autoTable({startY:o+15,head:[["grievance_id","grievance_mode","complaintType","dept","pincode","complaint","publicUser","phone","assignUser","assignUserphone","status","Escalation","Priority"]],body:V,theme:"striped"}),n<d&&(i.addPage(),o=10)}i.save("Grievance_data.pdf")}catch(s){console.error("Error exporting data:",s)}};return e.jsx(l.Fragment,{children:e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row  gap-3 p-2 mt-3 mx-8 flex-wrap md:justify-end ",children:[e.jsx(q,{value:p,onChange:t=>D(t.target.value),placeholder:"Search Grievances"}),C&&e.jsx(K,{selectedDoc:$,onChange:T,exportData:B})]}),e.jsx(W,{title:"Grievances",hasCreatePermission:S,onClick:E}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3 py-3 overflow-x-auto h-3/5 no-scrollbar ",children:e.jsxs("table",{className:"w-full mt-2 ",children:[e.jsx("thead",{className:" border-b border-gray-300  ",children:e.jsxs("tr",{className:"",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-3 my-2 font-lexend font-medium whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 text-start font-lexend font-medium  whitespace-nowrap",children:"Complaint No"})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Raised by ",e.jsx(m,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Complaint Type ",e.jsx(m,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Department",e.jsx(m,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Assigned JE ",e.jsx(m,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Date and Time ",e.jsx(m,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:["Priority ",e.jsx(m,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-center mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Status ",e.jsx(m,{})]})})]})}),e.jsx("tbody",{children:M.map((t,s)=>e.jsxs("tr",{className:" border-b border-gray-300  ",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"text-center text-sm mx-3 my-2 font-lexend whitespace-nowrap text-gray-700",children:u+s+1<10?`0${u+s+1}`:u+s+1})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 border-slate-900 rounded-lg text-center py-1 my-1   text-slate-900",onClick:()=>_("/view",{state:{grievanceId:t.grievance_id}}),children:t.grievance_id})}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.public_user_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.complaint_type_title})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.dept_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.assign_username?t.assign_username:"Yet to be assigned"})]}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:F(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:`border-2 w-26 rounded-full text-center py-1.5 mx-2 text-sm font-medium capitalize  ${t.priority==="High"?"text-red-500 border-red-500":t.priority==="Medium"?"text-sky-500 border-sky-500":t.priority==="Low"?"text-green-500 border-green-500":""}`,children:t.priority})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 rounded-full text-center py-1 tex-sm font-normal mx-2 capitalize  ",style:{borderColor:v[t.status]||"gray",color:v[t.status]||"black",fontSize:14},children:t.status})})]},s))})]})}),e.jsx("div",{className:" my-3 mb-5 mx-7",children:e.jsx(J,{Length:x.length,currentPage:g,totalPages:j,firstIndex:u,lastIndex:f,paginate:U,hasNextPage:f>=b.length})})]})})})};export{le as default};
