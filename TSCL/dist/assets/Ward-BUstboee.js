import{i as K,k as $,r as n,m as Q,o as X,j as e,b as P,A as C,B as y,d as O,x as De,D as Pe,y as Ce,q as E,s as J,v as ke,w as Ie,E as Ee,z as Ze}from"./index-tsgvEHmX.js";import{S as ee}from"./SavaCancel-r2kPCP2i.js";import{D as Be}from"./DeleteModal-DJp1pd7G.js";import{F as $e,B as We}from"./FileUploadButton-C5ckz8lU.js";const Me=K().shape({zone_name:$().test("not-select","Please select an Zone",a=>a!==""&&a!=="Select Zone"),ward_name:$().required("ward_name is required")}),Ae=a=>{const{ExistingZones:h}=a,[w,N]=n.useState(null),[_,g]=n.useState(null),{register:i,formState:{errors:u},handleSubmit:j,watch:p}=Q({resolver:X(Me),mode:"all"});n.useEffect(()=>{if(_){const o=h.find(c=>c.zone_name===_);o&&N(o.zone_id)}},[_,h]);const k=async o=>{const c={...o,zone_id:w,status:"active",created_by_user:localStorage.getItem("name")};try{const v=localStorage.getItem("token"),l=await P.post(`${C}/ward/post`,c,{headers:{Authorization:`Bearer ${v}`}});l.status===200?(y.success("Ward created Successfully"),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",l),y.error("Failed to Upload"))}catch(v){console.error("Error in posting data",v)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Ward"})}),e.jsxs("form",{onSubmit:j(k),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"zone_name",children:"Zone Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"zone_name",...i("zone_name"),onChange:o=>g(o.target.value),children:[e.jsx("option",{value:"",children:"Select Zone"}),h.map((o,c)=>e.jsx("option",{value:o.zone_name,children:o.zone_name},c))]}),u.zone_name&&e.jsx("p",{className:"text-red-500",children:u.zone_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"ward_name",children:"Ward Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",type:"text",placeholder:" Ward Name",...i("ward_name")}),u.ward_name&&e.jsx("p",{className:"text-red-500",children:u.ward_name.message})]})]}),e.jsx(ee,{onCancel:a.toggleCloseModal})]})]})})},Fe=K().shape({zone_name:$().test("not-select","Please select an Zone",a=>a!==""&&a!=="Select Zone"),ward_name:$().required("ward_name is required"),status:$().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Ue=a=>{const h=localStorage.getItem("token"),{ExistingZones:w,wardId:N}=a,[_,g]=n.useState(null),[i,u]=n.useState(null),{register:j,formState:{errors:p},handleSubmit:k,watch:o,setValue:c}=Q({resolver:X(Fe),mode:"all"});n.useEffect(()=>{(async()=>{try{const m=await P.get(`${C}/ward/getbyid?ward_id=${N}`,{headers:{Authorization:`Bearer ${h}`}}),x=O(m.data.data);u(x.zone_name),c("ward_name",x.ward_name),c("status",x.status),c("zone_name",x.zone_name)}catch(m){console.error("Error fetching data",m)}})()},[N,c]),n.useEffect(()=>{if(i){const l=w.find(m=>m.zone_name===i);l&&g(l.zone_id)}},[i,w]);const v=async l=>{const m={...l,zone_id:_};try{const x=await P.post(`${C}/ward/update?ward_id=${N}`,m,{headers:{Authorization:`Bearer ${h}`}});x.status===200?(y.success("Ward Updated Successfully"),g(null),g(null),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",x),y.error("Failed to Upload"))}catch(x){console.error("Error in posting data",x)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Ward"})}),e.jsxs("form",{onSubmit:k(v),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"zone_name",children:"Zone Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"zone_name",...j("zone_name"),onChange:l=>u(l.target.value),children:[e.jsx("option",{value:i,disabled:!0,children:i}),w.map((l,m)=>e.jsx("option",{value:l.zone_name,children:l.zone_name},m))]}),p.zone_name&&e.jsx("p",{className:"text-red-500",children:p.zone_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"ward_name",children:"Ward Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",type:"text",placeholder:" Ward Name",...j("ward_name")}),p.ward_name&&e.jsx("p",{className:"text-red-500",children:p.ward_name.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...j("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),p.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:p.status.message})]})]}),e.jsx(ee,{onCancel:a.toggleModal})]})]})})},Oe=`zone_id,zone_name,ward_name,status,created_by_user
Z***,ZoneName,WardName,Status,admin`,Ye=({permissions:a})=>{const h=a==null?void 0:a.includes("create"),w=a==null?void 0:a.includes("edit"),N=a==null?void 0:a.includes("delete"),_=a==null?void 0:a.includes("download"),[g,i]=n.useState(!1),[u,j]=n.useState(!1),[p,k]=n.useState(null),[o,c]=n.useState(!1),[v,l]=n.useState(null),[m,x]=n.useState(null),[W,te]=n.useState(""),[M,L]=n.useState(1),[S,ae]=n.useState(10),[T,se]=n.useState(1),[Le,ne]=n.useState([]),[le,q]=n.useState(null),[V,R]=n.useState("Bulk Upload"),[re,oe]=n.useState(null),[z,ce]=n.useState([]),[H,de]=n.useState(null),A=localStorage.getItem("token"),U=t=>{de(H===t?null:t)},ie=t=>H===t;n.useEffect(()=>{Z(),ge()},[W,M,S,A]);const me=t=>{t>0&&t<=T&&L(t)},Z=async()=>{try{const t=await P.get(`${C}/ward/get`,{headers:{Authorization:`Bearer ${A}`}}),s=O(t.data.data);ce(s);const b=s.filter(r=>Object.values(r).some(d=>d.toString().toLowerCase().includes(W.toLowerCase())));se(Math.ceil(b.length/S));const f=M*S,D=f-S;ne(b.slice(D,f))}catch(t){console.error(t)}},xe=()=>{i(!g)},ue=()=>{j(!u),k(null)},he=()=>{i(!g)},Y=()=>{c(!o),l(null)},ge=async()=>{try{const t=await P.get(`${C}/zone/getactive`,{headers:{Authorization:`Bearer ${A}`}}),s=O(t.data.data);x(s)}catch(t){console.error("Error fetching existing roles:",t)}},F=M*S,B=F-S,G=z.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(W.toLowerCase()))),pe=G.slice(B,F),fe=async()=>{try{await P.delete(`${C}/ward/delete?ward_id=${v}`,{headers:{Authorization:`Bearer ${A}`}}),Y(),Z(),y.success("Deleted successfully")}catch{y.error("Failed to delete")}},je=t=>{q(t.target.files[0]),R("Upload")},be=()=>{V==="Bulk Upload"?document.getElementById("fileInput").click():ye(le)},ye=async t=>{try{const s=new FormData;s.append("file",t),(await P.post(`${C}/ward/uploadcsv`,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(R("Bulk Upload"),q(null),Z(),y.success("Data Uploaded Successfully")):y.error("Data failed to Upload")}catch(s){console.log(s)}},we=t=>{oe(t.target.value)},Ne=async t=>{if(t==="csv"){const s=z.map(d=>({ward_id:d.ward_id,zone_id:d.zone_id,zone_name:d.zone_name,ward_name:d.ward_name,status:d.status,created_by_user:d.created_by_user})),b=[Object.keys(s[0]).join(","),...s.map(d=>Object.values(d).join(","))].join(`
`),f=new Blob([b],{type:"text/csv;charset=utf-8;"}),D=window.URL.createObjectURL(f),r=document.createElement("a");r.setAttribute("href",D),r.setAttribute("download","Ward_data.csv"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}else if(t==="pdf")try{const b=Math.ceil(z.length/30),f=new Ee("l","mm","a4");let D=0;for(let r=1;r<=b;r++){const d=(r-1)*30,Se=Math.min(d+30,z.length),ze=z.slice(d,Se).map(I=>[I.ward_id,I.zone_id,I.zone_name,I.ward_name,I.status,I.created_by_user]);f.text(`Page ${r}`,10,D+10),f.autoTable({startY:D+15,head:[["ward_id","zone_id","zone_name","ward_name","Status","createdBy"]],body:ze,theme:"striped"}),r<b&&(f.addPage(),D=10)}f.save("Ward_data.pdf")}catch(s){console.error("Error exporting data:",s)}},_e=()=>{Ze(Oe)},ve=t=>{const s=parseInt(t.target.value,10);ae(s),L(1)};return e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar mb-2",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-2 mx-8 flex-wrap",children:[e.jsx(De,{value:W,onChange:t=>te(t.target.value),placeholder:"Search Ward"}),h&&e.jsx($e,{onChange:je,buttonText:V,accept:".csv",onClick:be}),_&&e.jsx(Pe,{selectedDoc:re,onChange:we,exportData:Ne})]}),e.jsx(Ce,{title:"Ward",hasCreatePermission:h,onClick:()=>i(!0)}),e.jsxs("div",{className:`bg-white  mx-4 rounded-lg mt-1  p-3 ${z.length<8?"h-3/5":"h-fit"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mx-3",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-medium text-gray-600",children:"Page Entries"}),e.jsxs("select",{id:"itemsPerPage",value:S,onChange:ve,className:" p-1 outline-none text-sm rounded px-2",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]}),e.jsx("div",{className:"overflow-x-auto ",children:e.jsxs("table",{className:"w-full mt-3 ",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Ward ",e.jsx(E,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Zone ",e.jsx(E,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Status ",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedBy ",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedAt",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["UpdatedAt",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-semibold font-lexend",children:"Action"})})]})}),e.jsx("tbody",{children:pe.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-700",children:B+s+1<10?`0${B+s+1}`:B+s+1})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.ward_name})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.zone_name})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2  font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:J(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:J(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(ke,{onClick:()=>U(s)}),ie(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[w&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{j(!0),k(t.ward_id),U()},children:"Edit"}),N&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{c(!0),l(t.ward_id),U()},children:"Delete"})]})]})})]},s))})]})})]}),e.jsxs("div",{className:" my-2 mb-5 mx-7",children:[e.jsx(We,{handleDownload:_e}),e.jsx(Ie,{Length:z.length,currentPage:M,totalPages:T,firstIndex:B,lastIndex:F,paginate:me,hasNextPage:F>=G.length})]})]})}),g&&e.jsx(Ae,{toggleModal:xe,toggleCloseModal:he,ExistingZones:m,handlerefresh:Z}),u&&e.jsx(Ue,{toggleModal:ue,handlerefresh:Z,ExistingZones:m,wardId:p}),o&&e.jsx(Be,{toggleDeleteModal:Y,delete:fe})]})};export{Ye as default};
