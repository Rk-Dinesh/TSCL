import{c as P,a as W,r as l,C as U,p as V,u as H,j as e,m as G,o as J,b as c,A as n,d as g,B as p}from"./index-B-0fny-6.js";import{V as O}from"./ViewAttachment-BI0hPLJi.js";const Z=P().shape({worksheet_name:W().required("worksheet is required")}),ie=()=>{var A;const[s,k]=l.useState(null),[v,z]=l.useState(null),[f,L]=l.useState([]),[y,F]=l.useState([]),[K,u]=l.useState(!0),[Q,j]=l.useState(null),m=(A=U().state)==null?void 0:A.grievanceId,d=sessionStorage.getItem("token"),[w,b]=l.useState(!1),[T,_]=l.useState(null),[S,B]=l.useState([]),[N,D]=l.useState([]),$=V(),{register:C,formState:{errors:Y},handleSubmit:E,reset:ee,setValue:se,watch:ae}=H({resolver:J(Z),mode:"onBlur"});l.useEffect(()=>{const a=async()=>{try{const t=await c.get(`${n}/new-grievance/getbyid?grievance_id=${m}`,{headers:{Authorization:`Bearer ${d}`}}),i=g(t.data.data);k(i);const x=await c.get(`${n}/new-grievance/filter?zone_name=${i.zone_name}&ward_name=${i.ward_name}&street_name=${i.street_name}&dept_name=${i.dept_name}&complaint=${i.complaint}`,{headers:{Authorization:`Bearer ${d}`}});F(g(x.data.data))}catch(t){j(t)}finally{u(!1)}},r=async()=>{try{const t=await c.get(`${n}/status/getactive`,{headers:{Authorization:`Bearer ${d}`}}),i=g(t.data.data);L(i)}catch(t){j(t)}finally{u(!1)}},h=async()=>{try{const t=await c.get(`${n}/new-grievance-attachment/getattachments?grievance_id=${m}`,{headers:{Authorization:`Bearer ${d}`}}),i=g(t.data.data);z(i)}catch(t){j(t)}finally{u(!1)}},o=async()=>{try{const t=await c.get(`${n}/grievance-log/getbyid?grievance_id=${m}`,{headers:{Authorization:`Bearer ${d}`}}),i=g(t.data.data);B(i)}catch(t){j(t)}finally{u(!1)}};a(),r(),h(),o()},[]);const q=()=>{b(!w),_(null)},M=async a=>{const r={status:a},h=a;try{const o=await c.post(`${n}/new-grievance/updatestatus?grievance_id=${m}`,r,{headers:{Authorization:`Bearer ${d}`}});if(o.status===200){p.success("Status Updated Successfully"),$("/requestview3");const t=await c.post(`${n}/grievance-log/post`,{grievance_id:m,log_details:` Assigned work is ${h}`,created_by_user:"admin"},{headers:{Authorization:`Bearer ${d}`}})}else console.error("Error in posting data",o),p.error("Failed to Upload")}catch(o){console.error("Error in posting data",o)}},I=a=>{const r=a.target.files;r.length>5?(p.error("Maximum 5 files allowed"),a.target.value=null):D(r)},R=async a=>{const r=a.worksheet_name,h={...a,grievance_id:m,created_by_user:"admin"};try{if((await c.post(`${n}/grievance-worksheet/post`,h,{headers:{Authorization:`Bearer ${d}`}})).status===200){p.success("Wroksheet Uploaded Successfully");const t=await c.post(`${n}/grievance-log/post`,{grievance_id:m,log_details:` WorkSheet: ${r}`,created_by_user:"admin"},{headers:{Authorization:`Bearer ${d}`}})}if(N.length>0)if(N.length>5)p.error("File limit exceeded. Maximum 5 files allowed.");else try{const t=new FormData;for(let x=0;x<N.length;x++)t.append("files",N[x]);t.append("grievance_id",m),t.append("created_by_user","admin"),(await c.post(`${n}/grievance-worksheet-attachment/post`,t,{headers:{"Content-Type":"multipart/form-data"}})).status===200&&(D([]),p.success("Attachment Uploaded Successfully"))}catch(t){console.error(t),p.error("Error creating attachment")}$("/requestview3")}catch(o){console.log(o),p.error("An error occurred during submission. Please try again.")}};return e.jsxs(l.Fragment,{children:[e.jsx("div",{className:"h-screen overflow-y-auto no-scrollbar",children:s&&s.grievance_id&&e.jsxs("div",{className:"md:mx-6 mx-2  my-5 font-lexend",children:[e.jsxs("p",{children:["Complaint Details #",s.grievance_id]}),e.jsxs("div",{className:"bg-white mt-2 pb-3",children:[e.jsx("p",{className:"px-5 py-2 text-lg",children:"Request By :"}),e.jsxs("div",{className:"flex justify-between gap-3 mx-3 my-3",children:[e.jsxs("div",{className:"col-span-4 px-5 pb-3",children:[e.jsx("p",{className:"capitalize",children:s.public_user_name}),e.jsxs("p",{children:["+91 ",s.phone]})," "]}),e.jsxs("div",{className:"flex flex-col mx-3",children:[e.jsxs("div",{className:"flex  gap-3 mb-3 items-center",children:[e.jsx("p",{children:"Status: "}),e.jsx("span",{className:"text-sm border-2 border-gray-500 px-3 py-0.5 rounded-full",children:e.jsxs("select",{className:"col-span-2 block px-1 py-1 text-sm text-black border rounded-lg border-none outline-none capitalize",onChange:a=>M(a.target.value),children:[e.jsx("option",{value:s.status,hidden:!0,children:s.status}),f&&f.map(a=>e.jsx("option",{value:a.status_name,children:a.status_name},a.status_name))]})})]}),e.jsxs("div",{className:"flex gap-3 items-center ",children:[e.jsx("p",{children:"Priority: "}),e.jsx("span",{className:`border w-28 rounded-full text-center py-1.5 mx-2 text-sm font-normal capitalize text-white  ${s.priority==="High"?"bg-red-500":s.priority==="Medium"?"bg-green-500":s.priority==="Low"?"bg-sky-500":""}`,children:s.priority})]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 mx-3 my-4",children:[e.jsxs("div",{className:"md:col-span-6 col-span-12 border px-2 py-3 rounded",children:[e.jsx("p",{className:"pt-2 text-lg",children:"Grievance Details"}),e.jsx("hr",{className:"my-3"}),e.jsxs("div",{className:"flex flex-col gap-3 mx-2 text-base",children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Origin "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.grievance_mode]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Complaint Type "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.complaint_type_title]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Department "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.dept_name]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Complaint "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.complaint]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Zone "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.zone_name]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Ward "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.ward_name]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Street "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.street_name]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Pincode "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.pincode]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Description: "}),e.jsx("p",{className:"col-start-1 col-span-4 mt-2 capitalize",children:s.complaint_details})]}),v&&v.length>0&&e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Attachment Files "}),e.jsx("div",{className:"col-start-1 col-span-4 mt-2 text-xs  ",children:v.map((a,r)=>e.jsx("button",{className:" mx-1 my-1 px-3 py-1.5 bg-gray-500 rounded-full text-white",onClick:()=>{b(!0),_(a.attachment)},children:`Attachment ${r+1}`},r))})]})]})]}),e.jsxs("div",{className:"md:col-span-6 col-span-12 border px-1 py-3 rounded ",children:[e.jsx("p",{className:"pt-2 text-lg ",children:"Similar Request"}),e.jsx("hr",{className:"my-3 w-full"}),e.jsx("div",{className:"overflow-auto no-scrollbar",children:e.jsxs("table",{className:"w-full bg-gray-200 rounded  ",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"items-center mx-3 py-2 font-lexend whitespace-nowrap",children:"Date/Time"}),e.jsx("th",{className:"items-center mx-3 py-2 font-lexend whitespace-nowrap",children:"Complaint No"}),e.jsx("th",{className:"items-center mx-3 py-2 font-lexend whitespace-nowrap",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-300",children:y&&y.length>0?y.map((a,r)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"text-center mx-3 py-2.5 whitespace-nowrap",children:G(a.createdAt)}),e.jsx("td",{className:"text-center mx-3 py-2.5 whitespace-nowrap",children:a.grievance_id}),e.jsx("td",{className:"text-center mx-3 py-2.5 text-green-600 whitespace-nowrap capitalize",children:a.status})]},r)):e.jsx("tr",{children:e.jsx("td",{className:"text-center py-2.5",colSpan:"3",children:"No matching data found"})})})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 mx-3 my-3",children:[e.jsxs("div",{className:"md:col-span-6 col-span-12 border px-2 py-3 rounded mt-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"mx-3",children:"Replay"}),e.jsxs("select",{className:" block px-4 py-3 text-sm text-black border rounded-lg  outline-none",children:[e.jsx("option",{hidden:!0,children:"LAN"}),e.jsx("option",{value:"Tamil",children:"TA - EN"}),e.jsx("option",{value:"English",children:"EN - TA"})]})]}),e.jsx("hr",{className:"my-3 w-full"}),e.jsxs("form",{onSubmit:E(R),children:[e.jsx("textarea",{id:"worksheet_id",rows:"11",className:" w-full col-span-6 outline-none",placeholder:"Type....",...C("worksheet_name")}),e.jsxs("div",{className:" md:mt-12",children:[e.jsx("input",{type:"file",id:"file",multiple:!0,className:" py-2 px-3   outline-none",onChange:I}),e.jsx("div",{className:"flex justify-end mx-3 mt-3",children:e.jsx("button",{type:"submit",className:" text-white bg-gray-800 text-sm font-lexend rounded-full px-3 py-1.5 ",children:"submit"})})]})]})]}),e.jsxs("div",{className:"md:col-span-6 col-span-12",children:[e.jsx("p",{className:"mb-2 mx-1 text-lg",children:"Complaint History"}),e.jsx("div",{className:"bg-gray-100 py-3 h-[530px]",children:e.jsxs("div",{className:"mx-8 ",children:[e.jsxs("p",{className:"py-3 font-semibold",children:["Complaint No ",s.grievance_id]}),e.jsxs("div",{className:"h-[280px]  overflow-x-auto no-scrollbar mb-3",children:[S&&S.slice().reverse().map((a,r)=>e.jsxs("div",{children:[e.jsx("p",{className:"py-1",children:new Date(a.createdAt).toLocaleDateString()}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsx("p",{children:new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("p",{className:"pl-5 col-span-2",children:a.log_details})]}),e.jsx("br",{})]},r)),e.jsx("p",{className:"py-2",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsx("p",{children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsxs("p",{className:"pl-5 col-span-2",children:[" ","Assigned To Particular Department"]})]}),e.jsx("br",{}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsx("p",{children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsxs("p",{className:"pl-5 col-span-2",children:["Ticket Raised- ",s.grievance_id]})]}),e.jsx("br",{}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsx("p",{children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("p",{className:"pl-5 col-span-2",children:"Logged In"})]})]}),e.jsx("p",{className:"mb-2",children:"Work StatusFlow :"}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsxs("p",{children:[e.jsx("span",{className:"block",children:new Date(s.updatedAt).toLocaleDateString()}),new Date(s.updatedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"pl-5",children:"Status:"}),e.jsx("p",{className:"pl-5 text-gray-500",children:s.statusflow.split("/").join(" / ").replace(/(?: \/ ){5}/g,` / 
`)})]})]}),e.jsx("hr",{className:"my-3"}),e.jsxs("div",{className:"md:grid md:grid-cols-3 flex border-2 ",children:[e.jsx("p",{className:"text-center px-3 py-1.5",children:"Status"}),e.jsx("p",{className:"text-center w-full bg-gray-800 md:col-span-2 text-white py-1.5",children:s.status})]})]})})]})]})]})]})}),w&&e.jsx(O,{toggleModal:q,attachmentFile:T})]})};export{ie as default};
