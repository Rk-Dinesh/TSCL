import{l as Je,r as s,u as Ke,b as h,A as g,d as f,y as Qe,p as Xe,j as t,w as et,z as tt,B as at}from"./index-Cb3AN3R3.js";import{R as x}from"./index-C-hq6bKM.js";import{S as st,D as nt,E as lt}from"./DocumentDownload-A0b-q8L_.js";import{P as rt}from"./Pagination-ClPqWgoN.js";import{D as ct,a as it}from"./DateRangeComp-B_BpUMFB.js";import"./index-CmROlnnr.js";import"./index-Du0g9a49.js";import"./index-aztxF81R.js";const me=({permissions:i,include:v,endpoint:_})=>{i==null||i.includes("create"),i==null||i.includes("edit"),i==null||i.includes("delete");const F=i==null?void 0:i.includes("download"),xe=Je(),[N,pe]=s.useState(""),[S,J]=s.useState(1),[y,ue]=s.useState(10),[K,he]=s.useState(1),[ot,ge]=s.useState([]),[Q,fe]=s.useState([]),[je,ye]=s.useState({}),[X,ve]=s.useState([]),[ee,we]=s.useState([]),[te,ae]=s.useState([]),[se,be]=s.useState([]),[ne,le]=s.useState([]),[re,I]=s.useState([]),[A,_e]=s.useState([]),[p,E]=s.useState([]),[ce,Ne]=s.useState([]),[Se,Ae]=s.useState(null),u=localStorage.getItem("token");localStorage.getItem("dept");const Ce=Ke(),[ie,De]=s.useState("All"),[oe,ze]=s.useState({}),[M,T]=s.useState(null),[R,C]=s.useState(null),[D,B]=s.useState(null),[z,P]=s.useState(null),[L,w]=s.useState(null),[U,G]=s.useState(null),[Z,O]=s.useState(null),[H,W]=s.useState(null),[$,Y]=s.useState(null);s.useEffect(()=>{h.get(`${g}/new-grievance/${_}`,{headers:{Authorization:`Bearer ${u}`}}).then(e=>{const a=f(e.data.data);_e(a);const l=a.filter(r=>Object.values(r).some(d=>d.toString().toLowerCase().includes(N.toLowerCase())));E(l)}).catch(e=>{console.error(e)}),$e(),Pe(),ke(),Ee(),Ie(),xe(Qe())},[]);const j=Xe(e=>e.origin);s.useEffect(()=>{var e;if(j&&(j!=null&&j.data)){const a=(e=j==null?void 0:j.data)==null?void 0:e.reduce((l,r)=>(l[r.res_name]=r.image,l),{});ye(a)}},[j]),s.useEffect(()=>{const e=A.filter(a=>Object.values(a).some(l=>l.toString().toLowerCase().includes(N.toLowerCase())));E(e)},[N]),s.useEffect(()=>{const e=S*y,a=e-y;ge(p.slice(a,e)),he(Math.ceil(p.length/y))},[p,S,y]);const Pe=async()=>{try{const e=await h.get(`${g}/zone/get`,{headers:{Authorization:`Bearer ${u}`}}),a=f(e.data.data);be(a)}catch(e){console.error("Error fetching existing Dept:",e)}},$e=async()=>{try{const e=await h.get(`${g}/department/get`,{headers:{Authorization:`Bearer ${u}`}}),a=f(e.data.data);we(a)}catch(e){console.error("Error fetching existing Dept:",e)}},ke=async()=>{try{const e=await h.get(`${g}/status/get`,{headers:{Authorization:`Bearer ${u}`}}),a=f(e.data.data),l=a.reduce((r,d)=>(r[d.status_name]=d.color,r),{});fe(a),ze(l)}catch(e){console.error("Error fetching existing ActiveStatus:",e)}},Ie=async()=>{try{const e=await h.get(`${g}/user/get`,{headers:{Authorization:`Bearer ${u}`}}),a=f(e.data.data);Ne(a)}catch(e){console.error("Error fetching existing ActiveStatus:",e)}},Ee=async()=>{try{const e=await h.get(`${g}/complainttype/get`,{headers:{Authorization:`Bearer ${u}`}}),a=f(e.data.data);ve(a)}catch(e){console.error("Error fetching existing Complainttype:",e)}},m=e=>{e>0&&e<=K&&J(e)},Me=e=>{const a=e[0].startDate,l=e[0].endDate,r=A.filter(d=>{const c=new Date(d.createdAt);return c>=a&&c<it(l,1)});E(r),at.success("Grievance filtered")},k=S*y,b=k-y,Te=e=>{De(e),T(null),C(null),B(null),P(null),G(null),w(null),O(null),W(null),Y(null),m(1)},Re=async e=>{e==="All"?(T(null),ae([])):(T(e),C(null),await h.get(`${g}/complaint/getdept?dept_name=${e}`,{headers:{Authorization:`Bearer ${u}`}}).then(a=>{const l=f(a.data.data);ae(l)})),m(1)},Be=e=>{C(e==="All"?null:e),m(1)},Le=async e=>{e==="All"?(B(null),le([]),I([])):(B(e),P(null),w(null),await h.get(`${g}/ward/getzone?zone_name=${e}`,{headers:{Authorization:`Bearer ${u}`}}).then(a=>{const l=f(a.data.data);le(l)})),m(1)},Ue=async e=>{e==="All"?(P(null),I([])):(P(e),w(null),await h.get(`${g}/street/getward?ward_name=${e}`,{headers:{Authorization:`Bearer ${u}`}}).then(a=>{const l=f(a.data.data);I(l)})),m(1)},Ge=e=>{w(e==="All"?null:e),m(1)},Ze=e=>{G(e==="All"?null:e),m(1)},Oe=e=>{O(e==="All"?null:e),m(1)},He=e=>{W(e==="All"?null:e),m(1)},We=e=>{Y(e==="All"?null:e),m(1)},Ye=p.slice().reverse().filter(e=>{const a=ie==="All"?!0:"",l=M===null?!0:e.dept_name===M,r=R===null?!0:e.complaint===R,d=D===null?!0:e.zone_name===D,c=z===null?!0:e.ward_name===z,n=L===null?!0:e.street_name===L,V=U===null?!0:e.status===U,de=Z===null?!0:e.complaint_type_title===Z,q=H===null?!0:e.priority===H,o=$===null?!0:$==="Yet to be Assigned"?!e.assign_username:e.assign_username===$;return a&&V&&l&&r&&d&&c&&n&&de&&q&&o}).slice(b,k),Ve=e=>{Ae(e.target.value)},qe=async e=>{if(e==="csv"){const a=p.map(n=>({grievance_id:n.grievance_id,grievance_mode:n.grievance_mode,complaint_type_title:n.complaint_type_title,dept_name:n.dept_name,zone_name:n.zone_name,ward_name:n.ward_name,street_name:n.street_name,pincode:n.pincode,complaint:n.complaint,public_user_id:n.public_user_id,public_user_name:n.public_user_name,phone:n.phone,assign_user:n.assign_user,assign_username:n.assign_username,assign_userphone:n.assign_userphone,status:n.status,escalation_level:n.escalation_level,priority:n.priority})),l=[Object.keys(a[0]).join(","),...a.map(n=>Object.values(n).join(","))].join(`
`),r=new Blob([l],{type:"text/csv;charset=utf-8;"}),d=window.URL.createObjectURL(r),c=document.createElement("a");c.setAttribute("href",d),c.setAttribute("download","Grievance_data.csv"),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}else if(e==="pdf")try{const l=Math.ceil(p.length/30),r=new lt("l","mm","a4");let d=0;for(let c=1;c<=l;c++){const n=(c-1)*30,V=Math.min(n+30,p.length),q=p.slice(n,V).map(o=>[o.grievance_id,o.grievance_mode,o.complaint_type_title,o.dept_name,o.pincode,o.complaint,o.public_user_name,o.phone,o.assign_username,o.assign_userphone,o.status,o.escalation_level,o.priority]);r.text(`Page ${c}`,10,d+10),r.autoTable({startY:d+15,head:[["grievance_id","grievance_mode","complaintType","dept","pincode","complaint","publicUser","phone","assignUser","assignUserphone","status","Escalation","Priority"]],body:q,theme:"striped"}),c<l&&(r.addPage(),d=10)}r.save("Grievance_data.pdf")}catch(a){console.error("Error exporting data:",a)}},Fe=e=>{const a=parseInt(e.target.value,10);ue(a),J(1)};return t.jsx("div",{className:"mb-8",children:t.jsxs("div",{className:"  font-lexend h-screen ",children:[t.jsxs("div",{className:"flex flex-row  gap-3 p-2 mt-1 mx-4 flex-wrap md:justify-between items-center ",children:[t.jsxs("div",{className:"flex gap-3",children:[t.jsx(ct,{onChange:Me}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("label",{htmlFor:"itemsPerPage",className:"font-medium text-gray-600",children:"Page Entries"}),t.jsxs("select",{id:"itemsPerPage",value:y,onChange:Fe,className:" p-1 outline-none text-sm rounded px-2",children:[t.jsx("option",{value:"10",children:"10"}),t.jsx("option",{value:"20",children:"20"}),t.jsx("option",{value:"50",children:"50"}),t.jsx("option",{value:"100",children:"100"})]})]})]}),t.jsxs("div",{className:"flex flex-row flex-wrap gap-1.5",children:[t.jsx(st,{value:N,onChange:e=>pe(e.target.value),placeholder:"Search Grievances"}),F&&t.jsx(nt,{selectedDoc:Se,onChange:Ve,exportData:qe})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-1 mx-4",children:[t.jsx("button",{className:`w-20  py-1 ${ie==="All"?"bg-primary text-white":"bg-white text-black"} rounded-full shadow-lg`,onClick:()=>Te("All"),children:"All"}),t.jsx("div",{className:"flex gap-2 flex-wrap",children:t.jsxs("select",{className:"block w-full  px-1 md:py-2 py-1.5 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-lg",onChange:e=>Re(e.target.value),value:M||"",children:[t.jsx("option",{hidden:!0,children:"Department"}),t.jsx("option",{value:"All",children:"All"}),ee&&ee.map((e,a)=>t.jsx("option",{value:e.dept_name,children:e.dept_name},a))]})}),t.jsx("div",{className:"flex gap-2 flex-wrap",children:t.jsxs("select",{className:"block w-full  px-2 md:py-2 py-1.5 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-lg",onChange:e=>Be(e.target.value),value:R||"",children:[t.jsx("option",{hidden:!0,children:"Complaint"}),t.jsx("option",{value:"All",children:"All"}),te&&te.map((e,a)=>t.jsx("option",{value:e.complaint_type_title,children:e.complaint_type_title},a))]})}),t.jsx("div",{className:"flex gap-2 flex-wrap",children:t.jsxs("select",{className:"block w-full  px-1 md:py-2 py-1.5 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-lg",onChange:e=>Le(e.target.value),value:D||"",children:[t.jsx("option",{hidden:!0,children:"Zone"}),t.jsx("option",{value:"All",children:"All"}),se&&se.map((e,a)=>t.jsx("option",{value:e.zone_name,children:e.zone_name},a))]})}),t.jsx("div",{className:"flex gap-2 flex-wrap",children:t.jsxs("select",{className:"block w-full  px-1 md:py-2 py-1.5 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-lg",onChange:e=>Ue(e.target.value),value:z||"",children:[t.jsx("option",{hidden:!0,children:"ward"}),t.jsx("option",{value:"All",children:"All"}),ne&&ne.filter(e=>e.zone_name===D).map((e,a)=>t.jsx("option",{value:e.ward_name,children:e.ward_name},a))]})}),t.jsx("div",{className:"flex gap-2 flex-wrap",children:t.jsxs("select",{className:"block w-full  px-1 md:py-2 py-1.5 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-lg",onChange:e=>Ge(e.target.value),value:L||"",children:[t.jsx("option",{hidden:!0,children:"Area"}),t.jsx("option",{value:"All",children:"All"}),re&&re.filter(e=>e.ward_name===z).map((e,a)=>t.jsx("option",{value:e.street_name,children:e.street_name},a))]})})]}),t.jsxs("div",{className:`bg-white  mx-4 rounded-lg mt-3 overflow-x-auto p-3 ${A.length<8?"h-4/5":"h-fit"}`,children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center md:gap-6 gap-2 md:mt-2 mx-3",children:[t.jsx("div",{className:"flex flex-wrap gap-3",children:t.jsx("p",{className:"md:text-lg text-sm whitespace-nowrap",children:"View Report"})}),t.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[t.jsx("div",{className:"flex gap-2 flex-wrap",children:t.jsxs("select",{className:"block w-full  px-1 md:py-2 py-1.5 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-lg",onChange:e=>We(e.target.value),value:$||"",children:[t.jsx("option",{hidden:!0,children:"Select Assign"}),t.jsx("option",{value:"All",children:"All"}),t.jsx("option",{value:"Yet to be Assigned",children:"Yet to be Assigned"}),ce&&ce.map((e,a)=>t.jsx("option",{value:e.user_name,children:e.user_name},a))]})}),t.jsx("div",{className:"flex gap-2 flex-wrap",children:t.jsxs("select",{className:"block w-full  px-1 md:py-2 py-1.5 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-lg",onChange:e=>He(e.target.value),value:H||"",children:[t.jsx("option",{hidden:!0,children:"Priority"}),t.jsx("option",{value:"All",children:"All"}),t.jsx("option",{value:"High",children:"High"}),t.jsx("option",{value:"Medium",children:"Medium"}),t.jsx("option",{value:"Low",children:"Low"})]})}),t.jsx("div",{className:"flex gap-2 flex-wrap",children:t.jsxs("select",{className:"block w-full  px-1 md:py-2 py-1.5 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-lg",onChange:e=>Ze(e.target.value),value:U||"",children:[t.jsx("option",{hidden:!0,children:"Status"}),t.jsx("option",{value:"All",children:"All"}),Q&&Q.map((e,a)=>t.jsx("option",{value:e.status_name,children:e.status_name},a))]})}),t.jsx("div",{className:"flex gap-2 flex-wrap",children:t.jsxs("select",{className:"block w-full  px-1 md:py-2 py-1.5 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-lg",onChange:e=>Oe(e.target.value),value:Z||"",children:[t.jsx("option",{hidden:!0,children:"Complaint Type"}),t.jsx("option",{value:"All",children:"All"}),X&&X.map((e,a)=>t.jsx("option",{value:e.complaint_type,children:e.complaint_type},a))]})})]})]}),t.jsx("div",{className:`bg-white  mx-4 rounded-lg mt-1 overflow-x-auto p-3 ${A.length<8?"h-4/5":"h-fit"}`,children:t.jsxs("table",{className:"w-full md:mt-1 ",children:[t.jsx("thead",{className:" border-b border-gray-300  ",children:t.jsxs("tr",{className:"",children:[t.jsx("th",{className:"",children:t.jsx("p",{className:" mx-6 my-2 font-lexend font-medium whitespace-nowrap",children:"#"})}),t.jsx("th",{children:t.jsx("p",{className:"mx-1.5 my-2 text-start font-lexend font-medium  whitespace-nowrap",children:"Complaint No"})}),t.jsx("th",{children:t.jsx("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:"Origin"})}),t.jsx("th",{children:t.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Complaint Type",t.jsx(x,{})]})}),t.jsx("th",{children:t.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Department",t.jsx(x,{})]})}),t.jsx("th",{children:t.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Complaint",t.jsx(x,{})]})}),t.jsx("th",{children:t.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Date and Time ",t.jsx(x,{})]})}),t.jsx("th",{children:t.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Raised by ",t.jsx(x,{})]})}),t.jsx("th",{children:t.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Zone ",t.jsx(x,{})]})}),t.jsx("th",{children:t.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Ward ",t.jsx(x,{})]})}),t.jsx("th",{children:t.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Street ",t.jsx(x,{})]})}),t.jsx("th",{children:t.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Assigned JE ",t.jsx(x,{})]})}),t.jsx("th",{children:t.jsxs("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:["Priority ",t.jsx(x,{})]})}),t.jsx("th",{children:t.jsxs("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:["Status ",t.jsx(x,{})]})})]})}),t.jsx("tbody",{children:Ye.map((e,a)=>t.jsxs("tr",{className:" border-b border-gray-300  ",children:[t.jsx("td",{className:"",children:t.jsx("div",{className:"text-center text-sm mx-3 my-2 font-lexend whitespace-nowrap",children:b+a+1<10?`0${b+a+1}`:b+a+1})}),t.jsx("td",{children:t.jsx("p",{className:"border-2 w-28 border-slate-900 rounded-lg text-center py-1 my-1  capitalize text-slate-900",onClick:()=>Ce(`/view3?grievanceId=${e.grievance_id}&deptName=${encodeURIComponent(e.dept_name)}`),children:e.grievance_id})}),t.jsx("td",{className:"flex gap-1 items-center justify-center text-gray-700",children:t.jsx("img",{src:je[e.grievance_mode]||et,alt:e.grievance_mode,className:"w-6 h-6 mx-1.5 my-2 rounded-full"})}),t.jsxs("td",{children:[" ",t.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:e.complaint_type_title})]}),t.jsxs("td",{children:[" ",t.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:e.dept_name})]}),t.jsxs("td",{children:[" ",t.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:e.complaint})]}),t.jsx("td",{children:t.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:tt(e.createdAt)})}),t.jsxs("td",{children:[" ",t.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:e.public_user_name})]}),t.jsxs("td",{children:[" ",t.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:e.zone_name})]}),t.jsxs("td",{children:[" ",t.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:e.ward_name})]}),t.jsxs("td",{children:[" ",t.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:e.street_name})]}),t.jsxs("td",{children:[" ",t.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:e.assign_username?e.assign_username:"Yet to be assigned"})]}),t.jsx("td",{children:t.jsx("p",{className:`border-2 w-26 rounded-full text-center py-1.5 mx-2 text-sm font-medium capitalize  ${e.priority==="High"?"text-red-500 border-red-500":e.priority==="Medium"?"text-sky-500 border-sky-500":e.priority==="Low"?"text-green-500 border-green-500":""}`,children:e.priority})}),t.jsx("td",{children:t.jsx("p",{className:"border-2 w-28 rounded-full text-center py-1 tex-sm font-normal mx-2 capitalize  ",style:{borderColor:oe[e.status]||"gray",color:oe[e.status]||"black",fontSize:14},children:e.status})})]},a))})]})})]}),t.jsx("div",{className:" my-3 mb-5 mx-7",children:t.jsx(rt,{Length:p.length,currentPage:S,totalPages:K,firstIndex:b,lastIndex:k,paginate:m,hasNextPage:k>=p.length})}),t.jsx("p",{className:"text-transparent",children:"transparent"})]})})};function jt({permissions:i}){const[v,_]=s.useState("tab1");return t.jsxs("div",{className:"overflow-auto no-scrollbar",children:[t.jsxs("ul",{className:"flex mb-2 list-none justify-center mt-1",children:[t.jsx("li",{className:"-mb-px mr-1",children:t.jsx("a",{className:`text-white   font-medium rounded-sm text-sm px-5 py-1.5 text-center  ${v==="tab1"?"bg-gray-700":"bg-gray-400"}`,onClick:()=>_("tab1"),children:"Current Grievances"})}),t.jsx("li",{className:"-mb-px mr-1",children:t.jsx("a",{className:`text-white   font-medium rounded-sm text-sm px-5 py-1.5 text-center ${v==="tab2"?"bg-gray-700":"bg-gray-400"}`,onClick:()=>_("tab2"),children:"Closed Grievances"})})]}),t.jsxs("div",{className:"mx-1 ",children:[v==="tab1"&&t.jsx(me,{permissions:i,include:"yes",endpoint:"bynotclosed"}),v==="tab2"&&t.jsx(me,{permissions:i,endpoint:"byclosed"})]})]})}export{jt as default};
