import{i as G,k as V,r as a,l as K,o as Q,b as p,A as u,d as D,j as e,B as U,u as he,F as pe,t as ue}from"./index-BtER-45x.js";import{R as w,P as ge}from"./Pagination-DzgA0zaw.js";const fe=G().shape({dept_name:V().test("not-select","Please select an Department",l=>l!==""&&l!=="Select  Department"),complaint:V().test("not-select","Please select an complaint",l=>l!==""&&l!=="Select  complaint")}),je=l=>{const{selectedRows:T,toggleTModal:o,handlerefresh:$}=l,i=sessionStorage.getItem("token"),[g,z]=a.useState([]),[N,v]=a.useState([]),[S,I]=a.useState([]),{register:f,formState:{errors:x},handleSubmit:r,watch:j}=K({resolver:Q(fe),mode:"all"});a.useEffect(()=>{d(),_()},[]);const d=async()=>{try{const s=await p.get(`${u}/department/getactive`,{headers:{Authorization:`Bearer ${i}`}}),c=D(s.data.data);z(c)}catch(s){console.error("Error fetching existing Department:",s)}},_=async()=>{try{const s=await p.get(`${u}/complaint/getactive`,{headers:{Authorization:`Bearer ${i}`}}),c=D(s.data.data);v(c)}catch(s){console.error("Error fetching existing Department:",s)}},A=s=>{if(s){const c=s.target.value,m=N==null?void 0:N.filter(y=>y.dept_name===c);I(m)}else setFilteredWards([])},k=async s=>{const c={grievanceIds:T,transferDetails:{...s}};try{const m=sessionStorage.getItem("token"),y=await p.post(`${u}/new-grievance/updatemanytransfer`,c,{headers:{Authorization:`Bearer ${m}`}});y.status===200?(U.success("Bulk-Ticket Transfer Successfull"),o(),$()):(console.error("Error in posting data",y),U.error("Failed to Upload"))}catch(m){console.error("Error in posting data",m)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white  h-fit  font-lexend m-2 rounded-sm w-[500px]",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-6",children:e.jsx("h1",{className:"text-xl font-medium pt-6 ",children:"Ticket Transfer"})}),e.jsx("form",{onSubmit:r(k),children:e.jsxs("div",{className:"  py-2 mx-6 my-3 gap-5 ",children:[e.jsxs("div",{className:"mb-3 flex items-baseline gap-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3 w-2/6",htmlFor:"dept_name",children:"Department"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-4/6 py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",...f("dept_name"),onChange:A,children:[e.jsx("option",{value:"",children:"Select Department"}),g.map(s=>e.jsx("option",{value:s.dept_name,children:s.dept_name},s.dept_id))]})]}),x.dept_name&&e.jsx("p",{className:"text-red-500 text-end text-sm mb-2 -mt-2",children:x.dept_name.message}),e.jsxs("div",{className:"mb-3 flex items-baseline gap-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3 w-2/6",htmlFor:"complaint",children:"Complaint Type"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-4/6 py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"complaint",...f("complaint"),children:[e.jsx("option",{value:"",children:"Select complaint"}),S.map(s=>e.jsx("option",{value:s.complaint_type_title,children:s.complaint_type_title},s.complaint_id))]})]}),x.complaint&&e.jsx("p",{className:"text-red-500 text-end text-sm mb-2 -mt-2",children:x.complaint.message}),e.jsxs("div",{className:"flex justify-end py-3 mx-10 my-3 gap-5",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:o,children:"Cancel"}),e.jsx("button",{className:"text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",children:"Transfer"})]})]})})]})})},ye=G().shape({assign_username:V().test("not-select","Please select an Assign User",l=>l!==""&&l!=="Select  Assign_user")}),be=l=>{const{selectedRows:T,toggleAModal:o,handlerefresh:$}=l,i=sessionStorage.getItem("token"),[g,z]=a.useState([]),{register:N,formState:{errors:v},handleSubmit:S,watch:I}=K({resolver:Q(ye),mode:"all"});a.useEffect(()=>{f()},[]);const f=async()=>{try{const r=sessionStorage.getItem("dept"),j=await p.get(`${u}/user/getbydept?dept_name=${r}`,{headers:{Authorization:`Bearer ${i}`}}),d=D(j.data.data);z(d)}catch(r){console.error(r)}},x=async r=>{const j=event.target.querySelector("select"),d=j.options[j.selectedIndex],_=d.getAttribute("data-user-id"),A=d.getAttribute("data-user-phone"),k={grievanceIds:T,assignUserDetails:{...r,assign_user:_,assign_userphone:A}};try{const s=await p.post(`${u}/new-grievance/updatemanyassign`,k,{headers:{Authorization:`Bearer ${i}`}});s.status===200?(U.success("Bulk-Assign Successfull"),o(),$()):(console.error("Error in posting data",s),U.error("Failed to Upload"))}catch(s){console.error("Error in posting data",s)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white  h-fit  font-lexend m-2 rounded-sm w-[500px]",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-6",children:e.jsx("h1",{className:"text-xl font-medium pt-6 ",children:"Assign User"})}),e.jsx("form",{onSubmit:S(x),children:e.jsxs("div",{className:"  py-2 mx-6 my-3 gap-5 ",children:[e.jsxs("div",{className:"mb-3 flex items-baseline gap-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3 w-2/6",htmlFor:"assign_username",children:"Assign_user"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-4/6 py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"assign_username",...N("assign_username"),children:[e.jsx("option",{value:"",children:"Select Assign_user"}),g&&g.map(r=>e.jsx("option",{value:r.user_name,"data-user-id":r.user_id,"data-user-phone":r.phone,"data-user-name":r.user_name,children:r.user_name},r.user_name))]})]}),v.assign_username&&e.jsx("p",{className:"text-red-500 text-end text-sm mb-2 -mt-2",children:v.assign_username.message}),e.jsxs("div",{className:"flex justify-end py-3 mx-10 my-3 gap-5",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:o,children:"Cancel"}),e.jsx("button",{className:"text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",children:"Assign"})]})]})})]})})},ve=()=>{const[l,T]=a.useState(""),[o,$]=a.useState(1),[i]=a.useState(8),[g,z]=a.useState(1),[N,v]=a.useState([]),[S,I]=a.useState([]),[f,x]=a.useState([]),[r,j]=a.useState([]),[d,_]=a.useState(!1),[A,k]=a.useState(!1),[s,c]=a.useState([]),m=sessionStorage.getItem("token"),y=sessionStorage.getItem("dept"),[q,X]=a.useState({}),Z=he(),[J,ee]=a.useState("All"),[F,L]=a.useState(null),[R,O]=a.useState(null),[M,Y]=a.useState(null);a.useEffect(()=>{H(),te(),se()},[l,o]);const H=()=>{p.get(`${u}/new-grievance/getbydept?dept_name=${y}`,{headers:{Authorization:`Bearer ${m}`}}).then(t=>{const n=D(t.data.data);x(n);const h=n.filter(me=>Object.values(me).some(xe=>xe.toString().toLowerCase().includes(l.toLowerCase())));z(Math.ceil(h.length/i));const b=o*i,C=b-i;v(h.slice(C,b))}).catch(t=>{console.error(t)})},te=async()=>{try{const t=await p.get(`${u}/status/get`,{headers:{Authorization:`Bearer ${m}`}}),n=D(t.data.data),h=n.reduce((b,C)=>(b[C.status_name]=C.color,b),{});I(n),X(h)}catch(t){console.error("Error fetching existing ActiveStatus:",t)}},se=async()=>{try{const t=await p.get(`${u}/user/getbydept?dept_name=${y}`,{headers:{Authorization:`Bearer ${m}`}}),n=D(t.data.data);j(n)}catch(t){sconsole.error("Error fetching existing ActiveStatus:",t)}},E=t=>{t>0&&t<=g&&$(t)},B=o*i,P=B-i,W=f.filter(t=>Object.values(t).some(n=>n.toString().toLowerCase().includes(l.toLowerCase()))),ae=t=>{ee(t),L(null),O(null),Y(null),E(1)},ne=t=>{L(t==="All"?null:t),E(1)},re=t=>{O(t==="All"?null:t),E(1)},le=t=>{Y(t==="All"?null:t),E(1)},ie=W.slice().reverse().filter(t=>{const n=J==="All"?!0:"",h=F===null?!0:t.status===F,b=R===null?!0:t.priority===R,C=M===null?!0:M==="Yet to be Assigned"?!t.assign_username:t.assign_username===M;return n&&h&&b&&C}).slice(P,B),ce=t=>{c(n=>n.includes(t)?n.filter(h=>h!==t):[...n,t])},oe=()=>{_(!d),c([])},de=()=>{k(!A),c([])};return e.jsxs(a.Fragment,{children:[e.jsx("div",{className:"overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"  font-lexend h-screen ",children:[e.jsxs("div",{className:"bg-white h-4/5 mx-3 rounded-lg mt-8  p-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center md:gap-6 gap-2 md:mt-2 mx-3",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsx("p",{className:"text-lg  whitespace-nowrap",children:"View Report"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("select",{className:"block w-full  px-1 py-2 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-md",onChange:t=>le(t.target.value),value:M||"",children:[e.jsx("option",{hidden:!0,children:"Select Assign"}),e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"Yet to be Assigned",children:"Yet to be Assigned"}),r&&r.map(t=>e.jsx("option",{value:t.user_name,children:t.user_name},t.user_name))]})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("select",{className:"block w-full  px-1 py-2 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-md",onChange:t=>re(t.target.value),value:R||"",children:[e.jsx("option",{hidden:!0,children:"Priority"}),e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"Low",children:"Low"})]})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("select",{className:"block w-full  px-1 py-2 text-center  text-sm bg-primary text-white  border border-none rounded-full  hover:border-gray-200 outline-none capitalize shadow-md",onChange:t=>ne(t.target.value),value:F||"",children:[e.jsx("option",{hidden:!0,children:"Status"}),e.jsx("option",{value:"All",children:"All"}),S&&S.map(t=>e.jsx("option",{value:t.status_name,children:t.status_name},t.status_name))]})}),e.jsx("button",{className:`w-20 py-1.5 shadow-md ${J==="All"?"bg-primary text-white":"bg-white text-black"} rounded-full`,onClick:()=>ae("All"),children:"All"})]})]}),e.jsxs("div",{className:"my-2 mx-3 flex flex-wrap gap-2 ",children:[e.jsx("button",{className:"bg-blue-300 shadow-md px-3 py-1 rounded-full text-white text-sm",onClick:()=>k(!0),children:"Multi-Assign"}),e.jsx("button",{className:"bg-blue-300 shadow-md px-3 py-1 rounded-full text-white text-sm",onClick:()=>_(!0),children:"Multi-Transfer"})]}),e.jsx("div",{className:" rounded-lg  py-3 overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full mt-1 ",children:[e.jsx("thead",{className:" border-b border-gray-300  ",children:e.jsxs("tr",{className:"",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-3 my-2 font-lexend text-center font-semibold whitespace-nowrap",children:e.jsx(pe,{className:"text-xl text-center text-primary"})})}),e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-3 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 text-start font-lexend font-medium  whitespace-nowrap",children:"Complaint No"})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Complaint",e.jsx(w,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Department",e.jsx(w,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Date and Time ",e.jsx(w,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Raised by ",e.jsx(w,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium  whitespace-nowrap",children:["Assigned JE ",e.jsx(w,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:["Priority ",e.jsx(w,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:["Status ",e.jsx(w,{})]})})]})}),e.jsx("tbody",{children:ie.map((t,n)=>e.jsxs("tr",{className:" border-b border-gray-300  ",children:[e.jsx("td",{className:"w-4 p-4 mt-2 flex gap-2 items-center",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-dark bg-gray-800 border-gray-800 rounded",checked:s.includes(t.grievance_id),onChange:()=>ce(t.grievance_id)}),e.jsx("label",{className:"sr-only",htmlFor:"checkbox-table-search-1",children:"checkbox"})]})}),e.jsx("td",{className:"",children:e.jsx("div",{className:"text-center text-sm mx-3 my-2 font-lexend whitespace-nowrap",children:P+n+1<10?`0${P+n+1}`:P+n+1})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 border-slate-900 rounded-lg text-center py-1 my-1  capitalize text-slate-900",onClick:()=>Z("/view2",{state:{grievanceId:t.grievance_id,deptName:t.dept_name}}),children:t.grievance_id})}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.complaint})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.dept_name})]}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:ue(t.createdAt)})}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.public_user_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.assign_username?t.assign_username:"Yet to be assigned"})]}),e.jsx("td",{children:e.jsx("p",{className:`border-2 w-26 rounded-full text-center py-1.5 mx-2 text-sm font-medium capitalize  ${t.priority==="High"?"text-red-500 border-red-500":t.priority==="Medium"?"text-sky-500 border-sky-500":t.priority==="Low"?"text-green-500 border-green-500":""}`,children:t.priority})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 rounded-full text-center py-1 tex-sm font-normal mx-2 capitalize  ",style:{borderColor:q[t.status]||"gray",color:q[t.status]||"black",fontSize:14},children:t.status})})]},n))})]})})]}),e.jsx("div",{className:" mt-4 mb-5 mx-7",children:e.jsx(ge,{Length:f.length,currentPage:o,totalPages:g,firstIndex:P,lastIndex:B,paginate:E,hasNextPage:B>=W.length})})]})}),d&&e.jsx(je,{toggleTModal:oe,selectedRows:s,handlerefresh:H}),A&&e.jsx(be,{toggleAModal:de,selectedRows:s,handlerefresh:H})]})};export{ve as default};
