import{i as V,k as H,r as l,J,u as G,l as O,j as e,t as Z,o as K,b as c,A as n,d as g,B as m}from"./index-BcYsGqVu.js";import{V as Q}from"./ViewAttachment-CXH7DCbj.js";const X=V().shape({worksheet_name:H().required("worksheet is required")}),ne=()=>{var z;const[s,L]=l.useState(null),[y,C]=l.useState(null),[f,F]=l.useState([]),[w,T]=l.useState([]),[Y,u]=l.useState(!0),[ee,j]=l.useState(null),o=(z=J().state)==null?void 0:z.grievanceId,d=sessionStorage.getItem("token"),[b,_]=l.useState(!1),[B,S]=l.useState(null),[D,I]=l.useState([]),[N,k]=l.useState([]),$=G(),{register:E,formState:{errors:ae},handleSubmit:q,reset:te,setValue:re,watch:v}=O({resolver:K(X),mode:"onBlur"});l.useEffect(()=>{const a=async()=>{try{const t=await c.get(`${n}/new-grievance/getbyid?grievance_id=${o}`,{headers:{Authorization:`Bearer ${d}`}}),i=g(t.data.data);L(i);const x=await c.get(`${n}/new-grievance/filter?zone_name=${i.zone_name}&ward_name=${i.ward_name}&street_name=${i.street_name}&dept_name=${i.dept_name}&complaint=${i.complaint}`,{headers:{Authorization:`Bearer ${d}`}}),W=g(x.data.data).filter(U=>U.grievance_id!==o);T(W)}catch(t){j(t)}finally{u(!1)}},r=async()=>{try{const t=await c.get(`${n}/status/getactive`,{headers:{Authorization:`Bearer ${d}`}}),i=g(t.data.data);F(i)}catch(t){j(t)}finally{u(!1)}},p=async()=>{try{const t=await c.get(`${n}/new-grievance-attachment/getattachments?grievance_id=${o}`,{headers:{Authorization:`Bearer ${d}`}}),i=g(t.data.data);C(i)}catch(t){j(t)}finally{u(!1)}},h=async()=>{try{const t=await c.get(`${n}/grievance-log/getbyid?grievance_id=${o}`,{headers:{Authorization:`Bearer ${d}`}}),i=g(t.data.data);I(i)}catch(t){j(t)}finally{u(!1)}};a(),r(),p(),h()},[]);const M=()=>{_(!b),S(null)},P=async a=>{if(a.toLowerCase()==="closed"&&!v("worksheet_name")){m.error("Please fill out the worksheet form before closing the request");return}const r={status:a};a.toLowerCase()!=="closed"&&(r.worksheet_name=v("worksheet_name"));try{const p=await c.post(`${n}/new-grievance/updatestatus?grievance_id=${o}`,r,{headers:{Authorization:`Bearer ${d}`}});if(p.status===200){m.success("Status Updated Successfully");const h=await c.post(`${n}/grievance-log/post`,{grievance_id:o,log_details:` Assigned work is ${a}`,created_by_user:sessionStorage.getItem("name")},{headers:{Authorization:`Bearer ${d}`}});if(a.toLowerCase()==="closed"){A({worksheet_name:v("worksheet_name")});return}$("/requestview3")}else console.error("Error in posting data",p),m.error("Failed to Upload")}catch(p){console.error("Error in posting data",p)}},R=a=>{const r=a.target.files;r.length>5?(m.error("Maximum 5 files allowed"),a.target.value=null):k(r)},A=async a=>{const r=a.worksheet_name,p={...a,grievance_id:o,created_by_user:sessionStorage.getItem("name")};try{if((await c.post(`${n}/grievance-worksheet/post`,p,{headers:{Authorization:`Bearer ${d}`}})).status===200){m.success("Wroksheet Uploaded Successfully");const t=await c.post(`${n}/grievance-log/post`,{grievance_id:o,log_details:` WorkSheet given by ${sessionStorage.getItem("name")}: ${r}`,created_by_user:sessionStorage.getItem("name")},{headers:{Authorization:`Bearer ${d}`}})}if(N.length>0)if(N.length>5)m.error("File limit exceeded. Maximum 5 files allowed.");else try{const t=new FormData;for(let x=0;x<N.length;x++)t.append("files",N[x]);t.append("grievance_id",o),t.append("created_by_user","admin"),(await c.post(`${n}/grievance-worksheet-attachment/post`,t,{headers:{"Content-Type":"multipart/form-data"}})).status===200&&(k([]),m.success("Attachment Uploaded Successfully"))}catch(t){console.error(t),m.error("Error creating attachment")}$("/requestview3")}catch(h){console.log(h),m.error("An error occurred during submission. Please try again.")}};return e.jsxs(l.Fragment,{children:[e.jsx("div",{className:"h-screen overflow-y-auto no-scrollbar",children:s&&s.grievance_id&&e.jsxs("div",{className:"md:mx-6 mx-2  my-5 font-lexend",children:[e.jsxs("p",{children:["Complaint Details #",s.grievance_id]}),e.jsxs("div",{className:"bg-white mt-2 pb-3",children:[e.jsx("p",{className:"px-5 py-2 text-lg",children:"Request By :"}),e.jsxs("div",{className:"flex justify-between gap-3 mx-3 my-3",children:[e.jsxs("div",{className:"col-span-4 px-5 pb-3",children:[e.jsx("p",{className:"capitalize",children:s.public_user_name}),e.jsxs("p",{children:["+91 ",s.phone]})," "]}),e.jsxs("div",{className:"flex flex-col mx-3",children:[e.jsxs("div",{className:"flex gap-3 mb-3 items-center",children:[e.jsx("p",{children:"Status: "}),s.status&&s.status.toLowerCase()==="closed"?e.jsx("span",{className:"text-sm border-2 border-gray-500 w-28 text-center py-1.5 ml-3 rounded-full",children:"Closed"}):e.jsx("span",{className:"text-sm border-2 border-gray-500 px-3 py-0.5 rounded-full",children:e.jsxs("select",{className:"col-span-2 block px-1 py-1 text-sm text-black border rounded-lg border-none outline-none capitalize",onChange:a=>P(a.target.value),children:[e.jsx("option",{value:s.status,hidden:!0,children:s.status}),f&&f.map(a=>e.jsx("option",{value:a.status_name,disabled:a.status_name.toLowerCase()==="closed"&&!v("worksheet_name"),children:a.status_name},a.status_name))]})})]}),e.jsxs("div",{className:"flex gap-3 items-center ",children:[e.jsx("p",{children:"Priority: "}),e.jsx("span",{className:`border w-28 rounded-full text-center py-1.5 mx-2 text-sm font-normal capitalize text-white  ${s.priority==="High"?"bg-red-500":s.priority==="Medium"?"bg-sky-500":s.priority==="Low"?"bg-green-500":""}`,children:s.priority})]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 mx-3 my-4",children:[e.jsxs("div",{className:"md:col-span-6 col-span-12 border px-2 py-3 rounded",children:[e.jsx("p",{className:"pt-2 text-lg",children:"Grievance Details"}),e.jsx("hr",{className:"my-3"}),e.jsxs("div",{className:"flex flex-col gap-3 mx-2 text-base",children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Origin "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.grievance_mode]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Complaint Type "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.complaint_type_title]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Department "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.dept_name]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Complaint "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.complaint]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Zone "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.zone_name]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Ward "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.ward_name]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Street "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.street_name]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Pincode "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.pincode]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Description: "}),e.jsx("p",{className:"col-start-1 col-span-4 mt-2 capitalize",children:s.complaint_details})]}),y&&y.length>0&&e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Attachment Files "}),e.jsx("div",{className:"col-start-1 col-span-4 mt-2 text-xs  ",children:y.map((a,r)=>e.jsx("button",{className:" mx-1 my-1 px-3 py-1.5 bg-gray-500 rounded-full text-white",onClick:()=>{_(!0),S(a.attachment)},children:`Attachment ${r+1}`},r))})]})]})]}),e.jsxs("div",{className:"md:col-span-6 col-span-12 border px-1 py-3 rounded ",children:[e.jsx("p",{className:"pt-2 text-lg ",children:"Similar Request"}),e.jsx("hr",{className:"my-3 w-full"}),e.jsx("div",{className:"overflow-auto no-scrollbar",children:e.jsxs("table",{className:"w-full bg-gray-200 rounded  ",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"items-center mx-3 py-2 font-lexend whitespace-nowrap",children:"Date/Time"}),e.jsx("th",{className:"items-center mx-3 py-2 font-lexend whitespace-nowrap",children:"Complaint No"}),e.jsx("th",{className:"items-center mx-3 py-2 font-lexend whitespace-nowrap",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-300",children:w&&w.length>0?w.map((a,r)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"text-center mx-3 py-2.5 whitespace-nowrap",children:Z(a.createdAt)}),e.jsx("td",{className:"text-center mx-3 py-2.5 whitespace-nowrap",children:a.grievance_id}),e.jsx("td",{className:"text-center mx-3 py-2.5 text-green-600 whitespace-nowrap capitalize",children:a.status})]},r)):e.jsx("tr",{children:e.jsx("td",{className:"text-center py-2.5",colSpan:"3",children:"No matching data found"})})})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 mx-3 my-3",children:[e.jsxs("div",{className:"md:col-span-6 col-span-12 border px-2 py-3 rounded mt-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"mx-3",children:"Replay"}),e.jsxs("select",{className:" block px-4 py-3 text-sm text-black border rounded-lg  outline-none",children:[e.jsx("option",{hidden:!0,children:"LAN"}),e.jsx("option",{value:"Tamil",children:"TA - EN"}),e.jsx("option",{value:"English",children:"EN - TA"})]})]}),e.jsx("hr",{className:"my-3 w-full"}),e.jsxs("form",{onSubmit:q(A),children:[e.jsx("textarea",{id:"worksheet_id",rows:"11",className:" w-full col-span-6 outline-none",placeholder:"Type....",...E("worksheet_name")}),e.jsxs("div",{className:" md:mt-12",children:[e.jsx("input",{type:"file",id:"file",multiple:!0,className:" py-2 px-3   outline-none",onChange:R}),e.jsx("div",{className:"flex justify-end mx-3 mt-3",children:e.jsx("button",{type:"submit",className:" text-white bg-gray-800 text-sm font-lexend rounded-full px-3 py-1.5 ",children:"submit"})})]})]})]}),e.jsxs("div",{className:"md:col-span-6 col-span-12",children:[e.jsx("p",{className:"mb-2 mx-1 text-lg",children:"Complaint History"}),e.jsx("div",{className:"bg-gray-100 py-3 h-[530px]",children:e.jsxs("div",{className:"mx-8 ",children:[e.jsxs("p",{className:"py-3 font-semibold",children:["Complaint No ",s.grievance_id]}),e.jsxs("div",{className:"h-[280px]  overflow-x-auto no-scrollbar mb-3",children:[D&&D.slice().reverse().map((a,r)=>e.jsxs("div",{children:[e.jsx("p",{className:"py-1",children:new Date(a.createdAt).toLocaleDateString()}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsx("p",{children:new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("p",{className:"pl-5 col-span-2",children:a.log_details})]}),e.jsx("br",{})]},r)),e.jsx("p",{className:"py-2",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsx("p",{children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsxs("p",{className:"pl-5 col-span-2",children:[" ","Assigned To Particular Department"]})]}),e.jsx("br",{}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsx("p",{children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsxs("p",{className:"pl-5 col-span-2",children:["Ticket Raised- ",s.grievance_id]})]}),e.jsx("br",{}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsx("p",{children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("p",{className:"pl-5 col-span-2",children:"Logged In"})]})]}),e.jsx("p",{className:"mb-2",children:"Work StatusFlow :"}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsxs("p",{children:[e.jsx("span",{className:"block",children:new Date(s.updatedAt).toLocaleDateString()}),new Date(s.updatedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"pl-5",children:"Status:"}),e.jsx("p",{className:"pl-5 text-gray-500",children:s.statusflow.split("/").join(" / ").replace(/(?: \/ ){5}/g,` / 
`)})]})]}),e.jsx("hr",{className:"my-3"}),e.jsxs("div",{className:"md:grid md:grid-cols-3 flex border-2 ",children:[e.jsx("p",{className:"text-center px-3 py-1.5",children:"Status"}),e.jsx("p",{className:"text-center w-full bg-gray-800 md:col-span-2 text-white py-1.5",children:s.status})]})]})})]})]})]})]})}),b&&e.jsx(Q,{toggleModal:M,attachmentFile:B})]})};export{ne as default};
