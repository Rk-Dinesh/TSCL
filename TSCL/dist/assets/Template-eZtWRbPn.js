import{i as O,k as j,l as V,r as l,m as R,o as U,n as H,p as G,b as w,A as _,d as E,j as e,B as g,t as de,q as ie,s as me}from"./index-Cb3AN3R3.js";import{R as C}from"./index-C-hq6bKM.js";import{D as pe}from"./DeleteModal-De28Bu6M.js";import{P as xe}from"./Pagination-ClPqWgoN.js";import{S as he}from"./SearchHeader-Cu036AJA.js";import{S as J}from"./SavaCancel-CuKZ8TfL.js";import"./index-Du0g9a49.js";import"./index-BK6gNoz8.js";const ue=O().shape({temp_title:j().required("Template title is required"),dept_name:j().test("not-select","Please select an Department",t=>t!==""&&t!=="Select  Department"),complaint_type:j().test("not-select","Please select an Complaint Type",t=>t!==""&&t!=="Select  Complaint Type"),desc:j().required("Description is required")}),fe=t=>{const y=V(),[b,N]=l.useState([]),[S,p]=l.useState(!1),x=localStorage.getItem("token"),{register:h,formState:{errors:c},handleSubmit:d,watch:D,setValue:v}=R({resolver:U(ue),mode:"all"}),i=D("dept_name");l.useEffect(()=>{y(H())},[y]);const u=G(o=>o.department);l.useEffect(()=>{i?w.get(`${_}/complaint/getdept?dept_name=${i}`,{headers:{Authorization:`Bearer ${x}`}}).then(o=>{try{const a=E(o.data.data);N(a),v("complaint_type","")}catch(a){console.error("Error decrypting data:",a)}}).catch(o=>{console.error("Error fetching data:",o)}):N([])},[i]);const f=async o=>{const a={...o,created_by_user:localStorage.getItem("name")};try{p(!0);const r=await w.post(`${_}/template/post`,a,{headers:{Authorization:`Bearer ${x}`}});r.status===200?(g.success(" created Successfully"),p(!1),t.toggleModal(),t.handlerefresh()):(console.error("Error in posting data",r),p(!1),g.error("Failed to Upload"))}catch(r){console.error("Error in posting data",r),p(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px]   font-lexend p-3",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-6",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Add Template"})}),e.jsxs("form",{onSubmit:d(f),className:"mx-6 pb-3",children:[e.jsxs("div",{className:" my-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"complaint_type",children:"Template Title"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"temp_title",type:"text",placeholder:"Template Title",...h("temp_title")}),c.temp_title&&e.jsx("p",{className:"text-red-500",children:c.temp_title.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"dept_name",children:"Department"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",...h("dept_name"),children:[e.jsx("option",{value:"",children:"Select Departmnet"}),u.data&&u.data.map((o,a)=>e.jsx("option",{value:o.dept_name,children:o.dept_name},a))]}),c.dept_name&&e.jsx("p",{className:"text-red-500",children:c.dept_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"complaint_type",children:"Complaint Type"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"complaint_type",...h("complaint_type"),children:[e.jsx("option",{value:"",children:"Select Complaint Type"}),b&&b.map((o,a)=>e.jsx("option",{value:o.complaint_type_title,children:o.complaint_type_title},a))]}),c.dept_name&&e.jsx("p",{className:"text-red-500",children:c.dept_name.message})]}),e.jsxs("div",{className:" my-2",children:[e.jsx("label",{className:"block text-gray-900 text-base  font-normal mb-1 ",htmlFor:"desc",children:"Description"}),e.jsx("textarea",{id:"desc",rows:"5",className:"block py-2.5 pl-3 w-full text-sm text-gray-900 rounded border outline-none focus:outline-none focus:shadow-outline mb-2",placeholder:"Description here...",...h("desc")}),c.desc&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2",children:c.desc.message})]}),e.jsx(J,{onCancel:t.toggleModal,isLoading:S})]})]})})},ge=O().shape({temp_title:j().required("Template title is required"),dept_name:j().test("not-select","Please select a Department",t=>t&&t!=="Select Department"),complaint_type:j().test("not-select","Please select a Complaint Type",t=>t&&t!=="Select Complaint Type"),desc:j().required("Description is required")}),je=t=>{const y=V(),[b,N]=l.useState([]),[S,p]=l.useState(!1),x=localStorage.getItem("token"),{tempId:h}=t,{register:c,formState:{errors:d},handleSubmit:D,watch:v,setValue:i}=R({resolver:U(ge),mode:"all"}),u=v("dept_name");l.useEffect(()=>{(async()=>{try{const r=await w.get(`${_}/template/getbyid?temp_id=${h}`,{headers:{Authorization:`Bearer ${x}`}}),n=E(r.data.data);i("temp_title",n.temp_title),i("dept_name",n.dept_name),i("complaint_type",n.complaint_type),i("desc",n.desc)}catch(r){console.error("Error fetching data",r),g.error("Failed to fetch template data")}})()},[h,i,x]),l.useEffect(()=>{y(H())},[y]);const f=G(a=>a.department);l.useEffect(()=>{u?(async()=>{try{const r=await w.get(`${_}/complaint/getdept?dept_name=${u}`,{headers:{Authorization:`Bearer ${x}`}}),n=E(r.data.data);N(n),i("complaint_type","")}catch(r){console.error("Error fetching complaints",r),g.error("Failed to fetch complaint types")}})():N([])},[u,i,x]);const o=async a=>{const r={...a};try{p(!0);const n=await w.post(`${_}/template/update?temp_id=${h}`,r,{headers:{Authorization:`Bearer ${x}`}});n.status===200?(g.success("Updated Successfully"),p(!1),t.toggleModal(),t.handlerefresh()):(console.error("Error in posting data",n),p(!1),g.error("Failed to update template"))}catch(n){console.error("Error in posting data",n),p(!1),g.error("Failed to update template")}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] font-lexend p-3",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-6",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Template"})}),e.jsxs("form",{onSubmit:D(o),className:"mx-6 pb-3",children:[e.jsxs("div",{className:"my-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"temp_title",children:"Template Title"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"temp_title",type:"text",placeholder:"Template Title",...c("temp_title")}),d.temp_title&&e.jsx("p",{className:"text-red-500",children:d.temp_title.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"dept_name",children:"Department"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",...c("dept_name"),children:[e.jsx("option",{value:"",children:"Select Department"}),f.data&&f.data.map((a,r)=>e.jsx("option",{value:a.dept_name,children:a.dept_name},r))]}),d.dept_name&&e.jsx("p",{className:"text-red-500",children:d.dept_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"complaint_type",children:"Complaint Type"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"complaint_type",...c("complaint_type"),children:[e.jsx("option",{value:"",children:"Select Complaint Type"}),b&&b.map((a,r)=>e.jsx("option",{value:a.complaint_type_title,children:a.complaint_type_title},r))]}),d.complaint_type&&e.jsx("p",{className:"text-red-500",children:d.complaint_type.message})]}),e.jsxs("div",{className:"my-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-1",htmlFor:"desc",children:"Description"}),e.jsx("textarea",{id:"desc",rows:"5",className:"block py-2.5 pl-3 w-full text-sm text-gray-900 rounded border outline-none focus:outline-none focus:shadow-outline mb-2",placeholder:"Description here...",...c("desc")}),d.desc&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2",children:d.desc.message})]}),e.jsx(J,{onCancel:t.toggleModal,isLoading:S})]})]})})},Ce=({permissions:t})=>{const y=t==null?void 0:t.includes("create"),b=t==null?void 0:t.includes("edit"),N=t==null?void 0:t.includes("delete"),[S,p]=l.useState(!1),[x,h]=l.useState(!1),[c,d]=l.useState(null),[D,v]=l.useState(!1),[i,u]=l.useState(null),[f,o]=l.useState(""),[a,r]=l.useState(1),[n,K]=l.useState(10),[F,Q]=l.useState(1),[ye,W]=l.useState([]),[I,X]=l.useState([]),[M,Y]=l.useState(null),A=localStorage.getItem("token"),$=s=>{Y(M===s?null:s)},Z=s=>M===s;l.useEffect(()=>{k()},[f,a,n]);const ee=s=>{s>0&&s<=F&&r(s)},k=()=>{w.get(`${_}/template/get`,{headers:{Authorization:`Bearer ${A}`}}).then(s=>{const m=E(s.data.data);X(m);const q=m.filter(oe=>Object.values(oe).some(ce=>ce.toString().toLowerCase().includes(f.toLowerCase())));Q(Math.ceil(q.length/n));const B=a*n,ne=B-n;W(q.slice(ne,B))}).catch(s=>{console.error(s)})},te=()=>{p(!S)},ae=()=>{h(!x),d(null)},z=()=>{v(!D),u(null)},P=a*n,T=P-n,L=I.filter(s=>Object.values(s).some(m=>m.toString().toLowerCase().includes(f.toLowerCase()))),se=L.slice().reverse().slice(T,P),le=async()=>{try{await w.delete(`${_}/template/delete?temp_id=${i}`,{headers:{Authorization:`Bearer ${A}`}}),z(),k(),g.success("Deleted successfully")}catch{g.error("Failed to delete")}},re=s=>{const m=parseInt(s.target.value,10);K(m),r(1)};return e.jsxs(l.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen mt-10",children:[e.jsx(he,{title:"Template",hasCreatePermission:y,onClick:()=>p(!0),searchValue:f,setSearchValue:o}),e.jsxs("div",{className:`bg-white  mx-4 rounded-lg overflow-x-auto mt-1  p-3 ${I.length<6?"h-3/5":"h-fit"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mx-3",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-medium text-gray-600",children:"Page Entries"}),e.jsxs("select",{id:"itemsPerPage",value:n,onChange:re,className:" p-1 outline-none text-sm rounded px-2",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]}),e.jsx("div",{className:"overflow-x-auto  ",children:e.jsxs("table",{className:"w-full  mt-1",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font- whitespace-nowrap",children:["Template Title",e.jsx(C,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font- whitespace-nowrap",children:["Department",e.jsx(C,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Complaint Type ",e.jsx(C,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Desc ",e.jsx(C,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Date & Time ",e.jsx(C,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 font-semibold font-lexend whitespace-nowrap text-center",children:"Action"})})]})}),e.jsx("tbody",{children:se.map((s,m)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("p",{className:" mx-3 my-2 font-lexend text-center whitespace-nowrap text-sm text-gray-700",children:T+m+1<10?`0${T+m+1}`:T+m+1})}),e.jsx("td",{children:e.jsx("p",{className:"mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm capitalize text-gray-700",children:s.temp_title})}),e.jsx("td",{children:e.jsx("p",{className:"mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm capitalize text-gray-700",children:s.dept_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:s.complaint_type})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend truncate text-sm capitalize text-gray-700",children:de(s.desc,5)})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:ie(s.createdAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(me,{onClick:()=>$(m)}),Z(m)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[b&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{h(!0),d(s.temp_id),$()},children:"Edit"}),N&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{v(!0),u(s.temp_id),$()},children:"Delete"})]})]})})]},m))})]})})]}),e.jsx("div",{className:" my-3 mb-5 mx-7",children:e.jsx(xe,{Length:I.length,currentPage:a,totalPages:F,firstIndex:T,lastIndex:P,paginate:ee,hasNextPage:P>=L.length})})]})}),S&&e.jsx(fe,{toggleModal:te,handlerefresh:k}),x&&e.jsx(je,{toggleModal:ae,handlerefresh:k,tempId:c}),D&&e.jsx(pe,{toggleDeleteModal:z,delete:le})]})};export{Ce as default};
