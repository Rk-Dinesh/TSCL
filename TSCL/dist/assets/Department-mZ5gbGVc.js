import{i as W,k as B,r as n,m as X,o as ee,j as e,b as C,B as E,d as z,w as Ee,q as Q,s as Se,v as Pe}from"./index-Cb3AN3R3.js";import{R as I}from"./index-C-hq6bKM.js";import{S as te}from"./SavaCancel-CuKZ8TfL.js";import{A as f}from"./ApiClient-w4qWO__2.js";import{D as Te}from"./DeleteModal-De28Bu6M.js";import{S as Ce,D as Ie,E as Oe}from"./DocumentDownload-A0b-q8L_.js";import{B as Ae}from"./BulkUploadButton-C25cRLG1.js";import{P as ke}from"./Pagination-ClPqWgoN.js";import{F as Me}from"./FileUploadButton-DWkzr3As.js";import{H as Fe}from"./HeaderButton-By5upfsz.js";import"./index-Du0g9a49.js";import"./index-CmROlnnr.js";import"./index-BK6gNoz8.js";const Be=W().shape({org_name:B().test("not-select","Please select an Organization",a=>a!==""&&a!=="Select  Organization"),dept_name:B().required("Department is required")}),Re=({ExistingOrganiZations:a,toggleModal:N,handlerefresh:O})=>{const[S,R]=n.useState(null),[p,m]=n.useState(null),[D,j]=n.useState(!1),{register:h,formState:{errors:x},handleSubmit:u,watch:A}=X({resolver:ee(Be),mode:"all"});n.useEffect(()=>{if(p){const c=a.find(g=>g.org_name===p);c&&R(c.org_id)}},[p,a]);const _=async c=>{const g={...c,org_id:S,status:"active",created_by_user:localStorage.getItem("name")};try{j(!0);const r=await C.post(f.POST_DEPARTMENT.url,g,{headers:f.POST_DEPARTMENT.headers});r.status===200?(E.success("Department created Successfully"),j(!1),N(),O()):(console.error("Error in posting data",r),j(!1),E.error("Failed to Upload"))}catch(r){console.error("Error in posting data",r),j(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px] font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Department"})}),e.jsxs("form",{onSubmit:u(_),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"org_name",children:"Organization Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",...h("org_name"),onChange:c=>m(c.target.value),children:[e.jsx("option",{value:"",children:"Select Organization"}),a.map((c,g)=>e.jsx("option",{value:c.org_name,children:c.org_name},g))]}),x.org_name&&e.jsx("p",{className:"text-red-500",children:x.org_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"dept_name",children:"Department Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",type:"text",placeholder:"Department Name",...h("dept_name")}),x.dept_name&&e.jsx("p",{className:"text-red-500",children:x.dept_name.message})]})]}),e.jsx(te,{onCancel:N,isLoading:D})]})]})})},Ue=W().shape({org_name:B().test("not-select","Please select an Organization",a=>a!==""&&a!=="Select  Organization"),dept_name:B().required("Department is required"),status:B().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Le=({ExistingOrganiZations:a,toggleModal:N,handlerefresh:O,deptId:S})=>{const[R,p]=n.useState(null),[m,D]=n.useState(null),[j,h]=n.useState(!1),{register:x,formState:{errors:u},handleSubmit:A,setValue:_,watch:c}=X({resolver:ee(Ue),mode:"all"});n.useEffect(()=>{(async()=>{try{const l=f.FETCH_DEPARTMENT(S),w=await C.get(l.url,{headers:l.headers}),d=z(w.data.data);_("org_name",d.org_name),D(d.org_name),_("dept_name",d.dept_name),_("status",d.status)}catch(l){console.error("Error fetching data",l)}})()},[S,_]),n.useEffect(()=>{if(m){const r=a.find(l=>l.org_name===m);r&&p(r.org_id)}},[m,a]);const g=async r=>{const l={...r};try{h(!0);const w=f.UPDATE_DEPARTMENT(S),d=await C.post(w.url,l,{headers:w.headers});d.status===200?(E.success("Department Updated Successfully"),h(!1),D(null),p(null),N(),O()):(console.error("Error in posting data",d),h(!1),E.error("Failed to Upload"))}catch(w){console.error("Error in posting data",w),h(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px] font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Department"})}),e.jsxs("form",{onSubmit:A(g),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"org_name",children:"Organization Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",...x("org_name"),onChange:r=>D(r.target.value),children:[e.jsx("option",{value:m,disabled:!0,children:m}),a.map((r,l)=>e.jsx("option",{value:r.org_name,children:r.org_name},l))]}),u.org_name&&e.jsx("p",{className:"text-red-500",children:u.org_name.message})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"dept_name",children:"Department Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",type:"text",placeholder:"Department Name",...x("dept_name")}),u.dept_name&&e.jsx("p",{className:"text-red-500",children:u.dept_name.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...x("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),u.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:u.status.message})]})]}),e.jsx(te,{onCancel:N,isLoading:j})]})]})})},ze=`dept_name,org_name,status,created_by_user
Department,Organization,active,admin`,st=({permissions:a})=>{const N=a==null?void 0:a.includes("create"),O=a==null?void 0:a.includes("edit"),S=a==null?void 0:a.includes("delete"),R=a==null?void 0:a.includes("download"),[p,m]=n.useState(!1),[D,j]=n.useState(!1),[h,x]=n.useState(!1),[u,A]=n.useState(null),[_,c]=n.useState(null),[g,r]=n.useState(null),[l,w]=n.useState(""),[d,V]=n.useState(1),[P,ae]=n.useState(10),[G,se]=n.useState(1),[Ve,ne]=n.useState([]),[b,$]=n.useState([]),[q,re]=n.useState(null),[le,H]=n.useState(null),[Y,Z]=n.useState("Bulk Upload"),[oe,ce]=n.useState(null),L=t=>{re(q===t?null:t)},de=t=>q===t;n.useEffect(()=>{k(),pe()},[l,d,P]);const ie=t=>{t>0&&t<=G&&V(t)},k=()=>{C.get(f.GET_DEPARTMENT.url,{headers:f.GET_DEPARTMENT.headers}).then(t=>{const s=z(t.data.data);$(s);const v=s.filter(o=>Object.values(o).some(i=>i.toString().toLowerCase().includes(l.toLowerCase())));se(Math.ceil(v.length/P));const y=d*P,T=y-P;ne(v.slice(T,y))})},me=()=>{m(!p)},xe=()=>{j(!D),c(null)},ue=()=>{m(!p)},J=()=>{x(!h),A(null)},pe=async()=>{try{const t=await C.get(f.GET_ORGANIZATIONACTIVE.url,{headers:f.GET_ORGANIZATIONACTIVE.headers}),s=z(t.data.data);r(s)}catch(t){console.error("Error fetching existing Organisations:",t)}},U=d*P,M=U-P,K=b.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(l.toLowerCase()))),he=K.slice().reverse().slice(M,U),ge=async()=>{try{const t=f.DELETE_DEPARTMENT(u);await C.delete(t.url,{headers:t.headers}),J(),k(),$(b.filter(s=>b.dept_id!==u)),E.success("Deleted successfully")}catch{E.error("Failed to delete")}},fe=t=>{H(t.target.files[0]),Z("Upload")},je=()=>{Y==="Bulk Upload"?document.getElementById("fileInput").click():be(le)},be=async t=>{try{const s=new FormData;s.append("file",t),(await C.post(f.CSV_DEPARTMENT.url,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(Z("Bulk Upload"),H(null),k(),E.success("Data Uploaded Successfully")):E.error("Data failed to Upload")}catch(s){console.log(s)}},ye=t=>{ce(t.target.value)},Ne=async t=>{if(t==="csv"){const s=b.map(i=>({dept_id:i.dept_id,dept_name:i.dept_name,org_name:i.org_name,status:i.status,created_by_user:i.created_by_user})),v=[Object.keys(s[0]).join(","),...s.map(i=>Object.values(i).join(","))].join(`
`),y=new Blob([v],{type:"text/csv;charset=utf-8;"}),T=window.URL.createObjectURL(y),o=document.createElement("a");o.setAttribute("href",T),o.setAttribute("download","Department_data.csv"),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}else if(t==="pdf")try{const v=Math.ceil(b.length/30),y=new Oe("l","mm","a4");let T=0;for(let o=1;o<=v;o++){const i=(o-1)*30,we=Math.min(i+30,b.length),ve=b.slice(i,we).map(F=>[F.dept_id,F.dept_name,F.org_name,F.status,F.created_by_user]);y.text(`Page ${o}`,10,T+10),y.autoTable({startY:T+15,head:[["DeptId","DeptName","OrgName","Status","createdBy"]],body:ve,theme:"striped"}),o<v&&(y.addPage(),T=10)}y.save("Department_data.pdf")}catch(s){console.error("Error exporting data:",s)}},De=()=>{Pe(ze)},_e=t=>{const s=parseInt(t.target.value,10);ae(s),V(1)};return e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-1 mx-8 flex-wrap",children:[e.jsx(Ce,{value:l,onChange:t=>w(t.target.value),placeholder:"Search Department"}),N&&e.jsx(Me,{onChange:fe,buttonText:Y,accept:".csv",onClick:je}),R&&e.jsx(Ie,{selectedDoc:oe,onChange:ye,exportData:Ne})]}),e.jsx(Fe,{title:"Department",hasCreatePermission:N,onClick:()=>m(!0)}),e.jsxs("div",{className:`bg-white  mx-4 rounded-lg mt-1  p-3 overflow-y-auto ${b.length<5?"h-3/5":"h-fit"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mx-3",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-medium text-gray-600",children:"Page Entries"}),e.jsxs("select",{id:"itemsPerPage",value:P,onChange:_e,className:" p-1 outline-none text-sm rounded px-2",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]}),e.jsxs("table",{className:"w-full  mt-1",children:[e.jsx("thead",{className:"",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-3 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Department Name ",e.jsx(I,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Org Name ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold  whitespace-nowrap",children:["Status ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedBy ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedAt ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Last UpdatedAt ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-semibold font-lexend  whitespace-nowrap",children:"Action"})})]})}),e.jsx("tbody",{children:he.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-800",children:M+s+1<10?`0${M+s+1}`:M+s+1})}),e.jsx("td",{children:e.jsxs("div",{className:"flex  gap-2 items-center justify-start mx-5 my-3  text-sm text-gray-800",children:[e.jsx("img",{src:Ee,alt:"logo",className:"w-8 h-8"}),e.jsxs("p",{className:"font-lexend whitespace-nowrap capitalize   text-gray-800",children:[" ",t.dept_name]})]})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"capitalize mx-3 my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.org_name})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2  font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800 ",children:Q(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800",children:Q(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(Se,{onClick:()=>L(s)}),de(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[O&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{j(!0),c(t.dept_id),L()},children:"Edit"}),S&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{x(!0),A(t.dept_id),L()},children:"Delete"})]})]})})]},s))})]})]}),e.jsxs("div",{className:" my-2 mb-5 mx-7",children:[e.jsx(Ae,{handleDownload:De}),e.jsx(ke,{Length:b.length,currentPage:d,totalPages:G,firstIndex:M,lastIndex:U,paginate:ie,hasNextPage:U>=K.length})]})]})}),p&&e.jsx(Re,{toggleModal:me,toggleCloseModal:ue,ExistingOrganiZations:g,handlerefresh:k}),D&&e.jsx(Le,{toggleModal:xe,handlerefresh:k,ExistingOrganiZations:g,deptId:_}),h&&e.jsx(Te,{toggleDeleteModal:J,delete:ge})]})};export{st as default};
