import{i as K,k as M,r as n,l as Q,o as W,j as e,b as S,B as _,d as z,q as we,m as J,n as Ee,p as ve}from"./index-B6yk0xO3.js";import{R as P,P as Se}from"./Pagination-BU_bAkPA.js";import{S as X}from"./SavaCancel-CwerLI5p.js";import{A as h}from"./ApiClient-Cqu6SrPX.js";import{D as Pe}from"./DeleteModal-DjtI9iZz.js";import{S as Te,D as Ce,E as Oe}from"./DocumentDownload-qTtKlKox.js";import{F as Ie,B as Ae}from"./FileUploadButton-bZQPSjwS.js";import{H as ke}from"./HeaderButton-CjKVQo7l.js";import"./index-GsfYLfvr.js";import"./index-DZDX3-JM.js";import"./index-BCuu-0DM.js";const Me=K().shape({org_name:M().test("not-select","Please select an Organization",a=>a!==""&&a!=="Select  Organization"),dept_name:M().required("Department is required")}),Be=({ExistingOrganiZations:a,toggleModal:b,handlerefresh:T})=>{const[w,B]=n.useState(null),[u,i]=n.useState(null),{register:g,formState:{errors:m},handleSubmit:x,watch:C}=Q({resolver:W(Me),mode:"all"});n.useEffect(()=>{if(u){const l=a.find(E=>E.org_name===u);l&&B(l.org_id)}},[u,a]);const f=async l=>{const E={...l,org_id:w,status:"active",created_by_user:sessionStorage.getItem("name")};try{const r=await S.post(h.POST_DEPARTMENT.url,E,{headers:h.POST_DEPARTMENT.headers});r.status===200?(_.success("Department created Successfully"),b(),T()):(console.error("Error in posting data",r),_.error("Failed to Upload"))}catch(r){console.error("Error in posting data",r)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px] font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Department"})}),e.jsxs("form",{onSubmit:x(f),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"org_name",children:"Organization Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",...g("org_name"),onChange:l=>i(l.target.value),children:[e.jsx("option",{value:"",children:"Select Organization"}),a.map(l=>e.jsx("option",{value:l.org_name,children:l.org_name},l.org_id))]}),m.org_name&&e.jsx("p",{className:"text-red-500",children:m.org_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"dept_name",children:"Department Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",type:"text",placeholder:"Department Name",...g("dept_name")}),m.dept_name&&e.jsx("p",{className:"text-red-500",children:m.dept_name.message})]})]}),e.jsx(X,{onCancel:b})]})]})})},Fe=K().shape({org_name:M().test("not-select","Please select an Organization",a=>a!==""&&a!=="Select  Organization"),dept_name:M().required("Department is required"),status:M().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Re=({ExistingOrganiZations:a,toggleModal:b,handlerefresh:T,deptId:w})=>{const[B,u]=n.useState(null),[i,g]=n.useState(null),{register:m,formState:{errors:x},handleSubmit:C,setValue:f,watch:l}=Q({resolver:W(Fe),mode:"all"});n.useEffect(()=>{(async()=>{try{const p=h.FETCH_DEPARTMENT(w),y=await S.get(p.url,{headers:p.headers}),c=z(y.data.data);f("org_name",c.org_name),g(c.org_name),f("dept_name",c.dept_name),f("status",c.status)}catch(p){console.error("Error fetching data",p)}})()},[w,f]),n.useEffect(()=>{if(i){const r=a.find(p=>p.org_name===i);r&&u(r.org_id)}},[i,a]);const E=async r=>{const p={...r};try{const y=h.UPDATE_DEPARTMENT(w),c=await S.post(y.url,p,{headers:y.headers});c.status===200?(_.success("Department Updated Successfully"),g(null),u(null),b(),T()):(console.error("Error in posting data",c),_.error("Failed to Upload"))}catch(y){console.error("Error in posting data",y)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px] font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Department"})}),e.jsxs("form",{onSubmit:C(E),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"org_name",children:"Organization Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",...m("org_name"),onChange:r=>g(r.target.value),children:[e.jsx("option",{value:i,disabled:!0,children:i}),a.map(r=>e.jsx("option",{value:r.org_name,children:r.org_name},r.org_id))]}),x.org_name&&e.jsx("p",{className:"text-red-500",children:x.org_name.message})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"dept_name",children:"Department Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",type:"text",placeholder:"Department Name",...m("dept_name")}),x.dept_name&&e.jsx("p",{className:"text-red-500",children:x.dept_name.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...m("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),x.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:x.status.message})]})]}),e.jsx(X,{onCancel:b})]})]})})},Ue=`dept_name,org_name,status,created_by_user
Department,Organization,active,admin`,Xe=({permissions:a})=>{const b=a==null?void 0:a.includes("create"),T=a==null?void 0:a.includes("edit"),w=a==null?void 0:a.includes("delete"),B=a==null?void 0:a.includes("download"),[u,i]=n.useState(!1),[g,m]=n.useState(!1),[x,C]=n.useState(!1),[f,l]=n.useState(null),[E,r]=n.useState(null),[p,y]=n.useState(null),[c,ee]=n.useState(""),[F,te]=n.useState(1),[O]=n.useState(8),[L,ae]=n.useState(1),[ze,se]=n.useState([]),[N,V]=n.useState([]),[G,ne]=n.useState(null),[re,q]=n.useState(null),[$,H]=n.useState("Bulk Upload"),[le,oe]=n.useState(null),U=t=>{ne(G===t?null:t)},ce=t=>G===t;n.useEffect(()=>{I(),pe()},[c,F]);const de=t=>{t>0&&t<=L&&te(t)},I=()=>{S.get(h.GET_DEPARTMENT.url,{headers:h.GET_DEPARTMENT.headers}).then(t=>{const s=z(t.data.data);V(s);const D=s.filter(o=>Object.values(o).some(d=>d.toString().toLowerCase().includes(c.toLowerCase())));ae(Math.ceil(D.length/O));const j=F*O,v=j-O;se(D.slice(v,j))})},ie=()=>{i(!u)},me=()=>{m(!g),r(null)},xe=()=>{i(!u)},Y=()=>{C(!x),l(null)},pe=async()=>{try{const t=await S.get(h.GET_ORGANIZATIONACTIVE.url,{headers:h.GET_ORGANIZATIONACTIVE.headers}),s=z(t.data.data);y(s)}catch(t){console.error("Error fetching existing Organisations:",t)}},R=F*O,A=R-O,Z=N.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(c.toLowerCase()))),ue=Z.slice().reverse().slice(A,R),he=async()=>{try{const t=h.DELETE_DEPARTMENT(f);await S.delete(t.url,{headers:t.headers}),Y(),I(),V(N.filter(s=>N.dept_id!==f)),_.success("Deleted successfully")}catch{_.error("Failed to delete")}},ge=t=>{q(t.target.files[0]),H("Upload")},fe=()=>{$==="Bulk Upload"?document.getElementById("fileInput").click():je(re)},je=async t=>{try{const s=new FormData;s.append("file",t),(await S.post(h.CSV_DEPARTMENT.url,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(H("Bulk Upload"),q(null),I(),_.success("Data Uploaded Successfully")):_.error("Data failed to Upload")}catch(s){console.log(s)}},be=t=>{oe(t.target.value)},ye=async t=>{if(t==="csv"){const s=N.map(d=>({dept_id:d.dept_id,dept_name:d.dept_name,org_name:d.org_name,status:d.status,created_by_user:d.created_by_user})),D=[Object.keys(s[0]).join(","),...s.map(d=>Object.values(d).join(","))].join(`
`),j=new Blob([D],{type:"text/csv;charset=utf-8;"}),v=window.URL.createObjectURL(j),o=document.createElement("a");o.setAttribute("href",v),o.setAttribute("download","Department_data.csv"),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}else if(t==="pdf")try{const D=Math.ceil(N.length/30),j=new Oe("l","mm","a4");let v=0;for(let o=1;o<=D;o++){const d=(o-1)*30,De=Math.min(d+30,N.length),_e=N.slice(d,De).map(k=>[k.dept_id,k.dept_name,k.org_name,k.status,k.created_by_user]);j.text(`Page ${o}`,10,v+10),j.autoTable({startY:v+15,head:[["DeptId","DeptName","OrgName","Status","createdBy"]],body:_e,theme:"striped"}),o<D&&(j.addPage(),v=10)}j.save("Department_data.pdf")}catch(s){console.error("Error exporting data:",s)}},Ne=()=>{ve(Ue)};return e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-3 mx-8 flex-wrap",children:[e.jsx(Te,{value:c,onChange:t=>ee(t.target.value),placeholder:"Search Department"}),b&&e.jsx(Ie,{onChange:ge,buttonText:$,accept:".csv",onClick:fe}),B&&e.jsx(Ce,{selectedDoc:le,onChange:be,exportData:ye})]}),e.jsx(ke,{title:"Department",hasCreatePermission:b,onClick:()=>i(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3 overflow-x-auto h-3/5 no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{className:"",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-3 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Department Name ",e.jsx(P,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Org Name ",e.jsx(P,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold  whitespace-nowrap",children:["Status ",e.jsx(P,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedBy ",e.jsx(P,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedAt ",e.jsx(P,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Last UpdatedAt ",e.jsx(P,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-semibold font-lexend  whitespace-nowrap",children:"Action"})})]})}),e.jsx("tbody",{children:ue.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-800",children:A+s+1<10?`0${A+s+1}`:A+s+1})}),e.jsx("td",{children:e.jsxs("div",{className:"flex  gap-2 items-center justify-start mx-5 my-3  text-sm text-gray-800",children:[e.jsx("img",{src:we,alt:"logo",className:"w-8 h-8"}),e.jsxs("p",{className:"font-lexend whitespace-nowrap capitalize   text-gray-800",children:[" ",t.dept_name]})]})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"capitalize mx-3 my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.org_name})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2  font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800 ",children:J(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800",children:J(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(Ee,{onClick:()=>U(s)}),ce(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[T&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{m(!0),r(t.dept_id),U()},children:"Edit"}),w&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{C(!0),l(t.dept_id),U()},children:"Delete"})]})]})})]},s))})]})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx(Ae,{handleDownload:Ne}),e.jsx(Se,{Length:N.length,currentPage:F,totalPages:L,firstIndex:A,lastIndex:R,paginate:de,hasNextPage:R>=Z.length})]})]})}),u&&e.jsx(Be,{toggleModal:ie,toggleCloseModal:xe,ExistingOrganiZations:p,handlerefresh:I}),g&&e.jsx(Re,{toggleModal:me,handlerefresh:I,ExistingOrganiZations:p,deptId:E}),x&&e.jsx(Pe,{toggleDeleteModal:Y,delete:he})]})};export{Xe as default};
