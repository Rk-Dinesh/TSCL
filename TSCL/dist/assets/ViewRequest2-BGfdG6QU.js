import{i as Z,k as G,r,u as K,m as Q,o as X,b as d,A as m,d as x,j as e,B as k,C as ue,H as je,J as ye}from"./index-Cb3AN3R3.js";import{V as Ne}from"./ViewAttachment-DwyE4-Tj.js";import{S as fe}from"./SimilarReq-CmxM2ozc.js";import{G as ve}from"./GrievanceDetailsModal-Ce37D8zL.js";const be=Z().shape({dept_name:G().test("not-select","Please select an Department",s=>s!==""&&s!=="Select  Department"),complaint:G().test("not-select","Please select an complaint",s=>s!==""&&s!=="Select  complaint")}),we=s=>{const w=localStorage.getItem("token"),[N,A]=r.useState([]),[h,z]=r.useState([]),[T,_]=r.useState([]),S=K(),{register:D,formState:{errors:g},handleSubmit:I,watch:f}=Q({resolver:X(be),mode:"all"});r.useEffect(()=>{C(),F()},[]);const C=async()=>{try{const t=await d.get(`${m}/department/getactive`,{headers:{Authorization:`Bearer ${w}`}}),l=x(t.data.data);A(l)}catch(t){console.error("Error fetching existing Department:",t)}},F=async()=>{try{const t=await d.get(`${m}/complaint/getactive`,{headers:{Authorization:`Bearer ${w}`}}),l=x(t.data.data);z(l)}catch(t){console.error("Error fetching existing Department:",t)}},$=t=>{if(t){const l=t.target.value,o=h==null?void 0:h.filter(v=>v.dept_name===l);_(o)}else setFilteredWards([])},E=async t=>{const l={...t};try{const o=localStorage.getItem("token"),v=await d.post(`${m}/new-grievance/tickettransfer?grievance_id=${s.transerId}`,l,{headers:{Authorization:`Bearer ${o}`}});if(v.status===200){k.success("Ticket Transfered Successfully"),s.toggleTModal(),S("/requestview2");const j=await d.post(`${m}/grievance-log/post`,{grievance_id:s.transerId,log_details:`Ticket from ${s.transferDept[0]} ${s.transferDept[1]} complaint is transfered to ${t.dept_name} ${t.complaint} complaint by ${localStorage.getItem("name")}`,created_by_user:"admin"},{headers:{Authorization:`Bearer ${o}`}})}else console.error("Error in posting data",v),k.error("Failed to Upload")}catch(o){console.error("Error in posting data",o)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white  h-fit  font-lexend m-2 rounded-sm w-[500px]",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-6",children:e.jsx("h1",{className:"text-xl font-medium pt-6 ",children:"Ticket Transfer"})}),e.jsx("form",{onSubmit:I(E),children:e.jsxs("div",{className:"  py-2 mx-6 my-3 gap-5 ",children:[e.jsxs("div",{className:"mb-3 flex items-baseline gap-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3 w-2/6",htmlFor:"dept_name",children:"Department"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-4/6 py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",...D("dept_name"),onChange:$,children:[e.jsx("option",{value:"",children:"Select Department"}),N.map((t,l)=>e.jsx("option",{value:t.dept_name,children:t.dept_name},l))]})]}),g.dept_name&&e.jsx("p",{className:"text-red-500 text-end text-sm mb-2 -mt-2",children:g.dept_name.message}),e.jsxs("div",{className:"mb-3 flex items-baseline gap-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3 w-2/6",htmlFor:"complaint",children:"Complaint Type"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-4/6 py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"complaint",...D("complaint"),children:[e.jsx("option",{value:"",children:"Select complaint"}),T.map((t,l)=>e.jsx("option",{value:t.complaint_type_title,children:t.complaint_type_title},l))]})]}),g.complaint&&e.jsx("p",{className:"text-red-500 text-end text-sm mb-2 -mt-2",children:g.complaint.message}),e.jsxs("div",{className:"flex justify-end py-3 mx-10 my-3 gap-5",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:s.toggleTModal,children:"Cancel"}),e.jsx("button",{className:"text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",children:"Transfer"})]})]})})]})})},_e=Z().shape({assign_username:G().required(" required ")}),ze=()=>{const[s,w]=r.useState(null),[N,A]=r.useState(null),[h,z]=r.useState(null),[T,_]=r.useState(null),[S,D]=r.useState([]),[g,I]=r.useState([]),[f,C]=r.useState([]),[F,$]=r.useState(null),[E,t]=r.useState(null),[l,o]=r.useState(!0),[v,j]=r.useState(null),Y=ue(),R=new URLSearchParams(Y.search),u=R.get("grievanceId"),ee=R.get("deptName"),[se,ae]=r.useState(null),[te,U]=r.useState(!1),p=localStorage.getItem("token"),[P,M]=r.useState(!1),[re,W]=r.useState(!1),[O,V]=r.useState(!1),[ne,B]=r.useState(null),ce=K(),{register:ie,formState:{errors:H},handleSubmit:le,watch:Se}=Q({resolver:X(_e),mode:"all"});r.useEffect(()=>{const a=async()=>{try{const n=await d.get(`${m}/new-grievance/getbyid?grievance_id=${u}`,{headers:{Authorization:`Bearer ${p}`}}),i=x(n.data.data);w(i);const y=await d.get(`${m}/new-grievance/filter?zone_name=${i.zone_name}&ward_name=${i.ward_name}&street_name=${i.street_name}&dept_name=${i.dept_name}&complaint=${i.complaint}`,{headers:{Authorization:`Bearer ${p}`}}),he=x(y.data.data).filter(ge=>ge.grievance_id!==u);C(he)}catch(n){j(n)}finally{o(!1)}},c=async()=>{try{const n=await d.get(`${m}/user/getbydept?dept_name=${ee}`,{headers:{Authorization:`Bearer ${p}`}}),i=x(n.data.data);D(i)}catch(n){j(n)}finally{o(!1)}},b=async()=>{try{const n=await d.get(`${m}/new-grievance-attachment/getattachments?grievance_id=${u}`,{headers:{Authorization:`Bearer ${p}`}}),i=x(n.data.data);A(i)}catch(n){j(n)}finally{o(!1)}},q=async()=>{try{const n=await d.get(`${m}/grievance-log/getbyid?grievance_id=${u}`,{headers:{Authorization:`Bearer ${p}`}}),i=x(n.data.data);I(i)}catch(n){j(n)}finally{o(!1)}},L=async()=>{try{const n=await d.get(`${m}/grievance-worksheet-attachment/getattachments?grievance_id=${u}`,{headers:{Authorization:`Bearer ${p}`}}),i=x(n.data.data);z(i)}catch(n){j(n)}finally{o(!1)}};a(),c(),b(),q(),L()},[]);const oe=()=>{M(!P),B(null)},de=()=>{V(!O),$(null),t(null)},me=()=>{W(!W)},pe=async a=>{const c=event.target.querySelector("select"),b=c.options[c.selectedIndex],q=b.getAttribute("data-user-id"),L=b.getAttribute("data-user-phone"),n=b.getAttribute("data-user-name"),i={...a,assign_user:q,assign_userphone:L};try{const y=await d.post(`${m}/new-grievance/updateassign?grievance_id=${u}`,i,{headers:{Authorization:`Bearer ${p}`}});if(y.status===200){k.success("Work Assigned Successfully"),ce("/requestview2");const xe=await d.post(`${m}/grievance-log/post`,{grievance_id:u,log_details:`Work Assigned to ${n} by ${localStorage.getItem("name")}`,created_by_user:localStorage.getItem("name")},{headers:{Authorization:`Bearer ${p}`}})}else console.error("Error in posting data",y),k.error("Failed to Upload")}catch(y){console.error("Error in posting data",y)}},J=a=>{ae(a),U(!0)};return e.jsxs(r.Fragment,{children:[e.jsx("div",{className:"h-screen overflow-y-auto no-scrollbar",children:s&&s.grievance_id&&e.jsxs("div",{className:"md:mx-6 mx-2  my-5 font-lexend",children:[e.jsxs("div",{className:"flex gap-1 justify-between flex-wrap items-center",children:[e.jsxs("p",{children:["Complaint Details #",s.grievance_id]}),e.jsx("button",{className:"bg-primary rounded-full px-3 py-1.5 text-white text-sm mr-3",onClick:()=>{V(!0),$(s.grievance_id),t([s.dept_name,s.complaint])},children:"Ticket Transfer"})]}),e.jsxs("div",{className:"bg-white mt-2 pb-3",children:[e.jsx("p",{className:"px-5 py-2 text-lg",children:"Request By :"}),e.jsxs("div",{className:"md:grid md:grid-cols-12 grid grid-cols-12 items-center gap-6 mx-3 my-3",children:[e.jsxs("div",{className:"md:col-span-3 col-span-6 flex-col-2 px-5 pb-3",children:[e.jsx("p",{className:"capitalize",children:s.public_user_name}),e.jsxs("p",{children:["+91 ",s.phone]})," "]}),e.jsxs("div",{className:"md:col-span-3 col-span-6 ",children:[e.jsxs("div",{className:"flex gap-3 mb-2  items-center",children:[e.jsx("p",{children:"Status: "}),e.jsx("span",{className:" ml-1 text-sm border border-gray-500 w-28 py-1 text-center rounded-full capitalize",children:s.status})]}),e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("p",{className:"-ml-2",children:"Priority : "}),e.jsx("span",{className:`border w-28 rounded-full text-center py-1.5 mx-2 text-sm font-normal capitalize text-white  ${s.priority==="High"?"bg-red-500":s.priority==="Medium"?"bg-sky-500":s.priority==="Low"?"bg-green-500":""}`,children:s.priority})]})]}),e.jsx("form",{onSubmit:le(pe),children:e.jsxs("div",{className:" flex gap-4 items-center",children:[e.jsx("div",{className:"md:col-span-4 col-span-6",children:e.jsxs("select",{className:"col-span-2 block px-6 py-1.5 text-sm text-black border rounded-lg border-gray-500 outline-none capitalize",defaultValue:"",...ie("assign_username"),children:[e.jsx("option",{value:s.assign_username?s.assign_username:"",hidden:!0,children:s.assign_username?s.assign_username:"Assign User"}),S&&S.map((a,c)=>e.jsx("option",{value:a.user_name,"data-user-id":a.user_id,"data-user-phone":a.phone,"data-user-name":a.user_name,children:a.user_name},c))]})}),e.jsx("div",{className:"md:col-span-2 col-span-6",children:e.jsx("button",{className:"bg-primary px-4 py-1.5 text-sm text-white rounded-full",children:"Submit"})}),H.assign_username&&e.jsx("p",{className:"text-red-500 text-xs text-start px-2 pt-2",children:H.assign_username.message})]})})]}),e.jsx("hr",{}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 mx-3 my-4",children:[e.jsxs("div",{className:"md:col-span-6 col-span-12 border px-2 py-3 rounded",children:[e.jsx("p",{className:"pt-2 text-lg",children:"Grievance Details"}),e.jsx("hr",{className:"my-3"}),e.jsxs("div",{className:"flex flex-col gap-3 mx-2 text-base",children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Origin "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.grievance_mode]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Complaint Type "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.complaint_type_title]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Department "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.dept_name]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Complaint "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.complaint]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Zone "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.zone_name]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Ward "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.ward_name]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Street "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.street_name]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Pincode "}),e.jsxs("p",{className:"col-span-2 capitalize",children:[": ",s.pincode]})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Complaint Address: "}),e.jsx("p",{className:"col-start-1 col-span-4 mt-2 capitalize",children:s.complaintaddress})]}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Description: "}),e.jsx("p",{className:"col-start-1 col-span-4 mt-2 capitalize",children:s.complaint_details})]}),N&&N.length>0&&e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Attachment Files "}),e.jsx("div",{className:"col-start-1 col-span-4 mt-2 text-xs  ",children:N.map((a,c)=>e.jsx("button",{className:" mx-1 my-1 px-3 py-1.5 bg-gray-500 rounded-full text-white",onClick:()=>{M(!0),B(a.attachment),_("new-grievance-attachment")},children:`Attachment ${c+1}`},c))})]})]})]}),e.jsxs("div",{className:"md:col-span-6 col-span-12 border px-2 py-3 rounded ",children:[e.jsx("p",{className:"pt-2 text-lg ",children:"Similar Request"}),e.jsx("hr",{className:"my-3 w-full"}),e.jsx("div",{className:"overflow-auto no-scrollbar",children:e.jsxs("table",{className:"w-full bg-gray-200 rounded ",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"items-center mx-3 py-2 font-lexend whitespace-nowrap",children:"Grievance"}),e.jsx("th",{className:"items-center mx-3 py-2 font-lexend whitespace-nowrap",children:"Department"}),e.jsx("th",{className:"items-center mx-3 py-2 font-lexend whitespace-nowrap",children:"Origin"}),e.jsx("th",{className:"items-center mx-3 py-2 font-lexend whitespace-nowrap",children:"Date"}),e.jsx("th",{className:"items-center mx-3 py-2 font-lexend whitespace-nowrap",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-300",children:f&&f.length>0?f.map((a,c)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"text-center mx-3 py-2.5 whitespace-nowrap",onClick:()=>J(a.grievance_id),children:a.grievance_id}),e.jsx("td",{className:"text-center mx-3 py-2.5 whitespace-nowrap text-gray-600 capitalize",children:a.dept_name}),e.jsx("td",{className:"text-center mx-3 py-2.5 whitespace-nowrap text-gray-600 capitalize",children:a.grievance_mode}),e.jsx("td",{className:"text-center mx-3 py-2.5 whitespace-nowrap text-gray-600 ",children:je(a.createdAt)}),e.jsx("td",{className:"flex justify-center mt-3",children:e.jsx(ye,{className:"text-xl",onClick:()=>J(a.grievance_id)})})]},c)):e.jsx("tr",{children:e.jsx("td",{className:"text-center py-2.5",colSpan:"5",children:"No matching data found"})})})]})})]})]}),e.jsxs("div",{className:"mx-3 my-3 ",children:[e.jsx("p",{className:"mb-2 mx-1 text-lg",children:"Complaint History"}),e.jsx("div",{className:"bg-gray-100 py-3 h-[530px]",children:e.jsxs("div",{className:"mx-8 ",children:[e.jsxs("p",{className:"py-3 font-semibold",children:["Complaint No ",s.grievance_id]}),e.jsxs("div",{className:"h-[380px]  overflow-x-auto no-scrollbar mb-3",children:[g&&g.slice().reverse().map((a,c)=>e.jsxs("div",{children:[e.jsx("p",{className:"py-1",children:new Date(a.createdAt).toLocaleDateString()}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsx("p",{children:new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("p",{className:"pl-5 col-span-2",children:a.log_details})]}),e.jsx("br",{})]},c)),e.jsx("p",{className:"py-2",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsx("p",{children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsxs("p",{className:"pl-5 col-span-2",children:[" ","Assigned To Particular Department"]})]}),e.jsx("br",{}),e.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black",children:[e.jsx("p",{children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsxs("p",{className:"pl-5 col-span-2",children:["Ticket Raised- ",s.grievance_id]})]}),e.jsx("br",{}),h&&h.length>0&&e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("p",{className:"col-span-2",children:"Attachment Files "}),e.jsx("div",{className:"col-start-1 col-span-4 mt-2 text-xs  ",children:h.map((a,c)=>e.jsx("button",{className:" mx-1 my-1 px-3 py-1.5 bg-gray-500 rounded-full text-white",onClick:()=>{M(!0),B(a.attachment),_("grievance-worksheet-attachment")},children:`Attachment ${c+1}`},c))})]})]}),e.jsx("hr",{className:"my-3"}),e.jsxs("div",{className:"md:grid md:grid-cols-3 flex border-2 md:mx-20",children:[e.jsx("p",{className:"text-center px-3 py-1.5",children:"Status"}),e.jsx("p",{className:"text-center w-full bg-gray-800 md:col-span-2 text-white py-1.5",children:s.status})]})]})})]})]})]})}),P&&e.jsx(Ne,{endpoint:T,toggleModal:oe,attachmentFile:ne}),te&&e.jsx(ve,{grievanceId:se,closeModal:()=>U(!1)}),O&&e.jsx(we,{toggleTModal:de,transerId:F,transferDept:E}),re&&e.jsx(fe,{matchData:f,togglReModal:me})]})};export{ze as default};
