import{i as Q,k as A,r as n,m as X,o as ee,j as e,b as C,A as I,B as b,d as q,q as K,s as De,v as Pe}from"./index-Cb3AN3R3.js";import{R as Z}from"./index-C-hq6bKM.js";import{S as te}from"./SavaCancel-CuKZ8TfL.js";import{D as ke}from"./DeleteModal-De28Bu6M.js";import{S as Ce,D as Ie,E as Ee}from"./DocumentDownload-A0b-q8L_.js";import{B as Be}from"./BulkUploadButton-C25cRLG1.js";import{P as Ze}from"./Pagination-ClPqWgoN.js";import{F as $e}from"./FileUploadButton-DWkzr3As.js";import{H as We}from"./HeaderButton-By5upfsz.js";import"./index-Du0g9a49.js";import"./index-CmROlnnr.js";import"./index-BK6gNoz8.js";const Ae=Q().shape({zone_name:A().test("not-select","Please select an Zone",a=>a!==""&&a!=="Select Zone"),ward_name:A().required("ward_name is required")}),Me=a=>{const{ExistingZones:p}=a,[_,v]=n.useState(null),[S,f]=n.useState(null),[m,h]=n.useState(!1),{register:z,formState:{errors:x},handleSubmit:y,watch:g}=X({resolver:ee(Ae),mode:"all"});n.useEffect(()=>{if(S){const i=p.find(c=>c.zone_name===S);i&&v(i.zone_id)}},[S,p]);const E=async i=>{const c={...i,zone_id:_,status:"active",created_by_user:localStorage.getItem("name")};try{h(!0);const w=localStorage.getItem("token"),r=await C.post(`${I}/ward/post`,c,{headers:{Authorization:`Bearer ${w}`}});r.status===200?(b.success("Ward created Successfully"),h(!1),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",r),h(!1),b.error("Failed to Upload"))}catch(w){console.error("Error in posting data",w),h(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Ward"})}),e.jsxs("form",{onSubmit:y(E),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"zone_name",children:"Zone Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"zone_name",...z("zone_name"),onChange:i=>f(i.target.value),children:[e.jsx("option",{value:"",children:"Select Zone"}),p.map((i,c)=>e.jsx("option",{value:i.zone_name,children:i.zone_name},c))]}),x.zone_name&&e.jsx("p",{className:"text-red-500",children:x.zone_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"ward_name",children:"Ward Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",type:"text",placeholder:" Ward Name",...z("ward_name")}),x.ward_name&&e.jsx("p",{className:"text-red-500",children:x.ward_name.message})]})]}),e.jsx(te,{onCancel:a.toggleCloseModal,isLoading:m})]})]})})},Fe=Q().shape({zone_name:A().test("not-select","Please select an Zone",a=>a!==""&&a!=="Select Zone"),ward_name:A().required("ward_name is required"),status:A().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Ue=a=>{const p=localStorage.getItem("token"),{ExistingZones:_,wardId:v}=a,[S,f]=n.useState(null),[m,h]=n.useState(null),[z,x]=n.useState(!1),{register:y,formState:{errors:g},handleSubmit:E,watch:i,setValue:c}=X({resolver:ee(Fe),mode:"all"});n.useEffect(()=>{(async()=>{try{const l=await C.get(`${I}/ward/getbyid?ward_id=${v}`,{headers:{Authorization:`Bearer ${p}`}}),u=q(l.data.data);h(u.zone_name),c("ward_name",u.ward_name),c("status",u.status),c("zone_name",u.zone_name)}catch(l){console.error("Error fetching data",l)}})()},[v,c]),n.useEffect(()=>{if(m){const r=_.find(l=>l.zone_name===m);r&&f(r.zone_id)}},[m,_]);const w=async r=>{const l={...r,zone_id:S};try{x(!0);const u=await C.post(`${I}/ward/update?ward_id=${v}`,l,{headers:{Authorization:`Bearer ${p}`}});u.status===200?(b.success("Ward Updated Successfully"),x(!1),f(null),f(null),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",u),x(!1),b.error("Failed to Upload"))}catch(u){console.error("Error in posting data",u),x(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[368px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Ward"})}),e.jsxs("form",{onSubmit:E(w),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"zone_name",children:"Zone Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"zone_name",...y("zone_name"),onChange:r=>h(r.target.value),children:[e.jsx("option",{value:m,disabled:!0,children:m}),_.map((r,l)=>e.jsx("option",{value:r.zone_name,children:r.zone_name},l))]}),g.zone_name&&e.jsx("p",{className:"text-red-500",children:g.zone_name.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"ward_name",children:"Ward Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"ward_name",type:"text",placeholder:" Ward Name",...y("ward_name")}),g.ward_name&&e.jsx("p",{className:"text-red-500",children:g.ward_name.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...y("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),g.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:g.status.message})]})]}),e.jsx(te,{onCancel:a.toggleModal,isLoading:z})]})]})})},Le=`zone_id,ward_name
Z***,WardName`,at=({permissions:a})=>{const p=a==null?void 0:a.includes("create"),_=a==null?void 0:a.includes("edit"),v=a==null?void 0:a.includes("delete"),S=a==null?void 0:a.includes("download"),[f,m]=n.useState(!1),[h,z]=n.useState(!1),[x,y]=n.useState(null),[g,E]=n.useState(!1),[i,c]=n.useState(null),[w,r]=n.useState(null),[l,u]=n.useState(""),[M,R]=n.useState(1),[D,ae]=n.useState(10),[V,se]=n.useState(1),[Oe,ne]=n.useState([]),[re,F]=n.useState(null),[H,U]=n.useState("Bulk Upload"),[le,oe]=n.useState(null),[P,ce]=n.useState([]),[Y,de]=n.useState(null),L=localStorage.getItem("token"),T=t=>{de(Y===t?null:t)},ie=t=>Y===t;n.useEffect(()=>{$(),ge()},[l,M,D,L]);const me=t=>{t>0&&t<=V&&R(t)},$=async()=>{try{const t=await C.get(`${I}/ward/get`,{headers:{Authorization:`Bearer ${L}`}}),s=q(t.data.data);ce(s);const N=s.filter(o=>Object.values(o).some(d=>d.toString().toLowerCase().includes(l.toLowerCase())));se(Math.ceil(N.length/D));const j=M*D,k=j-D;ne(N.slice(k,j))}catch(t){console.error(t)}},xe=()=>{m(!f)},ue=()=>{z(!h),y(null)},he=()=>{m(!f)},G=()=>{E(!g),c(null)},ge=async()=>{try{const t=await C.get(`${I}/zone/getactive`,{headers:{Authorization:`Bearer ${L}`}}),s=q(t.data.data);r(s)}catch(t){console.error("Error fetching existing roles:",t)}},O=M*D,W=O-D,J=P.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(l.toLowerCase()))),pe=J.slice(W,O),fe=async()=>{try{await C.delete(`${I}/ward/delete?ward_id=${i}`,{headers:{Authorization:`Bearer ${L}`}}),G(),$(),b.success("Deleted successfully")}catch{b.error("Failed to delete")}},je=t=>{F(t.target.files[0]),U("Upload")},be=()=>{H==="Bulk Upload"?document.getElementById("fileInput").click():ye(re)},ye=async t=>{try{const s=new FormData;s.append("file",t),s.append("created_by_user",localStorage.getItem("name")),(await C.post(`${I}/ward/uploadcsv`,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200&&(U("Bulk Upload"),F(null),$(),b.success("Data Uploaded successfully"))}catch(s){s.response&&s.response.data&&s.response.data.error?(b.error(s.response.data.error),U("Bulk Upload"),F(null)):(b.error("An unexpected error occurred"),U("Bulk Upload"),F(null))}},we=t=>{oe(t.target.value)},Ne=async t=>{if(t==="csv"){const s=P.map(d=>({ward_id:d.ward_id,zone_id:d.zone_id,zone_name:d.zone_name,ward_name:d.ward_name,status:d.status,created_by_user:d.created_by_user})),N=[Object.keys(s[0]).join(","),...s.map(d=>Object.values(d).join(","))].join(`
`),j=new Blob([N],{type:"text/csv;charset=utf-8;"}),k=window.URL.createObjectURL(j),o=document.createElement("a");o.setAttribute("href",k),o.setAttribute("download","Ward_data.csv"),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}else if(t==="pdf")try{const N=Math.ceil(P.length/30),j=new Ee("l","mm","a4");let k=0;for(let o=1;o<=N;o++){const d=(o-1)*30,Se=Math.min(d+30,P.length),ze=P.slice(d,Se).map(B=>[B.ward_id,B.zone_id,B.zone_name,B.ward_name,B.status,B.created_by_user]);j.text(`Page ${o}`,10,k+10),j.autoTable({startY:k+15,head:[["ward_id","zone_id","zone_name","ward_name","Status","createdBy"]],body:ze,theme:"striped"}),o<N&&(j.addPage(),k=10)}j.save("Ward_data.pdf")}catch(s){console.error("Error exporting data:",s)}},_e=()=>{Pe(Le)},ve=t=>{const s=parseInt(t.target.value,10);ae(s),R(1)};return e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar mb-2",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-2 mx-8 flex-wrap",children:[e.jsx(Ce,{value:l,onChange:t=>u(t.target.value),placeholder:"Search Ward"}),p&&e.jsx($e,{onChange:je,buttonText:H,accept:".csv",onClick:be}),S&&e.jsx(Ie,{selectedDoc:le,onChange:we,exportData:Ne})]}),e.jsx(We,{title:"Ward",hasCreatePermission:p,onClick:()=>m(!0)}),e.jsxs("div",{className:`bg-white  mx-4 rounded-lg overflow-x-auto mt-1  p-3 ${P.length<6?"h-3/5":"h-fit"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mx-3",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-medium text-gray-600",children:"Page Entries"}),e.jsxs("select",{id:"itemsPerPage",value:D,onChange:ve,className:" p-1 outline-none text-sm rounded px-2",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]}),e.jsx("div",{className:"overflow-x-auto ",children:e.jsxs("table",{className:"w-full mt-3 ",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Ward ",e.jsx(Z,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Zone ",e.jsx(Z,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Status ",e.jsx(Z,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedBy ",e.jsx(Z,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedAt",e.jsx(Z,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["UpdatedAt",e.jsx(Z,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-semibold font-lexend",children:"Action"})})]})}),e.jsx("tbody",{children:pe.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-700",children:W+s+1<10?`0${W+s+1}`:W+s+1})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.ward_name})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.zone_name})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2  font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:K(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:K(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(De,{onClick:()=>T(s)}),ie(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[_&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{z(!0),y(t.ward_id),T()},children:"Edit"}),v&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{E(!0),c(t.ward_id),T()},children:"Delete"})]})]})})]},s))})]})})]}),e.jsxs("div",{className:" my-2 mb-5 mx-7",children:[e.jsx(Be,{handleDownload:_e}),e.jsx(Ze,{Length:P.length,currentPage:M,totalPages:V,firstIndex:W,lastIndex:O,paginate:me,hasNextPage:O>=J.length})]})]})}),f&&e.jsx(Me,{toggleModal:xe,toggleCloseModal:he,ExistingZones:w,handlerefresh:$}),h&&e.jsx(Ue,{toggleModal:ue,handlerefresh:$,ExistingZones:w,wardId:x}),g&&e.jsx(ke,{toggleDeleteModal:G,delete:fe})]})};export{at as default};
