import{i as Y,k as $,r as n,m as G,o as J,j as e,b as S,A as _,B as p,d as K,q as H,s as we,v as Ne}from"./index-Cb3AN3R3.js";import{R as C}from"./index-C-hq6bKM.js";import{S as Q}from"./SavaCancel-CuKZ8TfL.js";import{D as ve}from"./DeleteModal-De28Bu6M.js";import{S as Se,D as _e,E as De}from"./DocumentDownload-A0b-q8L_.js";import{B as ze}from"./BulkUploadButton-C25cRLG1.js";import{P as ke}from"./Pagination-ClPqWgoN.js";import{F as Pe}from"./FileUploadButton-DWkzr3As.js";import{H as Ce}from"./HeaderButton-By5upfsz.js";import"./index-Du0g9a49.js";import"./index-CmROlnnr.js";import"./index-BK6gNoz8.js";const Ie=Y().shape({zone_name:$().required("Zone_name is required")}),Ze=a=>{const[d,i]=n.useState(!1),{register:m,formState:{errors:j},handleSubmit:b,watch:x}=G({resolver:J(Ie),mode:"all"}),N=async D=>{const y={...D,status:"active",created_by_user:localStorage.getItem("name")};try{i(!0);const u=localStorage.getItem("token"),h=await S.post(`${_}/zone/post`,y,{headers:{Authorization:`Bearer ${u}`}});h.status===200?(p.success("Zone created Successfully"),i(!1),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",h),i(!1),p.error("Failed to Upload"))}catch(u){console.error("Error in posting data",u),i(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[340px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Zone"})}),e.jsxs("form",{onSubmit:b(N),children:[e.jsxs("div",{className:"mx-6 my-10",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-4",htmlFor:"zone_name",children:"Zone Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"zone_name",type:"text",placeholder:"Zone Name",...m("zone_name")}),j.zone_name&&e.jsx("p",{className:"text-red-500",children:j.zone_name.message})]}),e.jsx(Q,{onCancel:a.toggleModal,isLoading:d})]})]})})},Be=Y().shape({zone_name:$().required("Zone_name is required"),status:$().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Ee=a=>{const{zoneId:d}=a,[i,m]=n.useState(!1),j=localStorage.getItem("token"),{register:b,formState:{errors:x},handleSubmit:N,watch:D,setValue:y}=G({resolver:J(Be),mode:"all"});n.useEffect(()=>{(async()=>{try{const f=await S.get(`${_}/zone/getbyid?zone_id=${d}`,{headers:{Authorization:`Bearer ${j}`}}),r=K(f.data.data);y("zone_name",r.zone_name),y("status",r.status)}catch(f){console.error("Error fetching data",f)}})()},[d,y]);const u=async h=>{const f={...h};try{m(!0);const r=await S.post(`${_}/zone/update?zone_id=${d}`,f,{headers:{Authorization:`Bearer ${j}`}});r.status===200?(p.success("Zone Updated Successfully"),m(!1),a.toggleModal(),a.handlerefresh()):(console.error("Error in posting data",r),m(!1),p.error("Failed to Upload"))}catch(r){console.error("Error in posting data",r),m(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[340px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Edit Zone"})}),e.jsxs("form",{onSubmit:N(u),children:[e.jsxs("div",{className:"mx-8 my-6",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-4",htmlFor:"zone_name",children:"Zone Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"zone_name",type:"text",placeholder:"Zone Name",...b("zone_name")}),x.zone_name&&e.jsx("p",{className:"text-red-500",children:x.zone_name.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:" grid grid-cols-3 mx-10 my-6",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...b("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]})]}),x.status&&e.jsx("p",{className:"text-red-500 text-xs text-center -mt-4 mb-2 ",children:x.status.message})]}),e.jsx(Q,{onCancel:a.toggleModal,isLoading:i})]})]})})},Me=`zone_name,status,created_by_user
ZoneName,active,admin`,Ke=({permissions:a})=>{const d=a==null?void 0:a.includes("create"),i=a==null?void 0:a.includes("edit"),m=a==null?void 0:a.includes("delete"),j=a==null?void 0:a.includes("download"),[b,x]=n.useState(!1),[N,D]=n.useState(!1),[y,u]=n.useState(null),[h,f]=n.useState(!1),[r,A]=n.useState(null),[I,W]=n.useState(""),[Z,X]=n.useState(1),[z]=n.useState(8),[U,ee]=n.useState(1),[$e,te]=n.useState([]),[v,ae]=n.useState([]),[F,se]=n.useState(null),L=localStorage.getItem("token"),[ne,O]=n.useState(null),[T,q]=n.useState("Bulk Upload"),[oe,le]=n.useState(null),M=t=>{se(F===t?null:t)},re=t=>F===t;n.useEffect(()=>{k()},[I,Z]);const ce=t=>{t>0&&t<=U&&X(t)},k=()=>{S.get(`${_}/zone/get`,{headers:{Authorization:`Bearer ${L}`}}).then(t=>{const s=K(t.data.data);ae(s);const g=s.filter(o=>Object.values(o).some(l=>l.toString().toLowerCase().includes(I.toLowerCase())));ee(Math.ceil(g.length/z));const c=Z*z,w=c-z;te(g.slice(w,c))})},de=()=>{x(!b)},ie=()=>{D(!N),u(null)},R=()=>{f(!h),A(null)},B=Z*z,P=B-z,V=v.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(I.toLowerCase()))),me=V.slice(P,B),xe=async()=>{try{await S.delete(`${_}/zone/delete?zone_id=${r}`,{headers:{Authorization:`Bearer ${L}`}}),R(),k(),p.success("Deleted successfully")}catch{p.error("Failed to delete")}},ue=t=>{O(t.target.files[0]),q("Upload")},he=()=>{T==="Bulk Upload"?document.getElementById("fileInput").click():fe(ne)},fe=async t=>{try{const s=new FormData;s.append("file",t),(await S.post(`${_}/zone/uploadcsv`,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(q("Bulk Upload"),O(null),k(),p.success("Data Uploaded Successfully")):p.error("Data failed to Upload")}catch(s){console.log(s)}},ge=t=>{le(t.target.value)},pe=async t=>{if(t==="csv"){const s=v.map(l=>({zone_id:l.zone_id,zone_name:l.zone_name,status:l.status,created_by_user:l.created_by_user})),g=[Object.keys(s[0]).join(","),...s.map(l=>Object.values(l).join(","))].join(`
`),c=new Blob([g],{type:"text/csv;charset=utf-8;"}),w=window.URL.createObjectURL(c),o=document.createElement("a");o.setAttribute("href",w),o.setAttribute("download","Zone_data.csv"),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}else if(t==="pdf")try{const g=Math.ceil(v.length/30),c=new De("l","mm","a4");let w=0;for(let o=1;o<=g;o++){const l=(o-1)*30,be=Math.min(l+30,v.length),ye=v.slice(l,be).map(E=>[E.zone_id,E.zone_name,E.status,E.created_by_user]);c.text(`Page ${o}`,10,w+10),c.autoTable({startY:w+15,head:[["Zone_Id","Zone_Name","Status","createdBy"]],body:ye,theme:"striped"}),o<g&&(c.addPage(),w=10)}c.save("Zone_data.pdf")}catch(s){console.error("Error exporting data:",s)}},je=()=>{Ne(Me)};return e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen ",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-2 mx-8 flex-wrap",children:[e.jsx(Se,{value:I,onChange:t=>W(t.target.value),placeholder:"Search Zone"}),d&&e.jsx(Pe,{onChange:ue,buttonText:T,accept:".csv",onClick:he}),j&&e.jsx(_e,{selectedDoc:oe,onChange:ge,exportData:pe})]}),e.jsx(Ce,{title:"Zone",hasCreatePermission:d,onClick:()=>x(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-2  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar ",children:e.jsxs("table",{className:"w-full mt-3 ",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-semibold",children:["Zone ",e.jsx(C,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold  whitespace-nowrap",children:["Status ",e.jsx(C,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedBy ",e.jsx(C,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["CreatedAt",e.jsx(C,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5  my-2 font-lexend font-semibold",children:["UpdatedAt",e.jsx(C,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-lexend font-semibold",children:"Action"})})]})}),e.jsx("tbody",{children:me.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300 ",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-cente text-gray-700",children:P+s+1<10?`0${P+s+1}`:P+s+1})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"capitalize text-start mx-1.5 my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.zone_name})}),e.jsx("td",{children:e.jsx("p",{className:" mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize  text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2  font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:H(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:H(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(we,{onClick:()=>M(s)}),re(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[i&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{D(!0),u(t.zone_id),M()},children:"Edit"}),m&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{f(!0),A(t.zone_id),M()},children:"Delete"})]})]})})]},s))})]})})}),e.jsxs("div",{className:" my-2 mb-5 mx-7",children:[e.jsx(ze,{handleDownload:je}),e.jsx(ke,{Length:v.length,currentPage:Z,totalPages:U,firstIndex:P,lastIndex:B,paginate:ce,hasNextPage:B>=V.length})]})]})}),b&&e.jsx(Ze,{toggleModal:de,handlerefresh:k}),N&&e.jsx(Ee,{toggleModal:ie,handlerefresh:k,zoneId:y}),h&&e.jsx(ve,{toggleDeleteModal:R,delete:xe})]})};export{Ke as default};
