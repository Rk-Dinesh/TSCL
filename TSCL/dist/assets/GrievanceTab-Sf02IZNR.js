import{l as ee,r as n,u as te,b as C,A as I,d as E,y as ae,p as se,j as e,w as ne,z as ce,B as re}from"./index-Cb3AN3R3.js";import{R as u}from"./index-C-hq6bKM.js";import{S as le,D as ie,E as de}from"./DocumentDownload-A0b-q8L_.js";import{P as oe}from"./Pagination-ClPqWgoN.js";import{D as me,a as xe}from"./DateRangeComp-B_BpUMFB.js";import"./index-CmROlnnr.js";import"./index-Du0g9a49.js";import"./index-aztxF81R.js";const A=({permissions:c,include:p,endpoint:g})=>{c==null||c.includes("create"),c==null||c.includes("edit"),c==null||c.includes("delete");const _=c==null?void 0:c.includes("download"),z=ee();n.useState(!1);const[v,G]=n.useState(""),[f,N]=n.useState(1),[h,$]=n.useState(10),[w,k]=n.useState(1),[R,T]=n.useState([]),[j,L]=n.useState([]),[m,P]=n.useState([]),D=localStorage.getItem("token"),[M,U]=n.useState({}),B=te(),[he,O]=n.useState([]),[S,F]=n.useState({}),[V,Y]=n.useState(null);n.useEffect(()=>{C.get(`${I}/new-grievance/${g}`,{headers:{Authorization:`Bearer ${D}`}}).then(t=>{const r=E(t.data.data).reverse();L(r)}).catch(t=>{console.error(t)}),H(),z(ae())},[]);const x=se(t=>t.origin);n.useEffect(()=>{var t;if(x&&(x!=null&&x.data)){const a=(t=x==null?void 0:x.data)==null?void 0:t.reduce((r,i)=>(r[i.res_name]=i.image,r),{});U(a)}},[x]),n.useEffect(()=>{const t=j.filter(a=>Object.values(a).some(r=>r.toString().toLowerCase().includes(v.toLowerCase())));P(t)},[v,j]),n.useEffect(()=>{const t=f*h,a=t-h;T(m.slice(a,t)),k(Math.ceil(m.length/h))},[m,f,h]);const H=async()=>{try{const t=await C.get(`${I}/status/get`,{headers:{Authorization:`Bearer ${D}`}}),a=E(t.data.data),r=a.reduce((i,o)=>(i[o.status_name]=o.color,i),{});O(a),F(r)}catch(t){console.error("Error fetching existing ActiveStatus:",t)}},J=t=>{t>0&&t<=w&&N(t)},q=t=>{const a=t[0].startDate,r=t[0].endDate,i=j.filter(o=>{const l=new Date(o.createdAt);return l>=a&&l<xe(r,1)});P(i),re.success("Grievances filtered")},b=f*h,y=b-h,K=t=>{Y(t.target.value)},Q=async t=>{if(t==="csv"){const a=m.map(s=>({grievance_id:s.grievance_id,grievance_mode:s.grievance_mode,complaint_type_title:s.complaint_type_title,dept_name:s.dept_name,zone_name:s.zone_name,ward_name:s.ward_name,street_name:s.street_name,pincode:s.pincode,complaint:s.complaint,public_user_id:s.public_user_id,public_user_name:s.public_user_name,phone:s.phone,assign_user:s.assign_user,assign_username:s.assign_username,assign_userphone:s.assign_userphone,status:s.status,escalation_level:s.escalation_level,priority:s.priority})),r=[Object.keys(a[0]).join(","),...a.map(s=>Object.values(s).join(","))].join(`
`),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),o=window.URL.createObjectURL(i),l=document.createElement("a");l.setAttribute("href",o),l.setAttribute("download","Grievance_data.csv"),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}else if(t==="pdf")try{const r=Math.ceil(m.length/30),i=new de("l","mm","a4");let o=0;for(let l=1;l<=r;l++){const s=(l-1)*30,X=Math.min(s+30,m.length),Z=m.slice(s,X).map(d=>[d.grievance_id,d.grievance_mode,d.complaint_type_title,d.dept_name,d.pincode,d.complaint,d.public_user_name,d.phone,d.assign_username,d.assign_userphone,d.status,d.escalation_level,d.priority]);i.text(`Page ${l}`,10,o+10),i.autoTable({startY:o+15,head:[["grievance_id","grievance_mode","complaintType","dept","pincode","complaint","publicUser","phone","assignUser","assignUserphone","status","Escalation","Priority"]],body:Z,theme:"striped"}),l<r&&(i.addPage(),o=10)}i.save("Grievance_data.pdf")}catch(a){console.error("Error exporting data:",a)}},W=t=>{const a=parseInt(t.target.value,10);$(a),N(1)};return e.jsx(n.Fragment,{children:e.jsx("div",{className:"bg-blue-100 overflow-y-auto no-scrollbar mb-5",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row gap-1.5 p-2 mt-6 mx-4 flex-wrap md:justify-between items-center",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx(me,{onChange:q}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-medium text-gray-600",children:"Page Entries"}),e.jsxs("select",{id:"itemsPerPage",value:h,onChange:W,className:" p-1 outline-none text-sm rounded px-2",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]}),e.jsxs("div",{className:"flex flex-row flex-wrap gap-1.5",children:[e.jsx(le,{value:v,onChange:t=>G(t.target.value),placeholder:"Search Grievances"}),_&&e.jsx(ie,{selectedDoc:V,onChange:K,exportData:Q})]})]}),e.jsx("div",{className:`bg-white overflow-x-auto mx-4 rounded-lg mt-1  p-3 ${j.length<8?"h-4/5":"h-fit"}`,children:e.jsxs("table",{className:"w-full mt-2",children:[e.jsx("thead",{className:"border-b border-gray-300",children:e.jsxs("tr",{className:"",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:"mx-3 my-2 font-lexend font-medium whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 text-start font-lexend font-medium whitespace-nowrap",children:"Complaint No"})}),e.jsx("th",{children:e.jsx("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium  whitespace-nowrap",children:"Origin"})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium whitespace-nowrap",children:["Raised by ",e.jsx(u,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium whitespace-nowrap",children:["Complaint Type ",e.jsx(u,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium whitespace-nowrap",children:["Department",e.jsx(u,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium whitespace-nowrap",children:["Assigned JE ",e.jsx(u,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-start mx-1.5 my-2 font-lexend font-medium whitespace-nowrap",children:["Date and Time ",e.jsx(u,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-center mx-2 my-2 font-lexend font-medium whitespace-nowrap",children:["Priority ",e.jsx(u,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center justify-center mx-1.5 my-2 font-lexend font-medium whitespace-nowrap",children:["Status ",e.jsx(u,{})]})})]})}),e.jsx("tbody",{children:R.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"text-center text-sm mx-3 my-2 font-lexend whitespace-nowrap text-gray-700",children:y+a+1<10?`0${y+a+1}`:y+a+1})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 border-slate-900 rounded-lg text-center py-1 my-1   text-slate-900",onClick:()=>B(`/view?grievanceId=${t.grievance_id}`),children:t.grievance_id})}),e.jsx("td",{className:"flex gap-1 items-center justify-center text-gray-700",children:e.jsx("img",{src:M[t.grievance_mode]||ne,alt:t.grievance_mode,className:"w-6 h-6 mx-1.5 my-2 rounded-full"})}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.public_user_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.complaint_type_title})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:t.dept_name})]}),e.jsxs("td",{children:[" ",e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.assign_username?t.assign_username:"Yet to be assigned"})]}),e.jsx("td",{children:e.jsx("p",{className:" text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-700",children:ce(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:`border-2 w-26 rounded-full text-center py-1.5 mx-2 text-sm font-medium capitalize  ${t.priority==="High"?"text-red-500 border-red-500":t.priority==="Medium"?"text-sky-500 border-sky-500":t.priority==="Low"?"text-green-500 border-green-500":""}`,children:t.priority})}),e.jsx("td",{children:e.jsx("p",{className:"border-2 w-28 rounded-full text-center py-1 tex-sm font-normal mx-2 capitalize  ",style:{borderColor:S[t.status]||"gray",color:S[t.status]||"black",fontSize:14},children:t.status})})]},a))})]})}),e.jsx("div",{className:"my-3 mb-5 mx-7",children:e.jsx(oe,{Length:m.length,currentPage:f,totalPages:w,firstIndex:y,lastIndex:b,paginate:J,hasNextPage:b>=m.length})})]})})})};function Ne({permissions:c}){const[p,g]=n.useState("tab1");return e.jsxs("div",{className:"overflow-auto no-scrollbar",children:[e.jsxs("ul",{className:"flex mb-2 list-none justify-center mt-1",children:[e.jsx("li",{className:"-mb-px mr-1",children:e.jsx("a",{className:`text-white   font-medium rounded-sm text-sm px-5 py-1.5 text-center  ${p==="tab1"?"bg-gray-700":"bg-gray-400"}`,onClick:()=>g("tab1"),children:"Current Grievances"})}),e.jsx("li",{className:"-mb-px mr-1",children:e.jsx("a",{className:`text-white   font-medium rounded-sm text-sm px-5 py-1.5 text-center ${p==="tab2"?"bg-gray-700":"bg-gray-400"}`,onClick:()=>g("tab2"),children:"Closed Grievances"})})]}),e.jsxs("div",{className:"mx-1 ",children:[p==="tab1"&&e.jsx(A,{permissions:c,include:"yes",endpoint:"bynotclosed"}),p==="tab2"&&e.jsx(A,{permissions:c,endpoint:"byclosed"})]})]})}export{Ne as default};
