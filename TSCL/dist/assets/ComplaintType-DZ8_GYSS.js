import{i as F,k,l as L,o as O,j as e,b as j,A as b,B as C,r as a,d as q,m as B,n as re}from"./index-B-YhHBab.js";import{R as f,P as oe}from"./Pagination-DoNtECT-.js";import{S as U}from"./SavaCancel-89r2xThE.js";import{D as ne}from"./DeleteModal-BhbeyLgd.js";import{S as ce}from"./SearchHeader-BW_CJ0FD.js";import"./index-BnDzthMN.js";import"./index-D011Getu.js";const ie=F().shape({complaint_type:k().required("complaint_type is required")}),de=s=>{const{register:d,formState:{errors:m},handleSubmit:p,watch:o}=L({resolver:O(ie),mode:"all"}),h=async u=>{const n={...u,status:"active",created_by_user:sessionStorage.getItem("name")};try{const x=sessionStorage.getItem("token"),c=await j.post(`${b}/complainttype/post`,n,{headers:{Authorization:`Bearer ${x}`}});c.status===200?(C.success(" created Successfully"),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",c),C.error("Failed to Upload"))}catch(x){console.error("Error in posting data",x)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[330px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Complaint Type"})}),e.jsxs("form",{onSubmit:p(h),children:[e.jsxs("div",{className:"mx-6 my-10",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-4",htmlFor:"complaint_type",children:"Complaint Type"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"complaint_type",type:"text",placeholder:"Complaint Type",...d("complaint_type")}),m.complaint_type&&e.jsx("p",{className:"text-red-500",children:m.complaint_type.message})]}),e.jsx(U,{onCancel:s.toggleModal})]})]})})},me=F().shape({complaint_type:k().required("complaint_type is required"),status:k().test("not-select","Please select an Status",s=>s!==""&&s!=="Status")}),xe=s=>{const{comptId:d}=s,m=sessionStorage.getItem("token"),{register:p,formState:{errors:o},handleSubmit:h,watch:u,setValue:n}=L({resolver:O(me),mode:"all"});a.useEffect(()=>{(async()=>{try{const i=await j.get(`${b}/complainttype/getbyid?compliant_type_id=${d}`,{headers:{Authorization:`Bearer ${m}`}}),r=q(i.data.data);n("complaint_type",r.complaint_type),n("status",r.status)}catch(i){console.error("Error fetching data",i)}})()},[d,n]);const x=async c=>{const i={...c};try{const r=await j.post(`${b}/complainttype/update?compliant_type_id=${d}`,i,{headers:{Authorization:`Bearer ${m}`}});r.status===200?(C.success(" created Successfully"),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",r),C.error("Failed to Upload"))}catch(r){console.error("Error in posting data",r)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[330px]  font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Edit Complaint Type"})}),e.jsxs("form",{onSubmit:h(x),children:[e.jsxs("div",{className:"mx-6 my-4",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-4",htmlFor:"complaint_type",children:"Complaint Type"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"complaint_type",type:"text",placeholder:"Complaint Type",...p("complaint_type")}),o.complaint_type&&e.jsx("p",{className:"text-red-500",children:o.complaint_type.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:" grid grid-cols-3 mx-10 my-4",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...p("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]})]}),o.status&&e.jsx("p",{className:"text-red-500 text-xs text-center -mt-2 mb-2 ",children:o.status.message})]}),e.jsx(U,{onCancel:s.toggleModal})]})]})})},we=({permissions:s})=>{const d=s==null?void 0:s.includes("create"),m=s==null?void 0:s.includes("edit"),p=s==null?void 0:s.includes("delete"),[o,h]=a.useState(!1),[u,n]=a.useState(!1),[x,c]=a.useState(null),[i,r]=a.useState(!1),[V,D]=a.useState(null),[w,R]=a.useState(""),[N,H]=a.useState(1),[y]=a.useState(8),[I,G]=a.useState(1),[pe,J]=a.useState([]),[M,K]=a.useState([]),[$,Q]=a.useState(null),A=sessionStorage.getItem("token"),_=t=>{Q($===t?null:t)},W=t=>$===t;a.useEffect(()=>{S()},[w,N]);const X=t=>{t>0&&t<=I&&H(t)},S=()=>{j.get(`${b}/complainttype/get`,{headers:{Authorization:`Bearer ${A}`}}).then(t=>{const l=q(t.data.data);K(l);const T=l.filter(ae=>Object.values(ae).some(le=>le.toString().toLowerCase().includes(w.toLowerCase())));G(Math.ceil(T.length/y));const z=N*y,se=z-y;J(T.slice(se,z))}).catch(t=>{console.error(t)})},Y=()=>{h(!o)},Z=()=>{n(!u),c(null)},E=()=>{r(!i),D(null)},v=N*y,g=v-y,P=M.filter(t=>Object.values(t).some(l=>l.toString().toLowerCase().includes(w.toLowerCase()))),ee=P.slice().reverse().slice(g,v),te=async()=>{try{await j.delete(`${b}/complainttype/delete?compliant_type_id=${V}`,{headers:{Authorization:`Bearer ${A}`}}),E(),S(),toast.success("Deleted successfully")}catch{toast.error("Failed to delete")}};return e.jsxs(a.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen mt-10",children:[e.jsx(ce,{title:"Complaint Type",hasCreatePermission:d,onClick:()=>h(!0),searchValue:w,setSearchValue:R}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3 h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto  no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font- whitespace-nowrap",children:["Complaint Type",e.jsx(f,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font- whitespace-nowrap",children:["Status",e.jsx(f,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedBy ",e.jsx(f,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedAt ",e.jsx(f,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["UpdatedAt ",e.jsx(f,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"mx-1.5 my-2 font-semibold font-lexend whitespace-nowrap text-center",children:"Action"})})]})}),e.jsx("tbody",{children:ee.map((t,l)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("p",{className:" mx-3 my-2 font-lexend text-center whitespace-nowrap text-sm text-gray-700",children:g+l+1<10?`0${g+l+1}`:g+l+1})}),e.jsx("td",{children:e.jsx("p",{className:"mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm capitalize text-gray-700",children:t.complaint_type})}),e.jsx("td",{children:e.jsx("p",{className:"mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:B(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:"text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm capitalize text-gray-700",children:B(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(re,{onClick:()=>_(l)}),W(l)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[m&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{n(!0),c(t.compliant_type_id),_()},children:"Edit"}),p&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{r(!0),D(t.compliant_type_id),_()},children:"Delete"})]})]})})]},l))})]})})}),e.jsx("div",{className:" my-3 mb-5 mx-7",children:e.jsx(oe,{Length:M.length,currentPage:N,totalPages:I,firstIndex:g,lastIndex:v,paginate:X,hasNextPage:v>=P.length})})]})}),o&&e.jsx(de,{toggleModal:Y,handlerefresh:S}),u&&e.jsx(xe,{toggleModal:Z,handlerefresh:S,comptId:x}),i&&e.jsx(ne,{toggleDeleteModal:E,delete:te})]})};export{we as default};
