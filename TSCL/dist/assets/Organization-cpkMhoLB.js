import{i as X,k as U,l as Z,o as ee,j as e,b as k,A as S,B as u,r,d as te,I as we,F as Q,m as W,n as ve}from"./index-BcYsGqVu.js";import{R as I}from"./index-D7OJULEB.js";import{D as Ne}from"./DeleteModal-CGzHCWo0.js";import{P as ke,a as Se}from"./index-1Cs2earB.js";import{a as _e}from"./index-D_-LWkAi.js";import{E as De}from"./jspdf.plugin.autotable-doWDoFvS.js";const Oe=X().shape({org_name:U().required("Organization is required")}),ze=s=>{const{register:m,formState:{errors:j},handleSubmit:w,watch:p}=Z({resolver:ee(Oe),mode:"all"}),v=async _=>{const h=sessionStorage.getItem("token"),N={..._,status:"active",created_by_user:sessionStorage.getItem("name")};try{const i=await k.post(`${S}/organization/post`,N,{headers:{Authorization:`Bearer ${h}`}});i.status===200?(u.success("Org created Successfully"),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",i),u.error("Failed to Upload"))}catch(i){console.error("Error in posting data",i)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[358px]  font-lexend m-2 ",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Add Organization"})}),e.jsxs("form",{onSubmit:w(v),children:[e.jsxs("div",{className:"mx-6 my-10",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-4",htmlFor:"org_name",children:"Organization Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",type:"text",placeholder:" Organization Name",...m("org_name")}),j.org_name&&e.jsx("p",{className:"text-red-500",children:j.org_name.message})]}),e.jsxs("div",{className:"flex justify-end  mx-10 gap-5 ",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:s.toggleModal,children:"cancel"}),e.jsx("button",{className:" text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",type:"submit",children:"Save"})]})]})]})})},Ce=X().shape({org_name:U().required("Organization is required"),status:U().test("not-select","Please select an Status",s=>s!==""&&s!=="Status")}),Pe=s=>{const{orgId:m}=s,j=sessionStorage.getItem("token"),{register:w,formState:{errors:p},handleSubmit:v,watch:_,setValue:h}=Z({resolver:ee(Ce),mode:"all"});r.useEffect(()=>{(async()=>{try{const g=await k.get(`${S}/organization/getbyid?org_id=${m}`,{headers:{Authorization:`Bearer ${j}`}}),b=te(g.data.data);h("org_name",b.org_name),h("status",b.status)}catch(g){console.error("Error fetching data",g)}})()},[m,h]);const N=async i=>{const g=sessionStorage.getItem("token"),b={...i};try{const f=await k.post(`${S}/organization/update?org_id=${m}`,b,{headers:{Authorization:`Bearer ${g}`}});f.status===200?(u.success("Org Updated Successfully"),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",f),u.error("Failed to Upload"))}catch(f){console.error("Error in posting data",f)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsxs("div",{className:"bg-white w-[522px] h-[358px]  font-lexend m-2 ",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-10 pb-2",children:"Edit Organization"})}),e.jsxs("form",{onSubmit:v(N),children:[e.jsxs("div",{className:"mx-8 my-6",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-4",htmlFor:"org_name",children:"Organization Name"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",type:"text",placeholder:" Organization Name",...w("org_name")}),p.org_name&&e.jsx("p",{className:"text-red-500",children:p.org_name.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:" grid grid-cols-3 mx-10 my-8",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...w("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]})]}),p.status&&e.jsx("p",{className:"text-red-500 text-xs text-center -mt-4 mb-2 ",children:p.status.message})]}),e.jsxs("div",{className:"flex justify-end  mx-10 gap-5 ",children:[e.jsx("div",{className:"border border-primary text-primary bg-none font-lexend rounded-3xl px-5 py-1.5",onClick:s.toggleModal,children:"cancel"}),e.jsx("button",{className:" text-white bg-primary font-lexend rounded-3xl px-5 py-1.5",type:"submit",children:"Save"})]})]})]})})},Ie=`org_name,status,created_by_user
organization,active,admin`,Re=({permissions:s})=>{const m=s==null?void 0:s.includes("create"),j=s==null?void 0:s.includes("edit"),w=s==null?void 0:s.includes("delete"),p=s==null?void 0:s.includes("download"),[v,_]=r.useState(!1),[h,N]=r.useState(!1),[i,g]=r.useState(null),[b,f]=r.useState(!1),[F,L]=r.useState(null),[M,ae]=r.useState(""),[o,se]=r.useState(1),[D]=r.useState(8),[O,re]=r.useState(1),[Me,ne]=r.useState([]),[d,R]=r.useState([]),[T,le]=r.useState(null),V=sessionStorage.getItem("token"),[oe,q]=r.useState(null),[H,Y]=r.useState("Bulk Upload"),[$,ce]=r.useState(null),B=t=>{le(T===t?null:t)},ie=t=>T===t;r.useEffect(()=>{C()},[M,o]);const z=t=>{t>0&&t<=O&&se(t)},C=()=>{k.get(`${S}/organization/get`,{headers:{Authorization:`Bearer ${V}`}}).then(t=>{const a=te(t.data.data);R(a);const l=a.filter(n=>Object.values(n).some(c=>c.toString().toLowerCase().includes(M.toLowerCase())));re(Math.ceil(l.length/D));const x=o*D,y=x-D;ne(l.slice(y,x))}).catch(t=>{console.error(t)})},de=()=>{_(!v)},xe=()=>{N(!h),g(null)},G=()=>{f(!b),L(null)},E=o*D,P=E-D,J=d.filter(t=>Object.values(t).some(a=>a.toString().toLowerCase().includes(M.toLowerCase()))),me=J.slice().reverse().slice(P,E),he=async()=>{try{await k.delete(`${S}/organization/delete?org_id=${F}`,{headers:{Authorization:`Bearer ${V}`}}),G(),C(),R(d.filter(t=>d.org_id!==F)),u.success("Deleted successfully")}catch{u.error("Failed to delete")}},ge=t=>{q(t.target.files[0]),Y("Upload")},ue=()=>{H==="Bulk Upload"?document.getElementById("fileInput").click():pe(oe)},pe=async t=>{try{const a=new FormData;a.append("file",t),(await k.post(`${S}/organization/uploadcsv`,a,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(Y("Bulk Upload"),q(null),C(),u.success("Data Uploaded Successfully")):u.error("Data failed to Upload")}catch(a){console.log(a)}},be=t=>{ce(t.target.value)},K=async t=>{if(t==="csv"){const a=d.map(c=>({org_id:c.org_id,org_name:c.org_name,status:c.status,created_by_user:c.created_by_user})),l=[Object.keys(a[0]).join(","),...a.map(c=>Object.values(c).join(","))].join(`
`),x=new Blob([l],{type:"text/csv;charset=utf-8;"}),y=window.URL.createObjectURL(x),n=document.createElement("a");n.setAttribute("href",y),n.setAttribute("download","Organization_data.csv"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}else if(t==="pdf")try{const l=Math.ceil(d.length/30),x=new De("l","mm","a4");let y=0;for(let n=1;n<=l;n++){const c=(n-1)*30,ye=Math.min(c+30,d.length),je=d.slice(c,ye).map(A=>[A.org_id,A.org_name,A.status,A.created_by_user]);x.text(`Page ${n}`,10,y+10),x.autoTable({startY:y+15,head:[["OrgID","OrgName","Status","createdBy"]],body:je,theme:"striped"}),n<l&&(x.addPage(),y=10)}x.save("Organization_data.pdf")}catch(a){console.error("Error exporting data:",a)}},fe=()=>{const t=new Blob([Ie],{type:"text/csv"}),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download="bulkupload_template.csv",l.click(),URL.revokeObjectURL(a)};return e.jsxs(r.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen ",children:[e.jsxs("div",{className:"flex flex-row md:justify-end gap-2 p-2 mt-3 mx-8 flex-wrap items-center",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-white py-2 px-3 rounded-full",children:[e.jsx(we,{className:"text-xl"}),e.jsx("input",{type:"search",className:"outline-none bg-transparent text-base",placeholder:"Search Organization",value:M,onChange:t=>ae(t.target.value)})]}),m&&e.jsxs("div",{className:"relative text-center   hover:text-white py-1.5 rounded-full",children:[e.jsx("input",{type:"file",id:"fileInput",className:"hidden",onChange:ge,accept:".csv"}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border-primary border-2 font-normal text-base w-36 py-1.5  rounded-full text-primary hover:text-white hover:bg-primary  ",onClick:ue,children:[e.jsx(Q,{}),H]})]}),p&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("form",{children:e.jsxs("select",{className:"block w-full py-2 px-2  text-sm border-2 text-gray-400  border-gray-300 rounded-full bg-gray-50 outline-none",onChange:be,children:[e.jsx("option",{hidden:!0,children:"Download"}),e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"pdf",children:"PDF"})]})}),$===null&&e.jsx(_e,{className:"text-2xl text-gray-500"}),$==="csv"&&e.jsx(ke,{className:"text-3xl text-gray-500",onClick:()=>K("csv")}),$==="pdf"&&e.jsx(Se,{className:"text-3xl text-gray-500",onClick:()=>K("pdf")})]})]}),e.jsxs("div",{className:"flex flex-row  gap-1 justify-between items-center my-2 mx-8 flex-wrap",children:[e.jsxs("h1",{className:"md:text-xl text-lg font-medium whitespace-nowrap",children:[" ","Organization"]}),m&&e.jsxs("button",{className:"flex flex-row  gap-2  font-lexend items-center border-2 bg-blue-500 text-white rounded-full py-2 px-3 justify-between mb-2 md:text-base text-sm",onClick:()=>_(!0),children:[e.jsx(Q,{})," Add Organization"]})]}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar my-3",children:e.jsxs("table",{className:"w-full  ",children:[e.jsx("thead",{className:" border-b-2 border-gray-300",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Org Name ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Status ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedBy ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedAt ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Last UpdatedAt ",e.jsx(I,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-start mx-1.5 my-3 font-semibold font-lexend",children:"Action"})})]})}),e.jsx("tbody",{children:me.map((t,a)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center",children:P+a+1<10?`0${P+a+1}`:P+a+1})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"capitalize mx-1.5 my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.org_name})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2  font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800 ",children:W(t.createdAt)})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800",children:W(t.updatedAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(ve,{onClick:()=>B(a)}),ie(a)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[j&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{N(!0),g(t.org_id),B()},children:"Edit"}),w&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{f(!0),L(t.org_id),B()},children:"Delete"})]})]})})]},a))})]})})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"bg-primary px-3 py-2 rounded-full text-white text-sm font-alegerya",onClick:fe,children:"Bulk Upload Template"})}),e.jsxs("nav",{className:"flex items-center flex-column flex-wrap md:flex-row md:justify-between justify-center pt-4","aria-label":"Table navigation",children:[e.jsxs("span",{className:"text-sm font-normal text-gray-700 mb-4 md:mb-0 block w-full md:inline md:w-auto text-center font-alegerya",children:["Showing"," ",e.jsxs("span",{className:"text-gray-700",children:[P+1," to ",Math.min(E,d.length)]})," ","of"," ",e.jsxs("span",{className:"text-gray-900",children:[d.length," entries"]})]}),e.jsxs("ul",{className:"inline-flex -space-x-px rtl:space-x-reverse text-sm h-8 font-alegerya",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>z(1),disabled:o===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-s-lg hover:bg-paginate-bg hover:text-primary-hover",children:"<<"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>z(o-1),disabled:o===1,className:"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Back"})}),Array.from({length:O},(t,a)=>a+1).slice(Math.max(0,o-2),Math.min(O,o+1)).map(t=>e.jsx("li",{children:e.jsx("button",{onClick:()=>z(t),className:`flex items-center justify-center px-3 h-8 leading-tight border border-paginate-br hover:text-white hover:bg-primary ${o===t?"bg-primary text-white":"bg-white text-black"}`,children:t})},t)),e.jsx("li",{children:e.jsx("button",{onClick:()=>z(o+1),disabled:E>=J.length,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br hover:bg-paginate-bg hover:text-primary-hover",children:"Next"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>z(O),disabled:o===O,className:"flex items-center justify-center px-3 h-8 leading-tight text-primary bg-paginate-bg border border-paginate-br rounded-e-lg hover:bg-paginate-bg hover:text-primary-hover",children:">>"})})]})]})]})]})}),v&&e.jsx(ze,{toggleModal:de,handlerefresh:C}),h&&e.jsx(Pe,{toggleModal:xe,handlerefresh:C,orgId:i}),b&&e.jsx(Ne,{toggleDeleteModal:G,delete:he})]})};export{Re as default};
