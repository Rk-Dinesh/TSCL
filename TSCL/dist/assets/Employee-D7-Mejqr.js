import{i as X,k as c,r as n,l as Z,o as ee,j as e,b as D,A as _,B as w,d as L,n as Ee}from"./index-KlxDuXca.js";import{R as S,P as ke}from"./Pagination-CZoS4CI6.js";import{D as Se}from"./DeleteModal-Bq2aEtZp.js";import{S as Pe,D as Ie,E as Ce}from"./DocumentDownload-Cf_kB8s3.js";import{S as te}from"./SavaCancel-DnY9KWLv.js";import{F as Be,B as Fe}from"./FileUploadButton-Bc1PelCC.js";import{H as Ae}from"./HeaderButton-D4Lkrp4E.js";import"./index-BebfzzXM.js";import"./index-BKjO-751.js";import"./index-D_Jj7K4f.js";const qe=X().shape({emp_name:c().trim().required("Employee Name is required"),dept_name:c().required("Department is required"),phone:c().test("len","Phone Number must be 10 characters",s=>s.length===10).required("Phone Number is required"),email:c().email("Invalid Email Id").required("Email Id is required"),address:c().required("Address is required"),dob:c().required("DOB is required"),pincode:c().test("len","Pincode must be 6 characters",s=>s.length===6).required("Pincode is required"),designation:c().test("not-select","Please select a Designation",s=>s!==""&&s!=="Designation")}),$e=s=>{const{ExistingDesignation:N,ExistingDept:P}=s,[v,I]=n.useState(""),{register:h,formState:{errors:l},handleSubmit:E}=Z({resolver:ee(qe),mode:"all"}),C=r=>{const m=r.target.value,d=N.find(b=>b.designation===m);I(d.desgination_id)},A=async r=>{const m={...r,status:"active",created_by_user:sessionStorage.getItem("name"),designation_id:v},d=sessionStorage.getItem("token");try{const b=await D.post(`${_}/employee/post`,m,{headers:{Authorization:`Bearer ${d}`}});b.status===200?(w.success(b.data.message),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",b),w.error("Failed to Upload"))}catch(b){console.error("Error in posting data",b)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center",children:e.jsx("div",{className:"bg-white w-fit h-fit font-lexend m-2",children:e.jsxs("form",{onSubmit:E(A),children:[e.jsxs("div",{className:"border-b-2 border-gray-300 mx-10 my-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 col-span-1 whitespace-nowrap",htmlFor:"emp_name",children:"Name:"}),e.jsx("input",{type:"text",id:"emp_name",className:"mx-2 font-lexend px-2 text-sm text-end outline-none col-span-2",placeholder:"Employee Name",...h("emp_name")})]}),l.emp_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:l.emp_name.message})]}),e.jsxs("div",{className:"flex flex-col gap-3 mx-10 my-1",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-2",htmlFor:"dept_name",children:"Department:"}),e.jsxs("select",{className:"text-sm text-black border border-gray-900 rounded-lg border-none outline-none",id:"dept_name",...h("dept_name"),children:[e.jsx("option",{value:"",children:"Department"}),P.map(r=>e.jsx("option",{value:r.dept_name,children:r.dept_name},r.dept_id))]})]}),l.dept_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:l.dept_name.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"phone",children:"Phone:"}),e.jsx("input",{type:"text",id:"phone",className:"w-6/5 text-end outline-none col-span-2",placeholder:"Phone Number",...h("phone")})]}),l.phone&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:l.phone.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"email",children:"Email Id:"}),e.jsx("input",{type:"email",id:"email",className:"text-end outline-none col-span-2",placeholder:"abc@gmail.com",...h("email")})]}),l.email&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:l.email.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"address",children:"Address:"}),e.jsx("input",{type:"text",id:"address",className:"text-end outline-none col-span-2",placeholder:"Address",...h("address")})]}),l.address&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:l.address.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"pincode",children:"Pincode:"}),e.jsx("input",{type:"text",id:"pincode",className:"text-end outline-none col-span-2",placeholder:"Pincode",...h("pincode")})]}),l.pincode&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:l.pincode.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"dob",children:"Date of Birth :"}),e.jsx("input",{type:"text",id:"dob",className:"text-end outline-none col-span-2",placeholder:"DOB",...h("dob")})]}),l.dob&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:l.dob.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-2",htmlFor:"designation",children:"Desgination :"}),e.jsxs("select",{className:"text-sm text-black border border-gray-900 rounded-lg border-none outline-none",id:"designation",...h("designation"),onChange:C,children:[e.jsx("option",{value:"",children:"Designation"}),N.map(r=>e.jsx("option",{value:r.designation,children:r.designation},r.designation_id))]})]}),l.designation&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:l.designation.message})]})]}),e.jsx("div",{className:"py-6",children:e.jsx(te,{onCancel:s.toggleModal})})]})})})},Me=X().shape({emp_name:c().trim().required("Employee Name is required"),dept_name:c().required("Department is required"),address:c().required("Address is required"),dob:c().required("DOB is required"),pincode:c().test("len","Pincode must be 6 characters",s=>s.length===6).required("Pincode is required"),designation:c().test("not-select","Please select a Designation",s=>s!==""&&s!=="Designation"),status:c().test("not-select","Please select an Status",s=>s!==""&&s!=="Status")}),Ue=s=>{const{ExistingDesignation:N,ExistingDept:P,adminId:v}=s,[I,h]=n.useState(null),[l,E]=n.useState(null),[C,A]=n.useState(null),r=sessionStorage.getItem("token"),{register:m,formState:{errors:d},handleSubmit:b,setValue:g,watch:R}=Z({resolver:ee(Me),mode:"all"});n.useEffect(()=>{(async()=>{try{const u=await D.get(`${_}/employee/getbyid?emp_id=${v}`,{headers:{Authorization:`Bearer ${r}`}}),i=L(u.data.data);g("emp_name",i.emp_name),g("dept_name",i.dept_name),h(i.dept_name),g("address",i.address),g("pincode",i.pincode),g("dob",i.dob),E(i.designation),g("designation_id",i.designation_id),g("designation",i.designation),g("status",i.status)}catch(u){console.error("Error fetching data",u)}})()},[v,g]);const T=x=>{const u=x.target.value,i=N.find(B=>B.designation===u);A(i.desgination_id)},U=async x=>{const u={...x,designation_id:C};try{const i=await D.post(`${_}/employee/update?emp_id=${v}`,u,{headers:{Authorization:`Bearer ${r}`}});i.status===200?(w.success(i.data.message),h(null),E(null),s.toggleModal(),s.handlerefresh()):(console.error("Error in posting data",i),w.error("Failed to Upload"))}catch(i){console.error("Error in posting data",i)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex  justify-center items-center  ",children:e.jsx("div",{className:"bg-white w-fit h-fit  font-lexend m-2",children:e.jsxs("form",{onSubmit:b(U),children:[e.jsxs("div",{className:"border-b-2 border-gray-300 mx-10 my-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"block text-black text-lg font-medium mb-2 col-span-1 whitespace-nowrap",htmlFor:"emp_name",children:"Name:"}),e.jsx("input",{type:"text",id:"emp_name",className:"mx-2 font-lexend px-2 text-sm text-end outline-none col-span-2",placeholder:"Employee Name",...m("emp_name")})]}),d.emp_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.emp_name.message})]}),e.jsxs("div",{className:"flex flex-col gap-3 mx-10 my-1",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-2",htmlFor:"dept_name",children:"Department:"}),e.jsxs("select",{className:"text-sm text-black border border-gray-900 rounded-lg border-none outline-none",id:"dept_name",...m("dept_name"),children:[e.jsx("option",{value:I,children:I}),P.map(x=>e.jsx("option",{value:x.dept_name,children:x.dept_name},x.dept_id))]})]}),d.dept_name&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.dept_name.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"address",children:"Address:"}),e.jsx("input",{type:"text",id:"address",className:"text-end outline-none col-span-2",placeholder:"Address",...m("address")})]}),d.address&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.address.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"pincode",children:"Pincode:"}),e.jsx("input",{type:"text",id:"pincode",className:"text-end outline-none col-span-2",placeholder:"Pincode",...m("pincode")})]}),d.pincode&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.pincode.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-1",htmlFor:"dob",children:"Date of Birth :"}),e.jsx("input",{type:"text",id:"dob",className:"text-end outline-none col-span-2",placeholder:"DOB",...m("dob")})]}),d.dob&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.dob.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3",children:[e.jsx("label",{className:"text-black text-lg font-medium mb-2 col-span-2",htmlFor:"designation",children:"Desgination :"}),e.jsxs("select",{className:"text-sm text-black border border-gray-900 rounded-lg border-none outline-none",id:"designation",...m("designation"),onChange:T,children:[e.jsx("option",{value:l,children:l}),N.map(x=>e.jsx("option",{value:x.designation,children:x.designation},x.designation_id))]})]}),d.designation&&e.jsx("p",{className:"text-red-500 text-xs text-end ",children:d.designation.message})]}),e.jsxs("div",{className:" grid grid-cols-3 gap-3 ",children:[e.jsx("label",{className:" text-black text-lg font-medium mb-2 col-span-2",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...m("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),d.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:d.status.message})]})]}),e.jsx("div",{className:"py-6",children:e.jsx(te,{onCancel:s.toggleModal})})]})})})},Oe=`emp_name,designation_id,designation,dept_name,phone,email,address,pincode,status,created_by_user
name,DE***,designation,Department,1234567890,abc@gmail.com,address,123456,active,admin`,Xe=({permissions:s})=>{const[N,P]=n.useState(!1),v=s==null?void 0:s.includes("create"),I=s==null?void 0:s.includes("edit"),h=s==null?void 0:s.includes("delete"),l=s==null?void 0:s.includes("download"),[E,C]=n.useState(!1),[A,r]=n.useState(null),[m,d]=n.useState(!1),[b,g]=n.useState(null),[R,T]=n.useState(null),[U,x]=n.useState(null),[u,i]=n.useState(""),[B,se]=n.useState(1),[q]=n.useState(8),[H,ae]=n.useState(1),[ze,ne]=n.useState([]),[F,le]=n.useState([]),[Y,de]=n.useState(null),O=sessionStorage.getItem("token"),[ie,G]=n.useState(null),[J,K]=n.useState("Bulk Upload"),[oe,re]=n.useState(null),V=t=>{de(Y===t?null:t)},ce=t=>Y===t;n.useEffect(()=>{$(),he(),ge()},[u,B]);const me=t=>{t>0&&t<=H&&se(t)},$=()=>{D.get(`${_}/employee/get`,{headers:{Authorization:`Bearer ${O}`}}).then(t=>{const a=L(t.data.data);le(a);const j=a.filter(p=>Object.values(p).some(o=>o.toString().toLowerCase().includes(u.toLowerCase())));ae(Math.ceil(j.length/q));const y=B*q,k=y-q;ne(j.slice(k,y))}).catch(t=>{console.error(t)})},xe=()=>{P(!N)},pe=()=>{C(!E),r(null)},Q=()=>{d(!m),g(null)},he=async()=>{try{const t=await D.get(`${_}/designation/getactive`,{headers:{Authorization:`Bearer ${O}`}}),a=L(t.data.data);T(a)}catch(t){console.error("Error fetching existing Roles:",t)}},ge=async()=>{try{const t=await D.get(`${_}/department/getactive`,{headers:{Authorization:`Bearer ${O}`}}),a=L(t.data.data);x(a)}catch(t){console.error("Error fetching existing Department:",t)}},z=B*q,M=z-q,W=F.filter(t=>Object.values(t).some(a=>a.toString().toLowerCase().includes(u.toLowerCase()))),ue=W.slice().reverse().slice(M,z),je=async()=>{try{await D.delete(`${_}/employee/delete?emp_id=${b}`,{headers:{Authorization:`Bearer ${O}`}}),Q(),$(),w.success("Deleted successfully")}catch{w.error("Failed to delete")}},be=t=>{G(t.target.files[0]),K("Upload")},fe=()=>{J==="Bulk Upload"?document.getElementById("fileInput").click():ye(ie)},ye=async t=>{try{const a=new FormData;a.append("file",t),(await D.post(`${_}/user/uploadcsv`,a,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(K("Bulk Upload"),G(null),$(),w.success("Data Uploaded Successfully")):w.error("Data failed to Upload")}catch(a){console.log(a)}},Ne=t=>{re(t.target.value)},ve=async t=>{if(t==="csv"){const a=F.map(o=>({emp_id:o.emp_id,emp_name:o.emp_name,designation_id:o.designation_id,designation:o.designation,dept_name:o.dept_name,phone:o.phone,email:o.email,address:o.address,pincode:o.pincode,status:o.status,role:o.role,created_by_user:o.created_by_user})),j=[Object.keys(a[0]).join(","),...a.map(o=>Object.values(o).join(","))].join(`
`),y=new Blob([j],{type:"text/csv;charset=utf-8;"}),k=window.URL.createObjectURL(y),p=document.createElement("a");p.setAttribute("href",k),p.setAttribute("download","Employee_data.csv"),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p)}else if(t==="pdf")try{const j=Math.ceil(F.length/30),y=new Ce("l","mm","a4");let k=0;for(let p=1;p<=j;p++){const o=(p-1)*30,_e=Math.min(o+30,F.length),we=F.slice(o,_e).map(f=>[f.emp_id,f.emp_name,f.designation,f.dept_name,f.phone,f.email,f.address,f.pincode,f.status,f.created_by_user]);y.text(`Page ${p}`,10,k+10),y.autoTable({startY:k+15,head:[["Emp_Id","Emp_Name","Designation","Dept_Name","Phone","Email","Address","Pincode","Status","CreatedBy"]],body:we,theme:"striped"}),p<j&&(y.addPage(),k=10)}y.save("Employee_data.pdf")}catch(a){console.error("Error exporting data:",a)}},De=()=>{const t=new Blob([Oe],{type:"text/csv"}),a=URL.createObjectURL(t),j=document.createElement("a");j.href=a,j.download="bulkupload_template.csv",j.click(),URL.revokeObjectURL(a)};return e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-3 mx-8 flex-wrap",children:[e.jsx(Pe,{value:u,onChange:t=>i(t.target.value),placeholder:"Search Employee"}),v&&e.jsx(Be,{onChange:be,buttonText:J,accept:".csv",onClick:fe}),l&&e.jsx(Ie,{selectedDoc:oe,onChange:Ne,exportData:ve})]}),e.jsx(Ae,{title:"TSCL Employee",hasCreatePermission:v,onClick:()=>P(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3  h-3/5 ",children:e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Employee Name ",e.jsx(S,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Designation",e.jsx(S,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Department",e.jsx(S,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-3  my-2 font-lexend font-semibold whitespace-nowrap",children:["Phone",e.jsx(S,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Email",e.jsx(S,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["Status",e.jsx(S,{})]})}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2 items-center justify-start mx-1  my-2 font-lexend font-semibold whitespace-nowrap",children:["CreatedBy",e.jsx(S,{})]})}),e.jsx("th",{children:e.jsx("div",{className:"mx-1 my-3 text-start font-lexend font-semibold whitespace-nowrap",children:"Action"})})]})}),e.jsx("tbody",{children:ue.map((t,a)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsxs("p",{className:"text-center text-sm mx-4 my-2 font-lexend whitespace-nowrap  text-gray-700",children:[" ",M+a+1<10?`0${M+a+1}`:M+a+1]})}),e.jsx("td",{children:e.jsx("p",{className:" mx-1  my-2 font-lexend whitespace-nowrap text-start text-sm capitalize text-gray-700",children:t.emp_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm  mx-1  my-2  font-lexend whitespace-nowrap capitalize text-gray-700",children:t.designation})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm  mx-1  my-2  font-lexend whitespace-nowrap capitalize text-gray-700",children:t.dept_name})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-3  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.phone})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.email})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"text-start text-sm mx-1  my-2 font-lexend whitespace-nowrap capitalize text-gray-700",children:t.created_by_user})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(Ee,{onClick:()=>V(a)}),ce(a)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[I&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{C(!0),r(t.emp_id),V()},children:"Edit"}),h&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{d(!0),g(t.emp_id),V()},children:"Delete"})]})]})})]},a))})]})})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx(Fe,{handleDownload:De}),e.jsx(ke,{Length:F.length,currentPage:B,totalPages:H,firstIndex:M,lastIndex:z,paginate:me,hasNextPage:z>=W.length})]})]})}),N&&e.jsx($e,{toggleModal:xe,handlerefresh:$,ExistingDesignation:R,ExistingDept:U}),E&&e.jsx(Ue,{toggleModal:pe,handlerefresh:$,ExistingDesignation:R,ExistingDept:U,adminId:A}),m&&e.jsx(Se,{toggleDeleteModal:Q,delete:je})]})};export{Xe as default};
