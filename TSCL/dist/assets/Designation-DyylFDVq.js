import{i as W,k,l as X,o as ee,j as e,b,A as y,B as N,r as n,d as R,p as ke,s as Pe,n as Ce}from"./index-KlxDuXca.js";import{R as E,P as Ee}from"./Pagination-CZoS4CI6.js";import{D as Oe}from"./DeleteModal-Bq2aEtZp.js";import{S as Be,D as Ie,E as $e}from"./DocumentDownload-Cf_kB8s3.js";import{S as te}from"./SavaCancel-DnY9KWLv.js";import{F as ze,B as Ae}from"./FileUploadButton-Bc1PelCC.js";import{H as Fe}from"./HeaderButton-D4Lkrp4E.js";import"./index-BebfzzXM.js";import"./index-BKjO-751.js";import"./index-D_Jj7K4f.js";const Ue=W().shape({org_name:k().test("not-select","Please select an Organization",a=>a!==""&&a!=="Select  Organization"),dept_name:k().test("not-select","Please select an Department",a=>a!==""&&a!=="Select  Department"),designation:k().required("Designation is required")}),Me=({ExistingOrganiZations:a,ExistingDepartments:P,toggleModal:D,handlerefresh:O})=>{const{register:p,formState:{errors:c},handleSubmit:u}=X({resolver:ee(Ue),mode:"all"}),w=async o=>{const _={...o,status:"active",created_by_user:sessionStorage.getItem("name")};try{const g=sessionStorage.getItem("token"),l=await b.post(`${y}/designation/post`,_,{headers:{Authorization:`Bearer ${g}`}});l.status===200?(N.success("Designatiom created Successfully"),D(),O()):(console.error("Error in posting data",l),N.error("Failed to Upload"))}catch(g){console.error("Error in posting data",g)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] h-[460px] font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-8 pb-2",children:"Add Desgination"})}),e.jsxs("form",{onSubmit:u(w),children:[e.jsxs("div",{className:"mx-6 my-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-3",htmlFor:"org_name",children:"Organization Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",...p("org_name"),children:[e.jsx("option",{value:"",children:"Select Organization"}),a.map(o=>e.jsx("option",{value:o.org_name,children:o.org_name},o.org_id))]}),c.org_name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:c.org_name.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"dept_name",children:"Department Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",...p("dept_name"),children:[e.jsx("option",{value:"",children:"Select Department"}),P.map(o=>e.jsx("option",{value:o.dept_name,children:o.dept_name},o.dept_id))]}),c.dept_name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:c.dept_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"designation",children:"Designation"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-2 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"designation",type:"text",placeholder:"Designation Name",...p("designation")}),c.designation&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:c.designation.message})]})]}),e.jsx(te,{onCancel:D})]})]})})},Le=W().shape({org_name:k().test("not-select","Please select an Organization",a=>a!==""&&a!=="Select  Organization"),dept_name:k().test("not-select","Please select an Department",a=>a!==""&&a!=="Select  Department"),designation:k().required("Designation is required"),status:k().test("not-select","Please select an Status",a=>a!==""&&a!=="Status")}),Re=({ExistingOrganiZations:a,ExistingDepartments:P,toggleModal:D,handlerefresh:O,desgId:p})=>{const[c,u]=n.useState(null),[w,o]=n.useState(null),_=sessionStorage.getItem("token"),{register:g,formState:{errors:l},handleSubmit:z,setValue:v,watch:T}=X({resolver:ee(Le),mode:"all"});n.useEffect(()=>{(async()=>{try{const f=await b.get(`${y}/designation/getbyid?desgination_id=${p}`,{headers:{Authorization:`Bearer ${_}`}}),d=R(f.data.data);v("org_name",d.org_name),u(d.org_name),v("dept_name",d.dept_name),o(d.dept_name),v("designation",d.designation),v("status",d.status)}catch(f){console.error("Error fetching data",f)}})()},[p,v]);const A=async r=>{const f={...r};try{const d=await b.post(`${y}/designation/update?desgination_id=${p}`,f,{headers:{Authorization:`Bearer ${_}`}});d.status===200?(N.success("Desgination Updated Successfully"),u(null),o(null),D(),O()):(console.error("Error in posting data",d),N.error("Failed to Upload"))}catch(d){console.error("Error in posting data",d)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm flex justify-center items-center",children:e.jsxs("div",{className:"bg-white w-[522px] h-[420px] font-lexend m-2",children:[e.jsx("div",{className:"border-b-2 border-gray-300 mx-10",children:e.jsx("h1",{className:"text-xl font-medium pt-6 pb-2",children:"Edit Desgination"})}),e.jsxs("form",{onSubmit:z(A),children:[e.jsxs("div",{className:"mx-6 my-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"org_name",children:"Organization Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"org_name",...g("org_name"),onChange:r=>u(r.target.value),children:[e.jsx("option",{value:c,disabled:!0,children:c}),a.map(r=>e.jsx("option",{value:r.org_name,children:r.org_name},r.org_id))]}),l.org_name&&e.jsx("p",{className:"text-red-500",children:l.org_name.message})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"dept_name",children:"Department Name"}),e.jsxs("select",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"dept_name",...g("dept_name"),onChange:r=>o(r.target.value),children:[e.jsx("option",{value:w,disabled:!0,children:w}),P.map(r=>e.jsx("option",{value:r.dept_name,children:r.dept_name},r.dept_id))]}),l.dept_name&&e.jsx("p",{className:"text-red-500",children:l.dept_name.message})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-900 text-base font-normal mb-2",htmlFor:"designation",children:"Desgination"}),e.jsx("input",{className:"appearance-none border rounded-lg w-full py-1.5 px-3 text-gray-500 leading-relaxed focus:outline-none focus:shadow-outline",id:"designation",type:"text",placeholder:"Desgination Name",...g("designation")}),l.designation&&e.jsx("p",{className:"text-red-500",children:l.designation.message})]}),e.jsxs("div",{className:" grid grid-cols-3 mx-3 my-3 ",children:[e.jsx("label",{className:" text-gray-900 text-base font-normal  col-span-1",htmlFor:"status",children:"Status:"}),e.jsxs("select",{className:"   text-sm text-black border border-gray-900 rounded-lg  border-none outline-none",id:"status",...g("status"),children:[e.jsx("option",{value:"",hidden:!0,children:"Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"InActive"})]}),l.status&&e.jsx("p",{className:"text-red-500 text-xs text-center mb-3 ",children:l.status.message})]})]}),e.jsx(te,{onCancel:D})]})]})})},Te=`designation,dept_name,org_name,status,created_by_user
Designation,Department,Organization,active,admin`,tt=({permissions:a})=>{const P=a==null?void 0:a.includes("create"),D=a==null?void 0:a.includes("edit"),O=a==null?void 0:a.includes("delete"),p=a==null?void 0:a.includes("download"),[c,u]=n.useState(!1),[w,o]=n.useState(!1),[_,g]=n.useState(!1),[l,z]=n.useState(null),[v,T]=n.useState(null),[A,r]=n.useState(null),[f,d]=n.useState(null),[F,ae]=n.useState(""),[U,se]=n.useState(1),[B]=n.useState(8),[V,ne]=n.useState(1),[qe,oe]=n.useState([]),[j,Z]=n.useState([]),[H,re]=n.useState(null),M=sessionStorage.getItem("token"),[le,Y]=n.useState(null),[G,J]=n.useState("Bulk Upload"),[ie,ce]=n.useState(null),q=t=>{re(H===t?null:t)},de=t=>H===t;n.useEffect(()=>{I(),ue(),he()},[F,U]);const me=t=>{t>0&&t<=V&&se(t)},I=()=>{b.get(`${y}/designation/get`,{headers:{Authorization:`Bearer ${M}`}}).then(t=>{const s=R(t.data.data);Z(s);const x=s.filter(i=>Object.values(i).some(m=>m.toString().toLowerCase().includes(F.toLowerCase())));ne(Math.ceil(x.length/B));const h=U*B,S=h-B;oe(x.slice(S,h))})},xe=()=>{u(!c)},ge=()=>{o(!w),T(null)},pe=()=>{u(!c)},K=()=>{g(!_),z(null)},ue=async()=>{try{const t=await b.get(`${y}/organization/getactive`,{headers:{Authorization:`Bearer ${M}`}}),s=R(t.data.data);r(s)}catch(t){console.error("Error fetching existing Organisations:",t)}},he=async()=>{try{const t=await b.get(`${y}/department/getactive`,{headers:{Authorization:`Bearer ${M}`}}),s=R(t.data.data);d(s)}catch(t){console.error("Error fetching existing Departments:",t)}},L=U*B,$=L-B,Q=j.filter(t=>Object.values(t).some(s=>s.toString().toLowerCase().includes(F.toLowerCase()))),fe=Q.slice().reverse().slice($,L),je=async()=>{try{await b.delete(`${y}/designation/delete?desgination_id=${l}`,{headers:{Authorization:`Bearer ${M}`}}),K(),I(),Z(j.filter(t=>j.desgination_id!==l)),N.success("Deleted successfully")}catch{N.error("Failed to delete")}},be=t=>{Y(t.target.files[0]),J("Upload")},ye=()=>{G==="Bulk Upload"?document.getElementById("fileInput").click():Ne(le)},Ne=async t=>{try{const s=new FormData;s.append("file",t),(await b.post(`${y}/designation/uploadcsv`,s,{headers:{"Content-Type":"multipart/form-data"}})).status===200?(J("Bulk Upload"),Y(null),I(),N.success("Data Uploaded Successfully")):N.error("Data failed to Upload")}catch(s){console.log(s)}},De=t=>{ce(t.target.value)},we=async t=>{if(t==="csv"){const s=j.map(m=>({desgination_id:m.desgination_id,designation:m.designation,dept_name:m.dept_name,org_name:m.org_name,status:m.status,created_by_user:m.created_by_user})),x=[Object.keys(s[0]).join(","),...s.map(m=>Object.values(m).join(","))].join(`
`),h=new Blob([x],{type:"text/csv;charset=utf-8;"}),S=window.URL.createObjectURL(h),i=document.createElement("a");i.setAttribute("href",S),i.setAttribute("download","Designation_data.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}else if(t==="pdf")try{const x=Math.ceil(j.length/30),h=new $e("l","mm","a4");let S=0;for(let i=1;i<=x;i++){const m=(i-1)*30,ve=Math.min(m+30,j.length),Se=j.slice(m,ve).map(C=>[C.desgination_id,C.designation,C.dept_name,C.org_name,C.status,C.created_by_user]);h.text(`Page ${i}`,10,S+10),h.autoTable({startY:S+15,head:[["Designation ID","Designation","DeptName","OrgName","Status","createdBy"]],body:Se,theme:"striped"}),i<x&&(h.addPage(),S=10)}h.save("Designation_data.pdf")}catch(s){console.error("Error exporting data:",s)}},_e=()=>{const t=new Blob([Te],{type:"text/csv"}),s=URL.createObjectURL(t),x=document.createElement("a");x.href=s,x.download="bulkupload_template.csv",x.click(),URL.revokeObjectURL(s)};return e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"  bg-blue-100 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"h-screen",children:[e.jsxs("div",{className:"flex flex-row items-center md:justify-end gap-3 p-2 mt-3 mx-8 flex-wrap",children:[e.jsx(Be,{value:F,onChange:t=>ae(t.target.value),placeholder:"Search Designation"}),P&&e.jsx(ze,{onChange:be,buttonText:G,accept:".csv",onClick:ye}),p&&e.jsx(Ie,{selectedDoc:ie,onChange:De,exportData:we})]}),e.jsx(Fe,{title:"Designation",hasCreatePermission:P,onClick:()=>u(!0)}),e.jsx("div",{className:"bg-white mx-4 rounded-lg my-3 overflow-x-auto h-3/5 no-scrollbar",children:e.jsxs("table",{className:"w-full  mt-3",children:[e.jsx("thead",{className:"",children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"py-2",children:e.jsx("p",{className:" mx-6 my-2 font-lexend font-semibold whitespace-nowrap",children:"#"})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-3 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Designation ",e.jsx(E,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-3 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Department Name ",e.jsx(E,{})]})}),e.jsx("th",{className:"",children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5 my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["Org Name ",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold  whitespace-nowrap",children:["Status ",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedBy ",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsxs("p",{className:"flex gap-2 items-center mx-1.5  my-2 font-lexend justify-start font-semibold whitespace-nowrap",children:["CreatedAt ",e.jsx(E,{})]})}),e.jsx("th",{children:e.jsx("p",{className:"text-center mx-1.5 my-3 font-semibold font-lexend  whitespace-nowrap",children:"Action"})})]})}),e.jsx("tbody",{children:fe.map((t,s)=>e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("td",{className:"",children:e.jsx("div",{className:"items-center mx-6 my-2 font-lexend whitespace-nowrap text-sm text-center text-gray-800",children:$+s+1<10?`0${$+s+1}`:$+s+1})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"capitalize mx-3 my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.designation})}),e.jsx("td",{children:e.jsxs("div",{className:"flex  gap-2 items-center justify-start mx-3 my-3  text-sm text-gray-800",children:[e.jsx("img",{src:ke,alt:"logo",className:"w-8 h-8"}),e.jsxs("p",{className:"font-lexend whitespace-nowrap capitalize   text-gray-800",children:[" ",t.dept_name]})]})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"capitalize mx-3 my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.org_name})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2 font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.status})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize mx-1.5  my-2  font-lexend text-start whitespace-nowrap text-sm text-gray-800",children:t.created_by_user})}),e.jsx("td",{children:e.jsx("p",{className:"capitalize text-start mx-1.5  my-2 font-lexend whitespace-nowrap text-sm text-gray-800 ",children:Pe(t.createdAt)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-start mx-1.5 my-3",children:[e.jsx(Ce,{onClick:()=>q(s)}),de(s)&&e.jsxs("div",{className:" bg-white shadow-md rounded-lg ml-1",children:[D&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{o(!0),T(t.desgination_id),q()},children:"Edit"}),O&&e.jsx("button",{className:"block px-3 py-1.5 text-sm text-black hover:bg-gray-200 w-full text-left",onClick:()=>{g(!0),z(t.desgination_id),q()},children:"Delete"})]})]})})]},s))})]})}),e.jsxs("div",{className:" my-3 mb-5 mx-7",children:[e.jsx(Ae,{handleDownload:_e}),e.jsx(Ee,{Length:j.length,currentPage:U,totalPages:V,firstIndex:$,lastIndex:L,paginate:me,hasNextPage:L>=Q.length})]})]})}),c&&e.jsx(Me,{toggleModal:xe,toggleCloseModal:pe,ExistingOrganiZations:A,ExistingDepartments:f,handlerefresh:I}),w&&e.jsx(Re,{toggleModal:ge,handlerefresh:I,ExistingOrganiZations:A,ExistingDepartments:f,desgId:v}),_&&e.jsx(Oe,{toggleDeleteModal:K,delete:je})]})};export{tt as default};
